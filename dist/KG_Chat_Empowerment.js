// ==UserScript==
// @name         KG_Chat_Empowerment
// @namespace    klavogonki
// @version      1.0.3
// @description  Enhance the chat abilities
// @author       Patcher
// @match        *://klavogonki.ru/g*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=klavogonki.ru
// @grant        none
// ==/UserScript==

(()=>{"use strict";var e={56:(e,n,t)=>{e.exports=function(e){var n=t.nc;n&&e.setAttribute("nonce",n)}},72:e=>{var n=[];function t(e){for(var t=-1,o=0;o<n.length;o++)if(n[o].identifier===e){t=o;break}return t}function o(e,o){for(var a={},r=[],i=0;i<e.length;i++){var l=e[i],c=o.base?l[0]+o.base:l[0],d=a[c]||0,m="".concat(c," ").concat(d);a[c]=d+1;var p=t(m),u={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)n[p].references++,n[p].updater(u);else{var g=s(u,o);o.byIndex=i,n.splice(i,0,{identifier:m,updater:g,references:1})}r.push(m)}return r}function s(e,n){var t=n.domAPI(n);t.update(e);return function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap&&n.supports===e.supports&&n.layer===e.layer)return;t.update(e=n)}else t.remove()}}e.exports=function(e,s){var a=o(e=e||[],s=s||{});return function(e){e=e||[];for(var r=0;r<a.length;r++){var i=t(a[r]);n[i].references--}for(var l=o(e,s),c=0;c<a.length;c++){var d=t(a[c]);0===n[d].references&&(n[d].updater(),n.splice(d,1))}a=l}}},113:e=>{e.exports=function(e,n){if(n.styleSheet)n.styleSheet.cssText=e;else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(e))}}},208:(e,n,t)=>{t.d(n,{A:()=>i});var o=t(601),s=t.n(o),a=t(314),r=t.n(a)()(s());r.push([e.id,'.empowerment-button {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 48px;\n  height: 48px;\n  cursor: pointer;\n  background-color: #212226;\n  border: 1px solid #45474b;\n}\n\n/* input error indication */\n.input-error {\n  transition: background-color 300ms ease-in-out;\n  background-color: #6b2f2f !important;\n}\n\n/* chat length popup on field type with dynamic movement horizontally */\n.length-field-popup {\n  position: absolute;\n  font: bold 12px Montserrat;\n  bottom: 40px;\n  transition: left 100ms ease-out;\n  height: 20px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 2px 4px;\n  margin: 2px;\n  opacity: 0;\n  border: none !important;\n}\n\n.bounce-in {\n  animation: bounceIn 500ms forwards;\n}\n\n@keyframes bounceIn {\n  0% {\n    transform: translateY(0);\n    opacity: 0;\n  }\n\n  50% {\n    transform: translateY(-10px);\n    opacity: 1;\n  }\n\n  100% {\n    transform: translateY(0);\n    opacity: 1;\n  }\n}\n\n.bounce-out {\n  animation: bounceOut 500ms forwards;\n}\n\n@keyframes bounceOut {\n  0% {\n    transform: translateY(0);\n    opacity: 1;\n  }\n\n  50% {\n    transform: translateY(-10px);\n    opacity: 1;\n  }\n\n  100% {\n    transform: translateY(0);\n    opacity: 0;\n  }\n}\n\n/* catalogs panel && personal messages panel messages anchors color */\n.chat-logs-panel .message-text a,\n.cached-messages-panel .message-text a {\n  color: burlywood !important;\n  transition: color 0.15s ease-in-out;\n}\n\n.chat-logs-panel .message-text a:hover,\n.cached-messages-panel .message-text a:hover {\n  color: lightgoldenrodyellow !important;\n}\n\n/* Empowerment panel */\n.empowerment-panel {\n  position: fixed;\n  top: 50%;\n  transform: translateY(-100%);\n  right: 15px;\n  display: flex;\n  flex-direction: column;\n  z-index: 1000;\n  gap: 0.2em;\n}\n\n/* Chat user count element */\n.participant-count {\n  filter: grayscale(100%);\n  transition: 0.2s ease-in-out;\n  font-family: \'Orbitron\', sans-serif;\n  font-size: 24px;\n  color: #83cf40;\n  background-color: #2b4317;\n  width: 48px;\n  height: 48px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  border: 1px solid #4b7328;\n  cursor: default;\n}\n\n.pulse-effect {\n  animation: pulse 500ms ease-out;\n}\n\n@keyframes pulse {\n  0% {\n    filter: brightness(1);\n  }\n\n  50% {\n    filter: brightness(1.5);\n  }\n\n  100% {\n    filter: brightness(1);\n  }\n}\n\n.shake-effect {\n  animation: shake 500ms cubic-bezier(0.36, 0.07, 0.19, 0.97) both;\n}\n\n@keyframes shake {\n  0% {\n    transform: translateX(0);\n  }\n\n  10% {\n    transform: translateX(-4px);\n  }\n\n  20% {\n    transform: translateX(6px);\n  }\n\n  30% {\n    transform: translateX(-8px);\n  }\n\n  40% {\n    transform: translateX(8px);\n  }\n\n  50% {\n    transform: translateX(-6px);\n  }\n\n  60% {\n    transform: translateX(5px);\n  }\n\n  70% {\n    transform: translateX(-3px);\n  }\n\n  80% {\n    transform: translateX(2px);\n  }\n\n  90% {\n    transform: translateX(-1px);\n  }\n\n  100% {\n    transform: translateX(0);\n  }\n}\n\n.custom-tooltip-popup {\n  position: fixed;\n  background: rgb(22, 22, 22);\n  color: rgb(222, 222, 222);\n  padding: 0.5em;\n  z-index: 1200;\n  font-size: 0.9em;\n  pointer-events: none;\n  white-space: nowrap;\n  opacity: 0;\n  transition: opacity 0.1s;\n  display: none;\n  flex-direction: column;\n  left: 0;\n  top: 0;\n  border: 1px solid rgb(60, 60, 60) !important;\n  border-radius: 4px !important;\n  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3) !important;\n}\n\n.custom-tooltip-popup .tooltip-item {\n  display: inline-flex !important;\n  align-items: center !important;\n}\n\n.custom-tooltip-popup .tooltip-action {\n  font-weight: 500 !important;\n  color: hsl(100, 50%, 50%) !important;\n}\n\n.static-chat-notification {\n  cursor: default;\n  white-space: nowrap;\n  padding: 8px;\n  display: inline-flex;\n  flex: 0 auto;\n  justify-content: center;\n  margin: 4px;\n  font-size: 1em;\n  align-items: center;\n  border-radius: 4px !important;\n}\n\n.dynamic-chat-notifications-container {\n  z-index: 1000;\n  width: 0;\n  position: fixed;\n  display: flex;\n  flex-direction: column;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  padding-top: 160px;\n}\n\n.dynamic-chat-notification {\n  cursor: default;\n  white-space: nowrap;\n  position: relative;\n  align-items: center;\n  width: fit-content;\n  display: flex;\n  margin-bottom: 0.2em;\n  padding: 8px 16px 8px 12px;\n  border-radius: 0 4px 4px 0 !important;\n  left: 0;\n  transform: translateX(-100%);\n  opacity: 1;\n  transition: transform 0.3s cubic-bezier(0.83, 0, 0.17, 1), opacity 0.3s cubic-bezier(0.83, 0, 0.17, 1);\n}\n\n/* For both (static and dynamic) notifications */\n.user-enter {\n  color: hsl(100, 50%, 50%) !important;\n  background-color: hsl(100, 50%, 10%) !important;\n  border: 1px solid hsl(100, 50%, 25%) !important;\n}\n\n.user-left {\n  color: hsl(0, 50%, 70%) !important;\n  background-color: hsl(0, 50%, 15%) !important;\n  border: 1px solid hsl(0, 50%, 40%) !important;\n}\n\n/* convertImageLinksToImage */\n.clickable-thumbnail {\n  display: flex !important;\n  opacity: 1;\n  transition: opacity 0.15s ease-in-out;\n  border: none !important;\n  max-width: 150px;\n  max-height: 150px;\n  cursor: pointer;\n  background-color: transparent;\n  margin: 6px;\n  overflow: hidden !important;\n}\n\n.clickable-thumbnail:hover {\n  opacity: 0.8;\n}\n\n.clickable-thumbnail img {\n  max-height: 100%;\n  max-width: 100%;\n  background-color: transparent;\n  object-fit: contain;\n}\n\n.scaled-thumbnail {\n  top: 50%;\n  left: 50%;\n  transform-origin: center center;\n  transform: translate(-50%, -50%) scale(1);\n  position: fixed;\n  opacity: 0;\n  z-index: 1000;\n  transform-origin: center center;\n  max-height: 90vh;\n  max-width: 90vw;\n  cursor: pointer;\n  border-radius: 0.6em !important;\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3), 0 1px 3px rgba(0, 0, 0, 0.28) !important;\n}\n\n/* convertVideoLinksToPlayer */\n.video-wrapper {\n  display: flex;\n  flex-direction: column;\n}\n\n.video-wrapper .processed-video {\n  margin-bottom: 0.2em !important;\n}\n\n.video-wrapper .youtube-info {\n  display: flex;\n  flex-direction: column;\n  margin-bottom: 0.2em;\n  font-family: "Montserrat", sans-serift;\n  font-size: 0.9em;\n  color: #8ede87;\n  font-weight: 500;\n  white-space: break-spaces;\n}\n\n.video-container,\n.youtube-thumb {\n  border-radius: 0.4em !important;\n  display: flex;\n  border: none;\n  height: 200px !important;\n  width: 356px !important\n}\n\n.youtube-thumb {\n  cursor: pointer !important;\n  object-fit: cover !important;\n}\n\n/* Dimming element */\n.dimming-background {\n  background: black;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  position: fixed;\n  opacity: 0;\n  z-index: 998;\n}\n\n/* loadProfileIntoIframe */\n.profile-iframe-container {\n  opacity: 0;\n  border: none;\n  display: flex;\n  position: fixed;\n  z-index: 1001;\n  width: 75vw;\n  min-width: 1000px;\n  height: 80vh;\n  top: 48.5vh;\n  left: 50vw;\n  transform: translate(-50%, -50%);\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08) !important;\n  border-radius: 0.6em !important;\n}\n\n.scroll-buttons-container {\n  display: flex;\n  justify-content: center;\n  grid-area: scroll;\n  flex-direction: column;\n  height: calc(100% - 1em);\n  padding: 1em;\n}\n\n.scroll-buttons-container .scroll-button {\n  margin: 0.25em 0;\n  background-color: rgba(222, 222, 222, 0.1);\n}\n\n/* Common styles for all panel header buttons */\n.large-button {\n  width: 48px;\n  height: 48px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  cursor: pointer;\n  border-radius: 0.2em !important;\n  filter: brightness(1);\n  transition: filter 0.3s ease, opacity 0.3s ease;\n}\n\n.large-button:hover {\n  filter: brightness(0.8);\n}\n\n.panel-control-buttons {\n  display: flex;\n}\n\n.panel-control-buttons>div:not(:first-child) {\n  margin-left: 0.5em;\n}\n\n/* Common background color for all panel header buttons */\n.panel-header-clear-button {\n  background-color: brown;\n}\n\n.panel-header-close-button {\n  background-color: darkolivegreen;\n}\n\n.panel-header-save-button {\n  display: none;\n  opacity: 0;\n  visibility: hidden;\n  background-color: #2f6b63;\n}\n\n.panel-header-import-button {\n  background-color: #502f6b;\n}\n\n.panel-header-export-button {\n  background-color: #2f4c6b;\n}\n\n.panel-header-copy-button,\n.panel-header-date-button {\n  background-color: steelblue;\n}\n\n.panel-header-toggle-button {\n  background-color: #144e9d;\n}\n\n.panel-header-toggle-media-messages {\n  background-color: darkslategray;\n}\n\n.toggle-mention-messages-button {\n  background-color: saddlebrown;\n}\n\n.panel-header-one-day-back-button,\n.panel-header-one-day-forward-button {\n  background-color: darkcyan;\n}\n\n.panel-header-shuffle-button {\n  background-color: darkslateblue;\n}\n\n/* New chat user list */\n#chat-general .userlist-content {\n  opacity: 0;\n}\n\n#chat-general .smile-tab {\n  position: relative;\n  z-index: 1;\n}\n\n.chat-user-list {\n  display: flex;\n  flex-direction: column;\n  position: absolute;\n  top: 20px;\n  padding-top: 8px;\n  width: 200px;\n  height: 94%;\n  overflow-y: auto;\n  overflow-x: hidden;\n}\n\n.chat-user-list [class^="rank-group"] {\n  display: flex;\n  flex-direction: column;\n}\n\n.chat-user-list [class^="user"] {\n  display: inline-flex;\n  margin: 2px 0;\n}\n\n.chat-user-list .avatar {\n  width: 24px;\n  height: 24px;\n  display: inline-flex;\n}\n\n.chat-user-list .avatar img,\n.fetched-users .avatar img {\n  border-radius: 0.2em !important;\n  transform-origin: left;\n  transition: transform 0.15s;\n}\n\n.chat-user-list .avatar img:hover,\n.fetched-users .avatar img:hover {\n  transform: scale(2);\n}\n\n.chat-user-list .name {\n  text-decoration: none;\n  display: inline-flex;\n  width: auto;\n  height: 24px;\n  line-height: 24px;\n  padding: 0 8px;\n  max-width: 124px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.chat-user-list .name:hover {\n  text-decoration: underline;\n}\n\n.chat-user-list .profile,\n.chat-user-list .tracked,\n.chat-user-list .ignored,\n.chat-user-list .moderator {\n  display: inline-flex;\n  width: 24px;\n  height: 24px;\n  justify-content: center;\n  align-items: center;\n}\n\n/* Highlight for mention words */\n.mention {\n  display: inline-flex;\n  color: #83cf40;\n  font-family: Roboto Mono, monospace;\n  font-weight: bold;\n}\n\n/* Chat popup messages */\n.popup-messages-container {\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-end;\n  align-items: start;\n  user-select: none;\n  pointer-events: none;\n  position: fixed;\n  left: 0;\n  right: 0;\n  top: 50px;\n  bottom: 0;\n}\n\n.popup-chat-message {\n  display: flex;\n  align-items: center;\n  background-color: hsl(100, 50%, 10%);\n  position: relative;\n  max-width: 70vw;\n  border-radius: 0.2em !important;\n  color: hsl(100, 50%, 50%);\n  border: 1px solid hsl(100, 50%, 25%);\n  padding: 4px;\n  margin: 6px 15vw;\n  opacity: 0;\n  transform: translateY(20px);\n  transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;\n  animation: fadeIn 0.3s ease-in-out forwards;\n}\n\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n    transform: translateY(20px);\n  }\n\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n.popup-chat-message.fade-out {\n  animation: fadeOut 0.3s ease-in-out forwards;\n}\n\n@keyframes fadeOut {\n  from {\n    opacity: 1;\n    transform: translateY(0);\n  }\n\n  to {\n    opacity: 0;\n    transform: translateY(-20px);\n  }\n}\n\n.popup-chat-message>div {\n  padding: 2px;\n  display: flex;\n  font-family: \'Montserrat\', sans-serif;\n}\n\n.popup-chat-message .time,\n.popup-chat-message .time-icon {\n  opacity: 0.7;\n}\n\n/* Empowerment voice settings (Ctrl + Alt) */\n.voice-settings {\n  position: absolute;\n  top: 65px;\n  right: 70px;\n  opacity: 0;\n  transition: opacity 0.3s ease;\n  font-family: Orbitron, sans-serif;\n}\n\n/* Basic styles for empowerment voice settings */\n.voice-value-info {\n  display: flex;\n  width: 100%;\n  justify-content: center;\n  margin-bottom: 6px;\n}\n\n/* voice speed */\n.voice-speed {\n  color: hsl(100, 50%, 50%);\n}\n\n.voice-speed-progress {\n  display: block;\n  width: 120px;\n  height: 12px;\n  background-color: hsl(90, 60%, 30%);\n}\n\n.voice-speed-progress-fill {\n  display: block;\n  height: 100%;\n  background-color: hsl(90, 60%, 50%);\n}\n\n/* voice pitch */\n.voice-pitch {\n  color: hsl(180, 60%, 50%);\n}\n\n.voice-pitch-progress {\n  display: block;\n  width: 120px;\n  height: 12px;\n  background-color: hsl(180, 60%, 30%);\n}\n\n.voice-pitch-progress-fill {\n  display: block;\n  height: 100%;\n  background-color: hsl(180, 60%, 50%);\n}\n\n/* Tablets (768px to 991px) */\n@media (max-width: 991px) {\n  .scroll-buttons-container {\n    position: absolute !important;\n    right: 0.5em !important;\n    justify-content: end !important;\n  }\n}\n\n/* Very Small Screens (up to 630px) */\n@media (max-width: 630px) {\n  .scroll-buttons-container {\n    display: none !important;\n  }\n}',""]);const i=r},314:e=>{e.exports=function(e){var n=[];return n.toString=function(){return this.map((function(n){var t="",o=void 0!==n[5];return n[4]&&(t+="@supports (".concat(n[4],") {")),n[2]&&(t+="@media ".concat(n[2]," {")),o&&(t+="@layer".concat(n[5].length>0?" ".concat(n[5]):""," {")),t+=e(n),o&&(t+="}"),n[2]&&(t+="}"),n[4]&&(t+="}"),t})).join("")},n.i=function(e,t,o,s,a){"string"==typeof e&&(e=[[null,e,void 0]]);var r={};if(o)for(var i=0;i<this.length;i++){var l=this[i][0];null!=l&&(r[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);o&&r[d[0]]||(void 0!==a&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=a),t&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=t):d[2]=t),s&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=s):d[4]="".concat(s)),n.push(d))}},n}},344:(e,n,t)=>{t.d(n,{A:()=>i});var o=t(601),s=t.n(o),a=t(314),r=t.n(a)()(s());r.push([e.id,"/* showCachePanel */\n.cached-users-panel {\n  opacity: 0;\n  background-color: #1b1b1b;\n  border-radius: 0.6em !important;\n  position: fixed;\n  top: 100px;\n  left: 50%;\n  transform: translateX(-50%);\n  width: 80vw;\n  height: 80vh;\n  z-index: 1000;\n  display: grid;\n  grid-template-columns: 1fr;\n  grid-template-rows: min-content;\n  grid-template-areas:\n    \"header header\"\n    \"cache scroll\";\n}\n\n.cached-users-panel .panel-header {\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  padding: 0.6em;\n  grid-area: header;\n}\n\n.cached-users-panel .drop-time {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-width: fit-content;\n}\n\n.cached-users-panel .drop-time-threshold-description {\n  padding: 0.6em;\n  color: #c6b209;\n}\n\n.cached-users-panel .drop-time-threshold {\n  padding: 0.6em;\n  color: lightcoral;\n  font-family: 'Roboto Mono', monospace;\n  font-size: 1.1em;\n  font-weight: bold;\n  border-radius: 0.2em !important;\n  border: 1px solid rgba(240, 128, 128, 0.20);\n  background-color: rgba(240, 128, 128, 0.05);\n  transition: filter 0.3s;\n  filter: sepia(0);\n  cursor: pointer;\n}\n\n.cached-users-panel .drop-time-threshold:hover {\n  filter: sepia(1);\n}\n\n.cached-users-panel .drop-time-expiration-description {\n  padding: 0.6em;\n  color: #d0562c;\n}\n\n.cached-users-panel .drop-time-expiration {\n  padding: 0.6em;\n  color: antiquewhite;\n  font-family: 'Roboto Mono', monospace;\n  font-size: 1.1em;\n}\n\n.cached-users-panel .search-for-cached-users {\n  width: 100%;\n  margin: 0 0.5em;\n  display: flex;\n}\n\n.cached-users-panel .cached-users-search-input {\n  outline: none;\n  height: 48px;\n  width: 100%;\n  padding: 10px;\n  font-size: 1em;\n  font-family: 'Montserrat';\n  color: bisque !important;\n  border-radius: 0.2em !important;\n  box-sizing: border-box;\n  background-color: #111;\n  border: 1px solid #222;\n}\n\n.cached-users-panel .error-message {\n  width: fit-content;\n  white-space: nowrap;\n  font-family: 'Montserrat';\n  color: lightcoral;\n}\n\n.fetch-mode-button {\n  background-color: #b2a4f9;\n}\n\n.fetch-mode-button svg {\n  stroke: darkslateblue;\n}\n\n.cache-mode-button {\n  background-color: darkslateblue;\n}\n\n.cache-mode-button svg {\n  stroke: #b2a4f9;\n}\n\n.cached-users-panel .fetched-users {\n  display: grid;\n  grid-template-rows: 1fr 1fr;\n  height: calc(100% - 0.5em);\n  overflow-y: auto;\n  grid-area: cache;\n}\n\n.cached-users-panel .users-container {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));\n  gap: 12px;\n  padding: 1em;\n  height: fit-content;\n}\n\n/* Common styles for all descriptions */\n.cached-users-panel .description {\n  color: bisque;\n  font-family: Montserrat;\n  font-size: 1em;\n  margin: 0;\n  padding: 0.4em 0.2em;\n  grid-column: 1 / -1;\n  height: fit-content;\n}\n\n/* Common styles for user container elements in cached users panel */\n.cached-users-panel .user-item {\n  display: grid;\n  grid-template-columns: auto 1fr;\n  align-items: center;\n  height: fit-content;\n  gap: 0.6em;\n  margin-bottom: 1em;\n}\n\n/* Common styles for the visits element */\n.cached-users-panel .visits {\n  margin-left: 8px;\n  padding: 4px 6px;\n  border-radius: 2px !important;\n  cursor: pointer;\n  white-space: pre;\n}\n\n/* Styling for tracked visits */\n.cached-users-panel .visits.tracked {\n  color: greenyellow;\n  background-color: darkgreen;\n  font-weight: bold;\n}\n\n/* Styling for untracked visits */\n.cached-users-panel .visits.untracked {\n  color: orange;\n  background-color: #111111;\n  font-weight: normal;\n}\n\n/* Common styles for the action log container */\n.cached-users-panel .action-log {\n  position: fixed;\n  opacity: 0;\n  padding: 8px;\n  gap: 4px;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  max-height: 85vh;\n  overflow-y: auto;\n  scrollbar-width: none;\n  overflow-x: hidden;\n  display: flex;\n  flex-wrap: wrap;\n  background-color: #111111;\n  justify-content: center;\n  border: 3px dashed #212121;\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08) !important;\n  border-radius: 0.2em !important;\n}\n\n.cached-users-panel .rank {\n  padding: 2px 0;\n}\n\n.cached-users-panel .registered {\n  color: cadetblue;\n  font-size: 12px;\n}\n\n.cached-users-panel .user-metrics {\n  display: inline-flex;\n  grid-column: span 2;\n  white-space: nowrap;\n}\n\n.cached-users-panel .user-metrics span {\n  margin-right: 0.2em !important;\n}\n\n.cached-users-panel .avatar {\n  font-size: 1.8rem;\n}\n\n.cached-users-panel .avatar img {\n  height: 24px;\n  width: 24px;\n}\n\n.cached-users-panel .login {\n  color: skyblue !important;\n  text-decoration: none;\n  font-family: 'Montserrat', sans-serif;\n  transition: color 0.3s ease;\n}\n\n.cached-users-panel .login:hover {\n  color: cornsilk !important;\n}\n\n.cache-user-count {\n  display: flex;\n  position: absolute;\n  justify-content: center;\n  align-items: center;\n  left: 0;\n  bottom: 0;\n  transform: translate(-50%, 50%);\n  z-index: 1;\n  height: 20px;\n  padding: 0 4px;\n  border-radius: 2px !important;\n  background-color: #9db380;\n  color: rgb(2, 2, 2);\n  font-size: 12px;\n  font-family: Roboto, sans-serif;\n  font-weight: bold;\n}\n\n/* Desktops (992px to 1199px) */\n@media (max-width: 1199px) {\n  .cached-users-panel {\n    width: 90vw;\n    height: 85vh;\n    min-width: unset;\n  }\n}\n\n/* Tablets (768px to 991px) */\n@media (max-width: 991px) {\n  .cached-users-panel {\n    width: 95vw;\n    height: 90vh;\n    grid-template-columns: 1fr;\n    grid-template-rows: min-content auto;\n    grid-template-areas:\n      \"header\"\n      \"cache\";\n  }\n\n  .cached-users-panel .panel-header {\n    flex-wrap: wrap;\n  }\n\n  .cached-users-panel .search-for-cached-users {\n    margin: 0.5em 0;\n    order: 1;\n  }\n\n  .cached-users-panel .users-container {\n    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));\n  }\n}\n\n/* Mobile Phones (up to 576px) */\n@media (max-width: 576px) {\n  .cached-users-panel {\n    width: 100vw;\n    height: 100vh;\n    top: 0;\n    left: 0;\n    transform: none;\n    border-radius: 0 !important;\n  }\n\n  .cached-users-panel .panel-header {\n    padding: 0.5em;\n  }\n\n  .cached-users-panel .drop-time-threshold,\n  .cached-users-panel .drop-time-expiration {\n    padding: 0.4em;\n  }\n\n  .cached-users-panel .users-container {\n    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));\n    gap: 8px;\n    padding: 0.5em;\n  }\n\n  .cached-users-panel .user-item {\n    gap: 0.4em;\n    margin-bottom: 1em;\n  }\n\n  .cached-users-panel .avatar {\n    font-size: 1.4rem;\n  }\n\n  .cached-users-panel .avatar img {\n    height: 20px;\n    width: 20px;\n  }\n\n  .cached-users-panel .login {\n    font-size: 0.9em;\n  }\n\n  .cached-users-panel .visits {\n    font-size: 0.8em;\n    padding: 2px 4px;\n  }\n\n  .cached-users-panel .registered {\n    font-size: 10px;\n  }\n\n  /* Mobile Phones (up to 520px) */\n  @media (max-width: 520px) {\n    .cached-users-panel .drop-time-threshold-description,\n    .cached-users-panel .drop-time-expiration-description {\n      display: none !important;\n    }\n  }\n\n  /* Mobile Phones (up to 320px) */\n  @media (max-width: 320px) {\n    .cached-users-panel .drop-time {\n      display: none !important;\n    }\n\n    .cached-users-panel .panel-control-buttons {\n      width: 100% !important;\n      justify-content: end !important;\n    }\n  }\n}",""]);const i=r},479:(e,n,t)=>{t.d(n,{A:()=>i});var o=t(601),s=t.n(o),a=t(314),r=t.n(a)()(s());r.push([e.id,"/* toggleHiddenMessages */\n.toggle-button-hidden {\n  background-color: hsl(0, 20%, 10%);\n  color: hsl(0, 50%, 50%);\n  border: 1px solid hsl(0, 50%, 50%);\n}\n\n.toggle-button-show {\n  background-color: hsl(90, 20%, 10%);\n  color: hsl(90, 50%, 50%);\n  border: 1px solid hsl(90, 50%, 50%);\n}\n\n.toggle-button-hide {\n  background-color: hsl(50, 20%, 10%);\n  color: hsl(50, 50%, 50%);\n  border: 1px solid hsl(50, 50%, 50%);\n}\n\n/* Chat messages manual remover */\n/* Delete button base styles */\n.delete-btn {\n  z-index: 999;\n  padding: 8px 16px;\n  background-color: hsl(0, 50%, 20%);\n  color: hsl(0, 60%, 70%);\n  border: 1px solid hsl(0, 50%, 35%);\n  transition: all 0.3s;\n  cursor: pointer;\n  filter: brightness(1);\n  border-radius: 0.2em !important;\n}\n\n.delete-btn:hover {\n  filter: brightness(1.5);\n}\n\n/* Common styles for all selected messages */\n.selected-message {\n  background-clip: padding-box !important;\n}\n\n/* message-mode */\n.selected-message.message-mode {\n  background-color: hsla(0, 50%, 50%, 0.2) !important;\n  box-shadow: inset 0px 0px 0px 1px hsl(0, 50%, 50%, 0.4) !important;\n}\n\n/* username-mode */\n.selected-message.username-mode {\n  background-color: hsla(145, 50%, 30%, 0.2) !important;\n  box-shadow: inset 0px 0px 0px 1px hsl(145, 50%, 50%, 0.4) !important;\n}\n\n/* time-mode */\n.selected-message.time-mode {\n  background-color: hsla(200, 50%, 30%, 0.2) !important;\n  box-shadow: inset 0px 0px 0px 1px hsl(200, 50%, 50%, 0.4) !important;\n}\n\n.shown-message {\n  background-color: hsla(30, 60%, 30%, 0.2) !important;\n  box-shadow: inset 0px 0px 0px 1px hsl(30, 60%, 50%, 0.4) !important;\n  background-clip: padding-box !important;\n}\n\n.hidden-message {\n  display: none;\n}\n\n/* Toggle button base styles */\n.toggle-button {\n  font: bold 0.9em 'Montserrat', sans-serif;\n  position: absolute;\n  top: 0;\n  right: 2em;\n  padding: 8px 16px;\n  transition: filter 0.3s;\n  border-radius: 0 0 0.2em 0.2em !important;\n  border-top: none;\n  min-width: 4em;\n}\n\n.toggle-button.toggle-hidden {\n  background: linear-gradient(to top, hsl(0, 50%, 20%), hsl(0, 50%, 25%));\n  color: hsl(0, 60%, 70%);\n  border-left: 1px solid hsl(0, 50%, 35%);\n  border-right: 1px solid hsl(0, 50%, 35%);\n  border-bottom: 1px solid hsl(0, 50%, 35%);\n}\n\n.toggle-button.toggle-shown {\n  background: linear-gradient(to top, hsl(30, 50%, 20%), hsl(30, 50%, 25%));\n  color: hsl(30, 60%, 70%);\n  border-left: 1px solid hsl(30, 50%, 35%);\n  border-right: 1px solid hsl(30, 50%, 35%);\n  border-bottom: 1px solid hsl(30, 50%, 35%);\n}\n\n.toggle-button:hover {\n  filter: brightness(1.5);\n}",""]);const i=r},540:e=>{e.exports=function(e){var n=document.createElement("style");return e.setAttributes(n,e.attributes),e.insert(n,e.options),n}},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var n={};e.exports=function(e,t){var o=function(e){if(void 0===n[e]){var t=document.querySelector(e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(e){t=null}n[e]=t}return n[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}},664:(e,n,t)=>{t.d(n,{A:()=>i});var o=t(601),s=t.n(o),a=t(314),r=t.n(a)()(s());r.push([e.id,'/* showSettingsPanel */\n.settings-panel {\n  opacity: 0;\n  background-color: #1b1b1b;\n  border-radius: 0.6em !important;\n  position: fixed;\n  top: 100px;\n  left: 50%;\n  transform: translateX(-50%);\n  width: 50vw;\n  height: 80vh;\n  z-index: 1000;\n  min-width: 1000px;\n  display: grid;\n  grid-template-columns: 1fr;\n  grid-template-rows: min-content;\n  grid-template-areas:\n    "header header"\n    "settings scroll";\n}\n\n.settings-panel .panel-header {\n  display: flex;\n  flex-direction: row;\n  justify-content: flex-end;\n  padding: 0.6em;\n  grid-area: header;\n}\n\n.settings-panel .settings-content-container {\n  overflow-y: auto;\n  height: calc(100% - 0.5em);\n  padding: 1em;\n  grid-area: settings;\n}\n\n.settings-panel .settings-description {\n  position: relative;\n  font: 1em Montserrat;\n  color: burlywood;\n  background-color: rgba(222, 184, 135, 0.1);\n  width: fit-content;\n  margin: 0 0 1em;\n  padding: 0.4em 0.8em;\n  border-radius: 0.4em !important;\n  left: 50%;\n  transform: translateX(-50%);\n}\n\n.settings-panel .settings-spoiler button {\n  position: relative;\n  font: 1em Montserrat;\n  color: lightgreen;\n  background-color: rgba(222, 184, 135, 0.1);\n  margin: 0 0 3em 0;\n  padding: 0.4em 0.8em;\n  border-radius: 0.4em !important;\n  left: 50%;\n  transform: translateX(-50%);\n  cursor: pointer;\n  transition: background-color 0.3s ease;\n  border: none;\n}\n\n.settings-panel .settings-spoiler button:hover {\n  background-color: rgba(222, 184, 135, 0.25);\n}\n\n.settings-panel .settings-field {\n  height: 30px;\n  max-width: 200px;\n  min-width: 150px;\n  padding: 0.4em;\n  font: 1em Montserrat;\n  font-family: Montserrat;\n  color: bisque;\n  border-radius: 0.2em !important;\n  box-sizing: border-box;\n  background-color: rgb(17, 17, 17);\n  border: 1px solid rgb(34, 34, 34);\n}\n\n.settings-panel .settings-button {\n  width: 30px;\n  height: 30px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  border-radius: 0.2em !important;\n  cursor: pointer;\n  transition: filter 0.3s;\n  filter: brightness(1);\n}\n\n.settings-panel .settings-button:hover {\n  filter: brightness(0.8);\n}\n\n/* Disabled state */\n.settings-panel .settings-button.disabled {\n  filter: grayscale(1);\n  pointer-events: none;\n  opacity: 0.5;\n}\n\n.settings-panel .settings-button {\n  width: 30px;\n  height: 30px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  border-radius: 0.2em !important;\n  cursor: pointer;\n  transition: filter 0.3s;\n}\n\n.settings-panel select {\n  height: 30px;\n  min-width: 105px;\n  max-width: 120px;\n  padding: 0.4em;\n  font: 1em Montserrat, sans-serif;\n  color: bisque !important;\n  border-radius: 0.2em !important;\n  box-sizing: border-box;\n  background-color: rgb(17, 17, 17) !important;\n  border: 1px solid rgb(34, 34, 34) !important;\n}\n\n.settings-panel option {\n  height: 30px;\n  background-color: rgb(17, 17, 17) !important;\n  color: bisque !important;\n  font-family: \'Montserrat\', sans-serif;\n}\n\n.settings-panel .remove-settings-button {\n  stroke: #ee9090;\n  background-color: #6b2f2f;\n}\n\n.settings-panel .assigned-settings-button {\n  stroke: lightsteelblue;\n  background-color: steelblue;\n}\n\n.settings-panel .add-settings-button {\n  stroke: #d190ee;\n  background-color: #502f6b;\n}\n\n.settings-panel .toggle-item {\n  display: inline-flex;\n  align-items: center;\n  gap: 1em;\n}\n\n.settings-panel .toggle-description {\n  cursor: pointer;\n  color: burlywood;\n  transition: color 0.15s ease-in-out;\n}\n\n.settings-panel .toggle-description:hover {\n  color: lightgoldenrodyellow;\n}\n\n.settings-panel .settings-container {\n  width: 100%;\n  gap: 0.4em;\n  display: inline-flex;\n  flex-wrap: wrap;\n  align-items: start;\n  margin-bottom: 4em;\n}\n\n.settings-panel .settings-toggle-container {\n  flex-direction: column;\n}\n\n.settings-panel [class$="item"] {\n  display: inline-flex;\n  gap: 0.4em;\n}\n\n/* Desktops (992px to 1199px) */\n@media (max-width: 1199px) {\n  .settings-panel {\n    width: 90vw;\n    height: 85vh;\n    min-width: unset;\n  }\n\n  .settings-panel .settings-field,\n  .settings-panel select {\n    max-width: 180px;\n  }\n}\n\n/* Tablets (768px to 991px) */\n@media (max-width: 991px) {\n  .settings-panel {\n    width: 95vw;\n    height: 90vh;\n    grid-template-columns: 1fr;\n    grid-template-rows: min-content auto;\n    grid-template-areas:\n      "header"\n      "settings";\n  }\n\n  .settings-panel .panel-header {\n    flex-wrap: wrap;\n  }\n\n  .settings-panel .settings-field,\n  .settings-panel select {\n    max-width: 160px;\n    min-width: 120px;\n  }\n\n  .settings-panel .settings-container {\n    flex-direction: column;\n    align-items: flex-start;\n  }\n}\n\n/* Mobile Phones (up to 576px) */\n@media (max-width: 576px) {\n  .settings-panel {\n    width: 100vw;\n    height: 100vh;\n    top: 0;\n    left: 0;\n    transform: none;\n    border-radius: 0 !important;\n  }\n\n  .settings-panel .settings-description,\n  .settings-panel .toggle-description {\n    font-size: 0.9em;\n  }\n\n  .settings-panel .settings-container {\n    flex-direction: column;\n    gap: 0.2em;\n    margin-bottom: 2em;\n  }\n\n  .settings-panel .toggle-item {\n    gap: 0.5em;\n  }\n\n  .settings-panel [class$="item"] {\n    gap: 0.2em;\n  }\n}',""]);const i=r},720:(e,n,t)=>{t.d(n,{A:()=>i});var o=t(601),s=t.n(o),a=t(314),r=t.n(a)()(s());r.push([e.id,'/* positionChatLogsButton */\n.chat-logs-button {\n  position: relative;\n  z-index: 1;\n}\n\n/* showChatLogsPanel */\n.chat-logs-panel {\n  opacity: 0;\n  background-color: #1b1b1b;\n  border-radius: 0.6em !important;\n  position: fixed;\n  top: 100px;\n  left: 50%;\n  transform: translateX(-50%);\n  width: 80vw;\n  height: 80vh;\n  z-index: 1000;\n  min-width: 1000px;\n  display: grid;\n  grid-template-columns: 1fr;\n  grid-template-rows: min-content;\n  grid-template-areas:\n    "header header header"\n    "messages scroll users";\n}\n\n.chat-logs-panel .panel-header {\n  display: flex;\n  flex-direction: row;\n  grid-area: header;\n  justify-content: flex-end;\n  padding: 0.6em;\n}\n\n.chat-logs-panel .panel-control-buttons {\n  display: flex;\n}\n\n.chat-logs-panel .search-for-chatlogs-messages {\n  width: 100%;\n  margin: 0 0.5em 0 0;\n  display: flex;\n}\n\n.chat-logs-panel .chatlogs-search-input {\n  outline: none;\n  height: 48px;\n  width: 100%;\n  padding: 10px;\n  font-size: 1em;\n  font-family: Montserrat;\n  color: bisque !important;\n  border-radius: 0.2em !important;\n  box-sizing: border-box;\n  background-color: #111;\n  border: 1px solid #222 !important;\n}\n\n.chat-logs-panel .chatlogs-date-input {\n  background-color: #111;\n  color: bisque;\n  border: 1px solid #222;\n  width: fit-content;\n  height: 48px;\n  padding: 10px;\n  font-size: 1em;\n  font-family: Montserrat;\n  border-radius: 0.2em !important;\n  box-sizing: border-box;\n  margin: 0 0.5em;\n}\n\n.toggle-mention-messages-counter,\n.toggle-media-messages-counter {\n  display: flex;\n  position: absolute;\n  justify-content: center;\n  align-items: center;\n  padding: 2px 4px;\n  border-radius: 2px !important;\n  font-size: 12px;\n  font-family: Roboto;\n  font-weight: bold;\n  bottom: 0px;\n  left: 0px;\n  transform: translate(-50%, 50%);\n  color: #020202;\n  pointer-events: none;\n  user-select: none;\n}\n\n.toggle-mention-messages-counter {\n  background-color: #ffa07a;\n}\n\n.toggle-media-messages-counter {\n  background-color: #71c4c4;\n}\n\n.chat-logs-panel .saved-chatlog-url {\n  color: darkseagreen !important;\n  text-decoration: none;\n  display: inline-flex;\n  padding: 0.5em;\n}\n\n.chat-logs-panel .saved-chatlog-url-title {\n  color: lightsteelblue;\n  padding: 0.5em;\n}\n\n.saved-chatlog-container {\n  display: flex;\n  flex-direction: column;\n  overflow-y: auto;\n  background-color: rgb(30, 40, 45);\n  border: 1px solid rgb(60, 70, 80) !important;\n  border-radius: 0.2em !important;\n  position: absolute;\n  padding: 0.5em;\n  height: fit-content;\n  width: max-content;\n  max-height: 400px;\n  top: calc(50px + 1em);\n  right: 0;\n}\n\n.chat-logs-panel .chat-logs-container {\n  overflow-y: auto;\n  overflow-x: hidden;\n  height: calc(100% - 0.5em);\n  padding: 1em;\n  display: flex;\n  grid-area: messages;\n  flex-direction: column;\n}\n\n.chat-logs-panel .message-item {\n  padding: 0.2em;\n  display: inline-flex;\n  cursor: pointer;\n  align-items: start;\n}\n\n.chat-logs-panel .message-time {\n  color: darkseagreen;\n  margin: 0 0.4em;\n  cursor: pointer;\n  transition: color 0.2s ease;\n  height: fit-content;\n}\n\n.chat-logs-panel .message-time:hover {\n  color: lightgreen;\n}\n\n.chat-logs-panel .message-username {\n  cursor: pointer;\n  margin: 0 0.4em;\n  height: fit-content;\n}\n\n.chat-logs-panel .message-text {\n  color: lightsteelblue;\n  margin: 0 0.4em;\n  overflow-wrap: anywhere;\n  height: fit-content;\n}\n\n.chat-logs-panel .active-users {\n  padding: 1em;\n  height: calc(100% - 1em);\n  width: fit-content;\n  overflow-y: auto;\n  overflow-x: hidden;\n  grid-area: users;\n  display: flex;\n  flex-direction: column;\n}\n\n.chat-logs-panel .active-user-item {\n  display: flex;\n  height: fit-content;\n  align-items: center;\n  justify-content: left;\n  margin: 0.2em 0;\n  cursor: pointer;\n  transition: filter 0.15s;\n}\n\n.chat-logs-panel .active-user-item:hover {\n  filter: brightness(0.8);\n}\n\n.chat-logs-panel .active-user-name {\n  padding: 0.4em;\n}\n\n.chat-logs-panel .active-user-messages-count {\n  padding: 0.4em;\n  border-radius: 0.2em !important;\n}\n\n/* Adaptivity */\n/* Desktops (992px to 1199px) */\n@media (max-width: 1199px) {\n  .chat-logs-panel {\n    width: 90vw;\n    height: 85vh;\n    min-width: unset; /* Remove min-width for flexibility */\n  }\n  \n  .chat-logs-panel .active-users {\n    width: 200px; /* Reduce width of active users panel */\n  }\n}\n\n/* Tablets (768px to 991px) */\n@media (max-width: 991px) {\n  .chat-logs-panel {\n    width: 95vw;\n    height: 90vh;\n    grid-template-columns: 1fr; /* Switch to single column */\n    grid-template-rows: min-content auto auto; /* Stack elements vertically */\n    grid-template-areas:\n      "header"\n      "messages"\n      "users";\n  }\n  \n  .chat-logs-panel .active-users {\n    width: 100%; /* Full width */\n    height: auto;\n    max-height: 200px; /* Limit height with scrolling */\n    overflow-y: auto;\n  }\n  \n  .chat-logs-panel .panel-header {\n    flex-direction: column; /* Stack header items vertically */\n    align-items: flex-start;\n  }\n  \n  .chat-logs-panel .search-for-chatlogs-messages {\n    width: 100%; /* Full width search bar */\n    margin-bottom: 0.5em;\n  }\n  \n  .chat-logs-panel .panel-control-buttons {\n    width: 100%; /* Full width for buttons */\n    justify-content: center;\n  }\n\n  .chat-logs-panel .active-users,\n  .chat-logs-panel .panel-header-toggle-button {\n    display: none !important;\n  }\n}\n\n/* Mobile phones (576px and below) */\n@media (max-width: 576px) {\n  .chat-logs-panel {\n    width: 100vw;\n    height: 100vh;\n    top: 0;\n    left: 0;\n    transform: none; /* Remove centering */\n    border-radius: 0 !important; /* Full-screen, no rounded corners */\n  }\n  \n  .chat-logs-panel .panel-header {\n    padding: 0.5em; /* Reduce padding */\n  }\n  \n  .chat-logs-panel .active-users {\n    display: none; /* Hide active users */\n  }\n  \n  .chat-logs-panel .message-item {\n    padding: 0.1em; /* Reduce message padding */\n  }\n  \n  .chat-logs-panel .message-time,\n  .chat-logs-panel .message-username,\n  .chat-logs-panel .message-text {\n    margin: 0 0.2em; /* Reduce margins */\n    font-size: 0.9em; /* Smaller text */\n  }\n\n  .chat-logs-panel .video-container,\n  .chat-logs-panel .youtube-thumb {\n    transform-origin: top left;\n    transform: scale(0.8);\n  }\n  \n  .chat-logs-panel .toggle-mention-messages-counter,\n  .chat-logs-panel .toggle-media-messages-counter {\n    font-size: 10px; /* Smaller counters */\n  }\n  \n  .chat-logs-panel .saved-chatlog-container {\n    max-height: 300px; /* Reduce height of saved chat logs */\n  }\n}',""]);const i=r},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var n=e.insertStyleElement(e);return{update:function(t){!function(e,n,t){var o="";t.supports&&(o+="@supports (".concat(t.supports,") {")),t.media&&(o+="@media ".concat(t.media," {"));var s=void 0!==t.layer;s&&(o+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),o+=t.css,s&&(o+="}"),t.media&&(o+="}"),t.supports&&(o+="}");var a=t.sourceMap;a&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),n.styleTagTransform(o,e,n.options)}(n,e,t)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)}}}},946:(e,n,t)=>{t.d(n,{A:()=>i});var o=t(601),s=t.n(o),a=t(314),r=t.n(a)()(s());r.push([e.id,'/* positionMessagesButton */\n.personal-messages-button {\n  position: relative;\n  z-index: 2;\n}\n\n.message-count {\n  display: flex;\n  position: absolute;\n  justify-content: center;\n  align-items: center;\n  height: 20px;\n  padding: 0 4px;\n  border-radius: 2px !important;\n  color: rgb(2, 2, 2);\n  font-size: 12px;\n  font-family: Roboto, sans-serif;\n  font-weight: bold;\n  bottom: 0;\n}\n\n.total-message-count {\n  left: 0;\n  transform: translate(-50%, 50%);\n  background-color: #fa8072;\n}\n\n.new-message-count {\n  right: 0;\n  transform: translate(50%, 50%);\n  background-color: #ffd700;\n}\n\n/* showMessagesPanel */\n.cached-messages-panel {\n  opacity: 0;\n  background-color: #1b1b1b;\n  border-radius: 0.6em !important;\n  position: fixed;\n  top: 100px;\n  left: 50%;\n  transform: translateX(-50%);\n  width: 50vw;\n  height: 80vh;\n  z-index: 1000;\n  min-width: 1000px;\n  display: grid;\n  grid-template-columns: 1fr;\n  grid-template-rows: min-content;\n  grid-template-areas:\n    "header header"\n    "messages scroll";\n}\n\n.panel-header {\n  display: flex;\n  flex-direction: row;\n  justify-content: flex-end;\n  /* Aligns to the right */\n  padding: 0.6em;\n  grid-area: header;\n}\n\n.search-for-personal-messages {\n  width: 100%;\n  margin: 0 0.5em 0 0;\n  display: flex;\n}\n\n.personal-messages-search-input {\n  outline: none;\n  height: 48px;\n  width: 100%;\n  padding: 10px;\n  font-size: 1em;\n  font-family: Montserrat, sans-serif;\n  color: bisque !important;\n  border-radius: 0.2em !important;\n  box-sizing: border-box;\n  background-color: #111;\n  border: 1px solid #222 !important;\n}\n\n.cached-messages-panel .messages-container {\n  overflow-y: auto;\n  height: calc(100% - 0.5em);\n  padding: 1em;\n  grid-area: messages;\n}\n\n.cached-messages-panel .date-item {\n  position: relative;\n  font: 1em Montserrat, sans-serif;\n  color: burlywood;\n  background-color: rgba(222, 184, 135, 0.1);\n  width: fit-content;\n  margin: 2em 1em 1em;\n  padding: 0.4em 0.8em;\n  text-align: center;\n  border-radius: 0.4em !important;\n  left: 50%;\n  transform: translateX(-50%);\n}\n\n.cached-messages-panel .message-item {\n  padding: 0.2em;\n}\n\n.cached-messages-panel .message-time {\n  margin: 0px 0.4em;\n  height: fit-content;\n  cursor: pointer;\n  transition: color 0.2s ease;\n}\n\n.cached-messages-panel .message-username {\n  display: inline-flex;\n  cursor: pointer;\n  margin: 0px 0.4em;\n  height: fit-content;\n}\n\n.cached-messages-panel .message-text {\n  cursor: pointer;\n  margin: 0px 0.4em;\n  height: fit-content;\n}\n\n/* Adaptivity */\n/* Desktops (992px to 1199px) */\n@media (max-width: 1199px) {\n  .cached-messages-panel {\n    width: 90vw;\n    height: 85vh;\n    min-width: unset;\n  }\n}\n\n/* Tablets (768px to 991px) */\n@media (max-width: 991px) {\n  .cached-messages-panel {\n    width: 95vw;\n    height: 90vh;\n    grid-template-columns: 1fr;\n    grid-template-rows: min-content auto;\n    grid-template-areas:\n      "header"\n      "messages";\n  }\n\n  .cached-messages-panel .panel-header {\n    flex-direction: column;\n    align-items: flex-start;\n  }\n\n  .cached-messages-panel .search-for-personal-messages {\n    width: 100%;\n    margin-right: 0;\n    margin-bottom: 0.5em;\n  }\n\n  .cached-messages-panel .panel-control-buttons {\n    width: 100%;\n    justify-content: center;\n  }\n}\n\n/* Very Small Screens (up to 630px) */\n@media (max-width: 630px) {\n  .cached-messages-panel .panel-header-date-button,\n  .cached-messages-panel .chatlogs-date-input {\n    display: none !important;\n  }\n}\n\n/* Mobile Phones (up to 576px) */\n@media (max-width: 576px) {\n  .cached-messages-panel {\n    width: 100vw;\n    height: 100vh;\n    top: 0;\n    left: 0;\n    transform: none;\n    border-radius: 0 !important;\n  }\n\n  .cached-messages-panel .panel-header {\n    padding: 0.5em;\n  }\n\n  .cached-messages-panel .message-item {\n    padding: 0.1em;\n  }\n\n  .cached-messages-panel .message-time,\n  .cached-messages-panel .message-username,\n  .cached-messages-panel .message-text {\n    margin: 0 0.2em;\n    font-size: 0.9em;\n  }\n\n  .cached-messages-panel .video-container,\n  .cached-messages-panel .youtube-thumb {\n    transform-origin: top left;\n    transform: scale(0.8);\n  }\n\n  .cached-messages-panel .message-count {\n    font-size: 10px;\n    height: 16px;\n    padding: 0 3px;\n  }\n}',""]);const i=r}},n={};function t(o){var s=n[o];if(void 0!==s)return s.exports;var a=n[o]={id:o,exports:{}};return e[o](a,a.exports,t),a.exports}t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.nc=void 0;t.d({},{f:()=>us});var o=t(72),s=t.n(o),a=t(825),r=t.n(a),i=t(659),l=t.n(i),c=t(56),d=t.n(c),m=t(540),p=t.n(m),u=t(113),g=t.n(u),h=t(208),f={};f.styleTagTransform=g(),f.setAttributes=d(),f.insert=l().bind(null,"head"),f.domAPI=r(),f.insertStyleElement=p();s()(h.A,f);h.A&&h.A.locals&&h.A.locals;const y="http://www.w3.org/2000/svg",v=`\n  <svg xmlns="${y}"\n      width="16"\n      height="16"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="currentColor"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="icon-enter icon-feather icon-log-in">\n    <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>\n    <polyline points="10 17 15 12 10 7"></polyline>\n    <line x1="15" y1="12" x2="3" y2="12"></line>\n  </svg>`,b=`\n  <svg xmlns="${y}"\n      width="16"\n      height="16"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="currentColor" stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="icon-leave icon-feather icon-log-out">\n    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>\n    <polyline points="16 17 21 12 16 7"></polyline>\n    <line x1="21" y1="12" x2="9" y2="12"></line>\n  </svg>`,x=`\n  <svg xmlns="${y}"\n      width="18"\n      height="18"\n      viewBox="0 0 24 24"\n      fill="url(#moderatorGradient)"  \x3c!-- Use a gradient fill --\x3e\n      stroke="none"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-shield">\n    \x3c!-- Define the gradient --\x3e\n    <defs>\n        <linearGradient id="moderatorGradient" x1="0%" y1="0%" x2="0%" y2="100%">\n            <stop offset="0%" style="stop-color: rgb(255, 215, 0); stop-opacity: 1" />\n            <stop offset="100%" style="stop-color: rgb(255, 140, 0); stop-opacity: 1" />\n        </linearGradient>\n    </defs>\n    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>\n  </svg>`,w=`\n  <svg xmlns="${y}"\n       width="16"\n       height="16"\n       viewBox="0 0 24 24"\n       fill="url(#trackedGradient)"  \x3c!-- Use a gradient fill --\x3e\n       class="feather feather-star">\n      \x3c!-- Define the gradient for the fill --\x3e\n    <defs>\n      <linearGradient id="trackedGradient" x1="0%" y1="0%" x2="0%" y2="100%">\n        <stop offset="0%" style="stop-color: rgb(135, 206, 250); stop-opacity: 1" />\n        <stop offset="100%" style="stop-color: rgb(0, 191, 255); stop-opacity: 1" />\n      </linearGradient>\n    </defs>\n    \x3c!-- Use the gradient for the fill --\x3e\n    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"\n      stroke="url(#trackedGradient)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round">\n    </polygon>\n  </svg>`,S=`\n  <svg xmlns="${y}"\n      width="16"\n      height="16"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(255, 160, 122)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-slash">\n    <circle cx="12" cy="12" r="10"></circle>\n    <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line>\n  </svg>`,k=`\n  <svg xmlns="${y}"\n      width="28"\n      height="28"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="hsl(355, 80%, 65%)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round">\n    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>\n    <line x1="23" y1="9" x2="17" y2="15"></line>\n    <line x1="17" y1="9" x2="23" y2="15"></line>\n  </svg>`,E=`\n  <svg xmlns="${y}"\n      width="28"\n      height="28"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="hsl(55, 80%, 65%)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round">\n    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>\n    <path d="M19.07 4.93a10 10 0 0 1 0 14.14" opacity="0.3"></path>\n    <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>\n  </svg>`,C=`\n  <svg xmlns="${y}"\n      width="28"\n      height="28"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="hsl(80, 80%, 40%)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round">\n    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>\n    <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>\n    <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>\n  </svg>`,L=`\n  <svg xmlns="${y}"\n      width="28"\n      height="28"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="hsl(100, 50%, 50%)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round">\n    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>\n    <circle cx="9" cy="7" r="4"></circle>\n    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>\n    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>\n  </svg>`,T=`\n  <svg xmlns="${y}"\n      width="28"\n      height="28"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="hsl(180, 60%, 50%)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round">\n    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>\n    <circle cx="12" cy="7" r="4"></circle>\n  </svg>`,M=`\n  <svg xmlns="${y}"\n      width="16"\n      height="16"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="currentColor"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-slash">\n    <circle cx="12" cy="12" r="10"></circle>\n    <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line>\n  </svg>`,$=`\n  <svg xmlns="${y}"\n      width="28"\n      height="28"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(180, 213, 131)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-database">\n    <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>\n    <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>\n    <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>\n  </svg>`,N=`\n  <svg xmlns="${y}"\n      width="28"\n      height="28"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(255, 160, 122)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail">\n    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>\n    <polyline points="22,6 12,13 2,6"></polyline>\n  </svg>`,q=`\n  <svg xmlns="${y}"\n      width="28"\n      height="28"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(100, 149, 237)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-message-circle">\n      <path \n          d="M21 11.5 a8.38 8.38 0 0 1 -.9 3.8 a8.5 8.5 0 0 1 -7.6 4.7 a8.38 8.38 0 0 1 -3.8 -.9\n          L3 21 l1.9 -5.7 a8.38 8.38 0 0 1 -.9 -3.8 a8.5 8.5 0 0 1 4.7 -7.6\n          a8.38 8.38 0 0 1 3.8 -.9 h.5 a8.48 8.48 0 0 1 8 8 v.5 z">\n      </path>\n  </svg>`,A=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(113, 196, 196)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-film">\n    <rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect>\n    <line x1="7" y1="2" x2="7" y2="22"></line>\n    <line x1="17" y1="2" x2="17" y2="22"></line>\n    <line x1="2" y1="12" x2="22" y2="12"></line>\n    <line x1="2" y1="7" x2="7" y2="7"></line>\n    <line x1="2" y1="17" x2="7" y2="17"></line>\n    <line x1="17" y1="17" x2="22" y2="17"></line>\n    <line x1="17" y1="7" x2="22" y2="7"></line>\n  </svg>`,I=`\n  <svg xmlns="${y}"\n      width="16"\n      height="16"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(255, 100, 100)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-slash">\n    <circle cx="12" cy="12" r="10"></circle>\n    <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line>\n  </svg>`,j=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(255, 228, 196)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-sliders">\n    <line x1="4" y1="21" x2="4" y2="14"></line>\n    <line x1="4" y1="10" x2="4" y2="3"></line>\n    <line x1="12" y1="21" x2="12" y2="12"></line>\n    <line x1="12" y1="8" x2="12" y2="3"></line>\n    <line x1="20" y1="21" x2="20" y2="16"></line>\n    <line x1="20" y1="12" x2="20" y2="3"></line>\n    <line x1="1" y1="14" x2="7" y2="14"></line>\n    <line x1="9" y1="8" x2="15" y2="8"></line>\n    <line x1="17" y1="16" x2="23" y2="16"></line>\n  </svg>`,O=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(144, 238, 144)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-x">\n    <line x1="18" y1="6" x2="6" y2="18"></line>\n    <line x1="6" y1="6" x2="18" y2="18"></line>\n  </svg>`,B="rgb(211, 211, 211)",H=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="${B}"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevrons-up">\n    <polyline points="17 11 12 6 7 11"></polyline>\n    <polyline points="17 18 12 13 7 18"></polyline>\n  </svg>`,D=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="${B}"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-up">\n    <polyline points="18 15 12 9 6 15"></polyline>\n  </svg>`,P=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="${B}"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down">\n    <polyline points="6 9 12 15 18 9"></polyline>\n  </svg>`,z=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="${B}"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevrons-down">\n    <polyline points="7 13 12 18 17 13"></polyline>\n    <polyline points="7 6 12 11 17 6"></polyline>\n  </svg>`,F=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 25 25"\n      fill="none"\n      stroke="rgb(137, 187, 255)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-toggle-right">\n    <rect x="1" y="5" width="22" height="14" rx="7" ry="7"></rect>\n    <circle cx="16" cy="12" r="3"></circle>\n  </svg>`,U=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 25 25"\n      fill="none"\n      stroke="rgb(137, 187, 255)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-toggle-left">\n    <rect x="1" y="5" width="22" height="14" rx="7" ry="7"></rect>\n    <circle cx="8" cy="12" r="3"></circle>\n  </svg>`,_=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(176, 196, 222)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">\n    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>\n    <line x1="16" y1="2" x2="16" y2="6"></line>\n    <line x1="8" y1="2" x2="8" y2="6"></line>\n    <line x1="3" y1="10" x2="21" y2="10"></line>\n  </svg>`,R=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(176, 196, 222)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard">\n    <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>\n    <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>\n  </svg>`,J=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(28, 229, 229)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-left">\n    <polyline points="15 18 9 12 15 6"></polyline>\n  </svg>`,K=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(28, 229, 229)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">\n      <polyline points="9 18 15 12 9 6"></polyline>\n  </svg>`,V=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(169, 155, 255)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-shuffle">\n    <polyline points="16 3 21 3 21 8"></polyline>\n    <line x1="4" y1="20" x2="21" y2="3"></line>\n    <polyline points="21 16 21 21 16 21"></polyline>\n    <line x1="15" y1="15" x2="21" y2="21"></line>\n    <line x1="4" y1="4" x2="9" y2="9"></line>\n  </svg>`,X=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(255, 140, 0)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2">\n    <polyline points="3 6 5 6 21 6"></polyline>\n    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>\n    <line x1="10" y1="11" x2="10" y2="17"></line>\n    <line x1="14" y1="11" x2="14" y2="17"></line>\n  </svg>`,Y=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="currentColor"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-users">\n    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>\n    <circle cx="9" cy="7" r="4"></circle>\n    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>\n    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>\n  </svg>`,G=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(209, 144, 238)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-download">\n    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>\n    <polyline points="7 10 12 15 17 10"></polyline>\n    <line x1="12" y1="15" x2="12" y2="3"></line>\n  </svg>`,W=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(144, 185, 238)"\n      stroke-width="2" stroke-linecap="round"\n      stroke-linejoin="round" class="feather feather-upload">\n    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>\n    <polyline points="17 8 12 3 7 8"></polyline>\n    <line x1="12" y1="3" x2="12" y2="15"></line>\n  </svg>`,Z=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(144, 238, 220)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-save">\n    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>\n    <polyline points="17 21 17 13 7 13 7 21"></polyline>\n    <polyline points="7 3 7 8 15 8"></polyline>\n  </svg>`,Q=`\n  <svg xmlns="${y}"\n      width="16"\n      height="16"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(238, 144, 144)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash">\n    <polyline points="3 6 5 6 21 6"></polyline>\n    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>\n  </svg>`,ee=`\n  <svg xmlns="${y}"\n      width="20"\n      height="20"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(176, 196, 222)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-snowflake">\n    <g id="snowflake">\n      <line x1="12.06" y1="2.74" x2="12.06" y2="12.06" />\n      <line x1="20.12" y1="7.4" x2="12.06" y2="12.06" />\n      <line x1="20.12" y1="16.71" x2="12.06" y2="12.06" />\n      <line x1="12.06" y1="21.37" x2="12.06" y2="12.06" />\n      <line x1="3.99" y1="16.71" x2="12.06" y2="12.06" />\n      <line x1="3.99" y1="7.4" x2="12.06" y2="12.06" />\n      <polyline points="8.96,4.67 12.06,7.77 15.16,4.67"/>\n      <polyline points="16.9,5.68 15.76,9.92 20,11.05"/>\n      <polyline points="20,13.06 15.76,14.2 16.9,18.43"/>\n      <polyline points="15.16,19.44 12.06,16.34 8.96,19.44"/>\n      <polyline points="7.21,18.43 8.35,14.2 4.11,13.06"/>\n      <polyline points="4.11,11.05 8.35,9.92 7.21,5.68"/>\n    </g>\n  </svg>`,ne=`\n  <svg xmlns="${y}"\n      width="16"\n      height="16"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(209, 144, 238)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus">\n    <line x1="12" y1="5" x2="12" y2="19"></line>\n    <line x1="5" y1="12" x2="19" y2="12"></line>\n  </svg>`,te=300,oe="https://klavogonki.ru/u/#/",se=document.querySelector(".userpanel .user-block .user-dropdown .name span").textContent,ae=document.querySelector("a.drop-btn.mail")?.href?.match(/\/u\/#\/(\d+)\/messages\//)?.[1],re=new Intl.DateTimeFormat("en-CA").format(new Date),ie=2.5,le=["😀","😁","😂","🤣","😃","😄","😅","😆","😉","😊","😋","😎","😏","😐","😑","😒","😓","😔","😕","😖","😗","😘","😙","😚","😜","😝","😛","🤑","🤗","🤔","🤐","🤨","😣","😥","😮","🤯","😳","😱","😨","😰","😢","🤪","😵","😲","🤤","😷","🤒","🤕","🤢","🤧","😇","🥳","🥺","😬","😴","😌","🤥","🥴","🥵","🥶","🤧","🤭","🤫","😠","😡","😳","😞","😟","😕","🐱","😺","😸","😹","😻","😼","😽","🙀","😿","😾","🐶","🐭","🐹","🐰","🦊","🐻","🐼","🐨","🐯","🦁","🐮","🐷","🐸","🐵","🙈","🙉","🙊","🐔","🦄"];let ce={lastFocusedIframeTextarea:null,bigImageEvents:{},panelsEvents:{},fetchedUsers:JSON.parse(localStorage.getItem("fetchedUsers"))||{}};const de=function(e){const[n,t=0,o=0]=e.split(":").map(Number);return n+t/60+o/3600}(localStorage.getItem("cacheRefreshThresholdHours")||(localStorage.setItem("cacheRefreshThresholdHours",24),24)),me=["klavogonki.ru","youtube.com","youtu.be","imgur.com","pikabu.ru","userapi.com","ibb.co","yaplakal.com","freepik.com","fastpic.org"];var pe=t(664),ue={};ue.styleTagTransform=g(),ue.setAttributes=d(),ue.insert=l().bind(null,"head"),ue.domAPI=r(),ue.insertStyleElement=p();s()(pe.A,ue);pe.A&&pe.A.locals&&pe.A.locals;function ge(e,n=0,t=0){const o=[{transform:`translate(${n}%, calc(${t}%)) scale(1)`},{transform:`translate(${n}%, calc(${t}% - 60%)) scale(1.1)`},{transform:`translate(${n}%, calc(${t}% + 15%)) scale(1)`},{transform:`translate(${n}%, calc(${t}% - 20%)) scale(1.05)`},{transform:`translate(${n}%, calc(${t}% + 8%)) scale(1)`},{transform:`translate(${n}%, calc(${t}% - 10%)) scale(1.05)`},{transform:`translate(${n}%, calc(${t}% + 4%)) scale(1)`},{transform:`translate(${n}%, calc(${t}%)) scale(1)`}];return e.animate(o,{duration:500,easing:"ease",iterations:1}).finished}function he(e){e.classList.add("shake-effect"),setTimeout((()=>{e.classList.remove("shake-effect")}),500)}function fe(e){e.classList.add("pulse-effect"),setTimeout((()=>{e.classList.remove("pulse-effect")}),500)}let ye=null,ve=null,be=null,xe=!1,we=!1,Se=null;const ke=(e,n)=>{if(!ye)return;let t=e+10;const o=ye.offsetWidth,s=window.innerWidth;t=Math.min(Math.max(t,10),s-o-10),ye.style.left=`${t}px`,ye.style.top=`${n+18}px`},Ee=e=>ye&&ke(e.clientX,e.clientY),Ce=()=>{xe=!1,Se=null,clearTimeout(be),clearTimeout(ve),ve=setTimeout((()=>{ye&&(ye.style.opacity="0",we=!1,setTimeout((()=>{!xe&&ye&&(ye.style.display="none",ye.textContent="",document.removeEventListener("mousemove",Ee))}),50))}),100)};function Le(e,n){null!=n&&(e._tooltipContent=n,e._tooltipInitialized||(e._tooltipInitialized=!0,ye||=(()=>{const e=document.createElement("div");return e.classList.add("custom-tooltip-popup"),e.style.display="none",e.style.opacity="0",document.body.appendChild(e),e})(),e.addEventListener("mouseenter",(n=>{xe=!0,Se=e,clearTimeout(ve),clearTimeout(be),ye.innerHTML=function(e){const n=/\[([^\]]+)\]([^\[]*)/g;let t,o="",s=0;for(;null!==(t=n.exec(e));)t.index>s&&(o+=e.slice(s,t.index)),o+=`\n    <div class="tooltip-item">\n      <span class="tooltip-action">${t[1]}</span>&nbsp;\n      <span class="tooltip-message">${t[2].trim()}</span>\n    </div>`,s=n.lastIndex;s<e.length&&(o+=e.slice(s));return o}(e._tooltipContent),ye.style.display="flex",ye.style.opacity="0",ye.offsetHeight,ke(n.clientX,n.clientY),document.addEventListener("mousemove",Ee),be=setTimeout((()=>{ye.style.opacity="1",we=!0}),600)})),e.addEventListener("mouseleave",(()=>{Ce(),document.removeEventListener("mousemove",Ee)})),e.addEventListener("click",Ce)))}new MutationObserver((()=>{Se&&!document.contains(Se)&&Ce()})).observe(document,{childList:!0,subtree:!0});let{panelsEvents:Te}=ce;const Me=localStorage.getItem("KG_Chat_Empowerment"),$e=Me?JSON.parse(Me):{voiceSettings:{voiceSpeed:1.5,voicePitch:1},messageSettings:{}};function Ne(e,n){e.addEventListener("click",(()=>{const t=e.classList.toggle("assigned-frozen-config");e.classList.toggle("assigned-thawed-config"),e.style.opacity=t?"1":"0.3",function(e,n){const t=localStorage.getItem("usersToTrack");if(t){const o=JSON.parse(t).map((t=>t.name===e?{...t,state:n}:t));localStorage.setItem("usersToTrack",JSON.stringify(o))}}(n,t?"frozen":"thawed")}))}function qe(e){const n=document.createElement("div");return n.className=`${e}-item`,n}function Ae(e,n="",t=""){const o=document.createElement("input");return o.className=`settings-field ${e}-field`,o.value=n,o.placeholder=t,o}function Ie(e,n){const t=document.createElement("div");return t.className=`settings-button remove-settings-button remove-${e}-word`,t.innerHTML=Q,function(e,n){e.addEventListener("click",(()=>{n.remove()}))}(t,n),t}function je(e){const n=qe("tracked"),t=Ae("tracked-username",e.name,"Username"),o=Ae("tracked-pronunciation",e.pronunciation,"Pronunciation"),s=Ie("tracked",n),a=function(e="thawed",n){const t=document.createElement("div");return t.className=`settings-button assigned-settings-button assigned-${e}-config`,t.style.opacity="thawed"===e?"0.3":"1",t.innerHTML=ee,Ne(t,n),t}("frozen"===e.state?"frozen":"thawed",e.name),r=document.createElement("select");r.className="tracked-gender-select";return[{value:"Male",emoji:"👨"},{value:"Female",emoji:"👩"}].forEach((({value:n,emoji:t})=>{const o=document.createElement("option");o.value=n,o.textContent=`${t} ${n}`,e.gender===n&&(o.selected=!0),r.appendChild(o)})),n.appendChild(t),n.appendChild(r),n.appendChild(o),n.appendChild(s),n.appendChild(a),n}function Oe(e,n){const t=qe("toggle"),o=document.createElement("select");o.className="toggle-select";const s=document.createElement("span");s.className="toggle-description",s.dataset.category=e.category,s.dataset.type=e.type,s.textContent=e.description,s.style.cursor="pointer",s.style.transition="color 0.15s ease-in-out",s.addEventListener("click",(()=>{e.image&&window.open(e.image,"_blank")}));return[{value:"yes",emoji:"✔️"},{value:"no",emoji:"❌"}].forEach((({value:e,emoji:n})=>{const t=document.createElement("option");t.value=e,t.textContent=`${n} ${e}`,o.appendChild(t)})),o.value=n,t.appendChild(o),t.appendChild(s),t}Me||localStorage.setItem("KG_Chat_Empowerment",JSON.stringify($e));const Be=[{type:"tracked",emoji:"👀",key:"usersToTrack",selector:".settings-tracked-container",creator:je},{type:"mention",emoji:"📢",key:"mentionKeywords",selector:".settings-mention-container",creator:function(e){const n=qe("mention"),t=Ae("mention",e,"Mention Keyword"),o=Ie("mention",n);return n.appendChild(t),n.appendChild(o),n}},{type:"replacement",emoji:"♻️",key:"usernameReplacements",selector:".settings-replacement-container",creator:function(e={original:"",replacement:""}){const n=qe("replacement"),t=Ae("replacement-original",e.original,"Original username"),o=Ae("replacement",e.replacement,"Replacement name"),s=Ie("replacement",n);return n.appendChild(t),n.appendChild(o),n.appendChild(s),n}},{type:"moderator",emoji:"⚔️",key:"moderator",selector:".settings-moderator-container",creator:function(e){const n=qe("moderator"),t=Ae("moderator",e,"Moderator Name"),o=Ie("moderator",n);return n.appendChild(t),n.appendChild(o),n}},{type:"ignored",emoji:"🛑",key:"ignored",selector:".settings-ignored-container",creator:function(e){const n=qe("ignored"),t=Ae("ignored",e,"Ignored User"),o=Ie("ignored",n);return n.appendChild(t),n.appendChild(o),n}},{type:"toggle",emoji:"🔘",key:"toggle",selector:".settings-toggle-container",creator:Oe}],He=[{description:"👀 Show chat static notifications",image:"https://i.imgur.com/oUPSi9I.jpeg",category:"notifications",type:"static"},{description:"👀 Show global dynamic notifications",image:"https://i.imgur.com/8ffCdUG.jpeg",category:"notifications",type:"dynamic"},{description:"🔊 Play a beep sound and speak feedback when the user enters or leaves the chat",image:"https://i.imgur.com/6PXFIES.jpeg",category:"sound",type:"presence"},{description:"🔊 Switch to google TTS engine if available",image:"https://i.imgur.com/0H94LII.jpeg",category:"sound",type:"gTTS"},{description:"📦️ Create participants counter",image:"https://i.imgur.com/rqIVAgH.jpeg",category:"elements",type:"counter"}],De=Object.fromEntries(Be.map((e=>[e.key,[]])));Be.forEach((e=>{const n=e.key,t=JSON.parse(localStorage.getItem(n))||[];t.length&&De[n].splice(0,De[n].length,...t)}));const Pe=Be.find((e=>"mention"===e.type));async function ze(e){const n=e.target.files[0];if(n){const e=new FileReader;return new Promise(((t,o)=>{e.onload=function(e){const n=e.target.result;try{Re(JSON.parse(n)),t()}catch(e){console.error("Error parsing JSON data:",e.message),console.error("Invalid JSON:",n),alert("Failed to parse JSON data. Please check the format and try again."),o(e)}},e.onerror=function(e){console.error("Error reading file:",e.target.error),o(e.target.error)},e.readAsText(n)}))}}function Fe(e){if(!e||"object"!=typeof e)return console.error("Invalid settings data for download."),void alert("Cannot export settings. Please try again.");try{const n="  ",t="    ";let o="{\n";Be.forEach(((s,a)=>{const r=s.key,i=e[r];let l="";l=Array.isArray(i)?`[\n${i.map((e=>`${t}${JSON.stringify(e)}`)).join(",\n")}\n${n}]`:JSON.stringify(i),o+=`${n}"${r}": ${l}`,a<Be.length-1?o+=",\n":o+="\n"})),o+="}";const s=`KG_Chat_Empowerment_Settings_${new Intl.DateTimeFormat("en-CA").format(new Date)}.json`,a=new Blob([o],{type:"application/json"}),r=URL.createObjectURL(a),i=document.createElement("a");i.href=r,i.download=s,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}catch(e){console.error("Error exporting settings:",e),alert("Failed to export settings. Please try again.")}}function Ue(){return Object.fromEntries(Be.map((e=>[e.key,JSON.parse(localStorage.getItem(e.key))||[]])))}function _e(e){const n=document.createElement("div");n.classList.add("empowerment-button","settings-button"),Le(n,"Show Settings Panel"),n.style.position="relative",n.innerHTML=j;const t=document.createElement("input");t.type="file",t.accept=".json",t.style.display="none",t.addEventListener("change",ze),n.addEventListener("click",(e=>{fe(n),kn&&Fe(Ue()),Sn&&t.click(),kn||Sn||function(){const e=document.querySelector(".settings-panel");if(e)return e.remove(),void qn("hide");Cn();const n=document.createElement("div");n.className="settings-panel popup-panel",Te.handleSettingsKeydown=e=>{"Escape"===e.key&&(An(n,"hide"),qn("hide"),document.removeEventListener("keydown",Te.handleSettingsKeydown))},document.addEventListener("keydown",Te.handleSettingsKeydown);const t=document.createElement("div");t.className="panel-header";const o=document.createElement("div");o.classList.add("panel-control-buttons");const s=document.createElement("div");s.className="large-button panel-header-close-button",s.innerHTML=O,Le(s,"Close panel"),s.addEventListener("click",(()=>{An(n,"hide"),qn("hide")}));const a=document.createElement("div");a.className="large-button panel-header-clear-button",a.innerHTML=X,Le(a,"Clear settings"),a.addEventListener("click",(()=>{d()}));const r=document.createElement("div");r.className="large-button panel-header-import-button",r.innerHTML=G,Le(r,"Import settings");const i=document.createElement("div");function l(e){const n=document.querySelector(".settings-content-container");if(!n)return console.error("Container not found.");const t=()=>{e.style.visibility="visible",e.style.display="flex",setTimeout((()=>{e.style.opacity="1"}),10)},o=()=>{e.style.opacity="0",setTimeout((()=>{e.style.visibility="hidden",e.style.display="none"}),300)},s=Ue(),a=()=>{const e={};Be.forEach((n=>{e[n.key]=[]})),n.querySelectorAll(".settings-tracked-container .tracked-item").forEach((n=>{const t=n.querySelector(".tracked-username-field"),o=n.querySelector(".tracked-gender-select"),s=n.querySelector(".tracked-pronunciation-field"),a=n.querySelector(".assigned-thawed-config, .assigned-frozen-config"),r=t?t.value.trim():"",i=o?o.value.trim():"",l=s?s.value.trim():"",c=a.classList.contains("assigned-frozen-config")?"frozen":"thawed";e.usersToTrack.push({name:r,gender:i,pronunciation:l,state:c})}));const a=new Set(e.usersToTrack.map((e=>e.name.toLowerCase())));n.querySelectorAll(".settings-mention-container .mention-item").forEach((n=>{const t=n.querySelector(".mention-field"),o=t?t.value.trim():"";e.mentionKeywords.push(o)})),n.querySelectorAll(".settings-replacement-container .replacement-item").forEach((n=>{const t=n.querySelector(".replacement-original-field"),o=n.querySelector(".replacement-field"),s=t?t.value.trim():"",r=o?o.value.trim():"";if(a.has(s.toLowerCase()))return t.classList.add("input-error"),void he(t);t.classList.remove("input-error"),e.usernameReplacements.push({original:s,replacement:r})})),n.querySelectorAll(".settings-moderator-container .moderator-item").forEach((n=>{const t=n.querySelector(".moderator-field"),o=t?t.value.trim():"";e.moderator.push(o)})),n.querySelectorAll(".settings-ignored-container .ignored-item").forEach((n=>{const t=n.querySelector(".ignored-field"),o=t?t.value.trim():"";e.ignored.push(o)})),n.querySelectorAll(".settings-toggle-container .toggle-item").forEach((n=>{const t=n.querySelector(".toggle-description"),o=n.querySelector(".toggle-select"),s=o?.value.trim()||"no";e.toggle.push({category:t.dataset.category,type:t.dataset.type,option:s})}));return JSON.stringify(s)!==JSON.stringify(e)?t():o(),e};e.addEventListener("click",(()=>{const e=a();Re(e),Object.assign(s,e),o()})),n.querySelectorAll("input, select").forEach((e=>{e.addEventListener("input",a)}));const r=e=>{"INPUT"===e.tagName||"SELECT"===e.tagName?e.addEventListener("input",a):e.querySelectorAll("input, select").forEach((e=>{e.addEventListener("input",a)}))};new MutationObserver($n((e=>{e.forEach((e=>{"childList"===e.type&&(e.addedNodes.forEach((e=>{e.nodeType===Node.ELEMENT_NODE&&r(e)})),e.removedNodes.forEach((e=>{e.nodeType===Node.ELEMENT_NODE&&a()})))}))}),te)).observe(n,{childList:!0,subtree:!0})}i.className="large-button panel-header-save-button",i.innerHTML=Z,Le(i,"Save settings");const c=document.createElement("input");function d(){Be.forEach((e=>{const n=document.querySelector(e.selector);if(n){const e=n.querySelector(".add-settings-button");n.replaceChildren(),e&&n.appendChild(e)}}))}c.type="file",c.accept=".json",c.style.display="none",c.addEventListener("change",(async e=>{await ze(e),d(),u()})),r.addEventListener("click",(()=>{c.click()})),r.appendChild(c);const m=document.createElement("div");m.className="large-button panel-header-export-button",m.innerHTML=W,Le(m,"Export settings"),m.addEventListener("click",(function(){Fe(Ue())})),o.appendChild(i),o.appendChild(r),o.appendChild(m),o.appendChild(a),o.appendChild(s),t.appendChild(o),n.appendChild(t);const p=document.createElement("div");function u(){const e=Ue(),n=document.querySelector(".settings-content-container");Be.forEach((t=>{const{key:o,selector:s,creator:a,type:r,emoji:i}=t,l=document.querySelector(s);if(!l)return;l.classList.add("settings-container");const c=l.querySelector(".add-settings-button");for(;l.firstChild&&l.firstChild!==c;)l.removeChild(l.firstChild);if("toggle"!==r){(e[o]||[]).forEach((e=>l.appendChild(a(e))));const n=g(s,a);l.appendChild(n)}else{const e=JSON.parse(localStorage.getItem(o))||[];He.forEach((n=>{const t=e.find((e=>e.category===n.category&&e.type===n.type)),o=t?t.option:"yes",s=Oe(n,o);l.appendChild(s)}))}const d=function(e,n={}){const t=document.createElement("div");t.classList.add("settings-spoiler");const o=document.createElement("button");return o.textContent=n.showText||"Show Content",e.style.display="none",o.addEventListener("click",(()=>{const t="none"===e.style.display;e.style.display=t?"flex":"none",o.textContent=t?n.hideText||"Hide Content":n.showText||"Show Content"})),t.appendChild(o),t.appendChild(e),t}(l,{showText:`${i} Show ${r}`,hideText:`${i} Hide ${r}`});n.appendChild(d)}))}function g(e,n){const t=e.split("-")[1],o=document.querySelector(`.add-${t}-item`);o&&o.remove();const s=document.createElement("div");return s.className=`settings-button add-settings-button add-${t}-item`,s.innerHTML=ne,s.addEventListener("click",(()=>{const o=document.querySelector(e),a=o.querySelectorAll(`.${t}-item`),r=a.length>0?a[a.length-1]:null,i=r?r.querySelectorAll("input"):[],l=Array.from(i).some((e=>0===e.value.trim().length));if(!r||!l){const e=n(n===je?{name:"",pronunciation:""}:"");e instanceof HTMLElement?o.insertBefore(e,s):console.error("Invalid item created.")}else alert("Please fill in the previous item before adding a new one.")})),s}p.className="settings-content-container",Be.forEach((({type:e})=>{const n=document.createElement("div");n.className=`settings-${e}-container`,p.appendChild(n)})),n.appendChild(p);const{scrollButtonsContainer:h}=Mn(p);n.appendChild(h),document.body.appendChild(n),u(),l(i),An(n,"show"),qn("show")}()})),n.appendChild(t),e.appendChild(n)}function Re(e){Be.forEach((n=>{Array.isArray(e[n.key])&&(De[n.key]=e[n.key])})),Be.forEach((e=>{localStorage.setItem(e.key,JSON.stringify(De[e.key]))})),console.log("Uploaded settings applied:",De)}void 0!==se&&se&&Pe&&De[Pe.key].push(se);let Je,Ke,Ve=$e.voiceSettings.voiceSpeed??1.5,Xe=$e.voiceSettings.voicePitch??1;function Ye(){Ke.innerHTML="silence"===Je.id?k:"beep"===Je.id?E:C}function Ge(){return{speed:(Ve-0)/2.5*100+"%",pitch:(Xe-0)/2*100+"%"}}let We=null,Ze=null;function Qe(e){e.preventDefault();const n=function(e){const n=0===e.button,t=e.ctrlKey||e.metaKey,o=e.altKey;if(!t&&!o)return null;const s=t?"voiceSpeed":"voicePitch",a=n?-.1:.1,r=$e.voiceSettings[s],[i,l]="voiceSpeed"===s?[0,ie]:[0,2];return a<0&&r<=i||a>0&&r>=l?null:{prop:s,step:a}}(e);if(!n)return;const{prop:t,step:o}=n;en(t,o),We=setTimeout((()=>{Ze=setInterval((()=>{en(t,o)||clearInterval(Ze)}),100)}),500);const s=()=>{clearTimeout(We),clearInterval(Ze),Je.removeEventListener("mouseup",s),Je.removeEventListener("mouseleave",s)};Je.addEventListener("mouseup",s),Je.addEventListener("mouseleave",s)}function en(e,n){const t=parseFloat($e.voiceSettings[e]),[o,s]="voiceSpeed"===e?[0,ie]:[0,2],a=Math.min(s,Math.max(o,t+n));return t!==a&&(function(e,n){const t=parseFloat(n.toFixed(1));$e.voiceSettings[e]=t,"voiceSpeed"===e?Ve=t:"voicePitch"===e&&(Xe=t);localStorage.setItem("KG_Chat_Empowerment",JSON.stringify($e)),function(){let e=document.querySelector(".voice-settings"),n=document.querySelector(".current-voice-speed"),t=document.querySelector(".current-voice-pitch");if(Sn){e||(e=document.createElement("div"),e.classList.add("voice-settings"),Je.appendChild(e),e.offsetWidth,e.style.opacity="1"),t?.remove(),n||(n=document.createElement("span"),n.classList.add("current-voice-speed"),e.appendChild(n));let o=n.querySelector(".voice-value-info")||document.createElement("span");n.querySelector(".voice-value-info")||(o.classList.add("voice-speed","voice-value-info"),n.appendChild(o)),o.innerHTML=Ve<=0||Ve>=ie?M:`SPEED ${Number(Ve).toFixed(1)}`;let s=n.querySelector(".voice-speed-progress")||document.createElement("span");if(!n.querySelector(".voice-speed-progress")){s.classList.add("voice-speed-progress");const e=document.createElement("span");e.classList.add("voice-speed-progress-fill"),s.appendChild(e),n.appendChild(s)}n.querySelector(".voice-speed-progress-fill").style.width=Ge().speed,e.timeoutId&&clearTimeout(e.timeoutId),e.timeoutId=setTimeout((()=>{e.style.opacity="0",setTimeout((()=>e.remove()),500)}),2e3)}else if(kn){e||(e=document.createElement("div"),e.classList.add("voice-settings"),Je.appendChild(e),e.offsetWidth,e.style.opacity="1"),n?.remove(),t||(t=document.createElement("span"),t.classList.add("current-voice-pitch"),e.appendChild(t));let o=t.querySelector(".voice-value-info")||document.createElement("span");t.querySelector(".voice-value-info")||(o.classList.add("voice-pitch","voice-value-info"),t.appendChild(o)),o.innerHTML=Xe<=0||Xe>=2?M:`PITCH ${Xe.toFixed(1)}`;let s=t.querySelector(".voice-pitch-progress")||document.createElement("span");if(!t.querySelector(".voice-pitch-progress")){s.classList.add("voice-pitch-progress");const e=document.createElement("span");e.classList.add("voice-pitch-progress-fill"),s.appendChild(e),t.appendChild(s)}t.querySelector(".voice-pitch-progress-fill").style.width=Ge().pitch,e.timeoutId&&clearTimeout(e.timeoutId),e.timeoutId=setTimeout((()=>{e.style.opacity="0",setTimeout((()=>e.remove()),500)}),2e3)}else e?.remove()}()}(e,a),n>0?a<s:a>o)}const{usersToTrack:nn}=De;const tn=function(){const e=new AudioContext;return new Promise((n=>{e.onstatechange=function(){"running"===e.state&&n(e)}}))}(),on=[300,600],sn=[600,300],an=[500],rn=[600,800],ln=100;function cn(e,n){tn.then((t=>{for(let o=0;o<e.length;o++){const s=e[o];if(0===s)setTimeout((()=>{}),80);else{const e=t.createOscillator(),a=t.createGain();e.connect(a),e.frequency.value=s,e.type="sine";const r=t.createBiquadFilter();r.type="lowpass",r.frequency.value=250,e.connect(r);const i=t.createBiquadFilter();i.type="highpass",i.frequency.value=16e3,r.connect(i),a.connect(t.destination),a.gain.setValueAtTime(0,t.currentTime),a.gain.linearRampToValueAtTime(n,t.currentTime+.01),e.start(t.currentTime+o*ln/1e3),e.stop(t.currentTime+(o*ln+80)/1e3),a.gain.setValueAtTime(n,t.currentTime+(o*ln+70)/1e3),a.gain.linearRampToValueAtTime(0,t.currentTime+(o*ln+80)/1e3)}}}))}const dn=new Promise((e=>{const n=window.speechSynthesis;let t=n.getVoices();const o="Microsoft Pavel - Russian (Russia)",s="Microsoft Irina - Russian (Russia)";let a=t.find((e=>e.name===o)),r=t.find((e=>e.name===s));if(a&&r&&0!==t.length){const o=new SpeechSynthesisUtterance;o.lang="ru-RU",o.voice=r,e({synth:n,utterance:o,voices:t,pavelVoice:a,irinaVoice:r})}else n.addEventListener("voiceschanged",(()=>{if(t=n.getVoices(),a=t.find((e=>e.name===o)),r=t.find((e=>e.name===s)),a&&r){const o=new SpeechSynthesisUtterance;o.lang="ru-RU",o.voice=r,e({synth:n,utterance:o,voices:t,pavelVoice:a,irinaVoice:r})}}))}));async function mn(e,n=n){const t=_n("sound","gTTS"),o=await async function(e){return e.replace(/[-−_]/g," ").replace(/https?:\/\/(?:www\.)?([a-zA-Z0-9.-]+)(\/.*)?/g,((e,n)=>n)).replace(/\s(?=[?!,.:;@])/g,"").replace(/["#$%&'()*+\/<=>[\\\]^`{|}~]/g,"").split(" ").filter(Boolean).join(" ").trim()}(e);if(t){const e=(e=>e.split(/\s+/).reduce(((e,n)=>{const t=/[А-Яа-яЁё0-9]/.test(n)?"ru":"en";return e.length&&e[e.length-1].lang===t?e[e.length-1].text+=" "+n:e.push({lang:t,text:n}),e}),[]))(o);try{for(const{lang:n,text:t}of e)await new Promise(((e,o)=>{fetch(`http://127.0.0.1:5000/speak?text=${encodeURIComponent(t)}&lang=${n}`).then((e=>{if(!e.ok)throw new Error(`HTTP ${e.status}`);return e.arrayBuffer()})).then((n=>{const t=new(window.AudioContext||window.webkitAudioContext),s=new Audio(URL.createObjectURL(new Blob([n],{type:"audio/mp3"}))),a=t.createMediaElementSource(s),r=t.createGain();r.gain.value=2,a.connect(r),r.connect(t.destination),s.onended=e,s.onerror=o,s.play()})).catch(o)}))}catch(e){console.error("Server TTS failed:",e)}}else await async function(e,n=n){const{synth:t,utterance:o,voice:s}=await dn;return Object.assign(o,{text:e,rate:n,volume:1,pitch:Xe,voice:s}),new Promise((e=>{o.onend=e,t.speak(o)}))}(e,n)}const pn={Male:{enter:"зашёл",leave:"вышел"},Female:{enter:"зашла",leave:"вышла"}};const{ignored:un,mentionKeywords:gn,usernameReplacements:hn,usersToTrack:fn}=De;let{panelsEvents:yn,bigImageEvents:vn,lastFocusedIframeTextarea:bn,fetchedUsers:xn}=ce;const wn=e=>window.location.href.includes(e);let Sn=!1,kn=!1;function En(){Object.entries(vn).forEach((([e,n])=>{document.removeEventListener(e,n)}))}function Cn(){Object.values(yn).forEach((e=>{document.removeEventListener("keydown",e)})),Object.keys(yn).forEach((e=>delete yn[e]));const e=document.querySelector(".popup-panel");e&&e.remove()}function Ln({container:e,buttons:n}){const t=0===e.scrollTop,o=e.scrollTop+e.clientHeight>=e.scrollHeight-3;[n.fullScrollUpButton,n.partialScrollUpButton].forEach((e=>{e.style.opacity=t?"0.3":"1",e.style.pointerEvents=t?"none":"auto"})),[n.fullScrollDownButton,n.partialScrollDownButton].forEach((e=>{e.style.opacity=o?"0.3":"1",e.style.pointerEvents=o?"none":"auto"}))}function Tn({container:e,scrollButtonsContainer:n}){e.scrollHeight>e.clientHeight?n.style.display="flex":n.style.display="none"}function Mn(e){const n=document.createElement("div");n.className="scroll-buttons-container";const t=document.createElement("div");t.innerHTML=H,Le(t,"Scroll Up (Full)");const o=document.createElement("div");o.innerHTML=D,Le(o,"Scroll Up (Partial)");const s=document.createElement("div");s.innerHTML=P,Le(s,"Scroll Down (Partial)");const a=document.createElement("div");a.innerHTML=z,Le(a,"Scroll Down (Full)");const r={fullScrollUpButton:t,partialScrollUpButton:o,partialScrollDownButton:s,fullScrollDownButton:a};function i(n,t){const o=t?e.scrollHeight:e.clientHeight;e.scrollBy({top:"up"===n?-o:o,behavior:"smooth"}),Ln({container:e,buttons:r})}Object.values(r).forEach((e=>{e.classList.add("large-button","scroll-button"),n.appendChild(e)})),t.addEventListener("click",(()=>i("up",!0))),o.addEventListener("click",(()=>i("up",!1))),s.addEventListener("click",(()=>i("down",!1))),a.addEventListener("click",(()=>i("down",!0))),Ln({container:e,buttons:r}),Tn({container:e,scrollButtonsContainer:n});const l=()=>{Tn({container:e,scrollButtonsContainer:n}),Ln({container:e,buttons:r})};e.addEventListener("scroll",l);const c=new ResizeObserver(l);c.observe(e);const d=new MutationObserver(l);d.observe(e,{childList:!0,subtree:!0,characterData:!0,attributes:!0});return{scrollButtonsContainer:n,cleanup:()=>{c.disconnect(),d.disconnect(),e.removeEventListener("scroll",l)}}}["keydown","keyup"].forEach((e=>document.addEventListener(e,(n=>{return t=n.key,o="keydown"===e,"Control"===t&&(Sn=o),void("Alt"===t&&(kn=o));var t,o})))),["blur","focus"].forEach((e=>document.addEventListener(e,(()=>{(Sn||kn)&&(console.log(`${Sn?"Ctrl ":""}${kn?"Alt ":""}key was true`),Sn=!1,kn=!1)}))));const $n=(e,n=300)=>{let t;return function(...o){clearTimeout(t),t=setTimeout((()=>e.apply(this,o)),n)}};function Nn(e,n,t){e&&(e.offsetHeight,e.style.transition="opacity 0.3s",e.style.opacity="show"===n?t:"0","hide"===n&&e.addEventListener("transitionend",(()=>{"0"===e.style.opacity&&e.remove()}),{once:!0}))}function qn(e){let n=document.querySelector(".dimming-background"),t=document.querySelector(".scaled-thumbnail");("hide"!==e||n)&&(n||(n=document.createElement("div"),n.classList.add("dimming-background"),document.body.appendChild(n),n.addEventListener("click",(function(){const e=document.querySelector(".popup-panel")||n.previousElementSibling;e&&Nn(e,"hide",0),qn("hide"),t&&En()}))),Nn(n,e,.5),"hide"===e&&t&&(En(),An(t,"hide")))}function An(e,n){e&&(Nn(e,n,1),e.addEventListener("dblclick",(n=>{const t=document.querySelector(".popup-panel");(n.target===e||n.target.parentElement===e||n.target.parentElement&&n.target.parentElement.parentElement===e)&&(t&&n.target.closest(".scaled-thumbnail")||qn("hide"),Nn(e,"hide",1))})))}function In(e){return/^https?:\/\//.test(e)&&/%[0-9A-Fa-f]{2}/.test(e)}function jn(e){const[n]=e.split("#");return decodeURIComponent(n).replace(/ /g,"_")}function On(e){document.querySelector({generalMessages:".messages-content div",chatlogsMessages:".chat-logs-container",personalMessages:".messages-container-wrapper"}[e])?.querySelectorAll("a:not(.media):not(.decoded)").forEach((e=>{try{if(In(e.href)){let n=jn(e.href);e.href=e.textContent=n,e.classList.add("decoded")}}catch(n){console.error("Error decoding link:",n,e.href)}}))}const Bn=e=>{const n=document.createElement("iframe");n.classList.add("profile-iframe-container"),n.src=e,document.body.appendChild(n),Nn(n,"show",1);const t=()=>{Nn(n,"hide",0),document.removeEventListener("keydown",o),document.removeEventListener("mousedown",o)},o=e=>{if("keydown"===e.type&&"Space"===e.code){if(bn)return void e.stopPropagation();e.preventDefault(),t()}"mousedown"!==e.type||n.contains(e.target)||t()};document.addEventListener("keydown",o),document.addEventListener("mousedown",o),n.onload=()=>{try{const e=n.contentWindow,s=e.document;s.addEventListener("focusin",(e=>{"TEXTAREA"===e.target.tagName&&(bn=e.target)})),s.addEventListener("focusout",(()=>{setTimeout((()=>{s.activeElement&&"TEXTAREA"===s.activeElement.tagName||(bn=null)}),0)})),e.addEventListener("keydown",o),e.addEventListener("dblclick",t),new MutationObserver(((e,n)=>{e.some((e=>[...e.removedNodes].some((e=>1===e.nodeType&&(e.classList.contains("dimming-background")||e.classList.contains("cached-users-panel"))))))&&(t(),n.disconnect())})).observe(document.body,{childList:!0,subtree:!0})}catch(e){console.warn("Unable to access iframe contents:",e)}}};let Hn=null;function Dn(){let e;do{e=le[Math.floor(Math.random()*le.length)]}while(e===Hn);return Hn=e,e}async function Pn(e){const n=await fetch(e);if(!n.ok)throw new Error(`Failed to fetch ${e}`);return n.json()}async function zn(e,n=!0){return new Promise((async(t,o)=>{let s=n&&JSON.parse(localStorage.getItem("fetchedUsers"))||{};const a=s[e];if(n&&function(e){return e&&"object"==typeof e&&["rank","login","registered","bestSpeed","ratingLevel","friends","cars","avatarTimestamp"].every((n=>void 0!==e?.[n]))}(a))t({rank:a.rank,login:a.login,registeredDate:a.registered,bestSpeed:a.bestSpeed,ratingLevel:a.ratingLevel,friends:a.friends,cars:a.cars,avatar:a.avatar,avatarTimestamp:a.avatarTimestamp});else try{const o=`https://klavogonki.ru/api/profile/get-summary?id=${e}`,a=`https://klavogonki.ru/api/profile/get-index-data?userId=${e}`,[i,l]=await Promise.all([fetch(o),fetch(a)]);if(!i.ok||!l.ok)throw new Error("Failed to fetch data from one of the APIs.");const c=await i.json(),d=await l.json();if(!(c?.user?.login&&c.title&&d?.stats?.registered))throw new Error("Invalid data format received from the API.");{const o=c.title,a=c.user.login,i=d.stats.registered.sec?(r=d.stats.registered.sec,new Date(1e3*r).toISOString().slice(0,19).replace("T"," ")):"Invalid Date",l=d.stats.best_speed||0,m=d.stats.rating_level||0,p=d.stats.friends_cnt||0,u=d.stats.cars_cnt||0,g=c.user?.avatar||null,h=c.user.avatar?.sec||0,f=function(e,n){return e.toString()+Math.floor(n/1e3).toString()}(h,c.user.avatar?.usec||0);n&&(s[e]={rank:o,login:a,registered:i,bestSpeed:l,ratingLevel:m,friends:p,cars:u,avatar:g,avatarTimestamp:f},localStorage.setItem("fetchedUsers",JSON.stringify(s))),t({rank:o,login:a,registeredDate:i,bestSpeed:l,ratingLevel:m,friends:p,cars:u,avatar:g,avatarTimestamp:f})}}catch(n){console.error(`Error fetching user profile data for ${e}:`,n),o(n)}var r}))}function Fn(e=!1,n=24){const t=localStorage.getItem("lastClearTime"),o=t?((new Date).getTime()-t)/36e5:1/0;if(e||o>=n){localStorage.removeItem("fetchedUsers"),Object.keys(xn).forEach((e=>delete xn[e]));const e=(new Date).getTime()+60*n*60*1e3;localStorage.setItem("lastClearTime",(new Date).getTime().toString()),localStorage.setItem("nextClearTime",e.toString())}}function Un(e,n){const t=Object.values(JSON.parse(localStorage.getItem("fetchedUsers")||"[]")).find((n=>n?.login===e));if(!t)return`❌ User "${e}" not found`;const o=t.actionLog||[],s=o.find((e=>e.timestamp===n));if(!s)return`Action not found at ${n}`;const a=o.indexOf(s);if(0===a)return`🙌 ${e}'s first action`;const r=o.slice(0,a).reverse().find((e=>e.type!==s.type));if(!r)return`❌ No valid previous action found for ${n}`;const i=function(e,n){const t=e=>e.split(":").reduce(((e,n,t)=>e+n*[3600,60,1][t]),0),o=Math.abs(t(n)-t(e));return[Math.floor(o/3600),Math.floor(o%3600/60),o%60].map((e=>e.toString().padStart(2,"0"))).join(":")}(r.timestamp,s.timestamp);return"leave"===s.type?`🛑 ${e} stayed in chat for ${i}`:`✅ ${e} was absent for ${i}`}function _n(e,n){const t=(JSON.parse(localStorage.getItem("toggle"))||[]).find((t=>t.category===e&&t.type===n));return!t||"yes"===t.option}let Rn=!0;function Jn(e="generalMessages",n=600){const t={generalMessages:".messages-content",chatlogsMessages:".chat-logs-container",personalMessages:".messages-container-wrapper"}[e];if(!t)return;const o=document.querySelector(t);if(o)if(Rn)o.scrollTop=o.scrollHeight,Rn=!1;else{o.scrollHeight-o.scrollTop-o.clientHeight<=n&&(o.scrollTop=o.scrollHeight)}}async function Kn(e,n){const{top:t,height:o}=n.getBoundingClientRect(),{top:s,height:a}=e.getBoundingClientRect(),r=t-(s+a/2)+o/2;e.scrollBy({top:r,behavior:"smooth"}),await new Promise((e=>setTimeout(e,500))),e.style.scrollBehavior="auto",he(n)}function Vn(){return(new Date).toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})}const Xn=e=>{try{const{hostname:n}=new URL(e),t=n.toLowerCase().split(".").slice(-2).join(".");return{isTrusted:me.includes(t),domain:t}}catch(n){return console.error("Error in isTrustedDomain:",n.message),{isTrusted:!1,domain:e}}};function Yn(e="generalMessages"){const n={generalMessages:{container:".messages-content div",messageElement:"p",exclude:[".time",".username"]},chatlogsMessages:{container:".chat-logs-container",messageElement:".message-text"},personalMessages:{container:".messages-container",messageElement:".message-text"}}[e];if(!n)return void console.error("Invalid container type");const t=document.querySelectorAll(n.container),o=new WeakSet;t.forEach((t=>{t.querySelectorAll(n.messageElement).forEach((t=>{[...t.querySelectorAll(".private"),...t.querySelectorAll(".system-message"),t].forEach((t=>{const s=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,{acceptNode:t=>{if(o.has(t))return NodeFilter.FILTER_SKIP;const s=t.parentElement;return s.closest(".mention, .time, .username")||"generalMessages"===e&&s.closest(n.exclude.join(","))?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT}},!1),a=[];let r;for(;r=s.nextNode();)a.push(r);a.forEach((e=>{o.has(e)||(!function(e){const n=/[\s]+|[^\s\wа-яА-ЯёЁ]+|[\wа-яА-ЯёЁ]+/g,t=e.textContent.match(n);if(!t)return;const o=document.createDocumentFragment();t.forEach((e=>{if(gn.map((e=>e.toLowerCase())).includes(e.toLowerCase())){const n=document.createElement("span");n.className="mention",n.textContent=e,o.appendChild(n)}else o.appendChild(document.createTextNode(e))})),e.parentNode.replaceChild(o,e)}(e),o.add(e))}))}))}))}))}let Gn=localStorage.personalMessages&&Object.keys(JSON.parse(localStorage.personalMessages)).length||0;function Wn(){const e=document.querySelector(".personal-messages-button .total-message-count"),n=document.querySelector(".personal-messages-button .new-message-count");if(!e||!n)return;const t=JSON.parse(localStorage.getItem("personalMessages"))||{},o=Object.keys(t).length;let s=Number(localStorage.getItem("newMessagesCount"))||0;o>Gn&&(s++,localStorage.setItem("newMessagesCount",s),fe(n),ge(n,50,50)),e.textContent=o,n.textContent=s,n.style.visibility=s>0?"visible":"hidden",o!==Gn&&fe(e),Gn=o}function Zn(e){return function(e){const n={А:"A",Б:"B",В:"V",Г:"G",Д:"D",Е:"E",Ё:"Yo",Ж:"Zh",З:"Z",И:"I",Й:"Y",К:"K",Л:"L",М:"M",Н:"N",О:"O",П:"P",Р:"R",С:"S",Т:"T",У:"U",Ф:"F",Х:"Kh",Ц:"Ts",Ч:"Ch",Ш:"Sh",Щ:"Shch",Ъ:"y",Ы:"Y",Ь:"i",Э:"E",Ю:"Yu",Я:"Ya",а:"a",б:"b",в:"v",г:"g",д:"d",е:"e",ё:"yo",ж:"zh",з:"z",и:"i",й:"y",к:"k",л:"l",м:"m",н:"n",о:"o",п:"p",р:"r",с:"s",т:"t",у:"u",ф:"f",х:"kh",ц:"ts",ч:"ch",ш:"sh",щ:"shch",ъ:"y",ы:"y",ь:"i",э:"e",ю:"yu",я:"ya"};return e.split("").map((e=>n[e]||e)).join("")}(e)}function Qn(e){return!!e&&["Клавобот","Пользователь","заблокирован"].every((n=>e.includes(n)))}const et=()=>{const e=localStorage.getItem("activeChatTab")||"game",n=window.location.href.includes("gmid"),t=n&&"game"===e?'[id^="chat-game"] .text':"#chat-general .text",o=n&&"game"===e?'[id^="chat-game"] .send':"#chat-general .send",s=n&&"game"===e?'[id^="chat-game"] .messages':"#chat-general .messages",a={game:document.querySelector('[id^="chat-game"] .userlist-content'),general:document.querySelector("#chat-general .userlist-content")},r=document.querySelector(n?"game"===e?".game.c":".general.c":"general"===e?".general.c":".game.c"),i=document.querySelector(n?document.querySelector(".game.c.active")?".general.c":".game.c":document.querySelector(".general.c.active")?".game.c":".general.c"),l=document.querySelectorAll(".messages-content p"),c=document.querySelector(s);return{chatField:document.querySelector(t),chatSend:document.querySelector(o),activeChatTab:r,nextChatTab:i,chatHidden:document.querySelector("#chat-wrapper.chat-hidden"),allMessages:l,messagesContainer:c,userList:a}};function nt(e){const[n,t,o]=e.match(/\d+/g).map(Number),{h:s,s:a,l:r}=((e,n,t)=>{e/=255,n/=255,t/=255;const o=Math.max(e,n,t),s=Math.min(e,n,t);let a,r,i=(o+s)/2;if(o===s)a=r=0;else{const l=o-s;r=i<.5?l/(o+s):l/(2-o-s),a=(o===e?(n-t)/l+(n<t?6:0):o===n?(t-e)/l+2:(e-n)/l+4)/6}return a=Math.round(360*a),r=Math.min(Math.round(100*r),90),i=Math.round(100*i),a>215&&a<280&&(a=a<255?215:280),{h:a,s:r,l:i}})(n,t,o),i=((e,n,t)=>{let o,s,a;if(t/=100,0==(n/=100))o=s=a=255*t;else{const r=t<.5?t*(1+n):t+n-t*n,i=2*t-r,l=(e,n,t)=>(t<0&&(t+=1),t>1&&(t-=1),t<1/6?e+6*(n-e)*t:t<.5?n:t<2/3?e+(n-e)*(2/3-t)*6:e);o=Math.round(255*l(i,r,e/360+1/3)),s=Math.round(255*l(i,r,e/360)),a=Math.round(255*l(i,r,e/360-1/3))}return`rgb(${o}, ${s}, ${a})`})(s,a,r<50?50:r);return i}function tt(e,n){if(e)if("one"===n){const n=e.querySelector("span[data-user]");if(!n)return;const t=nt(getComputedStyle(e).color);e.style.setProperty("color",t,"important"),n.style.setProperty("filter","invert(0)","important")}else"all"===n?Array.from(e).forEach((e=>{if(!e)return;const n=e.querySelector("span[data-user]");if(!n)return;const t=nt(getComputedStyle(e).color);e.style.setProperty("color",t,"important"),n.style.setProperty("filter","invert(0)","important")})):console.error("Invalid mode. Use 'one' or 'all'.")}async function ot(){const e=document.querySelector(".messages-content div p:last-of-type");if(!e)return null;const n=async e=>Array.from(e.childNodes).map((e=>e.nodeType===Node.TEXT_NODE&&e.textContent.trim()?e.textContent.trim():"IMG"===e.nodeName&&e.getAttribute("title")?e.getAttribute("title"):"A"===e.nodeName&&e.getAttribute("href")?e.getAttribute("href"):"")).filter(Boolean);let t=(await n(e)).join(" ").trim(),o="common";const s=e.querySelector(".room.private");if(s&&s.textContent.includes("[шепчет ")){const s=e.querySelector("span.private");s&&(t=(await n(s)).join(" ").trim(),o="private")}const a=e.querySelector(".system-message");if(a){let e=(await n(a)).join(" ").trim();e=e.replace(/<Клавобот>\s*/g,""),t=e,o="system"}"common"===o&&function(e){const n=e.toLowerCase();return gn.some((e=>n.includes(e.toLowerCase())))}(t)&&(o="mention");const r=JSON.parse(localStorage.getItem("personalMessages"))||{},i=e.querySelector(".time")?.textContent||"N/A",l=e.querySelector(".username span[data-user]"),c=l?l.getAttribute("data-user"):null,d=l?l.textContent:"SYSTEM",m=nt(l?l.parentElement.style.color:"rgb(180,180,180)"),p=`${i}_${d}`;("mention"===o||"private"===o)&&!un.includes(d)&&(r[p]={time:i,date:(new Date).toLocaleDateString("en-CA"),username:d,usernameColor:m,message:t,type:o,userId:c},localStorage.setItem("personalMessages",JSON.stringify(r)));const u=e.querySelector(".username"),g=u?u.textContent.replace(/[<>]/g,""):"SYSTEM";Yn();let h="mention"===o||"private"===o?`${at(g)} обращается: `:g!==st?`${at(g)} пишет: `:"";st=g;return{messageText:h+at(t),usernameText:g}}let st=null;function at(e){if(null===e)return e;const n=[...fn.map((e=>e.name)),...hn.map((e=>e.original))],t=new RegExp(`(${n.join("|")})`,"gu");return e.replace(t,(e=>{const n=hn.find((n=>n.original===e));if(n)return n.replacement;const t=fn.find((n=>n.name===e));return t?.pronunciation||e}))}let rt=!1;const it=new Set;function lt(e){it.has(e)||(it.add(e),rt||(rt=!0,async function(){for(const e of it)await mn(e,Ve),it.delete(e);rt=!1}()))}function ct(){return window.getSelection().toString().length>0}const dt="Вы не можете отправлять сообщения",mt="Связь с сервером потеряна";function pt(e){if(!e)return null;const n=e.value;return n.includes(dt)?dt:n.includes(mt)?mt:null}function ut(){const e=document.getElementById("chat-content").querySelectorAll(".messages-content div p"),n="14px",t=Array.from(e).map((e=>({element:e,isSystem:!!e.querySelector(".system-message"),username:(()=>{const n=e.querySelector("span.username span[data-user]");return n?n.textContent.replace(/[<>]/g,""):null})()})));let o=null,s=!1;t.forEach(((e,a)=>{const{element:r,isSystem:i,username:l}=e;if(r.style.marginTop="",r.style.marginBottom="",i)return r.style.marginTop=n,void(r.style.marginBottom=n);if(!l)return;s&&l!==o&&(r.style.marginTop=n);const c=t[a+1];c&&!c.isSystem&&c.username!==l&&(r.style.marginBottom=n),o=l,s=!0}))}if(wn("gamelist")){function gs(e,n,t){if(n.disabled){const o=pt(n);o===dt?(n.disabled=t.disabled=!1,t.style.setProperty("background-color","rgb(160, 35, 35)","important"),t.style.setProperty("background-image",`url("data:image/svg+xml,${encodeURIComponent(I)}")`,"important"),t.style.setProperty("background-repeat","no-repeat","important"),t.style.setProperty("background-position","center","important"),t.style.setProperty("color","transparent","important"),n.value=null,console.log("Chat field was blocked, re-enabled.")):o===mt&&(console.log("Lost connection, reloading..."),setTimeout((()=>{window.location.reload()}),e))}}const hs=new MutationObserver((()=>{const{chatField:e,chatSend:n}=et();gs(5e3,e,n)})),{chatField:fs}=et();fs&&hs.observe(fs,{attributes:!0,attributeFilter:["disabled"]}),document.addEventListener("visibilitychange",(()=>{if("visible"===document.visibilityState){const{chatField:e,chatSend:n}=et();gs(1e3,e,n)}}))}function gt(){const{chatHidden:e,chatField:n}=et();!e&&n&&n.focus()}function ht(e){console.log("Clicked element:",e.target);const n=e.target.classList.contains("general")?"general":"game";localStorage.setItem("activeChatTab",n)}[...document.querySelectorAll(".general.c, .game.c")].forEach((e=>e.addEventListener("click",ht))),document.addEventListener("keydown",(e=>{"Tab"===e.key&&(!function(){const{nextChatTab:e,chatField:n,chatHidden:t}=et();!t&&e&&(e.click(),n?.focus())}(),e.preventDefault())}));const ft=document.querySelector(".mostright");function yt(){const{chatField:e}=et();e.setAttribute("maxlength","1000"),e.addEventListener("paste",(n=>{n.preventDefault();const t=n.clipboardData.getData("text");let o=t;In(t)&&(o=jn(t));const s=e.selectionStart,a=e.selectionEnd;e.value=e.value.slice(0,s)+o+e.value.slice(a),e.setSelectionRange(s+o.length,s+o.length)})),e.addEventListener("keydown",(n=>{const t=e.value;"Enter"===n.key&&(t.length>300?(n.preventDefault(),async function(e){const n=e.split(" ").reduce(((e,n)=>{const t=e[e.length-1];return(t+" "+n).trim().length>300?[...e,n]:[...e.slice(0,-1),(t+" "+n).trim()]}),[""]),{chatField:t,chatSend:o}=et(),s=e.length>300;s&&(t.disabled=!0);for(let e=0;e<n.length;e++){const s=n[e];if(t.value=s,console.log(`Sending piece ${e+1}: "${s}" (Length: ${s.length})`),o.click(),e<n.length-1){const e=Math.floor(500*Math.random())+500;console.log(`Waiting for ${e} ms before sending the next piece.`),await new Promise((n=>setTimeout(n,e)))}}s&&(t.disabled=!1)}(t),console.log(`Long message processed: "${t}"`),e.value=""):console.log(`Short message processed: "${t}"`))}))}(wn("gmid")||wn("gamelist"))&&ft.addEventListener("click",(()=>{setTimeout((()=>{document.querySelector("#chat-wrapper.chat-hidden")?(localStorage.setItem("shouldShowPopupMessage","true"),isInitializedChat=!1):(pruneDeletedMessages(),gt(),isInitializedChat=!1,setTimeout((()=>isInitializedChat=!1),3e3),localStorage.setItem("shouldShowPopupMessage","false"))}),300)})),(wn("gmid")||wn("gamelist"))&&document.addEventListener("keydown",(e=>{if(e.ctrlKey&&"Space"===e.code){const e=document.querySelector("#chat-fixed-placeholder"),n="none"===e.style.display;e.style.display=n?"unset":"none",localStorage.setItem("shouldShowPopupMessage",!n),n?et().chatField?.focus():document.querySelector(".popup-messages-container")?.remove()}}));const vt=[{family:"Montserrat",weights:["100","200","300","400","500","600","700","800","900"]},{family:"Orbitron",weights:["400","500","600","700","800","900"]},{family:"Roboto Mono",weights:["100","200","300","400","500","600","700"]}];async function bt(){try{vt.forEach((e=>{!function(e,n){if(!document.querySelector(`.font-${e.replace(/\s/g,"-")}`)){const t=document.createElement("link");t.rel="stylesheet",t.href=`https://fonts.googleapis.com/css2?family=${e.replace(/\s/g,"+")}:wght@${n.join(";")}&display=swap`,t.classList.add(`font-${e.replace(/\s/g,"-")}`),document.head.appendChild(t)}}(e.family,e.weights)}))}catch(e){console.error("Font loading failed:",e)}}var xt=t(344),wt={};wt.styleTagTransform=g(),wt.setAttributes=d(),wt.insert=l().bind(null,"head"),wt.domAPI=r(),wt.insertStyleElement=p();s()(xt.A,wt);xt.A&&xt.A.locals&&xt.A.locals;const{usersToTrack:St}=De;function kt(e){const n=document.createElement("span");return n.classList.add("action-icon"),n.style.margin="0 4px",n.style.setProperty("border","none","important"),n.innerHTML=e,n}function Et(e,n,t,o,s){const a={generalChat:".messages-content div",cachePanel:".fetched-users .action-log"}[s];if(!a)return void console.error("Invalid or missing container. Please provide 'generalChat' or 'cachePanel'.");const r=document.querySelector(a);if(!r)return void console.error("Container not found in DOM.");r.classList.add("generalChat"===s?"static-chat-notifications-container":"static-cache-notifications-container");const i=document.createElement("span");i.classList.add("static-chat-notification"),"generalChat"===s&&i.addEventListener("dblclick",(()=>{!async function(e=40,n=600,t=140){const o=document.querySelector(".messages-content");if(!o)return;const s=o.style.scrollBehavior;o.style.scrollBehavior="smooth";const a=[...document.querySelectorAll(".static-chat-notification")].reverse();for(const s of a){!Nt(s,o)&&(o.scrollTop=s.offsetTop-o.offsetTop-o.clientHeight/2,await Tt(n)),Object.assign(s.style,{transition:[`opacity ${t/1e3}s cubic-bezier(.3,.1,1,.1)`,`transform ${t/1e3}s cubic-bezier(0,.7,.3,0.95)`].join(","),opacity:0,transformOrigin:"left",transform:"translateX(8em) skewX(-20deg)"}),await Tt(t),s.remove(),await Tt(e)}o.scrollHeight-o.scrollTop<=o.clientHeight||(o.scrollTop=o.scrollHeight,await Tt(n));o.style.scrollBehavior=s}()}));const l=document.createElement("span");l.classList.add("action-user"),l.textContent=e;const c=kt(n),d=document.createElement("span");d.classList.add("action-time"),d.textContent=t,i.appendChild(l),i.appendChild(c),i.appendChild(d),i.dataset.username=e,i.dataset.time=t,o?i.classList.add("user-enter"):i.classList.add("user-left"),r.appendChild(i),i.addEventListener("mouseover",(()=>{const e=Un(i.dataset.username,i.dataset.time);Le(i,e)}))}const Ct=[];let Lt=!1;const Tt=e=>new Promise((n=>setTimeout(n,e)));function Mt(){if(0===Ct.length)return void(Lt=!1);Lt=!0;const{user:e,iconType:n,time:t,presence:o}=Ct.shift();!function(e,n,t,o){let s=document.querySelector(".dynamic-chat-notifications-container");s||(s=document.createElement("div"),s.classList.add("dynamic-chat-notifications-container"),document.body.appendChild(s));const a=document.createElement("span");a.classList.add("dynamic-chat-notification");const r=document.createElement("span");r.classList.add("action-user"),r.textContent=e;const i=kt(n),l=document.createElement("span");l.classList.add("action-time"),l.textContent=t,a.appendChild(r),a.appendChild(i),a.appendChild(l),a.dataset.username=e,a.dataset.time=t,o?a.classList.add("user-enter"):a.classList.add("user-left"),s.appendChild(a),a.addEventListener("mouseover",(()=>{const e=Un(a.dataset.username,a.dataset.time);Le(a,e)})),setTimeout((()=>{a.style.transform="translateX(0)",setTimeout((()=>{a.style.transform="translateX(-100%)",setTimeout((()=>{s.removeChild(a)}),300)}),5e3)}),300)}(e,n,t,o),setTimeout(Mt,500)}function $t(e,n,t){const o=St.some((n=>n.name===e&&"thawed"===n.state)),s=o&&_n("notifications","static"),a=_n("notifications","dynamic");if(!s&&!a)return;const r=Vn();s&&o&&(Et(e,n,r,t,"generalChat"),Jn("generalMessages",350)),a&&function(e,n,t,o){Ct.push({user:e,iconType:n,time:t,presence:o}),Lt||Mt()}(e,n,r,t)}function Nt(e,n){const t=n.getBoundingClientRect(),o=e.getBoundingClientRect();return o.top>=t.top&&o.bottom<=t.bottom}const qt={Экстракибер:1,Кибергонщик:2,Супермен:3,Маньяк:4,Гонщик:5,Профи:6,Таксист:7,Любитель:8,Новичок:9},At={Экстракибер:"#06B4E9",Кибергонщик:"#5681ff",Супермен:"#B543F5",Маньяк:"#DA0543",Гонщик:"#FF8C00",Профи:"#C1AA00",Таксист:"#2DAB4F",Любитель:"#61B5B3",Новичок:"#AFAFAF"};function It(){const e=document.querySelector(".cached-users-panel");if(e)return e.remove(),void qn("hide");Cn();let n=JSON.parse(localStorage.getItem("fetchedUsers"))||{};const t=document.createElement("div");t.className="cached-users-panel popup-panel",ce.panelsEvents.handleCacheKeydown=e=>{"Escape"===e.key&&(An(t,"hide"),qn("hide"),document.removeEventListener("keydown",ce.panelsEvents.handleCacheKeydown))},document.addEventListener("keydown",ce.panelsEvents.handleCacheKeydown);const o=document.createElement("div");o.className="panel-header";const s=document.createElement("div");s.className="drop-time";const a=document.createElement("span");a.className="drop-time-threshold-description",a.textContent="🚧 Threshold";const r=document.createElement("span");r.className="drop-time-threshold";const i=localStorage.getItem("cacheRefreshThresholdHours");r.innerHTML=i||"00:00:00",r.addEventListener("click",(function(){let e=!1;for(;!e;){const n=prompt("Enter a cache refresh time (e.g., HH, HH:mm, or HH:mm:ss):"),t=document.querySelector(".drop-time-threshold");if(null===n)e=!0;else if(/^([0-9]+|[01][0-9]|2[0-4])(:([0-5]?[0-9])(:([0-5]?[0-9]))?)?$/.test(n)){const[o,s="00",a="00"]=n.split(":").map((e=>e.padStart(2,"0")));t.textContent=`${o}:${s}:${a}`,localStorage.setItem("cacheRefreshThresholdHours",`${o}:${s}:${a}`),localStorage.removeItem("fetchedUsers"),localStorage.removeItem("lastClearTime"),localStorage.removeItem("nextClearTime"),setTimeout((()=>location.reload()),1e3),e=!0}else alert("Invalid time format. Please use HH, HH:mm, or HH:mm:ss.")}})),Le(r,"Click to set cache refresh time");const l=document.createElement("span");l.className="drop-time-expiration-description",l.textContent="💣 Countdown";const c=document.createElement("span");c.className="drop-time-expiration",Le(c,"Time until cache refresh"),s.append(a,r,l,c),o.appendChild(s);const d=document.createElement("div");d.className="search-for-cached-users";const m=document.createElement("input");m.className="cached-users-search-input",m.type="text",Le(m,"\n    [Ctrl + Click] to clear the input and display all users\n    [Enter] to activate user search mode on the site\n  "),d.appendChild(m),m.addEventListener("click",(e=>{e.ctrlKey&&(m.value="",m.dispatchEvent(new Event("input",{bubbles:!0})))})),m.addEventListener("input",(()=>{const e=document.querySelector(".old-users"),n=document.querySelector(".new-users"),t=document.querySelector(".fetched-users");if(!m.value.trim()){e.style.display="grid",n.style.display="grid";const o=document.querySelector(".search-results");o&&t&&t.removeChild(o)}})),m.addEventListener("keydown",(e=>{"Enter"!==e.key||e.target.value.trim()||(e.preventDefault(),e.target.value="user ")}));const p=async e=>{const n=document.querySelector(".old-users"),t=document.querySelector(".new-users"),o=document.querySelector(".fetched-users");if(e){n.style.display="none",t.style.display="none";let s=document.querySelector(".search-results")||k("search");s.parentElement||o.appendChild(s),s.replaceChildren();const a=[];try{const n=await async function(e){const n=`https://klavogonki.ru/api/profile/search-users?query=${e}`,t=(await Pn(n)).all;if(!t||0===t.length)throw new Error(`User ${e} not found.`);return t.map((e=>e.id))}(e);await Promise.all(n.map((async e=>{const n=await zn(e,!1),t={rank:n.rank,login:n.login,registered:n.registeredDate,bestSpeed:n.bestSpeed,ratingLevel:n.ratingLevel,friends:n.friends,cars:n.cars,avatarTimestamp:n.avatarTimestamp,avatar:n.avatar},o=N(e,t);o&&a.push(o)}))),a.sort(((e,n)=>e.order!==n.order?e.order-n.order:n.bestSpeed-e.bestSpeed)),a.forEach((({userElement:e})=>s.appendChild(e)));const t=L(`Search Results for: ${e}`,"search-results-description");s.prepend(t)}catch(e){console.error("Error fetching user profile:",e);const n=document.createElement("div");n.className="error-message",n.textContent=`Error: ${e.message}`,s.appendChild(n)}}};m.addEventListener("input",$n((e=>{const n=e.target.value.trim(),t=localStorage.getItem("cachePanelSearchMode"),o=n.startsWith("user ")?n.substring(5).trim():"fetch"===t?n:"";o&&p(o)}),te)),o.appendChild(d);const u=new MutationObserver((e=>{if(e.some((e=>"childList"===e.type&&e.addedNodes.length))){const e=document.querySelector(".cached-users-search-input"),n=Array.from(document.querySelectorAll(".fetched-users .login")),t=(e,n)=>{let t=0,o=0;for(const s of n.toLowerCase())o<e.length&&s===e[o].toLowerCase()&&(t+=2,o++);return o===e.length?t:0},o=e=>{n.forEach((n=>{n.closest(".user-item").style.display=!e||t(e,n.textContent)>0?"grid":"none"}))};e.focus(),e.addEventListener("input",(()=>o(e.value.trim()))),u.disconnect()}}));u.observe(o,{childList:!0,subtree:!0});const g=document.createElement("div");g.className="panel-control-buttons",g.style.display="flex";const h=document.createElement("div");h.className="large-button user-mode-button",h.innerHTML=Y;const f=localStorage.getItem("cachePanelSearchMode")||(localStorage.setItem("cachePanelSearchMode","cache"),"cache");function y(e){h.classList.toggle("cache-mode-button","cache"===e),h.classList.toggle("fetch-mode-button","cache"!==e)}Le(h,`Current active mode: ${f}`),y(f),h.addEventListener("click",(()=>{const e="cache"===localStorage.getItem("cachePanelSearchMode")?"fetch":"cache";localStorage.setItem("cachePanelSearchMode",e),y(e),Le(h,`Current active mode: ${e}`);const n=document.querySelector(".old-users"),t=document.querySelector(".new-users");let o=document.querySelector(".search-results");"fetch"===e?(n.style.display="none",t.style.display="none",o||(o=document.createElement("div"),o.className="users-container search-results",S.appendChild(o)),o.style.display="grid"):(n.style.display="grid",t.style.display="grid",o&&(o.style.display="none"))})),g.appendChild(h);const x=document.createElement("div");x.className="large-button panel-header-clear-button",Le(x,"Clear cache"),x.innerHTML=X,x.addEventListener("click",(()=>{jt(),Fn(!0,de);const e=document.querySelector(".cache-panel-load-button .cache-user-count");e&&(e.textContent="0")})),g.appendChild(x);const w=document.createElement("div");w.className="large-button panel-header-close-button",Le(w,"Close panel"),w.innerHTML=O,w.addEventListener("click",jt),g.appendChild(w),o.appendChild(g);const S=document.createElement("div");function k(e){const n=document.createElement("div");return"old"===e?n.className="users-container old-users":"new"===e?n.className="users-container new-users":"search"===e&&(n.className="users-container search-results"),n}S.className="fetched-users";const E=k("old"),C=k("new");function L(e,n){const t=document.createElement("span");return t.className=`description ${n}`,t.textContent=e,t}E.appendChild(L("Active Users","old-users-description")),C.appendChild(L("New Registrations","new-users-description")),S.append(E,C);const T=[];let M=!0;const $=new Date,N=(e,n)=>{const t=document.createElement("div");t.className="user-item";const o=document.createElement("div");o.className="avatar";const s=n.avatarTimestamp,a=`/storage/avatars/${e}_big.png`;if(s&&"00"!==s||n.avatar&&Object.keys(n.avatar).length){const e=document.createElement("img");e.src=`${a}?updated=${s}`,e.alt=`${n.login}'s avatar`,e.style.objectFit="cover",o.appendChild(e)}else o.innerHTML=Dn();const r=document.createElement("div");r.className="user-data";const i=document.createElement("div");i.className="login-container";const l=document.createElement("a");l.className="login",l.textContent=n.login,l.href=`https://klavogonki.ru/profile/${e}`,Le(l,"\n      [Click] to open profile in iframe (summary)\n      [Ctrl + Click] to open profile in iframe (messages)\n      [Ctrl + Shift + Click] to open profile in a new tab (messages)\n    "),i.appendChild(l);const c=oe+e,d=`${oe}${ae}/messages/${e}/`;if(l.addEventListener("click",(e=>{if(e.preventDefault(),e.ctrlKey&&e.shiftKey){const e=window.open(d,"_blank");e&&e.focus()}else e.ctrlKey?Bn(d):Bn(c)})),void 0!==n.visits){const t=document.createElement("span");t.className="visits "+(n.tracked?"tracked":"untracked"),t.textContent=n.visits,t.dataset.userId=e,Le(t,`View action log for ${n.login}`),function(e){const n=Number(e.textContent);if(isNaN(n))return console.warn("Invalid visits count!");const t=n<=10?"💧":n<=20?"💦":n<=30?"🌊":"🔥";e.textContent=`${t} ${n}`}(t),i.appendChild(t),t.addEventListener("click",(e=>{M=!0;const o=t.dataset.userId,s=JSON.parse(localStorage.getItem("fetchedUsers"))||{},a=s?s[o]:null,r=a?.actionLog;if(a){let t=document.querySelector(".action-log");t?t.replaceChildren():(t=document.createElement("div"),t.className="action-log",S.appendChild(t),Nn(t,"show",1)),r&&M&&r.forEach(((e,t)=>{if(!M||"object"!=typeof e||!e)return;const{type:o,timestamp:s}=e,a=n.login||"Unknown User",r="enter"===o?v:b,i="enter"===o;setTimeout((()=>{M&&Et(a,r,s,i,"cachePanel")}),10*(t+1))}));const o=e=>{t.contains(e.target)&&"Space"!==e.code||("Space"===e.code&&e.preventDefault(),Nn(t,"hide",0),M=!1,["click","keydown"].forEach((e=>document.removeEventListener(e,o))))};["click","keydown"].forEach((e=>document.addEventListener(e,o))),e.stopPropagation()}else console.error("User data not found")}))}r.appendChild(i);const m=document.createElement("div");m.className="rank",m.textContent=n.rank||"N/A",m.style.color=At[n.rank]||"white",r.appendChild(m);const p=document.createElement("div");let u;p.className="registered",p.textContent=n.registered||"N/A";const g=p.textContent;p.addEventListener("mouseover",(()=>{clearTimeout(u),u=setTimeout((()=>{p.textContent=function(e){const n=Math.floor((new Date-new Date(e))/1e3),t=Math.floor(n/31536e3),o=Math.floor(n%31536e3/(30.44*24*60*60)),s=Math.floor(n%(30.44*24*60*60)/86400),a=Math.floor(n%86400/3600),r=Math.floor(n%3600/60),i=n%60,l=[];return t>0?(l.push(`${t} year${t>1?"s":""}`),o>0&&l.push(`${o} month${o>1?"s":""}`)):o>1||1===o&&s>0?(l.push(`${o} month${o>1?"s":""}`),s>0&&l.push(`${s} day${s>1?"s":""}`)):s>0?(l.push(`${s} day${s>1?"s":""}`),a>0&&l.push(`${a} hour${a>1?"s":""}`),r>0&&l.push(`${r} minute${r>1?"s":""}`)):a>0?(l.push(`${a} hour${a>1?"s":""}`),r>0&&l.push(`${r} minute${r>1?"s":""}`)):r>0?(l.push(`${r} minute${r>1?"s":""}`),i>0&&l.push(`${i} second${i>1?"s":""}`)):l.push(`${i} second${i>1?"s":""}`),l.filter(Boolean).join(" ")}(n.registered)}),300)})),p.addEventListener("mouseout",(()=>{clearTimeout(u),p.textContent=g})),r.appendChild(p);const h=(e,n,t,o,s,a)=>{const r=document.createElement("span");return r.className=e,r.style.color=n,r.innerHTML=`${t}${o||0}`,Le(r,s),r.style.cursor="pointer",r.addEventListener("click",(()=>Bn(a))),r},f=document.createElement("div");return f.className="user-metrics",f.append(h("best-speed","cyan","🚀",n.bestSpeed,"Best speed",`https://klavogonki.ru/u/#/${e}/stats/normal/`),h("rating-level","gold","⭐",n.ratingLevel,"Rating level",`https://klavogonki.ru/top/rating/today?s=${n.login}`),h("cars-count","lightblue","🚖",n.cars,"Cars count",`https://klavogonki.ru/u/#/${e}/car/`),h("friends-count","lightgreen","🤝",n.friends,"Friends count",`https://klavogonki.ru/u/#/${e}/friends/list/`)),t.append(o,r,f),{userElement:t,order:qt[n.rank]||10,bestSpeed:n.bestSpeed||0,registered:n.registered}};"cache"===localStorage.getItem("cachePanelSearchMode")&&(Object.keys(n).forEach((e=>{const t=n[e];T.push(N(e,t))})),T.sort(((e,n)=>e.order!==n.order?e.order-n.order:n.bestSpeed-e.bestSpeed)),T.forEach((({userElement:e,registered:n})=>{((e=>$-new Date(e)<=864e5)(n)?C:E).appendChild(e)}))),document.body.appendChild(t),t.append(o,S);const{scrollButtonsContainer:q}=Mn(S);function A(){const e=localStorage.getItem("lastClearTime"),n=localStorage.getItem("nextClearTime"),t=document.querySelector(".drop-time-expiration");if(e&&n&&t){const e=n-Date.now();e<=0?Fn(!0,de):function(e,n){const t=String(Math.floor(n/36e5)).padStart(2,"0"),o=String(Math.floor(n%36e5/6e4)).padStart(2,"0"),s=String(Math.floor(n%6e4/1e3)).padStart(2,"0"),a=5*Math.ceil(parseInt(s)/5);e.textContent=`${t}:${o}:${s} ${I[a]||I[0]}`}(t,e)}}t.appendChild(q),An(t,"show"),qn("show");const I={0:"🕛",5:"🕐",10:"🕑",15:"🕒",20:"🕓",25:"🕔",30:"🕕",35:"🕖",40:"🕗",45:"🕘",50:"🕙",55:"🕚"};setInterval(A,1e3),A()}function jt(){const e=document.querySelector(".cached-users-panel");e&&(An(e,"hide"),qn("hide"))}let{fetchedUsers:Ot}=ce;const{usersToTrack:Bt,ignored:Ht,moderator:Dt}=De;function Pt(e){const n={class:"unknown",icon:"❓",color:"#000000"},t={Экстракибер:{class:"extra",icon:"🚀",color:"#06B4E9"},Кибергонщик:{class:"cyber",icon:"🤖",color:"#5681ff"},Супермен:{class:"superman",icon:"👊",color:"#B543F5"},Маньяк:{class:"maniac",icon:"🔪",color:"#DA0543"},Гонщик:{class:"racer",icon:"⚡️️",color:"#FF8C00"},Профи:{class:"profi",icon:"️💼️",color:"#C1AA00"},Таксист:{class:"driver",icon:"🚖️",color:"#2DAB4F"},Любитель:{class:"amateur",icon:"🍆️",color:"#61B5B3"},Новичок:{class:"newbie",icon:"🐥",color:"#AFAFAF"}}[e]||n;return t.class===n.class&&console.log(`Class not found for status title: ${e}. Using default class: ${n.class}`),t}function zt(e,n,t,o,s){const a=Ot?.[e]?.avatarTimestamp,r="00"!==a?`/storage/avatars/${e}_big.png?updated=${a}`:"",i=document.createElement("div"),l=Pt(n),c=l.class,d=l.color,m=l.icon;i.classList.add(`user${e}`,c);const p=document.createElement("div");if(p.classList.add("avatar"),"00"!==a){const e=document.createElement("img");e.src=r,p.appendChild(e)}else p.style.fontSize="1.8rem",p.innerHTML=Dn();const u=document.createElement("a");u.classList.add("name"),Le(u,"Send private message"),u.dataset.user=e,u.textContent=t,u.style.setProperty("color",d,"important");const g=document.createElement("a");g.classList.add("profile");Le(g,`${m} ${n} - ${o}`),g.target="_blank",g.href=`/profile/${e}/`;let h=function(e,n,t){const o="http://www.w3.org/2000/svg",s=20,a=10,r=Math.random().toString(36).substring(2,22),i=t||0!==e?1:.6,l=document.createElementNS(o,"svg");if(Object.entries({width:s,height:s,viewBox:"0 0 20 20",xmlns:o}).forEach((([e,n])=>l.setAttribute(e,n))),l.classList.add("circularProgress"),t||0===e){if(!t){const e=document.createElementNS(o,"circle");Object.entries({cx:a,cy:a,r:8,fill:"none",stroke:n,"stroke-width":2}).forEach((([n,t])=>e.setAttribute(n,t))),e.classList.add("outerCircle"),l.appendChild(e)}const e=s/24*i,r=a-12*e,c=document.createElementNS(o,"g");c.setAttribute("transform",`translate(${r}, ${r}) scale(${e})`),c.classList.add("closeIconGroup");const d=document.createElementNS(o,"path");Object.entries({d:"M18.364 5.636a1 1 0 0 1 0 1.414L13.414 12l4.95 4.95a1 1 0 0 1-1.414 1.414L12 13.414l-4.95 4.95a1 1 0 0 1-1.414-1.414L10.586 12l-4.95-4.95a1 1 0 0 1 1.414-1.414L12 10.586l4.95-4.95a1 1 0 0 1 1.414 0z",fill:n}).forEach((([e,n])=>d.setAttribute(e,n))),c.appendChild(d),l.appendChild(c)}else{const t=document.createElementNS(o,"defs");t.classList.add("defs");const s=document.createElementNS(o,"clipPath");s.setAttribute("id",`clipInner-${r}`),s.classList.add("clipPath");const i=document.createElementNS(o,"rect");Object.entries({x:2,y:2,width:16,height:0,transform:"rotate(180, 10, 10)"}).forEach((([e,n])=>i.setAttribute(e,n))),i.classList.add("clipRect");const c=document.createElementNS(o,"animate");Object.entries({attributeName:"height",from:0,to:e/100*16,begin:"indefinite",dur:"1s",fill:"freeze",calcMode:"spline",keySplines:"0.4 0 0.2 1",keyTimes:"0;1"}).forEach((([e,n])=>c.setAttribute(e,n))),c.classList.add("animateProfileProgress"),i.appendChild(c),s.appendChild(i),t.appendChild(s),l.appendChild(t);const d=document.createElementNS(o,"circle");Object.entries({cx:a,cy:a,r:8,fill:"none",stroke:n,"stroke-width":2}).forEach((([e,n])=>d.setAttribute(e,n))),d.classList.add("outerCircle"),l.appendChild(d);const m=document.createElementNS(o,"circle");Object.entries({cx:a,cy:a,r:8,fill:n,"clip-path":`url(#clipInner-${r})`}).forEach((([e,n])=>m.setAttribute(e,n))),m.classList.add("innerCircle"),l.appendChild(m)}return l.outerHTML}(function(e){const n=100*Math.floor(e/100);return(e-n)/(n+100-n)*100}(o),d,s);g.innerHTML=h,setTimeout((()=>{const e=g.querySelector(".animateProfileProgress");e&&e.beginElement()}),10),g.addEventListener("click",(function(n){n.preventDefault(),Sn?window.open(oe+e,"_blank"):Bn(oe+e)}));const f=`${oe}${ae}/messages/${e}/`;u.addEventListener("click",(function(n){if(n.ctrlKey&&n.shiftKey){const e=window.open(f,"_blank");e&&e.focus()}else n.ctrlKey?Bn(f):function(e){const n=`<${document.querySelector(`.name[data-user="${e}"]`).textContent}>`,t=document.querySelector(".messages .text");t.value=n,t.focus(),t.selectionEnd=t.value.length}(e)})),i.appendChild(p),i.appendChild(u),i.appendChild(g);if(Bt.find((e=>e.name===t&&"thawed"===e.state))){const e=document.createElement("div");Le(e,"Tracked user"),e.classList.add("tracked"),e.innerHTML=w,i.appendChild(e)}if(Ht.includes(t)){const e=document.createElement("div");Le(e,"Ignored user"),e.classList.add("ignored"),e.innerHTML=S,i.appendChild(e)}const y=document.querySelector(`.userlist-content ins.user${e} img[src*="moderator"]`),v=Dt.includes(t);if(y||v){const e=document.createElement("div");e.classList.add("moderator"),e.innerHTML=x,i.appendChild(e)}return i}async function Ft(e,n){try{const t=document.querySelector(".userlist-content");let o=document.querySelector(".chat-user-list");if(!o){o=document.createElement("div"),o.classList.add("chat-user-list");const e=document.querySelector(".userlist");e&&e.appendChild(o)}const s={};["extra","cyber","superman","maniac","racer","profi","driver","amateur","newbie"].forEach((e=>{const n=o.querySelector(`.rank-group-${e}`);n?s[e]=n:(s[e]=document.createElement("div"),s[e].classList.add(`rank-group-${e}`),o.appendChild(s[e]))}));const a=new Set;for(const o of t.querySelectorAll("ins")){const t=o.querySelector(".name"),r=t.getAttribute("data-user"),i=t.textContent;if(!a.has(r))try{const{rank:t,login:l,registeredDate:c,bestSpeed:d,ratingLevel:m,friends:p,cars:u,avatarTimestamp:g}=await zn(r);Ot[r]?(Ot[r].rank=t,Ot[r].login=l,Ot[r].registered=c,Ot[r].bestSpeed=d,Ot[r].ratingLevel=m,Ot[r].friends=p,Ot[r].cars=u,Ot[r].avatarTimestamp=g):Ot[r]={rank:t,login:l,registered:c,bestSpeed:d,ratingLevel:m,friends:p,cars:u,avatarTimestamp:g},e===i&&"enter"===n&&(Ot[r].visits=(Ot[r].visits||0)+1,Ot[r].tracked=Bt.some((n=>n.name===e)));const{class:h}=Pt(t);if(!s[h].querySelector(`.user${r}`)){const e=zt(r,t,i,d,o.classList.contains("revoked"));s[h].appendChild(e),us&&he(e)}a.add(r)}catch(e){console.error(`Error fetching profile summary for user ${r}:`,e)}}o.querySelectorAll('.chat-user-list [class^="user"]').forEach((e=>{const n=e.querySelector(".name").getAttribute("data-user");a.has(n)||e.remove()})),Object.values(s).forEach((e=>[...e.children].sort(((e,n)=>(Ot[n.querySelector(".name")?.getAttribute("data-user")]?.bestSpeed||0)-(Ot[e.querySelector(".name")?.getAttribute("data-user")]?.bestSpeed||0))).forEach((n=>e.appendChild(n))))),localStorage.setItem("fetchedUsers",JSON.stringify(Ot)),function(){const e=document.querySelector(".cache-panel-load-button .cache-user-count");if(!e)return;const n=Object.keys(JSON.parse(localStorage.getItem("fetchedUsers"))||{}).length.toString();n!==e.textContent&&(e.textContent=n,fe(e))}()}catch(e){console.error("Error refreshing user list:",e)}}var Ut=t(479),_t={};_t.styleTagTransform=g(),_t.setAttributes=d(),_t.insert=l().bind(null,"head"),_t.domAPI=r(),_t.insertStyleElement=p();s()(Ut.A,_t);Ut.A&&Ut.A.locals&&Ut.A.locals;class Rt{constructor(){this.selected=new Set,this.isDragging=!1,this.toggleBtn=null,this.init()}init(){this.attachEvents(),this.updateDeletedMessages(),this.renderToggle()}attachEvents(){document.addEventListener("mousedown",(e=>{const n=e.target.closest(".messages-content p");if(n&&2===e.button&&n){if(e.target.closest(".time")){const t=Array.from(document.querySelectorAll(".messages-content p")),o=t.indexOf(n);if(-1!==o)if(e.ctrlKey)t.slice(o).forEach((e=>{this.toggleSelect(e,!0,"time-mode"),e.classList.add("time-mode")}));else{const e=n.querySelector(".username");if(e){const n=e.textContent.trim();t.slice(o).forEach((e=>{const t=e.querySelector(".username");t&&t.textContent.trim()===n&&(this.toggleSelect(e,!0,"time-mode"),e.classList.add("time-mode"))}))}}}else if(e.target.closest(".username")){const n=e.target.closest(".username").textContent.trim();document.querySelectorAll(".messages-content p").forEach((e=>{const t=e.querySelector(".username");t&&t.textContent.trim()===n&&(this.toggleSelect(e,!0,"username-mode"),e.classList.add("username-mode"))}))}else this.isDragging=!0,this.toggleSelect(n,!0,"message-mode")}})),document.addEventListener("mouseup",(()=>this.isDragging=!1)),document.addEventListener("mousemove",(e=>{if(!this.isDragging)return;const n=e.target.closest(".messages-content p");n&&this.toggleSelect(n,!0,"message-mode")})),document.addEventListener("contextmenu",(e=>{const n=e.target.closest(".messages-content p");n&&(ct()||(e.preventDefault(),this.showDeleteButton(e,n)))}))}toggleSelect(e,n,t="message-mode"){if(!e)return;if(ct())return;e.classList.toggle("selected-message",n),n?"message-mode"===t&&e.classList.add("message-mode"):e.classList.remove("username-mode","time-mode","message-mode");const o=Jt(e);n?this.selected.add(o):this.selected.delete(o)}showDeleteButton(e,n){if(ct())return;const t=document.querySelector(".delete-btn");t&&t.remove();const o=document.createElement("button");o.className="delete-btn",o.textContent="Delete",document.body.append(o);const{offsetWidth:s,offsetHeight:a}=o;let r;o.remove(),Object.assign(o.style,{position:"fixed",top:e.clientY-a/2+"px",left:e.clientX-s/2+"px"}),o.onclick=()=>{document.querySelectorAll(".selected-message").forEach((e=>{e&&(e.classList.remove("selected-message","username-mode","time-mode","message-mode"),0===e.classList.length&&e.removeAttribute("class"))})),this.storeDeleted([...this.selected]),o.remove(),this.selected.clear(),this.updateDeletedMessages(),this.renderToggle()},o.addEventListener("mouseenter",(()=>{r&&clearTimeout(r)})),o.addEventListener("mouseleave",(()=>{r=setTimeout((()=>{o.remove(),this.clearSelection()}),1e3)})),document.body.append(o)}clearSelection(){document.querySelectorAll(".selected-message").forEach((e=>{e&&(e.classList.remove("selected-message","username-mode","time-mode","message-mode"),0===e.classList.length&&e.removeAttribute("class"))})),this.selected.clear()}storeDeleted(e){const n=new Set(JSON.parse(localStorage.getItem("deletedChatMessagesContent")||"[]"));e.forEach((e=>n.add(e))),localStorage.setItem("deletedChatMessagesContent",JSON.stringify([...n]))}updateDeletedMessages(){const e=new Set(JSON.parse(localStorage.getItem("deletedChatMessagesContent")||"[]")),n=document.querySelectorAll(".messages-content p");0!==n.length&&(n.forEach((n=>{if(!n)return;const t=Jt(n);n.classList.remove("shown-message"),n.classList.toggle("hidden-message",e.has(t))})),localStorage.setItem("deletedChatMessagesContent",JSON.stringify([...e])))}renderToggle(){if(!(JSON.parse(localStorage.getItem("deletedChatMessagesContent")||"[]").length>0))return void(this.toggleBtn&&(this.toggleBtn.remove(),this.toggleBtn=null));const e=document.querySelector(".messages-content");e&&(this.toggleBtn||(this.toggleBtn=document.createElement("button"),this.toggleBtn.className="toggle-button toggle-hidden",this.toggleBtn.textContent="Show",this.toggleBtn.onclick=e=>{if(e.ctrlKey)return document.querySelectorAll(".messages-content p").forEach((e=>{e&&e.classList.remove("hidden-message","shown-message")})),localStorage.setItem("deletedChatMessagesContent",JSON.stringify([])),this.selected.clear(),this.updateDeletedMessages(),void this.renderToggle();const n="Show"===this.toggleBtn.textContent,t=JSON.parse(localStorage.getItem("deletedChatMessagesContent")||"[]");document.querySelectorAll(".messages-content p").forEach((e=>{if(!e)return;const o=Jt(e);t.includes(o)&&(e.classList.toggle("hidden-message",!n),e.classList.toggle("shown-message",n))})),n?(this.toggleBtn.textContent="Hide",this.toggleBtn.classList.remove("toggle-hidden"),this.toggleBtn.classList.add("toggle-shown")):(this.toggleBtn.textContent="Show",this.toggleBtn.classList.remove("toggle-shown"),this.toggleBtn.classList.add("toggle-hidden"))},e.append(this.toggleBtn)))}}function Jt(e){if(!e)return"";const n=e.cloneNode(!0);Array.from(n.querySelectorAll(".time")).forEach((e=>e.remove()));return[n.textContent,[...Array.from(e.querySelectorAll("a")).map((e=>e.href)),...Array.from(e.querySelectorAll("img")).map((e=>e.title.trim())),...Array.from(e.querySelectorAll("iframe")).map((e=>e.src.trim()))].filter(Boolean).join(" ")].filter(Boolean).join(" ")}const Kt={extra:"🚀",cyber:"🤖",superman:"👊",maniac:"🔪",racer:"⚡️",profi:"💼",driver:"🚖",amateur:"🍆",newbie:"🐥"};function Vt(e,n=0){const t=document.createElement("div");t.classList.add("participant-count"),t.innerHTML=n.toString(),e&&e.appendChild(t),t.addEventListener("mouseover",(function(){const e=Object.keys(Kt).reduce(((e,n)=>{const t=document.getElementsByClassName(n).length;return t>0&&e.push(`${Kt[n]}${t}`),e}),[]).join(" ");Le(t,e)}))}const{usersToTrack:Xt}=De,Yt=et().userList.general;let Gt=new Map,Wt=0,Zt=!1;function Qt(e,n){if(!e)return;const t=n.toString().length;e.textContent=n,e.style.fontSize=Math.max(24-2*(t-1),12)+"px"}const eo=new MutationObserver($n((e=>{e.forEach((e=>{if("childList"===e.type){const n=document.querySelector("#voice, #beep, #silence"),t=n&&"silence"===n.id,o=document.querySelector("#chat-wrapper.chat-hidden"),s=document.querySelector(".participant-count");if(o)return void(s&&(s.style.filter="grayscale(100%)",s.textContent="0"));const a=new Map(Array.from(Yt.children).map((e=>{const n=e.querySelector(".name"),t=n?.getAttribute("data-user"),o=n?.textContent?.trim();return t?[t,{userName:o}]:null})).filter(Boolean));if(!us)return;if(!Zt)return s&&0===Number(s.textContent)&&function(e,n){let t=0;const o=()=>{if(t<=e){const s=Math.min(t/(e||1),1);Qt(n,t++),n.style.filter=`grayscale(${100-100*s}%)`,setTimeout(o,20)}else fe(n),ge(n),Zt=!0};setTimeout(o,20)}(a.size,s),a.forEach(((e,n)=>Gt.set(n,e))),void setTimeout((()=>{Zt=!0}),2e3);let r=[...a].filter((([e])=>!Gt.has(e))).map((([e,n])=>({userId:e,...n}))),i=[...Gt].filter((([e])=>!a.has(e))).map((([e,n])=>({userId:e,userName:n.userName})));Gt=new Map(a);const l=Gt.size;function c(e,n){const{userName:o,userId:s}=e,a=function(e){const n=fn.find((n=>n.name===e));return n?n.gender:null}(o),r=Xt.some((e=>e.name===o&&"thawed"===e.state));$t(o,"enter"===n?v:b,"enter"===n),Ft(o,n),function(e,n){e&&n?(xn[e]=xn[e]||{},xn[e].actionLog=xn[e].actionLog||[],xn[e].actionLog.push({type:n,timestamp:Vn()})):console.error("Missing userId or actionType")}(s,n),!t&&r&&function(e,n,t){if(!_n("sound","presence"))return;const o=t||"Male",s=nn.find((n=>n.name===e)),a="enter"===n?pn[o].enter:pn[o].leave;cn("enter"===n?on:sn,.2),setTimeout((()=>mn(`${s.pronunciation} ${a}`,Ve)),300)}(o,n,a)}l!==Wt&&Zt&&s&&(Qt(s,l),s.style.filter=l>0?"none":"grayscale(100%)",fe(s)),r.forEach((e=>c(e,"enter"))),i.forEach((e=>c(e,"leave"))),Wt=l}}))}),te));const no=["jpg","jpeg","png","gif","webp"],to="📸",oo="🖥️",so="💀️️",ao=.2,ro=10,io=.1;let lo=0,co=!1,mo=[],po=null;const{bigImageEvents:uo}=ce,go=e=>{const n=(e=>{try{return e.match(/\.([^?#.]+)(?:[?#]|$)/i)?.[1]?.toLowerCase()||""}catch(e){return console.error("Error extracting extension:",e.message),""}})(e);return{allowed:no.includes(n),extension:n}},ho=(e,n)=>{const t=document.createElement("img");t.src=e,t.classList.add("scaled-thumbnail"),document.body.appendChild(t),lo=n;let o=1,s=!1,a=0,r=0,i=-50,l=-50;const c=e=>{An(e,"hide"),document.querySelector(".popup-panel")||qn("hide"),En()};return uo.unfocusedClick=e=>{t.contains(e.target)||(t.remove(),En())},uo.keydown=e=>{"Escape"===e.code||"Space"===e.code?(e.preventDefault(),c(t)):"ArrowLeft"===e.code?fo(-1):"ArrowRight"===e.code&&fo(1)},uo.wheel=e=>{const n=e.deltaY<0?1:-1;o+=n*io*o,o=Math.max(ao,Math.min(o,ro)),t.style.transform=`translate(${i}%, ${l}%) scale(${o})`},uo.mousemove=e=>{if(s){if(e.ctrlKey){const n=e.clientY-r,t=n<0?1:-1,s=Math.abs(n)*io*.05;o+=t*s*o,o=Math.max(ao,Math.min(o,ro))}else{const n=(e.clientX-a)/o*5,s=(e.clientY-r)/o*5;i+=n/t.clientWidth*100,l+=s/t.clientHeight*100}t.style.transform=`translate(${i}%, ${l}%) scale(${o})`,a=e.clientX,r=e.clientY}},uo.mousedown=e=>{const{button:n,clientX:o,clientY:i,target:l,ctrlKey:d}=e;if((0===n||2===n)&&l!==t)return;const m=l.src;0===n?fo(-1):2===n?(e.preventDefault(),d?(navigator.clipboard.writeText(m).catch(console.error),c(t)):fo(1)):1===n&&(s=!0,a=o,r=i,e.preventDefault())},uo.mouseup=e=>{1===e.button&&(s=!1)},uo.contextmenu=e=>e.preventDefault(),Object.entries(vn).forEach((([e,n])=>{document.addEventListener(e,n)})),t},fo=e=>{const n=lo+e;n>=0&&n<mo.length&&!co&&(co=!0,po&&(po.src=mo[n].imgSrc),setTimeout((()=>co=!1),50),lo=n)};function yo(e){const n=document.querySelector({generalMessages:".messages-content div",chatlogsMessages:".chat-logs-container",personalMessages:".messages-container-wrapper"}[e]);if(!n)return;const t=n.querySelectorAll("a:not(.skipped):not(.processed-image)");function o(t,o){const s=document.createElement("div");s.classList.add("clickable-thumbnail"),s.dataset.sourceLink=t.href;const a=document.createElement("img");a.src=t.href,a.onload=()=>{s.appendChild(a),t.parentNode.insertBefore(s,t.nextSibling),Jn(e,600)},a.onerror=()=>{console.error("Failed to load image:",t.href),t.classList.add("skipped")},o?t.querySelector(".clickable-thumbnail")||t.addEventListener("click",(e=>{t.querySelector(".clickable-thumbnail")||(s.appendChild(a),t.parentNode.insertBefore(s,t.nextSibling))})):(s.appendChild(a),t.parentNode.insertBefore(s,t.nextSibling)),s.addEventListener("click",(e=>{e.stopPropagation(),mo=[],n.querySelectorAll(".clickable-thumbnail").forEach(((e,n)=>{const t=e.querySelector("img");t&&e.dataset.sourceLink&&mo.push({link:e.dataset.sourceLink,imgSrc:t.src,index:n})}));const o=mo.findIndex((e=>e.link===t.href||e.imgSrc===a.src));po=ho(a.src,o>=0?o:0),An(po,"show"),qn("show")}))}t.length&&t.forEach((e=>{if(!e.href||!e.href.startsWith("http"))return;const{allowed:n,extension:t}=go(e.href);if(!n)return;e.classList.add("media");const{isTrusted:s,domain:a}=Xn(e.href);Le(e,In(e.href)?jn(e.href):e.href),s?function(e,n,t){e.textContent=`${to} ${n.toUpperCase()} ${oo} ${t}`,e.classList.add("processed-image"),o(e,!1)}(e,t,a):function(e,n,t){e.classList.add("skipped"),e.textContent=`${to} ${n.toUpperCase()} ${oo} ${t} ${so} Untrusted`,e.addEventListener("click",(n=>{e.classList.contains("processed-image")||(n.preventDefault(),e.classList.remove("skipped"),e.classList.add("processed-image"),o(e,!0))}))}(e,t,a)}))}const vo="📺",bo="📹",xo="🎬️",wo="🖥️",So="💀️️",ko=["mp4","webm","ogg","mov","avi"];let Eo=null,Co=null;async function Lo(e,n,t,o,s){e.innerHTML="",n.innerHTML="";const a=await async function(e){const n=`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${e}&format=json`;try{const e=await fetch(n),t=await e.json();return{title:t.title||"Title not found",channel:t.author_name||"Channel not found"}}catch(e){return console.error("Error fetching YouTube metadata:",e),{title:"Error",channel:"Error"}}}(t),r=document.createElement("span");r.classList.add("channel-name"),r.textContent=`${vo} ${a.channel}`;const i=document.createElement("span");i.classList.add("video-title"),i.textContent=`${bo} ${a.title}`,e.append(r,i);const l=document.createElement("img");l.src=`https://img.youtube.com/vi/${t}/hqdefault.jpg`,l.alt=o,l.classList.add("youtube-thumb"),n.appendChild(l),l.addEventListener("load",(()=>{Jn(s,600)}))}function To(e){if(!e)return void console.warn("containerType parameter is required");const n={generalMessages:".messages-content div",chatlogsMessages:".chat-logs-container",personalMessages:".messages-container-wrapper"};if(!n[e])return void console.warn(`Invalid containerType: ${e}`);const t=document.querySelector(n[e]);if(!t)return;const o=t.querySelectorAll("a:not(.skipped):not(.processed-video)");function s(e,n,t,o,s){const{youtubeMatch:a,videoType:r,videoId:i}=o,l=(e=>{const n=e.match(/\.([^?#.]+)(?:[?#]|$)/i)?.[1]?.toLowerCase()||"";return{allowed:ko.includes(n),extension:n}})(n);if(!a&&!l.allowed)return;e.classList.add("processed-video");const c=document.createElement("div");if(c.classList.add("video-wrapper"),e.textContent=`${xo} ${r} ${wo} ${t}`,Le(e,In(n)?jn(n):n),e.style.display="inline-flex",a){const n=document.createElement("div");n.classList.add("youtube-info");const t=document.createElement("div");t.classList.add("youtube-placeholder"),t.dataset.videoId=i,t.dataset.videoType=r,t.dataset.containerType=s,e.parentNode.insertBefore(c,e),c.append(e,n,t),Lo(n,t,i,r,s),t.addEventListener("click",(()=>{if(Co&&Co!==t){const e=Co.dataset.videoId,n=Co.dataset.videoType,t=Co.dataset.containerType,o=Co.previousElementSibling;o&&o.classList.contains("youtube-info")&&Lo(o,Co,e,n,t)}Co=t;const e=(Eo||(Eo=document.createElement("iframe"),Eo.classList.add("video-container"),Eo.allowFullscreen=!0,Eo.setAttribute("allow","fullscreen")),Eo);e.src=`https://www.youtube.com/embed/${i}?autoplay=1`,t.innerHTML="",t.appendChild(e)}))}else{const t=document.createElement("video");t.classList.add("video-container"),t.src=n,t.controls=!0,e.parentNode.insertBefore(c,e),c.append(e,t)}}o.length&&o.forEach((n=>{const t=n.href;if(!t)return;const o=function(e){const n=e.match(/(?:shorts\/|live\/|watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/i);if(n)return{youtubeMatch:!0,videoId:n[1],videoType:e.includes("shorts/")?"Shorts":e.includes("live/")?"Live":e.includes("watch?v=")?"Watch":e.includes("youtu.be/")?"Share":"YouTube"};const t=e.split(".").pop().toLowerCase();return!!ko.includes(t)&&{youtubeMatch:!1,videoType:`Video (${t.toUpperCase()})`}}(t);if(!o)return;n.classList.add("media");const{isTrusted:a,domain:r}=Xn(t);if(!a)return n.classList.add("skipped"),n.textContent=`${xo} ${o.videoType} ${wo} ${r} ${So} Untrusted`,void n.addEventListener("click",(a=>{n.classList.contains("processed-video")||(a.preventDefault(),n.classList.remove("skipped"),s(n,t,r,o,e))}));s(n,t,r,o,e)}))}const Mo={};function $o(){if("true"!==localStorage.getItem("shouldShowPopupMessage"))return;const e=document.querySelector(".messages-content p:last-of-type");if(e){const n=e.querySelector(".time"),t=e.querySelector(".username"),o=Array.from(e.childNodes).map((e=>{if(e.nodeType===Node.TEXT_NODE)return{type:"text",value:e.nodeValue.replace(/ /g," ")};if(e.nodeType===Node.ELEMENT_NODE){if("a"===e.tagName.toLowerCase()&&e.classList.contains("private"))return{type:"text",value:"📢 "};if("span"===e.tagName.toLowerCase()&&e.classList.contains("private"))return{type:"text",value:e.textContent.replace(/ /g," ")};if("img"===e.tagName.toLowerCase())return{type:"img",title:e.getAttribute("title")};if("a"===e.tagName.toLowerCase())return{type:"anchor",href:e.getAttribute("href")}}})).filter(Boolean),s=n.textContent.replace(/[\[\]]/g,""),a=t.textContent.replace(/[<>]/g,"");let r=Mo[a];r||(r=15*Math.floor(24*Math.random()),Mo[a]=r);let i=document.querySelector(".popup-messages-container");if(i||(i=document.createElement("div"),i.classList.add("popup-messages-container"),document.body.appendChild(i)),i.childElementCount>=10){const e=i.firstChild;e.classList.add("fade-out"),setTimeout((()=>{i.removeChild(e)}),300)}const l=document.createElement("div");l.classList.add("popup-chat-message"),l.style.filter=`hue-rotate(${r}deg)`;const c=document.createElement("div");c.classList.add("time-icon"),c.innerHTML=icons.clockSVG;const d=document.createElement("div");d.classList.add("time"),d.textContent=s;const m=document.createElement("div");m.classList.add("user-icon"),m.innerHTML=icons.userSVG;const p=document.createElement("div");p.classList.add("username"),p.textContent=a;const u=document.createElement("div");u.classList.add("action-icon"),u.innerHTML=icons.actionSVG;const g=document.createElement("div");g.classList.add("message"),l.appendChild(c),l.appendChild(d),l.appendChild(m),l.appendChild(p),l.appendChild(u),l.appendChild(g),o.forEach((e=>{const n=document.createElement("div");"text"===e.type?n.textContent=e.value:"img"===e.type?n.innerHTML=`&nbsp;${e.title}&nbsp;`:"anchor"===e.type&&(n.innerHTML=`&nbsp;${e.href}&nbsp;`),g.appendChild(n)})),i.appendChild(l)}}const{ignored:No}=De;let qo=!1;const Ao=new MutationObserver((async e=>{if(tt(document.querySelectorAll(".username"),"all"),us)for(let n of e)if("childList"===n.type)for(let e of n.addedNodes)if(e.nodeType===Node.ELEMENT_NODE&&"P"===e.tagName){const n=e.querySelector(".username");n&&tt(n,"one");const t=localStorage.getItem("previousMessageText"),o=await ot(),s=o?.messageText||null,a=o?.usernameText||null,r=Zn(a);if(Qn(s)&&(console.log("Ban message detected:",s),new Audio("https://github.com/VimiummuimiV/Sounds/raw/refs/heads/main/Mario_Game_Over.mp3").play()),a&&No.includes(a)){e.classList.add("ignored-user",r),e.style.display="none";continue}const i=document.querySelector("#voice, #beep, #silence"),l=i&&"voice"===i.id,c=i&&"beep"===i.id,d=document.querySelector("#every-message, #mention-message"),m=d&&"every-message"===d.id,p=d&&"mention-message"===d.id,u="[шепчет вам]",g=e.querySelector(".room.private"),h=g&&g.textContent.includes(u);if(l&&us&&s&&s!==t&&(localStorage.setItem("previousMessageText",s),a&&!a.includes(se))){(m||p&&qo||h)&&lt(s)}if(c&&us&&s&&s!==t&&(localStorage.setItem("previousMessageText",s),a&&!a.includes(se))){if(m||p&&qo||h){cn(!m||qo?rn:an,.2),qo&&(qo=!1)}}us&&(yo("generalMessages"),To("generalMessages"),On("generalMessages"),ut(),Jn("generalMessages",350),$o(),Wn())}}));const{chatField:Io,messagesContainer:jo}=et();let Oo=null;(wn("gmid")||wn("gamelist"))&&(Oo=document.createElement("div"),Oo.className="length-field-popup",jo.appendChild(Oo));const Bo=document.createElement("canvas").getContext("2d");let Ho,Do,Po,zo=!1,Fo=0;function Uo(e){let n;n=e>Fo?`${e} 🡆`:e<Fo?`🡄 ${e}`:`${e}`,Oo.textContent=n,function(e){if(!Oo)return void console.error("lengthPopup is not defined");let n;if(0===e)n="hsl(200, 20%, 50%)";else if(e>=1&&e<=90)n="hsl(120, 100%, 40%)";else if(e>90&&e<=100){const t=(e-90)/10;n=`hsl(${Math.round(120+-60*t)}, 100%, 40%)`}else if(e>100&&e<=190)n="hsl(60, 100%, 50%)";else if(e>190&&e<=200){const t=(e-190)/10;n=`hsl(${Math.round(60+-30*t)}, 100%, 50%)`}else if(e>200&&e<=250)n="hsl(40, 100%, 50%)";else if(e>250&&e<=300){const t=(e-250)/50;n=`hsl(${Math.round(40+-40*t)}, 100%, 70%)`}else n="hsl(0, 100%, 70%)";Oo.style.color=n}(e),Fo=e}function _o(e){zo!==e&&(Oo.classList.toggle("bounce-in",e),Oo.classList.toggle("bounce-out",!e),zo=e,e||setTimeout((()=>Oo.classList.remove("bounce-out")),500))}function Ro(){clearTimeout(Ho),Uo(Io.value.length),function(e){const n=getComputedStyle(Io);Bo.font=`${n.fontWeight} ${n.fontSize} ${n.fontFamily}`;const t=Bo.measureText(e).width,o=Io.offsetLeft+t+5,s=Io.offsetLeft+Io.offsetWidth-Oo.offsetWidth;Oo.style.left=`${Math.min(o,s)}px`}(Io.value),_o(!0),Ho=setTimeout((()=>_o(!1)),1e3)}function Jo(e){"Enter"===e.key&&(Uo(0),Object.assign(Oo.style,{left:"0px",color:"hsl(200, 20%, 50%)"}),_o(!0),Ho=setTimeout((()=>_o(!1)),1e3))}function Ko(){Po.innerHTML="every-message"===Do.id?L:T}var Vo=t(946),Xo={};Xo.styleTagTransform=g(),Xo.setAttributes=d(),Xo.insert=l().bind(null,"head"),Xo.domAPI=r(),Xo.insertStyleElement=p();s()(Vo.A,Xo);Vo.A&&Vo.A.locals&&Vo.A.locals;var Yo=t(720),Go={};Go.styleTagTransform=g(),Go.setAttributes=d(),Go.insert=l().bind(null,"head"),Go.domAPI=r(),Go.insertStyleElement=p();s()(Yo.A,Go);Yo.A&&Yo.A.locals&&Yo.A.locals;const{ignored:Wo}=De;let{panelsEvents:Zo}=ce;const Qo=async(e,n)=>{n&&(n.innerHTML="");const t=`https://klavogonki.ru/chatlogs/${e}.html?rand=${Math.floor(Math.random()*10**20)}`;try{const e=await fetch(t);if(!e.ok)throw new Error("Network response was not ok");const n=await e.text(),o=1024*1e3,s=n.length>o?n.slice(0,o):n,a=(e=>[...(new DOMParser).parseFromString(e,"text/html").querySelectorAll(".ts")].map((e=>{const n=e.nextElementSibling,t=n?.nextSibling,o=e=>e?[...e.childNodes].reduce(((e,n)=>{if(n.nodeType===Node.TEXT_NODE)e+=n.textContent;else if(n.nodeType===Node.ELEMENT_NODE)if("A"===n.tagName)e+=n.getAttribute("href");else if("BR"===n.tagName)return e;return e}),"").trim():"";if(n?.classList.contains("mn")&&t){let s="";if(t.nodeType===Node.ELEMENT_NODE)s=o(t);else if(t.nodeType===Node.TEXT_NODE){const e=n.nextElementSibling;s=e&&"A"===e.tagName?`${t.textContent.trim()} ${e.getAttribute("href")}`:t.textContent.trim()}return s||(s=o(n.nextSibling)),{time:e.textContent.trim().replace(/[\[\]]/g,""),username:n.textContent.trim().replace(/<|>/g,""),message:s||null}}const s=e.nextElementSibling;if(s&&s.classList.contains("mne")){const n=s.textContent.trim();return{time:e.textContent.trim().replace(/[\[\]]/g,""),username:"SYSTEM",message:n||null}}return null})).filter(Boolean))(s),r=n.length>o,i=[];let l=null;for(const e of a){const n=e.message!==l?.message,t=e.username!==l?.username;(n||t)&&(i.push(e),l=e)}return{chatlogs:i.filter((e=>!Wo.includes(e.username))),url:t,size:s.length,info:r,error:null}}catch(e){return{chatlogs:[],url:t,size:0,error:e.message}}},es="2012-02-12";async function ns(e){const n=JSON.parse(localStorage.getItem("userIdsCache")||"{}");if(n[e])return n[e];try{const t=await async function(e){const n=`https://klavogonki.ru/api/profile/search-users?query=${e}`,t=await Pn(n);if(!t.all?.length)throw new Error(`User ${e} not found.`);const o=t.all.find((n=>n.login===e));if(!o)throw new Error(`Exact match for user ${e} not found.`);return o.id}(e);if(t)return n[e]=t,localStorage.setItem("userIdsCache",JSON.stringify(n)),t}catch(n){console.error(`Error fetching user ID for ${e}:`,n)}return null}let ts={media:!1,mention:!1};const os=()=>{ts={media:!1,mention:!1}};async function ss(e){const n="mention"===e;ts={media:!!("media"===e)&&!ts.media,mention:!!n&&!ts.mention},document.querySelectorAll(".message-item").forEach((e=>{const n=e.querySelector(".media"),t=e.querySelector(".mention");ts.media?(e.style.contentVisibility=n?"visible":"hidden",e.style.fontSize=n?"":"0"):ts.mention?(e.style.contentVisibility=t?"visible":"hidden",e.style.fontSize=t?"":"0"):(e.style.contentVisibility="visible",e.style.fontSize="")}))}async function as(e){const n=document.querySelector(".chat-logs-panel");if(n)return n.remove(),void qn("hide");Cn();const t=document.createElement("div");t.className="chat-logs-panel popup-panel";const o=document.createElement("div");o.className="panel-header";const s=document.createElement("div");s.className="panel-control-buttons";const a=document.createElement("div");a.className="search-for-chatlogs-messages";const r=document.createElement("input");function i(){requestAnimationFrame((function(){r.focus()}))}r.className="chatlogs-search-input",r.type="text",Le(r,"\n    [Ctrl + Click] clear input and reset filtered items\n    [Valid date + Enter] load chat logs for the date in input field (e.g. 2023-10-01, 2023:10:01, 231001, 2310, 2310:01)\n    "),a.appendChild(r),o.appendChild(a),r.addEventListener("input",(()=>D(r.value))),r.addEventListener("click",(e=>{e.ctrlKey&&(r.value="",D(r.value))})),r.addEventListener("keydown",(async e=>{const n=r.value;if("Enter"===e.key){let e=n;/^\d{8}$/.test(n)?(e=6===n.length?"20"+n:n,e=e.replace(/(\d{4})(\d{2})(\d{2})/,"$1-$2-$3")):/^\d{6}$/.test(n)&&(e="20"+n.replace(/(\d{2})(\d{2})(\d{2})/,"$1-$2-$3"));/^\d{2,4}[:\-]\d{2}[:\-]\d{2}$/.test(e.replace(/:/g,"-"))&&!isNaN(new Date(e.replace(/:/g,"-")).getTime())?(await j(e),c(d)):alert("Please enter a valid date.\n\nValid formats include:\n1. yyyy-mm-dd\n2. yyyy:mm:dd\n3. yy-mm-dd\n4. yy:mm:dd\n5. yyyymmdd\n6. yymmdd\n\n"),r.value=""}})),i();const l=document.createElement("div");function c(e){"none"===e.style.display&&(e.style.display="flex")}l.className="large-button panel-header-date-button",l.innerHTML=_,l.addEventListener("click",(()=>{var e;(e=d).style.display="none"===e.style.display?"flex":"none"}));const d=document.createElement("input");d.type="date",d.className="chatlogs-date-input",d.style.display="none",s.appendChild(l),s.appendChild(d);const m=document.createElement("div");m.className="large-button toggle-mention-messages-button",m.innerHTML=N,Le(m,"Toggle Mention Messages"),m.addEventListener("click",(async()=>{await ss("mention")}));const p=document.createElement("div");p.className="toggle-mention-messages-counter",p.textContent="0",m.appendChild(p),s.appendChild(m);const u=document.createElement("div");u.className="large-button panel-header-toggle-media-messages",u.innerHTML=A,Le(u,"Toggle Media Messages"),u.addEventListener("click",(async()=>{await ss("media")}));const g=document.createElement("div");g.className="toggle-media-messages-counter",g.textContent="0",u.appendChild(g),s.appendChild(u);const h=document.createElement("div");h.className="large-button panel-header-copy-button",h.innerHTML=R,Le(h,"\n    [Click] to copy Chat Logs Url\n    [Ctrl + Click] to save Chat Logs Url with title\n    [Shift + Click] to show/hide saved Chat Logs Urls\n  ");const f=e=>{const n=e.match(/(\d{4}-\d{2}-\d{2})/);return n?n[1]:null};function y(e,n){n&&(n.replaceChildren(),e.forEach((({url:t,title:o})=>{const s=f(t),a=document.createElement("div");a.classList.add("saved-chatlog-url-wrapper");const r=document.createElement("a");r.classList.add("saved-chatlog-url"),r.textContent=s,r.href=t,r.addEventListener("click",(async n=>{if(n.preventDefault(),n.ctrlKey){const t=n.target.href,o=e.filter((e=>e.url!==t));if(o.length!==e.length){e=o,localStorage.setItem("savedChatlogs",JSON.stringify(e));n.target.closest(".saved-chatlog-url-wrapper").remove()}}else await j(s)}));const i=document.createElement("span");i.classList.add("saved-chatlog-url-title"),i.textContent=o||"➕",i.addEventListener("click",(()=>{const n=prompt("Enter a new title for this chat log:",i.textContent);if(null!==n&&n!==i.textContent){i.textContent=n;const o=e.findIndex((e=>e.url===t));-1!==o&&(e[o].title=n,localStorage.setItem("savedChatlogs",JSON.stringify(e)))}})),a.appendChild(r),a.appendChild(i),n.appendChild(a)})))}h.addEventListener("click",(e=>{let n=document.querySelector(".saved-chatlog-container");!n&&!e.shiftKey&&ge(h,0,0),!n||e.ctrlKey||n.contains(e.target)||n.remove();let t=JSON.parse(localStorage.getItem("savedChatlogs"))||[];if(e.ctrlKey&&!e.target.closest(".saved-chatlog-url")){const e=f(I);if(!e)return;const o=prompt("Enter a title for this chat log:","➕");t.some((n=>f(n.url)===e))||(t.push({url:I,title:o||"➕"}),t.sort(((e,n)=>{const t=f(e.url),o=f(n.url);return new Date(t)-new Date(o)})),localStorage.setItem("savedChatlogs",JSON.stringify(t))),y(t,n)}else e.shiftKey?t.length>0&&!n&&(n=document.createElement("div"),n.classList.add("saved-chatlog-container"),y(t,n),h.appendChild(n)):navigator.clipboard.writeText(I).catch((e=>console.error("Failed to copy: ",e)))})),s.appendChild(h);const v=localStorage.getItem("shouldShowActiveUsers")||(localStorage.setItem("shouldShowActiveUsers","shown"),"shown"),b=document.createElement("div");function x(e){b.innerHTML="shown"===e?U:F,Le(b,"shown"===e?"Hide User List":"Show User List")}b.className="large-button panel-header-toggle-button",x(v),b.addEventListener("click",(function(){const e="shown"===localStorage.getItem("shouldShowActiveUsers")?"hidden":"shown";if(localStorage.setItem("shouldShowActiveUsers",e),x(e),"shown"===e)B(q,t);else{const e=t.querySelector(".active-users");e&&t.removeChild(e)}})),s.appendChild(b);const w=document.createElement("div");w.className="large-button panel-header-one-day-back-button",w.innerHTML=J,Le(w,"Previous Day");const S=document.createElement("div");S.className="large-button panel-header-one-day-forward-button",S.innerHTML=K,Le(S,"Next Day");const k=document.createElement("div");function E(){return d.value?new Date(d.value):new Date}k.className="large-button panel-header-shuffle-button",k.innerHTML=V,Le(k,"Random Date");w.addEventListener("click",(async()=>{const e=E();e.setDate(e.getDate()-1),await j(e),c(d),i(),os()})),S.addEventListener("click",(async()=>{const e=E();e.setDate(e.getDate()+1),await j(e),c(d),i(),os()})),k.addEventListener("click",(async()=>{const e=function(){const e=new Date(es),n=new Date-e,t=Math.floor(Math.random()*n),o=new Date(e.getTime()+t);return new Intl.DateTimeFormat("en-CA").format(o)}();await j(e),c(d),i(),os()})),s.appendChild(w),s.appendChild(S),s.appendChild(k);const C=document.createElement("div");C.className="large-button panel-header-close-button",C.innerHTML=O,Le(C,"Close panel"),C.addEventListener("click",(()=>{An(t,"hide"),qn("hide")})),s.appendChild(C),o.appendChild(s);const L=document.createElement("div");L.className="chat-logs-container",t.appendChild(o),t.appendChild(L),document.body.appendChild(t);const{scrollButtonsContainer:T}=Mn(L);t.appendChild(T),An(t,"show"),qn("show");const M={};let $=null;const q=new Map;let I="";const j=async e=>{const n=new Intl.DateTimeFormat("en-CA").format(new Date((e=>/^\d{4}:\d{2}:\d{2}$/.test(e)?e.replace(/:/g,"-"):e)(e)));if(n<es||n>re)return void alert(n<es?`The selected date cannot be earlier than ${es}.`:"You cannot load a future date.");var o;o=n,d.value=o,Le(l,`Current date: ${o}`);const{chatlogs:s,url:a,size:i,info:c,error:m}=await Qo(n,L),u=(i/1024).toFixed(2);r.placeholder=m?`Error: ${m}`:c?`Limit reached: ${u} KB`:c||`Size: ${u} KB`,I=a,q.clear(),s.forEach((async({time:n,username:t,message:o})=>{q.set(t,(q.get(t)||0)+1);const s=document.createElement("div");s.classList.add("message-item"),s.addEventListener("click",(async e=>{e.target.closest("a")||(ts&&await ss(),r.value.length>0&&(r.value=""),await Kn(L,s))}));const a=document.createElement("span");a.className="message-time",a.textContent=n,a.addEventListener("click",(function(){const t=`https://klavogonki.ru/chatlogs/${e}.html#${n}`;window.open(t,"_blank","noopener,noreferrer")}));const i=document.createElement("span");i.className="message-username",i.textContent=t,i.addEventListener("click",(async()=>{const e=await ns(t);if(e){const n=`https://klavogonki.ru/u/#/${e}/`;window.open(n,"_blank","noopener,noreferrer")}else he(i)}));let l=M[t];l||(l=15*Math.floor(14*Math.random()),M[t]=l),i.style.color=`hsl(${l}, 80%, 50%)`;const c=document.createElement("span");c.className="message-text",c.innerHTML=o.replace(/:(?=\w*[a-zA-Z])(\w+):/g,((e,n)=>`<img src="/img/smilies/${n}.gif" alt=":${n}:" title=":${n}:" class="smile">`)).replace(/(https?:\/\/[^\s]+)/gi,(e=>`<a href="${e}" target="_blank" rel="noopener noreferrer">${e}</a>`)),s.style.marginTop=$!==t?"0.6em":"",$=t,s.appendChild(a),s.appendChild(i),s.appendChild(c),L.appendChild(s)})),B(q,t,r),requestAnimationFrame((()=>{yo("chatlogsMessages"),To("chatlogsMessages"),On("chatlogsMessages"),Yn("chatlogsMessages"),L.scrollTop=L.scrollHeight,g.textContent=document.querySelectorAll(".chat-logs-container .media").length,p.textContent=document.querySelectorAll(".chat-logs-container .mention").length,L.childElementCount>0&&(r.placeholder+=` | Total messages: ${L.childElementCount}`),r.value.length>0&&D(r.value)}))};function B(e,n,t){if("shown"===localStorage.getItem("shouldShowActiveUsers")){let t=n.querySelector(".active-users");t||(t=document.createElement("div"),t.className="active-users",n.appendChild(t));const o=Array.from(e.entries()).sort((([,e],[,n])=>n-e));t.innerHTML="",o.forEach((([e,n])=>{const o=document.createElement("div");o.className="active-user-item",o.addEventListener("click",(n=>{const t=r.value.trim(),o=n.ctrlKey?`, ${e}`:e;r.value=t===e?"":n.ctrlKey&&!t.includes(e)?t+o:e,D(r.value)}));const s=document.createElement("span");s.className="active-user-name",s.textContent=e,Le(s,`\n          [Click] to filter messages by ${e}\n          [Repeat Click] to clear ${e} from the search input\n          [Ctrl + Click] to add additional username to the search input\n        `);const a=M[e]||0;s.style.color=`hsl(${a}, 80%, 50%)`;const i=document.createElement("span");i.className="active-user-messages-count",i.textContent=n,i.style.color=`hsl(${a}, 80%, 50%)`,i.style.backgroundColor=`hsla(${a}, 80%, 50%, 0.2)`,o.appendChild(i),o.appendChild(s),t.appendChild(o)}))}}const H=e||re;function D(e){if(/^[\d-:]+$/.test(e.trim()))return;function n(e){return e.replace(/[_-]/g," ").toLowerCase()}const t=n(e).trim(),o=Array.from(document.querySelectorAll(".chat-logs-container > .message-item")),s=function(e){return e.map((e=>{const n=e.querySelector(".message-username"),t=n?n.textContent.toLowerCase().trim():"",o=e.querySelector(".message-text");return{username:t,messageText:o?o.textContent.toLowerCase().trim():""}}))}(o),a=!t,r=t.split(",").map((e=>e.trim())).filter(Boolean),i=r.filter((e=>s.some((t=>n(t.username)===e)))).length>=2;o.forEach(((e,o)=>{const l=e.closest(".message-item"),c=s[o];let d=!1;const m=n(c.username),p=n(c.messageText);d=!!a||(i?r.some((e=>m===e)):m.includes(t)||p.includes(t)),l.style.contentVisibility=d?"visible":"hidden",l.style.fontSize=d?"":"0"}))}await j(H),e&&c(d),d.max=re,d.min=es,d.value=H,Le(l,`Current date: ${H}`),d.addEventListener("change",(async e=>{const n=e.target.value;await j(n),Le(l,`Current date: ${n}`)})),Zo.handleChatLogsKeydown=e=>{"Escape"===e.key&&(An(t,"hide"),qn("hide"),document.removeEventListener("keydown",Zo.handleChatLogsKeydown))},document.addEventListener("keydown",Zo.handleChatLogsKeydown)}let{panelsEvents:rs}=ce;function is(e){const n=document.createElement("div");n.classList.add("empowerment-button","personal-messages-button"),n.innerHTML=N;const t=document.createElement("div");t.classList.add("message-count","total-message-count");const o=JSON.parse(localStorage.getItem("personalMessages"))||{};t.textContent=Object.keys(o).length,n.appendChild(t);const s=document.createElement("div");s.classList.add("message-count","new-message-count");let a=Number(localStorage.getItem("newMessagesCount"))||(localStorage.setItem("newMessagesCount","0"),0);s.textContent=a,s.style.visibility=a>0?"visible":"hidden",n.appendChild(s),Le(n,"Show Personal Messages"),n.addEventListener("click",(function(){fe(n),ps();Object.keys(JSON.parse(localStorage.getItem("personalMessages"))||{}).length>0&&(localStorage.setItem("newMessagesCount","0"),a=0,s.textContent=a)})),e.appendChild(n)}async function ls(e,n,t){const o=document.querySelector(".messages-content");if(!o)return null;const s=e=>(e||"").replace(/\s+/g," ").replace(/[_-]/g," ").trim().toLowerCase(),a=s(e),r=s(n),i=Array.from(o.querySelectorAll("p")).find((e=>{const n=e.querySelector(".username span[data-user]");if(n){const t=s(n.textContent),o=s(function(e){let n="";for(let t of e.childNodes)t.nodeType===Node.TEXT_NODE&&(n+=t.textContent);return n.trim()}(e));return t===r&&o.includes(a)}return!1}));return i&&t&&await Kn(o,i),i||!1}function cs(e){const n=180- -(new Date).getTimezoneOffset(),[t,o,s]=e.split(":").map(Number);let a=60*t+o+n;a=(a%1440+1440)%1440;const r=a%60;return`${Math.floor(a/60).toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`}function ds(e,n="single"){const t=e.querySelector(".message-time").textContent,o=e.querySelector(".message-username").textContent;let s=JSON.parse(localStorage.getItem("personalMessagesBackup"))||{};if(0===Object.keys(s).length){s={...JSON.parse(localStorage.getItem("personalMessages"))||{}},localStorage.setItem("personalMessagesBackup",JSON.stringify(s))}let a={...s};if("all"===n)document.querySelectorAll(".message-item").forEach((e=>{const n=e.querySelector(".message-username").textContent;if(n===o){e.remove();const t=e.querySelector(".message-time").textContent;delete a[`[${t}]_${n}`]}}));else if("from"===n){const n=Array.from(document.querySelectorAll(".message-item"));for(let t=n.indexOf(e);t<n.length;t++){const e=n[t],s=e.querySelector(".message-username").textContent;if(s===o){e.remove();const n=e.querySelector(".message-time").textContent;delete a[`[${n}]_${s}`]}}}else{const n=`[${t}]_${o}`;a[n]&&(delete a[n],e.remove())}localStorage.setItem("personalMessagesBackup",JSON.stringify(a));const r=document.querySelector(".personal-messages-button .total-message-count");r&&(r.textContent=Object.keys(a).length)}function ms(){const e=Object.keys(JSON.parse(localStorage.getItem("personalMessages")||"{}")).length;document.querySelector(".personal-messages-button .total-message-count").textContent=e}async function ps(){const e=document.querySelector(".cached-messages-panel");if(e)return e.remove(),void qn("hide");let n=!0,t=!1;ms(),localStorage.getItem("personalMessagesBackup")&&localStorage.removeItem("personalMessagesBackup"),Cn();const o=document.querySelector(".personal-messages-button .new-message-count");function s(){const e=localStorage.getItem("personalMessages");return JSON.parse(e)||{}}o&&(o.textContent="0"),o.style.visibility="hidden",localStorage.removeItem("newMessagesCount");let a=s();const r=document.createElement("div");r.className="cached-messages-panel popup-panel";const i=document.createElement("div");i.className="panel-header";const l=document.createElement("div");l.className="search-for-personal-messages";const c=document.createElement("input");c.className="personal-messages-search-input",c.type="search",Le(c,"[Ctrl + Click] to clear search input and display all personal messages"),l.appendChild(c);const d=document.createElement("div");d.className="panel-control-buttons";const m=document.createElement("div");m.className="large-button panel-header-save-button",m.innerHTML=Z,Le(m,"Save messages"),m.style.opacity="0",m.addEventListener("click",(()=>{const e=localStorage.getItem("personalMessagesBackup"),t=localStorage.getItem("personalMessages"),o=e&&t;if(o&&o&&t!==e&&!n){window.confirm("Do you want to apply changes?")&&(localStorage.setItem("personalMessages",e),localStorage.removeItem("personalMessagesBackup"),m.style.setProperty("display","none","important"),m.style.opacity="0",m.addEventListener("transitionend",(function(){m.style.display="none"})))}}));const p=document.createElement("div");p.className="large-button panel-header-import-button",p.innerHTML=G,Le(p,"Import messages"),p.addEventListener("click",(()=>{t=!0;const e=document.createElement("input");e.type="file",e.accept=".json",e.addEventListener("change",(e=>{const n=e.target.files[0];if(n){const e=new FileReader;e.onload=async()=>{try{const n=JSON.parse(e.result),t={...JSON.parse(localStorage.getItem("personalMessages")||"{}"),...n},o=Object.fromEntries(Object.entries(t).sort((([,e],[,n])=>{const t=e.time.replace(/[[\]]/g,""),o=n.time.replace(/[[\]]/g,""),s=`${e.date} ${t}`,a=`${n.date} ${o}`;return new Date(s)-new Date(a)})));localStorage.setItem("personalMessages",JSON.stringify(o)),ms();const a=s();await L(a)}catch(e){alert("Failed to import messages. The file may be corrupted.")}},e.readAsText(n)}})),e.click()}));const u=document.createElement("div");u.className="large-button panel-header-export-button",u.innerHTML=W,Le(u,"Export messages"),u.addEventListener("click",(()=>{const e=localStorage.getItem("personalMessages");if(e&&"{}"!==e){const n=new Intl.DateTimeFormat("en-CA").format(new Date),t=JSON.parse(e),o=JSON.stringify(t,null,2),s=new Blob([o],{type:"application/json"}),a=document.createElement("a");a.href=URL.createObjectURL(s),a.download=`Personal_Messages_${n}.json`,a.click()}else alert("No messages to export.")}));const g=document.createElement("div");g.className="large-button panel-header-copy-button",g.innerHTML=R,Le(g,"Copy Personal Messages"),g.addEventListener("click",(()=>{const e=Array.from(document.querySelector(".messages-container").children).filter((e=>{const n=window.getComputedStyle(e);return"hidden"!==n.contentVisibility&&"none"!==n.display})).map((e=>e.classList.contains("date-item")?e.textContent.trim():[e.querySelector(".message-time"),e.querySelector(".message-username"),e.querySelector(".message-text")].map((e=>e?.textContent.trim())).filter(Boolean).join(" "))).filter(Boolean).join(" \n");e.trim()?(ge(g,0,0),navigator.clipboard.writeText(e).catch(console.error)):alert("No messages to copy.")}));const h=document.createElement("div");h.className="large-button panel-header-clear-button",Le(h,"Clear personal messages"),h.innerHTML=X,h.addEventListener("click",(()=>{t=!0;const e=JSON.parse(localStorage.getItem("personalMessages")||"{}");if(0===Object.keys(e).length)return void alert("No messages to delete.");y.innerHTML=null,localStorage.setItem("personalMessages",JSON.stringify({})),An(r,"hide"),qn("hide");const n=document.querySelector(".personal-messages-button .total-message-count");n&&(n.textContent="0")}));const f=document.createElement("div");f.className="large-button panel-header-close-button",Le(f,"Close panel"),f.innerHTML=O,f.addEventListener("click",(()=>{An(r,"hide"),qn("hide")})),i.appendChild(l),d.appendChild(m),d.appendChild(p),d.appendChild(u),d.appendChild(g),d.appendChild(h),d.appendChild(f),i.appendChild(d),r.appendChild(i);const y=document.createElement("div");y.className="messages-container";let v=null,b=0,x=100,w=!1,S=null;const k=[],E={private:"coral",mention:"darkseagreen"},C={private:"coral",mention:"lightsteelblue",default:"slategray"};async function L(e){y.children.length&&y.replaceChildren(),Object.entries(e).forEach((([,{time:e,date:n,username:t,usernameColor:o,message:s,type:a,userId:i}])=>{if(S!==n){const e=document.createElement("div");e.className="date-item",e.textContent=n===re?"Today ⏳":`${n} 📅`,e.dataset.date=n,y.appendChild(e),S=n}const l=document.createElement("div");l.className="message-item",t!==v&&(l.style.marginTop="0.6em",v=t);const c=e.replace(/[\[\]]/g,"").trim(),d=document.createElement("span");if(d.className="message-time",d.textContent=c,Le(d,`Moscow Time: ${cs(c)}`),d.style.color=E[a]||"slategray","mention"===a||"private"===a){const e="mention"===a?"lightgreen":"peachpuff";d.addEventListener("mouseover",(()=>{d.style.color=e})),d.addEventListener("mouseout",(()=>{d.style.color=E[a]})),d.addEventListener("click",(e=>{if(e.ctrlKey)ds(l,"from");else if("mention"===a){const e=`https://klavogonki.ru/chatlogs/${n}.html#${cs(c)}`;window.open(e,"_blank","noopener,noreferrer")}}))}const m=document.createElement("span");m.className="message-username",m.textContent=t,m.style.color=o,m.addEventListener("click",(e=>{if(e.ctrlKey)ds(l,"all");else if(i){const e=`https://klavogonki.ru/u/#/${i}/`;window.open(e,"_blank","noopener,noreferrer")}else addShakeEffect(m)}));const p=document.createElement("span");p.className="message-text",p.innerHTML=s.replace(/:(?=\w*[a-zA-Z])(\w+):/g,((e,n)=>`<img src="/img/smilies/${n}.gif" alt=":${n}:" title=":${n}:" class="smile">`)).replace(/(https?:\/\/[^\s]+)/gi,(e=>`<a href="${e}" target="_blank" rel="noopener noreferrer">${e}</a>`)),p.addEventListener("click",(async function(n){if(n.ctrlKey)return void ds(l,"single");if(await ls(e,t,!0))An(r,"hide"),qn("hide");else{let e=p.parentElement.previousElementSibling;for(;e&&!e.classList.contains("date-item");)e=e.previousElementSibling;if(e){await as(e.dataset.date);const n=p.textContent;requestAnimationFrame((async()=>{setTimeout((async()=>{const e=await async function(e,n,t){const o=document.querySelector(".chat-logs-container");if(!o)return null;const s=e=>(e||"").replace(/\s+/g," ").replace(/[_-]/g," ").trim().toLowerCase(),a=s(e),r=s(n),i=Array.from(o.querySelectorAll(".message-item")).find((e=>{const n=e.querySelector(".message-username"),t=e.querySelector(".message-text");if(n&&t){const e=s(n.textContent),o=s(t.textContent);return e===r&&o.includes(a)}return!1}));return i&&t&&await Kn(o,i),i||!1}(n,t,!0);if(!e){An(document.querySelector(".chat-logs-panel"),"hide"),ps()}}),500)}))}}}));const u={messageTextElement:p,time:e,username:t,type:a};k.push(u),l.appendChild(d),l.appendChild(m),l.appendChild(p),y.appendChild(l)})),requestAnimationFrame((()=>{yo("personalMessages"),To("personalMessages"),On("personalMessages"),Yn("personalMessages"),y.scrollTop=y.scrollHeight,new MutationObserver((e=>{t||e.find((e=>"childList"===e.type&&e.removedNodes.length>0))&&"0"===m.style.opacity&&(n=!1,m.style.visibility="visible",m.style.display="flex",m.offsetHeight,m.style.opacity="1",m.style.transition="opacity 0.5s ease")})).observe(y,{childList:!0,subtree:!0}),setTimeout((()=>{t=!1}),500)})),k.reverse().forEach((async({messageTextElement:e,time:n,username:t,type:o})=>{b<x&&(w=await ls(n,t,!1),b++,b>=x&&(w=!1,console.log("Reached maximum ping checks, resetting pingMessages."))),e.style.color=w&&"mention"===o?"lightgreen":w&&"private"===o?"lemonchiffon":C[o]||"slategray"}))}await L(a),r.appendChild(y),document.body.appendChild(r);const{scrollButtonsContainer:T}=Mn(y);r.appendChild(T),An(r,"show"),qn("show"),c.addEventListener("click",(e=>{e.ctrlKey&&(c.value="",c.dispatchEvent(new Event("input",{bubbles:!0})))})),c.addEventListener("input",(()=>{const e=c.value.toLowerCase().replace(/_/g," ");y.querySelectorAll(".date-item").forEach((n=>{let t=!1,o=n.nextElementSibling;for(;o&&!o.classList.contains("date-item");){const n=(o.querySelector(".message-time")?.textContent.toLowerCase().replace(/_/g," ")+" "+o.querySelector(".message-username")?.textContent.toLowerCase().replace(/_/g," ")+" "+o.querySelector(".message-text")?.textContent.toLowerCase().replace(/_/g," ")).includes(e);o.style.contentVisibility=n?"visible":"hidden",o.style.fontSize=n?"":"0",t=t||n,o=o.nextElementSibling}n.style.display=t?"":"none"}))})),requestAnimationFrame((function(){c.focus()})),rs.handlePersonalMessagesKeydown=e=>{"Escape"===e.key&&(An(r,"hide"),qn("hide"),document.removeEventListener("keydown",rs.handlePersonalMessagesKeydown))},document.addEventListener("keydown",rs.handlePersonalMessagesKeydown)}let us=!1;(()=>{bt();const e=(()=>{const e=document.createElement("div");return e.classList.add("empowerment-panel"),document.body.appendChild(e),e})();if(wn("gmid")||wn("gamelist")){_n("elements","counter")&&Vt(e),function(){const e=getComputedStyle(document.querySelector(".chat .messages")).backgroundColor,n=document.createElement("style");n.innerHTML=`\n    #chat-general .smile-tab, .chat-user-list {\n      background-color: ${e};\n    }\n  `,document.head.appendChild(n)}()}if((wn("gmid")||wn("gamelist"))&&(function(e){Je=document.createElement("div");const n=$e.messageSettings.messageNotificationState||"silence";Je.classList.add("empowerment-button","sound-switcher-button"),Je.id=n,Le(Je,$e.messageSettings.messageNotificationTitle||"Do not disturb"),Ke=document.createElement("span"),Ke.classList.add("sound-switcher-icon"),Je.appendChild(Ke),e.appendChild(Je),Je.addEventListener("click",(function(){if(!Sn&&!kn){switch(document.querySelector(".current-voice-speed")?.remove(),document.querySelector(".current-voice-pitch")?.remove(),fe(this),this.id){case"silence":this.id="beep",Le(this,"Notify with beep signal"),$e.messageSettings.messageNotificationState="beep",$e.messageSettings.messageNotificationTitle="Notify with beep signal";break;case"beep":this.id="voice",Le(this,"Notify with voice API"),$e.messageSettings.messageNotificationState="voice",$e.messageSettings.messageNotificationTitle="Notify with voice API";break;case"voice":this.id="silence",Le(this,"Do not disturb"),$e.messageSettings.messageNotificationState="silence",$e.messageSettings.messageNotificationTitle="Do not disturb"}localStorage.setItem("KG_Chat_Empowerment",JSON.stringify($e)),Ye()}})),Je.addEventListener("mousedown",Qe),Je.addEventListener("contextmenu",(e=>e.preventDefault())),Ye()}(e),function(e){Do=document.createElement("div");const n=$e.messageSettings.messageModeState||"every-message";Do.classList.add("empowerment-button","message-mode-button"),Do.id=n,Le(Do,$e.messageSettings.messageModeTitle||"Notify about every message"),Po=document.createElement("span"),Po.classList.add("message-mode-icon"),Do.appendChild(Po),e.appendChild(Do),Do.addEventListener("click",(function(){Sn&&kn||(fe(this),"every-message"===this.id?(this.id="mention-message",Le(this,"Notify about mention message"),$e.messageSettings.messageModeState="mention-message",$e.messageSettings.messageModeTitle="Notify about mention message"):(this.id="every-message",Le(this,"Notify about every message"),$e.messageSettings.messageModeState="every-message",$e.messageSettings.messageModeTitle="Notify about every message"),localStorage.setItem("KG_Chat_Empowerment",JSON.stringify($e)),Ko())})),Ko()}(e)),function(e){const n=document.createElement("div");n.classList.add("empowerment-button","cache-panel-load-button"),n.style.position="relative",n.style.zIndex="3",n.innerHTML=$;const t=document.createElement("div");t.className="cache-user-count",t.textContent=Object.keys(JSON.parse(localStorage.getItem("fetchedUsers"))||{}).length,n.appendChild(t),Le(n,"Show Cache Panel"),n.addEventListener("click",(()=>{fe(n),It()})),e.appendChild(n)}(e),is(e),function(e){const n=document.createElement("div");n.classList.add("empowerment-button","chat-logs-button"),n.style.position="relative",n.style.zIndex="1",n.innerHTML=q,Le(n,"Show Chat Logs"),n.addEventListener("click",(async function(){fe(n),await as()})),e.appendChild(n)}(e),_e(e),function(){const e=document.querySelector(".messages-content div");e?Ao.observe(e,{childList:!0,subtree:!0}):console.warn("Messages container not found!")}(),Yt?eo.observe(Yt,{childList:!0}):console.warn("User list not found!"),!wn("gmid")&&!wn("gamelist"))return;const n=new Rt;let t=new MutationObserver((()=>{const e=document.querySelector(".messages-content div"),o=document.querySelectorAll(".messages-content div p");document.contains(e)&&(!function(){const e=document.querySelector("#chat-fixed-placeholder");localStorage.getItem("shouldShowPopupMessage")||localStorage.setItem("shouldShowPopupMessage","false"),e.style.display=JSON.parse(localStorage.getItem("shouldShowPopupMessage"))?"none":"unset"}(),o.length>=20&&(t.disconnect(),function(){const{allMessages:e}=et();e.forEach((e=>{const n=e.querySelector(".username"),t=n?.textContent?.replace(/[<>]/g,"")||null;if(t&&un.includes(t)){const n=Zn(t);e.classList.add("ignored-user",n),e.style.display="none"}}))}(),yo("generalMessages"),To("generalMessages"),On("generalMessages"),window.location.href.includes("gmid")&&function(){const{activeChatTab:e,chatField:n}=et();e?.click(),n?.focus()}(),function(){const{chatField:e}=et();e&&(e.value=localStorage.getItem("inputBackup")||"",e.addEventListener("input",$n((()=>{pt(e)||localStorage.setItem("inputBackup",e.value)}),250)),e.addEventListener("keydown",(e=>{"Enter"===e.key&&localStorage.removeItem("inputBackup")})))}(),Yn(),ut(),Jn("generalMessages",350),Fn(!1,de),Ft(),gt(),n.updateDeletedMessages(),yt(),function(){const e=document.querySelectorAll(".messages-content p");if(0===e.length)return;const n=new Set(Array.from(e).map((e=>Jt(e)))),t=new Set(JSON.parse(localStorage.getItem("deletedChatMessagesContent")||"[]"));localStorage.setItem("deletedChatMessagesContent",JSON.stringify([...t].filter((e=>n.has(e)))))}(),setTimeout((()=>{Oo&&(Io.addEventListener("input",Ro),Io.addEventListener("keydown",Jo))}),600),setTimeout((()=>us=!0),600)))}));t.observe(document,{childList:!0,subtree:!0})})()})();