// ==UserScript==
// @name         KG_Chat_Empowerment
// @namespace    klavogonki
// @version      1.0.0
// @description  Enhance the chat abilities
// @author       Patcher
// @match        *://klavogonki.ru/g*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=klavogonki.ru
// @updateURL    https://raw.githubusercontent.com/VimiummuimiV/KG_Goddies/refs/heads/master/KG_Chat_Empowerment.js
// @downloadURL  https://raw.githubusercontent.com/VimiummuimiV/KG_Goddies/refs/heads/master/KG_Chat_Empowerment.js
// @grant        none
// ==/UserScript==

(()=>{"use strict";var e={56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72:e=>{var t=[];function n(e){for(var n=-1,o=0;o<t.length;o++)if(t[o].identifier===e){n=o;break}return n}function o(e,o){for(var r={},a=[],i=0;i<e.length;i++){var l=e[i],c=o.base?l[0]+o.base:l[0],d=r[c]||0,u="".concat(c," ").concat(d);r[c]=d+1;var m=n(u),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==m)t[m].references++,t[m].updater(p);else{var g=s(p,o);o.byIndex=i,t.splice(i,0,{identifier:u,updater:g,references:1})}a.push(u)}return a}function s(e,t){var n=t.domAPI(t);n.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,s){var r=o(e=e||[],s=s||{});return function(e){e=e||[];for(var a=0;a<r.length;a++){var i=n(r[a]);t[i].references--}for(var l=o(e,s),c=0;c<r.length;c++){var d=n(r[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}r=l}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},208:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(601),s=n.n(o),r=n(314),a=n.n(r)()(s());a.push([e.id,'.empowerment-button {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 48px;\n  height: 48px;\n  cursor: pointer;\n  margin: 4px;\n  background-color: #212226;\n  border: 1px solid #45474b;\n}\n\n/* input error indication */\n.input-error {\n  transition: background-color 300ms ease-in-out;\n  background-color: #6b2f2f !important;\n}\n\n/* chat length popup on field type with dynamic movement horizontally */\n.length-field-popup {\n  position: absolute;\n  font: bold 12px Montserrat;\n  bottom: 40px;\n  transition: left 100ms ease-out;\n  height: 20px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 2px 4px;\n  margin: 2px;\n  opacity: 0;\n}\n\n.bounce-in {\n  animation: bounceIn 500ms forwards;\n}\n\n@keyframes bounceIn {\n  0% {\n    transform: translateY(0);\n    opacity: 0;\n  }\n\n  50% {\n    transform: translateY(-10px);\n    opacity: 1;\n  }\n\n  100% {\n    transform: translateY(0);\n    opacity: 1;\n  }\n}\n\n.bounce-out {\n  animation: bounceOut 500ms forwards;\n}\n\n@keyframes bounceOut {\n  0% {\n    transform: translateY(0);\n    opacity: 1;\n  }\n\n  50% {\n    transform: translateY(-10px);\n    opacity: 1;\n  }\n\n  100% {\n    transform: translateY(0);\n    opacity: 0;\n  }\n}\n\n/* catalogs panel && personal messages panel messages anchors color */\n.chat-logs-panel .message-text a,\n.cached-messages-panel .message-text a {\n  color: burlywood !important;\n  transition: color 0.15s ease-in-out;\n}\n\n.chat-logs-panel .message-text a:hover,\n.cached-messages-panel .message-text a:hover {\n  color: lightgoldenrodyellow !important;\n}\n\n/* Empowerment panel */\n.empowerment-panel {\n  position: fixed;\n  top: 60px;\n  right: 12px;\n  padding: 6px;\n  z-index: 1000;\n}\n\n/* Chat user count element */\n.chat-user-count {\n  filter: grayscale(100%);\n  transition: 0.2s ease-in-out;\n  font-family: \'Orbitron\', sans-serif;\n  font-size: 24px;\n  color: #83cf40;\n  background-color: #2b4317;\n  width: 48px;\n  height: 48px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  border: 1px solid #4b7328;\n  margin: 4px;\n}\n\n.pulse-effect {\n  animation: pulse 500ms ease-out;\n}\n\n@keyframes pulse {\n  0% {\n    filter: brightness(1);\n  }\n\n  50% {\n    filter: brightness(1.5);\n  }\n\n  100% {\n    filter: brightness(1);\n  }\n}\n\n.shake-effect {\n  animation: shake 500ms cubic-bezier(0.36, 0.07, 0.19, 0.97) both;\n}\n\n@keyframes shake {\n  0% {\n    transform: translateX(0);\n  }\n\n  10% {\n    transform: translateX(-4px);\n  }\n\n  20% {\n    transform: translateX(6px);\n  }\n\n  30% {\n    transform: translateX(-8px);\n  }\n\n  40% {\n    transform: translateX(8px);\n  }\n\n  50% {\n    transform: translateX(-6px);\n  }\n\n  60% {\n    transform: translateX(5px);\n  }\n\n  70% {\n    transform: translateX(-3px);\n  }\n\n  80% {\n    transform: translateX(2px);\n  }\n\n  90% {\n    transform: translateX(-1px);\n  }\n\n  100% {\n    transform: translateX(0);\n  }\n}\n\n.custom-tooltip-popup {\n  position: fixed;\n  background: rgb(22, 22, 22);\n  color: rgb(222, 222, 222);\n  padding: 0.5em;\n  z-index: 1200;\n  font-size: 0.9em;\n  pointer-events: none;\n  white-space: nowrap;\n  opacity: 0;\n  transition: opacity 0.1s;\n  display: none;\n  left: 0;\n  top: 0;\n  border: 1px solid rgb(60, 60, 60) !important;\n  border-radius: 4px !important;\n  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3) !important;\n}\n\n.static-chat-notification {\n  cursor: default;\n  white-space: nowrap;\n  padding: 8px;\n  display: inline-flex;\n  flex: auto;\n  justify-content: center;\n  margin: 4px;\n  font-size: 1em;\n  align-items: center;\n  border-radius: 4px !important;\n}\n\n.dynamic-chat-notifications-container {\n  z-index: 1000;\n  width: 0;\n  position: fixed;\n  display: flex;\n  flex-direction: column;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  padding-top: 160px;\n}\n\n.dynamic-chat-notification {\n  cursor: default;\n  white-space: nowrap;\n  position: relative;\n  align-items: center;\n  width: fit-content;\n  display: flex;\n  margin-bottom: 0.2em;\n  padding: 8px 16px 8px 12px;\n  border-radius: 0 4px 4px 0 !important;\n  left: 0;\n  transform: translateX(-100%);\n  opacity: 1;\n  transition: transform 0.3s cubic-bezier(0.83, 0, 0.17, 1), opacity 0.3s cubic-bezier(0.83, 0, 0.17, 1);\n}\n\n/* For both (static and dynamic) notifications */\n.user-enter {\n  color: hsl(100, 50%, 50%) !important;\n  background-color: hsl(100, 50%, 10%) !important;\n  outline: 1px solid hsl(100, 50%, 25%) !important;\n}\n\n.user-left {\n  color: hsl(0, 50%, 70%) !important;\n  background-color: hsl(0, 50%, 15%) !important;\n  outline: 1px solid hsl(0, 50%, 40%) !important;\n}\n\n/* convertImageLinksToImage */\n.clickable-thumbnail {\n  opacity: 1;\n  transition: opacity 0.15s ease-in-out;\n  border: none;\n  width: 6vw;\n  min-width: 100px;\n  max-height: 200px;\n  height: auto;\n  cursor: pointer;\n  background-color: transparent;\n  padding: 2px;\n  margin: 6px;\n  overflow-y: auto;\n}\n\n.clickable-thumbnail:hover {\n  opacity: 0.8;\n}\n\n.clickable-thumbnail img {\n  max-height: 100%;\n  max-width: 100%;\n  background-color: transparent;\n}\n\n.scaled-thumbnail {\n  top: 50%;\n  left: 50%;\n  transform-origin: center center;\n  transform: translate(-50%, -50%) scale(1);\n  position: fixed;\n  opacity: 0;\n  z-index: 999;\n  transform-origin: center center;\n  max-height: 90vh;\n  max-width: 90vw;\n  cursor: pointer;\n}\n\n/* convertVideoLinksToPlayer */\n.video-wrapper {\n  display: flex;\n  width: fit-content;\n  flex-direction: column;\n  gap: 6px;\n  margin-bottom: 10px;\n}\n\n.video-container {\n  display: flex;\n  border: none;\n  height: 165px;\n}\n\n/* Dimming element */\n.dimming-background {\n  background: black;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  position: fixed;\n  opacity: 0;\n  z-index: 998;\n}\n\n/* loadProfileIntoIframe */\n.profile-iframe-container {\n  opacity: 0;\n  border: none;\n  display: flex;\n  position: fixed;\n  z-index: 999;\n  width: 75vw;\n  min-width: 1000px;\n  height: 80vh;\n  top: 48.5vh;\n  left: 50vw;\n  transform: translate(-50%, -50%);\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08) !important;\n  border-radius: 0.6em !important;\n}\n\n.scroll-buttons-container {\n  display: flex;\n  justify-content: center;\n  grid-area: scroll;\n  flex-direction: column;\n  height: calc(100% - 1em);\n  padding: 1em;\n}\n\n.scroll-buttons-container .scroll-button {\n  margin: 0.25em 0;\n  background-color: rgba(222, 222, 222, 0.1);\n}\n\n/* Common styles for all panel header buttons */\n.large-button {\n  width: 48px;\n  height: 48px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  cursor: pointer;\n  border-radius: 0.2em !important;\n  filter: brightness(1);\n  transition: filter 0.3s ease, opacity 0.3s ease;\n}\n\n.large-button:hover {\n  filter: brightness(0.8);\n}\n\n.panel-control-buttons {\n  display: flex;\n}\n\n.panel-control-buttons>div:not(:first-child) {\n  margin-left: 0.5em;\n}\n\n/* Common background color for all panel header buttons */\n.panel-header-clear-button {\n  background-color: brown;\n}\n\n.panel-header-close-button {\n  background-color: darkolivegreen;\n}\n\n.panel-header-save-button {\n  display: none;\n  opacity: 0;\n  visibility: hidden;\n  background-color: #2f6b63;\n}\n\n.panel-header-import-button {\n  background-color: #502f6b;\n}\n\n.panel-header-export-button {\n  background-color: #2f4c6b;\n}\n\n.panel-header-copy-button,\n.panel-header-date-button {\n  background-color: steelblue;\n}\n\n.panel-header-toggle-button {\n  background-color: #144e9d;\n}\n\n.panel-header-toggle-media-messages {\n  background-color: darkslategray;\n}\n\n.toggle-mention-messages-button {\n  background-color: saddlebrown;\n}\n\n.panel-header-one-day-back-button,\n.panel-header-one-day-forward-button {\n  background-color: darkcyan;\n}\n\n.panel-header-shuffle-button {\n  background-color: darkslateblue;\n}\n\n/* New chat user list */\n#chat-general .userlist-content {\n  opacity: 0;\n}\n\n#chat-general .smile-tab {\n  position: relative;\n  z-index: 1;\n}\n\n.chat-user-list {\n  display: flex;\n  flex-direction: column;\n  position: absolute;\n  top: 20px;\n  padding-top: 8px;\n  width: 200px;\n  height: 94%;\n  overflow-y: auto;\n  overflow-x: hidden;\n}\n\n.chat-user-list [class^="rank-group"] {\n  display: flex;\n  flex-direction: column;\n}\n\n.chat-user-list [class^="user"] {\n  display: inline-flex;\n  margin: 2px 0;\n}\n\n.chat-user-list .avatar {\n  width: 24px;\n  height: 24px;\n  display: inline-flex;\n}\n\n.chat-user-list .avatar img,\n.fetched-users .avatar img {\n  transform-origin: left;\n  transition: transform 0.3s;\n}\n\n.chat-user-list .avatar img:hover,\n.fetched-users .avatar img:hover {\n  transform: scale(2);\n}\n\n.chat-user-list .name {\n  text-decoration: none;\n  display: inline-flex;\n  width: auto;\n  height: 24px;\n  line-height: 24px;\n  padding: 0 8px;\n  max-width: 124px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.chat-user-list .name:hover {\n  text-decoration: underline;\n}\n\n.chat-user-list .profile,\n.chat-user-list .tracked,\n.chat-user-list .ignored,\n.chat-user-list .moderator {\n  display: inline-flex;\n  width: 24px;\n  height: 24px;\n  justify-content: center;\n  align-items: center;\n}\n\n/* Highlight for mention words */\n.mention {\n  display: inline-flex;\n  color: #83cf40;\n  font-family: Roboto Mono, monospace;\n  font-weight: bold;\n}\n\n/* Chat popup messages */\n.popup-messages-container {\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-end;\n  align-items: start;\n  user-select: none;\n  pointer-events: none;\n  position: fixed;\n  left: 0;\n  right: 0;\n  top: 50px;\n  bottom: 0;\n}\n\n.popup-chat-message {\n  display: flex;\n  align-items: center;\n  background-color: hsl(100, 50%, 10%);\n  position: relative;\n  max-width: 70vw;\n  border-radius: 0.2em !important;\n  color: hsl(100, 50%, 50%);\n  border: 1px solid hsl(100, 50%, 25%);\n  padding: 4px;\n  margin: 6px 15vw;\n  opacity: 0;\n  transform: translateY(20px);\n  transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;\n  animation: fadeIn 0.3s ease-in-out forwards;\n}\n\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n    transform: translateY(20px);\n  }\n\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n.popup-chat-message.fade-out {\n  animation: fadeOut 0.3s ease-in-out forwards;\n}\n\n@keyframes fadeOut {\n  from {\n    opacity: 1;\n    transform: translateY(0);\n  }\n\n  to {\n    opacity: 0;\n    transform: translateY(-20px);\n  }\n}\n\n.popup-chat-message>div {\n  padding: 2px;\n  display: flex;\n  font-family: \'Montserrat\', sans-serif;\n}\n\n.popup-chat-message .time,\n.popup-chat-message .time-icon {\n  opacity: 0.7;\n}\n\n/* Empowerment voice settings (Ctrl + Alt) */\n.voice-settings {\n  position: absolute;\n  top: 65px;\n  right: 70px;\n  opacity: 0;\n  transition: opacity 0.3s ease;\n  font-family: Orbitron, sans-serif;\n}\n\n/* Basic styles for empowerment voice settings */\n.voice-value-info {\n  display: flex;\n  width: 100%;\n  justify-content: center;\n  margin-bottom: 6px;\n}\n\n/* voice speed */\n.voice-speed {\n  color: hsl(100, 50%, 50%);\n}\n\n.voice-speed-progress {\n  display: block;\n  width: 120px;\n  height: 12px;\n  background-color: hsl(90, 60%, 30%);\n}\n\n.voice-speed-progress-fill {\n  display: block;\n  height: 100%;\n  background-color: hsl(90, 60%, 50%);\n}\n\n/* voice pitch */\n.voice-pitch {\n  color: hsl(180, 60%, 50%);\n}\n\n.voice-pitch-progress {\n  display: block;\n  width: 120px;\n  height: 12px;\n  background-color: hsl(180, 60%, 30%);\n}\n\n.voice-pitch-progress-fill {\n  display: block;\n  height: 100%;\n  background-color: hsl(180, 60%, 50%);\n}\n\n/* showCachePanel */\n.cached-users-panel {\n  opacity: 0;\n  background-color: #1b1b1b;\n  border-radius: 0.6em !important;\n  position: fixed;\n  top: 100px;\n  left: 50%;\n  transform: translateX(-50%);\n  width: 80vw;\n  height: 80vh;\n  z-index: 999;\n  display: grid;\n  grid-template-columns: 1fr;\n  grid-template-rows: min-content;\n  grid-template-areas:\n    "header header"\n    "cache scroll";\n}\n\n.cached-users-panel .panel-header {\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  padding: 0.6em;\n  grid-area: header;\n}\n\n.cached-users-panel .drop-time {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-width: fit-content;\n}\n\n.cached-users-panel .drop-time-threshold-description {\n  padding: 0.6em;\n  color: #c6b209;\n}\n\n.cached-users-panel .drop-time-threshold {\n  padding: 0.6em;\n  color: lightcoral;\n  font-family: \'Roboto Mono\', monospace;\n  font-size: 1.1em;\n  font-weight: bold;\n  border-radius: 0.2em !important;\n  border: 1px solid rgba(240, 128, 128, 0.20);\n  background-color: rgba(240, 128, 128, 0.05);\n  transition: filter 0.3s;\n  filter: sepia(0);\n  cursor: pointer;\n}\n\n.cached-users-panel .drop-time-threshold:hover {\n  filter: sepia(1);\n}\n\n.cached-users-panel .drop-time-expiration-description {\n  padding: 0.6em;\n  color: #d0562c;\n}\n\n.cached-users-panel .drop-time-expiration {\n  padding: 0.6em;\n  color: antiquewhite;\n  font-family: \'Roboto Mono\', monospace;\n  font-size: 1.1em;\n}\n\n.cached-users-panel .search-for-cached-users {\n  width: 100%;\n  margin: 0 0.5em;\n  display: flex;\n}\n\n.cached-users-panel .cached-users-search-input {\n  outline: none;\n  width: 100%;\n  padding: 10px;\n  font-size: 1em;\n  font-family: \'Montserrat\';\n  color: bisque !important;\n  border-radius: 0.2em !important;\n  box-sizing: border-box;\n  background-color: #111;\n  border: 1px solid #222;\n}\n\n.cached-users-panel .error-message {\n  width: fit-content;\n  white-space: nowrap;\n  font-family: \'Montserrat\';\n  color: lightcoral;\n}\n\n.fetch-mode-button {\n  background-color: #b2a4f9;\n}\n\n.fetch-mode-button svg {\n  stroke: darkslateblue;\n}\n\n.cache-mode-button {\n  background-color: darkslateblue;\n}\n\n.cache-mode-button svg {\n  stroke: #b2a4f9;\n}\n\n.cached-users-panel .fetched-users {\n  display: grid;\n  grid-template-rows: 1fr 1fr;\n  height: calc(100% - 0.5em);\n  overflow-y: auto;\n  grid-area: cache;\n}\n\n.cached-users-panel .users-container {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));\n  gap: 12px;\n  padding: 1em;\n  height: fit-content;\n}\n\n/* Common styles for all descriptions */\n.cached-users-panel .description {\n  color: bisque;\n  font-family: Montserrat;\n  font-size: 1em;\n  margin: 0;\n  padding: 0.4em 0.2em;\n  grid-column: 1 / -1;\n  height: fit-content;\n}\n\n/* Common styles for user container elements in cached users panel */\n.cached-users-panel .user-item {\n  padding: 0.2em;\n  margin: 0.4em 0.2em;\n  display: grid;\n  grid-template-columns: auto 1fr;\n  align-items: center;\n  height: fit-content;\n}\n\n/* Common styles for the visits element */\n.cached-users-panel .visits {\n  margin-left: 8px;\n  padding: 4px 6px;\n  border-radius: 2px !important;\n  cursor: pointer;\n  white-space: pre;\n}\n\n/* Styling for tracked visits */\n.cached-users-panel .visits.tracked {\n  color: greenyellow;\n  background-color: darkgreen;\n  font-weight: bold;\n}\n\n/* Styling for untracked visits */\n.cached-users-panel .visits.untracked {\n  color: orange;\n  background-color: #111111;\n  font-weight: normal;\n}\n\n/* Common styles for the action log container */\n.cached-users-panel .action-log {\n  position: fixed;\n  opacity: 0;\n  padding: 8px;\n  gap: 4px;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  max-height: 85vh;\n  overflow-y: auto;\n  scrollbar-width: none;\n  overflow-x: hidden;\n  display: flex;\n  min-width: 30vw;\n  max-width: 50vw;\n  flex-wrap: wrap;\n  background-color: #111111;\n  border: 3px dashed #212121;\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08) !important;\n  border-radius: 0.2em !important;\n}\n\n.cached-users-panel .rank {\n  padding: 2px 0;\n}\n\n.cached-users-panel .registered {\n  color: cadetblue;\n  font-size: 12px;\n}\n\n.cached-users-panel .user-metrics {\n  margin-top: 4px;\n  grid-column: span 2;\n}\n\n.cached-users-panel .avatar {\n  font-size: 1.8rem;\n  margin-right: 8px;\n}\n\n.cached-users-panel .avatar img {\n  height: 24px;\n  width: 24px;\n}\n\n.cached-users-panel .login {\n  color: skyblue !important;\n  text-decoration: none;\n  font-family: \'Montserrat\', sans-serif;\n  transition: color 0.3s ease;\n}\n\n.cached-users-panel .login:hover {\n  color: cornsilk !important;\n}\n\n/* createCacheButton */\n.cache-user-count {\n  display: flex;\n  position: absolute;\n  justify-content: center;\n  align-items: center;\n  left: 0;\n  bottom: 0;\n  transform: translate(-50%, 50%);\n  z-index: 1;\n  height: 20px;\n  padding: 0 4px;\n  border-radius: 2px !important;\n  background-color: #9db380;\n  color: rgb(2, 2, 2);\n  font-size: 12px;\n  font-family: Roboto, sans-serif;\n  font-weight: bold;\n}\n\n/* createPersonalMessagesButton */\n.personal-messages-button {\n  position: relative;\n  z-index: 2;\n}\n\n.message-count {\n  display: flex;\n  position: absolute;\n  justify-content: center;\n  align-items: center;\n  height: 20px;\n  padding: 0 4px;\n  border-radius: 2px !important;\n  color: rgb(2, 2, 2);\n  font-size: 12px;\n  font-family: Roboto, sans-serif;\n  font-weight: bold;\n  bottom: 0;\n}\n\n.total-message-count {\n  left: 0;\n  transform: translate(-50%, 50%);\n  background-color: #fa8072;\n}\n\n.new-message-count {\n  right: 0;\n  transform: translate(50%, 50%);\n  background-color: #ffd700;\n}\n\n/* showPersonalMessagesPanel */\n.cached-messages-panel {\n  opacity: 0;\n  background-color: #1b1b1b;\n  border-radius: 0.6em !important;\n  position: fixed;\n  top: 100px;\n  left: 50%;\n  transform: translateX(-50%);\n  width: 50vw;\n  height: 80vh;\n  z-index: 999;\n  min-width: 1000px;\n  display: grid;\n  grid-template-columns: 1fr;\n  grid-template-rows: min-content;\n  grid-template-areas:\n    "header header"\n    "messages scroll";\n}\n\n.panel-header {\n  display: flex;\n  flex-direction: row;\n  justify-content: flex-end;\n  /* Aligns to the right */\n  padding: 0.6em;\n  grid-area: header;\n}\n\n.search-for-personal-messages {\n  width: 100%;\n  margin: 0 0.5em 0 0;\n  display: flex;\n}\n\n.personal-messages-search-input {\n  outline: none;\n  width: 100%;\n  padding: 10px;\n  font-size: 1em;\n  font-family: Montserrat, sans-serif;\n  color: bisque !important;\n  border-radius: 0.2em !important;\n  box-sizing: border-box;\n  background-color: #111;\n  border: 1px solid #222 !important;\n}\n\n.cached-messages-panel .messages-container {\n  overflow-y: auto;\n  height: calc(100% - 0.5em);\n  padding: 1em;\n  grid-area: messages;\n}\n\n.cached-messages-panel .date-item {\n  position: relative;\n  font: 1em Montserrat, sans-serif;\n  color: burlywood;\n  background-color: rgba(222, 184, 135, 0.1);\n  width: fit-content;\n  margin: 2em 1em 1em;\n  padding: 0.4em 0.8em;\n  text-align: center;\n  border-radius: 0.4em !important;\n  left: 50%;\n  transform: translateX(-50%);\n}\n\n.cached-messages-panel .message-item {\n  padding: 0.2em;\n}\n\n.cached-messages-panel .message-time {\n  margin: 0px 0.4em;\n  height: fit-content;\n  cursor: pointer;\n  transition: color 0.2s ease;\n}\n\n.cached-messages-panel .message-username {\n  display: inline-flex;\n  cursor: pointer;\n  margin: 0px 0.4em;\n  height: fit-content;\n}\n\n.cached-messages-panel .message-text {\n  cursor: pointer;\n  margin: 0px 0.4em;\n  height: fit-content;\n}\n\n/* createChatLogsButton */\n.chat-logs-button {\n  position: relative;\n  z-index: 1;\n}\n\n/* showChatLogsPanel */\n.chat-logs-panel {\n  opacity: 0;\n  background-color: #1b1b1b;\n  border-radius: 0.6em !important;\n  position: fixed;\n  top: 100px;\n  left: 50%;\n  transform: translateX(-50%);\n  width: 80vw;\n  height: 80vh;\n  z-index: 999;\n  min-width: 1000px;\n  display: grid;\n  grid-template-columns: 1fr;\n  grid-template-rows: min-content;\n  grid-template-areas:\n    "header header header"\n    "messages scroll users";\n}\n\n.chat-logs-panel .panel-header {\n  display: flex;\n  flex-direction: row;\n  grid-area: header;\n  justify-content: flex-end;\n  padding: 0.6em;\n}\n\n.chat-logs-panel .panel-control-buttons {\n  display: flex;\n}\n\n.chat-logs-panel .search-for-chatlogs-messages {\n  width: 100%;\n  margin: 0 0.5em 0 0;\n  display: flex;\n}\n\n.chat-logs-panel .chatlogs-search-input {\n  outline: none;\n  height: 48px;\n  width: 100%;\n  padding: 10px;\n  font-size: 1em;\n  font-family: Montserrat;\n  color: bisque !important;\n  border-radius: 0.2em !important;\n  box-sizing: border-box;\n  background-color: #111;\n  border: 1px solid #222 !important;\n}\n\n.chat-logs-panel .chatlogs-date-input {\n  background-color: #111;\n  color: bisque;\n  border: 1px solid #222;\n  width: fit-content;\n  height: 48px;\n  padding: 10px;\n  font-size: 1em;\n  font-family: Montserrat;\n  border-radius: 0.2em !important;\n  box-sizing: border-box;\n  margin: 0 0.5em;\n}\n\n.toggle-mention-messages-counter,\n.toggle-media-messages-counter {\n  display: flex;\n  position: absolute;\n  justify-content: center;\n  align-items: center;\n  padding: 2px 4px;\n  border-radius: 2px !important;\n  font-size: 12px;\n  font-family: Roboto;\n  font-weight: bold;\n  bottom: 0px;\n  left: 0px;\n  transform: translate(-50%, 50%);\n  color: #020202;\n  pointer-events: none;\n  user-select: none;\n}\n\n.toggle-mention-messages-counter {\n  background-color: #ffa07a;\n}\n\n.toggle-media-messages-counter {\n  background-color: #71c4c4;\n}\n\n.chat-logs-panel .saved-chatlog-url {\n  color: darkseagreen !important;\n  text-decoration: none;\n  display: inline-flex;\n  padding: 0.5em;\n}\n\n.chat-logs-panel .saved-chatlog-url-title {\n  color: lightsteelblue;\n  padding: 0.5em;\n}\n\n.saved-chatlog-container {\n  display: flex;\n  flex-direction: column;\n  overflow-y: auto;\n  background-color: rgb(30, 40, 45);\n  border: 1px solid rgb(60, 70, 80) !important;\n  border-radius: 0.2em !important;\n  position: absolute;\n  padding: 0.5em;\n  height: fit-content;\n  width: max-content;\n  max-height: 400px;\n  top: calc(50px + 1em);\n  right: 0;\n}\n\n.chat-logs-panel .chat-logs-container {\n  overflow-y: auto;\n  height: calc(100% - 0.5em);\n  padding: 1em;\n  display: flex;\n  grid-area: messages;\n  flex-direction: column;\n}\n\n.chat-logs-panel .message-item {\n  padding: 0.2em;\n  display: inline-flex;\n  cursor: pointer;\n  align-items: start;\n}\n\n.chat-logs-panel .message-time {\n  color: darkseagreen;\n  margin: 0 0.4em;\n  cursor: pointer;\n  transition: color 0.2s ease;\n  height: fit-content;\n}\n\n.chat-logs-panel .message-time:hover {\n  color: lightgreen;\n}\n\n.chat-logs-panel .message-username {\n  cursor: pointer;\n  margin: 0 0.4em;\n  height: fit-content;\n}\n\n.chat-logs-panel .message-text {\n  color: lightsteelblue;\n  margin: 0 0.4em;\n  overflow-wrap: anywhere;\n  height: fit-content;\n}\n\n.chat-logs-panel .active-users {\n  padding: 1em;\n  height: calc(100% - 1em);\n  width: fit-content;\n  overflow-y: auto;\n  overflow-x: hidden;\n  grid-area: users;\n  display: flex;\n  flex-direction: column;\n}\n\n.chat-logs-panel .active-user-item {\n  display: flex;\n  height: fit-content;\n  align-items: center;\n  justify-content: left;\n  margin: 0.2em 0;\n  cursor: pointer;\n  transition: filter 0.15s;\n}\n\n.chat-logs-panel .active-user-item:hover {\n  filter: brightness(0.8);\n}\n\n.chat-logs-panel .active-user-name {\n  padding: 0.4em;\n}\n\n.chat-logs-panel .active-user-messages-count {\n  padding: 0.4em;\n  border-radius: 0.2em !important;\n}\n\n/* showSettingsPanel */\n.settings-panel {\n  opacity: 0;\n  background-color: #1b1b1b;\n  border-radius: 0.6em !important;\n  position: fixed;\n  top: 100px;\n  left: 50%;\n  transform: translateX(-50%);\n  width: 50vw;\n  height: 80vh;\n  z-index: 999;\n  min-width: 1000px;\n  display: grid;\n  grid-template-columns: 1fr;\n  grid-template-rows: min-content;\n  grid-template-areas:\n    "header header"\n    "settings scroll";\n}\n\n.settings-panel .panel-header {\n  display: flex;\n  flex-direction: row;\n  justify-content: flex-end;\n  padding: 0.6em;\n  grid-area: header;\n}\n\n.settings-panel .settings-content-container {\n  overflow-y: auto;\n  height: calc(100% - 0.5em);\n  padding: 1em;\n  grid-area: settings;\n}\n\n.settings-panel .settings-description {\n  position: relative;\n  font: 1em Montserrat;\n  color: burlywood;\n  background-color: rgba(222, 184, 135, 0.1);\n  width: fit-content;\n  margin: 0 0 1em;\n  padding: 0.4em 0.8em;\n  border-radius: 0.4em !important;\n  left: 50%;\n  transform: translateX(-50%);\n}\n\n.settings-panel .settings-spoiler button {\n  position: relative;\n  font: 1em Montserrat;\n  color: lightgreen;\n  background-color: rgba(222, 184, 135, 0.1);\n  margin: 0 0 3em 0;\n  padding: 0.4em 0.8em;\n  border-radius: 0.4em !important;\n  left: 50%;\n  transform: translateX(-50%);\n  cursor: pointer;\n  transition: background-color 0.3s ease;\n  border: none;\n}\n\n.settings-panel .settings-spoiler button:hover {\n  background-color: rgba(222, 184, 135, 0.25);\n}\n\n.settings-panel .settings-field {\n  height: 30px;\n  max-width: 200px;\n  min-width: 150px;\n  padding: 0.4em;\n  font: 1em Montserrat;\n  font-family: Montserrat;\n  color: bisque;\n  border-radius: 0.2em !important;\n  box-sizing: border-box;\n  background-color: rgb(17, 17, 17);\n  border: 1px solid rgb(34, 34, 34);\n}\n\n.settings-panel .settings-button {\n  width: 30px;\n  height: 30px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  border-radius: 0.2em !important;\n  cursor: pointer;\n  transition: filter 0.3s;\n  filter: brightness(1);\n}\n\n.settings-panel .settings-button:hover {\n  filter: brightness(0.8);\n}\n\n/* Disabled state */\n.settings-panel .settings-button.disabled {\n  filter: grayscale(1);\n  pointer-events: none;\n  opacity: 0.5;\n}\n\n.settings-panel .settings-button {\n  width: 30px;\n  height: 30px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  border-radius: 0.2em !important;\n  cursor: pointer;\n  transition: filter 0.3s;\n}\n\n.settings-panel .remove-settings-button {\n  stroke: #ee9090;\n  background-color: #6b2f2f;\n}\n\n.settings-panel .assigned-settings-button {\n  stroke: lightsteelblue;\n  background-color: steelblue;\n}\n\n.settings-panel .add-settings-button {\n  stroke: #d190ee;\n  background-color: #502f6b;\n}\n\n.settings-panel .settings-container {\n  width: 100%;\n  display: flex;\n  flex-wrap: wrap;\n  align-items: start;\n  flex-direction: column;\n}\n\n/* toggleHiddenMessages */\n.toggle-button-hidden {\n  background-color: hsl(0, 20%, 10%);\n  color: hsl(0, 50%, 50%);\n  border: 1px solid hsl(0, 50%, 50%);\n}\n\n.toggle-button-show {\n  background-color: hsl(90, 20%, 10%);\n  color: hsl(90, 50%, 50%);\n  border: 1px solid hsl(90, 50%, 50%);\n}\n\n.toggle-button-hide {\n  background-color: hsl(50, 20%, 10%);\n  color: hsl(50, 50%, 50%);\n  border: 1px solid hsl(50, 50%, 50%);\n}',""]);const i=a},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",o=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),o&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),o&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,o,s,r){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(o)for(var i=0;i<this.length;i++){var l=this[i][0];null!=l&&(a[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);o&&a[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),s&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=s):d[4]="".concat(s)),t.push(d))}},t}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var t={};e.exports=function(e,n){var o=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var s=void 0!==n.layer;s&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,s&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function n(o){var s=t[o];if(void 0!==s)return s.exports;var r=t[o]={id:o,exports:{}};return e[o](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0;var o=n(72),s=n.n(o),r=n(825),a=n.n(r),i=n(659),l=n.n(i),c=n(56),d=n.n(c),u=n(540),m=n.n(u),p=n(113),g=n.n(p),h=n(208),f={};f.styleTagTransform=g(),f.setAttributes=d(),f.insert=l().bind(null,"head"),f.domAPI=a(),f.insertStyleElement=m();s()(h.A,f);h.A&&h.A.locals&&h.A.locals;const y="http://www.w3.org/2000/svg",v=`\n  <svg xmlns="${y}"\n      width="16"\n      height="16"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="currentColor"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="icon-enter icon-feather icon-log-in">\n    <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>\n    <polyline points="10 17 15 12 10 7"></polyline>\n    <line x1="15" y1="12" x2="3" y2="12"></line>\n  </svg>`,b=`\n  <svg xmlns="${y}"\n      width="16"\n      height="16"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="currentColor" stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="icon-leave icon-feather icon-log-out">\n    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>\n    <polyline points="16 17 21 12 16 7"></polyline>\n    <line x1="21" y1="12" x2="9" y2="12"></line>\n  </svg>`,x=`\n  <svg xmlns="${y}"\n      width="18"\n      height="18"\n      viewBox="0 0 24 24"\n      fill="url(#moderatorGradient)"  \x3c!-- Use a gradient fill --\x3e\n      stroke="none"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-shield">\n    \x3c!-- Define the gradient --\x3e\n    <defs>\n        <linearGradient id="moderatorGradient" x1="0%" y1="0%" x2="0%" y2="100%">\n            <stop offset="0%" style="stop-color: rgb(255, 215, 0); stop-opacity: 1" />\n            <stop offset="100%" style="stop-color: rgb(255, 140, 0); stop-opacity: 1" />\n        </linearGradient>\n    </defs>\n    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>\n  </svg>`,w=`\n  <svg xmlns="${y}"\n       width="16"\n       height="16"\n       viewBox="0 0 24 24"\n       fill="url(#trackedGradient)"  \x3c!-- Use a gradient fill --\x3e\n       class="feather feather-star">\n      \x3c!-- Define the gradient for the fill --\x3e\n    <defs>\n      <linearGradient id="trackedGradient" x1="0%" y1="0%" x2="0%" y2="100%">\n        <stop offset="0%" style="stop-color: rgb(135, 206, 250); stop-opacity: 1" />\n        <stop offset="100%" style="stop-color: rgb(0, 191, 255); stop-opacity: 1" />\n      </linearGradient>\n    </defs>\n    \x3c!-- Use the gradient for the fill --\x3e\n    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"\n      stroke="url(#trackedGradient)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round">\n    </polygon>\n  </svg>`,S=`\n  <svg xmlns="${y}"\n      width="16"\n      height="16"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(255, 160, 122)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-slash">\n    <circle cx="12" cy="12" r="10"></circle>\n    <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line>\n  </svg>`,k=`\n  <svg xmlns="${y}"\n       width="16"\n       height="16"\n       viewBox="0 0 24 24"\n       fill="none"\n       stroke="currentColor"\n       stroke-width="2"\n       stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">\n    <circle cx="12" cy="12" r="10"></circle>\n    <polyline points="12 6 12 12 16 14"></polyline>\n  </svg>`,E=`\n    <svg xmlns="${y}"\n        width="16"\n        height="16"\n        viewBox="0 0 24 24"\n        fill="none"\n        stroke="currentColor"\n        stroke-width="2"\n        stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">\n      <polyline points="9 18 15 12 9 6"></polyline>\n    </svg>`,C=`\n  <svg xmlns="${y}"\n      width="16"\n      height="16"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="currentColor"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-user">\n    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>\n    <circle cx="12" cy="7" r="4"></circle>\n  </svg>`,L=`\n  <svg xmlns="${y}"\n      width="28"\n      height="28"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="hsl(355, 80%, 65%)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round">\n    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>\n    <line x1="23" y1="9" x2="17" y2="15"></line>\n    <line x1="17" y1="9" x2="23" y2="15"></line>\n  </svg>`,T=`\n  <svg xmlns="${y}"\n      width="28"\n      height="28"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="hsl(55, 80%, 65%)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round">\n    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>\n    <path d="M19.07 4.93a10 10 0 0 1 0 14.14" opacity="0.3"></path>\n    <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>\n  </svg>`,M=`\n  <svg xmlns="${y}"\n      width="28"\n      height="28"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="hsl(80, 80%, 40%)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round">\n    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>\n    <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>\n    <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>\n  </svg>`,$=`\n  <svg xmlns="${y}"\n      width="28"\n      height="28"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="hsl(100, 50%, 50%)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round">\n    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>\n    <circle cx="9" cy="7" r="4"></circle>\n    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>\n    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>\n  </svg>`,N=`\n  <svg xmlns="${y}"\n      width="28"\n      height="28"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="hsl(180, 60%, 50%)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round">\n    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>\n    <circle cx="12" cy="7" r="4"></circle>\n  </svg>`,q=`\n  <svg xmlns="${y}"\n      width="16"\n      height="16"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="currentColor"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-slash">\n    <circle cx="12" cy="12" r="10"></circle>\n    <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line>\n  </svg>`,I=`\n  <svg xmlns="${y}"\n      width="28"\n      height="28"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(180, 213, 131)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-database">\n    <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>\n    <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>\n    <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>\n  </svg>`,A=`\n  <svg xmlns="${y}"\n      width="28"\n      height="28"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(255, 160, 122)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail">\n    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>\n    <polyline points="22,6 12,13 2,6"></polyline>\n  </svg>`,j=`\n  <svg xmlns="${y}"\n      width="28"\n      height="28"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(100, 149, 237)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-message-circle">\n      <path \n          d="M21 11.5 a8.38 8.38 0 0 1 -.9 3.8 a8.5 8.5 0 0 1 -7.6 4.7 a8.38 8.38 0 0 1 -3.8 -.9\n          L3 21 l1.9 -5.7 a8.38 8.38 0 0 1 -.9 -3.8 a8.5 8.5 0 0 1 4.7 -7.6\n          a8.38 8.38 0 0 1 3.8 -.9 h.5 a8.48 8.48 0 0 1 8 8 v.5 z">\n      </path>\n  </svg>`,O=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(113, 196, 196)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-film">\n    <rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect>\n    <line x1="7" y1="2" x2="7" y2="22"></line>\n    <line x1="17" y1="2" x2="17" y2="22"></line>\n    <line x1="2" y1="12" x2="22" y2="12"></line>\n    <line x1="2" y1="7" x2="7" y2="7"></line>\n    <line x1="2" y1="17" x2="7" y2="17"></line>\n    <line x1="17" y1="17" x2="22" y2="17"></line>\n    <line x1="17" y1="7" x2="22" y2="7"></line>\n  </svg>`,H=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(255, 228, 196)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-sliders">\n    <line x1="4" y1="21" x2="4" y2="14"></line>\n    <line x1="4" y1="10" x2="4" y2="3"></line>\n    <line x1="12" y1="21" x2="12" y2="12"></line>\n    <line x1="12" y1="8" x2="12" y2="3"></line>\n    <line x1="20" y1="21" x2="20" y2="16"></line>\n    <line x1="20" y1="12" x2="20" y2="3"></line>\n    <line x1="1" y1="14" x2="7" y2="14"></line>\n    <line x1="9" y1="8" x2="15" y2="8"></line>\n    <line x1="17" y1="16" x2="23" y2="16"></line>\n  </svg>`,P=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(144, 238, 144)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-x">\n    <line x1="18" y1="6" x2="6" y2="18"></line>\n    <line x1="6" y1="6" x2="18" y2="18"></line>\n  </svg>`,B="rgb(211, 211, 211)",D=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="${B}"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevrons-up">\n    <polyline points="17 11 12 6 7 11"></polyline>\n    <polyline points="17 18 12 13 7 18"></polyline>\n  </svg>`,F=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="${B}"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-up">\n    <polyline points="18 15 12 9 6 15"></polyline>\n  </svg>`,z=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="${B}"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down">\n    <polyline points="6 9 12 15 18 9"></polyline>\n  </svg>`,J=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="${B}"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevrons-down">\n    <polyline points="7 13 12 18 17 13"></polyline>\n    <polyline points="7 6 12 11 17 6"></polyline>\n  </svg>`,U=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 25 25"\n      fill="none"\n      stroke="rgb(137, 187, 255)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-toggle-right">\n    <rect x="1" y="5" width="22" height="14" rx="7" ry="7"></rect>\n    <circle cx="16" cy="12" r="3"></circle>\n  </svg>`,R=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 25 25"\n      fill="none"\n      stroke="rgb(137, 187, 255)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-toggle-left">\n    <rect x="1" y="5" width="22" height="14" rx="7" ry="7"></rect>\n    <circle cx="8" cy="12" r="3"></circle>\n  </svg>`,_=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(176, 196, 222)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">\n    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>\n    <line x1="16" y1="2" x2="16" y2="6"></line>\n    <line x1="8" y1="2" x2="8" y2="6"></line>\n    <line x1="3" y1="10" x2="21" y2="10"></line>\n  </svg>`,K=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(176, 196, 222)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard">\n    <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>\n    <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>\n  </svg>`,V=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(28, 229, 229)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-left">\n    <polyline points="15 18 9 12 15 6"></polyline>\n  </svg>`,X=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(28, 229, 229)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">\n      <polyline points="9 18 15 12 9 6"></polyline>\n  </svg>`,G=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(169, 155, 255)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-shuffle">\n    <polyline points="16 3 21 3 21 8"></polyline>\n    <line x1="4" y1="20" x2="21" y2="3"></line>\n    <polyline points="21 16 21 21 16 21"></polyline>\n    <line x1="15" y1="15" x2="21" y2="21"></line>\n    <line x1="4" y1="4" x2="9" y2="9"></line>\n  </svg>`,Y=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(255, 140, 0)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2">\n    <polyline points="3 6 5 6 21 6"></polyline>\n    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>\n    <line x1="10" y1="11" x2="10" y2="17"></line>\n    <line x1="14" y1="11" x2="14" y2="17"></line>\n  </svg>`,W=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="currentColor"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-users">\n    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>\n    <circle cx="9" cy="7" r="4"></circle>\n    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>\n    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>\n  </svg>`,Z=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(209, 144, 238)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-download">\n    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>\n    <polyline points="7 10 12 15 17 10"></polyline>\n    <line x1="12" y1="15" x2="12" y2="3"></line>\n  </svg>`,Q=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(144, 185, 238)"\n      stroke-width="2" stroke-linecap="round"\n      stroke-linejoin="round" class="feather feather-upload">\n    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>\n    <polyline points="17 8 12 3 7 8"></polyline>\n    <line x1="12" y1="3" x2="12" y2="15"></line>\n  </svg>`,ee=`\n  <svg xmlns="${y}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(144, 238, 220)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-save">\n    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>\n    <polyline points="17 21 17 13 7 13 7 21"></polyline>\n    <polyline points="7 3 7 8 15 8"></polyline>\n  </svg>`,te=`\n  <svg xmlns="${y}"\n      width="16"\n      height="16"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(238, 144, 144)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash">\n    <polyline points="3 6 5 6 21 6"></polyline>\n    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>\n  </svg>`,ne=`\n  <svg xmlns="${y}"\n      width="20"\n      height="20"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(176, 196, 222)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-snowflake">\n    <g id="snowflake">\n      <line x1="12.06" y1="2.74" x2="12.06" y2="12.06" />\n      <line x1="20.12" y1="7.4" x2="12.06" y2="12.06" />\n      <line x1="20.12" y1="16.71" x2="12.06" y2="12.06" />\n      <line x1="12.06" y1="21.37" x2="12.06" y2="12.06" />\n      <line x1="3.99" y1="16.71" x2="12.06" y2="12.06" />\n      <line x1="3.99" y1="7.4" x2="12.06" y2="12.06" />\n      <polyline points="8.96,4.67 12.06,7.77 15.16,4.67"/>\n      <polyline points="16.9,5.68 15.76,9.92 20,11.05"/>\n      <polyline points="20,13.06 15.76,14.2 16.9,18.43"/>\n      <polyline points="15.16,19.44 12.06,16.34 8.96,19.44"/>\n      <polyline points="7.21,18.43 8.35,14.2 4.11,13.06"/>\n      <polyline points="4.11,11.05 8.35,9.92 7.21,5.68"/>\n    </g>\n  </svg>`,oe=`\n  <svg xmlns="${y}"\n      width="16"\n      height="16"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(209, 144, 238)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus">\n    <line x1="12" y1="5" x2="12" y2="19"></line>\n    <line x1="5" y1="12" x2="19" y2="12"></line>\n  </svg>`,se=300,re="https://klavogonki.ru/u/#/",ae=document.querySelector(".userpanel .user-block .user-dropdown .name span").textContent,ie=document.querySelector("a.drop-btn.mail")?.href?.match(/\/u\/#\/(\d+)\/messages\//)?.[1],le=new Intl.DateTimeFormat("en-CA").format(new Date);let ce=[{name:"Даниэль",gender:"Male",pronunciation:"Даниэль",state:"thawed"}],de=[],ue=[],me=[],pe=[],ge=[];const he=["😀","😁","😂","🤣","😃","😄","😅","😆","😉","😊","😋","😎","😏","😐","😑","😒","😓","😔","😕","😖","😗","😘","😙","😚","😜","😝","😛","🤑","🤗","🤔","🤐","🤨","😣","😥","😮","🤯","😳","😱","😨","😰","😢","🤪","😵","😲","🤤","😷","🤒","🤕","🤢","🤧","😇","🥳","🥺","😬","😴","😌","🤥","🥴","🥵","🥶","🤧","🤭","🤫","😠","😡","😳","😞","😟","😕","🐱","😺","😸","😹","😻","😼","😽","🙀","😿","😾","🐶","🐭","🐹","🐰","🦊","🐻","🐼","🐨","🐯","🦁","🐮","🐷","🐸","🐵","🙈","🙉","🙊","🐔","🦄"],fe={lastEmojiAvatar:null,lastFocusedIframeTextarea:null,bigImageEvents:{},panelsEvents:{},fetchedUsers:JSON.parse(localStorage.getItem("fetchedUsers"))||{}},ye=function(e){const[t,n=0,o=0]=e.split(":").map(Number);return t+n/60+o/3600}(localStorage.getItem("cacheRefreshThresholdHours")||(localStorage.setItem("cacheRefreshThresholdHours",24),24)),ve=["klavogonki.ru","youtube.com","youtu.be","imgur.com","pikabu.ru","userapi.com","ibb.co","yaplakal.com","freepik.com"];let{panelsEvents:be,bigImageEvents:xe,lastFocusedIframeTextarea:we,lastEmojiAvatar:Se}=fe,ke=!1,Ee=!1;function Ce(e){e.classList.add("pulse-effect"),setTimeout((()=>{e.classList.remove("pulse-effect")}),500)}function Le(){Object.entries(xe).forEach((([e,t])=>{document.removeEventListener(e,t)}))}function Te(){Object.values(be).forEach((e=>{document.removeEventListener("keydown",e)})),Object.keys(be).forEach((e=>delete be[e]));const e=document.querySelector(".popup-panel");e&&e.remove()}function Me({container:e,buttons:t}){const n=0===e.scrollTop,o=e.scrollTop+e.clientHeight>=e.scrollHeight-3;[t.fullScrollUpButton,t.partialScrollUpButton].forEach((e=>{e.style.opacity=n?"0.3":"1",e.style.pointerEvents=n?"none":"auto"})),[t.fullScrollDownButton,t.partialScrollDownButton].forEach((e=>{e.style.opacity=o?"0.3":"1",e.style.pointerEvents=o?"none":"auto"}))}function $e({container:e,scrollButtonsContainer:t}){e.scrollHeight>e.clientHeight?t.style.display="flex":t.style.display="none"}function Ne(e){const t=document.createElement("div");t.className="scroll-buttons-container";const n=document.createElement("div");n.innerHTML=D,n.title="Scroll Up (Full)";const o=document.createElement("div");o.innerHTML=F,o.title="Scroll Up (Partial)";const s=document.createElement("div");s.innerHTML=z,s.title="Scroll Down (Partial)";const r=document.createElement("div");r.innerHTML=J,r.title="Scroll Down (Full)";const a={fullScrollUpButton:n,partialScrollUpButton:o,partialScrollDownButton:s,fullScrollDownButton:r};function i(t,n){const o=n?e.scrollHeight:e.clientHeight;e.scrollBy({top:"up"===t?-o:o,behavior:"smooth"}),Me({container:e,buttons:a})}return Object.values(a).forEach((e=>{e.classList.add("large-button","scroll-button"),t.appendChild(e)})),n.addEventListener("click",(()=>i("up",!0))),o.addEventListener("click",(()=>i("up",!1))),s.addEventListener("click",(()=>i("down",!1))),r.addEventListener("click",(()=>i("down",!0))),Me({container:e,buttons:a}),$e({container:e,scrollButtonsContainer:t}),e.addEventListener("scroll",(()=>{Me({container:e,buttons:a}),$e({container:e,scrollButtonsContainer:t})})),{scrollButtonsContainer:t}}["keydown","keyup"].forEach((e=>document.addEventListener(e,(t=>{return n=t.key,o="keydown"===e,"Control"===n&&(ke=o),void("Alt"===n&&(Ee=o));var n,o})))),["blur","focus"].forEach((e=>document.addEventListener(e,(()=>{(ke||Ee)&&(console.log(`${ke?"Ctrl ":""}${Ee?"Alt ":""}key was true`),ke=!1,Ee=!1)}))));const qe=(e,t=300)=>{let n;return function(...o){clearTimeout(n),n=setTimeout((()=>e.apply(this,o)),t)}};function Ie(e,t,n){e&&(e.offsetHeight,e.style.transition="opacity 0.3s",e.style.opacity="show"===t?n:"0","hide"===t&&e.addEventListener("transitionend",(()=>{"0"===e.style.opacity&&e.remove()}),{once:!0}))}function Ae(e){let t=document.querySelector(".dimming-background"),n=document.querySelector(".scaled-thumbnail");("hide"!==e||t)&&(t||(t=document.createElement("div"),t.classList.add("dimming-background"),document.body.appendChild(t),t.addEventListener("click",(function(){const e=document.querySelector(".popup-panel")||t.previousElementSibling;e&&Ie(e,"hide",0),Ae("hide"),n&&Le()}))),Ie(t,e,.5),"hide"===e&&n&&(Le(),je(n,"hide")))}function je(e,t){e&&(Ie(e,t,1),e.addEventListener("dblclick",(t=>{document.querySelector(".popup-panel")&&t.target.closest(".scaled-thumbnail")||Ae("hide"),je(e,"hide")})))}function Oe(e){return/^https?:\/\//.test(e)&&/%[0-9A-Fa-f]{2}/.test(e)}function He(e){const[t]=e.split("#");return decodeURIComponent(t).replace(/ /g,"_")}function Pe(e){document.querySelector({generalMessages:".messages-content div",chatlogsMessages:".chat-logs-container",personalMessages:".messages-container-wrapper"}[e])?.querySelectorAll("a:not(.media):not(.decoded)").forEach((e=>{try{if(Oe(e.href)){let t=He(e.href);e.href=e.textContent=t,e.classList.add("decoded")}}catch(t){console.error("Error decoding link:",t,e.href)}}))}function Be(){let e;do{e=he[Math.floor(Math.random()*he.length)]}while(e===Se);return Se=e,e}async function De(e){const t=await fetch(e);if(!t.ok)throw new Error(`Failed to fetch ${e}`);return t.json()}async function Fe(e,t=!0){return new Promise((async(n,o)=>{let s=t&&JSON.parse(localStorage.getItem("fetchedUsers"))||{};const r=s[e];if(t&&function(e){return e&&"object"==typeof e&&["rank","login","registered","bestSpeed","ratingLevel","friends","cars","avatarTimestamp"].every((t=>void 0!==e?.[t]))}(r))n({rank:r.rank,login:r.login,registeredDate:r.registered,bestSpeed:r.bestSpeed,ratingLevel:r.ratingLevel,friends:r.friends,cars:r.cars,avatar:r.avatar,avatarTimestamp:r.avatarTimestamp});else try{const o=`https://klavogonki.ru/api/profile/get-summary?id=${e}`,r=`https://klavogonki.ru/api/profile/get-index-data?userId=${e}`,[i,l]=await Promise.all([fetch(o),fetch(r)]);if(!i.ok||!l.ok)throw new Error("Failed to fetch data from one of the APIs.");const c=await i.json(),d=await l.json();if(!(c?.user?.login&&c.title&&d?.stats?.registered))throw new Error("Invalid data format received from the API.");{const o=c.title,r=c.user.login,i=d.stats.registered.sec?(a=d.stats.registered.sec,new Date(1e3*a).toISOString().slice(0,19).replace("T"," ")):"Invalid Date",l=d.stats.best_speed||0,u=d.stats.rating_level||0,m=d.stats.friends_cnt||0,p=d.stats.cars_cnt||0,g=c.user?.avatar||null,h=c.user.avatar?.sec||0,f=function(e,t){return e.toString()+Math.floor(t/1e3).toString()}(h,c.user.avatar?.usec||0);t&&(s[e]={rank:o,login:r,registered:i,bestSpeed:l,ratingLevel:u,friends:m,cars:p,avatar:g,avatarTimestamp:f},localStorage.setItem("fetchedUsers",JSON.stringify(s))),n({rank:o,login:r,registeredDate:i,bestSpeed:l,ratingLevel:u,friends:m,cars:p,avatar:g,avatarTimestamp:f})}}catch(t){console.error(`Error fetching user profile data for ${e}:`,t),o(t)}var a}))}function ze(e=!1,t=24){const n=localStorage.getItem("lastClearTime"),o=n?((new Date).getTime()-n)/36e5:1/0;if(e||o>=t){localStorage.removeItem("fetchedUsers"),fe.fetchedUsers={};const e=(new Date).getTime()+60*t*60*1e3;localStorage.setItem("lastClearTime",(new Date).getTime().toString()),localStorage.setItem("nextClearTime",e.toString())}}function Je(e,t){const n=Object.values(JSON.parse(localStorage.getItem("fetchedUsers")||"[]")).find((t=>t?.login===e));if(!n)return`❌ User "${e}" not found`;const o=n.actionLog||[],s=o.find((e=>e.timestamp===t));if(!s)return`Action not found at ${t}`;const r=o.indexOf(s);if(0===r)return`🙌 ${e}'s first action`;const a=o.slice(0,r).reverse().find((e=>e.type!==s.type));if(!a)return`❌ No valid previous action found for ${t}`;const i=function(e,t){const n=e=>e.split(":").reduce(((e,t,n)=>e+t*[3600,60,1][n]),0),o=Math.abs(n(t)-n(e));return[Math.floor(o/3600),Math.floor(o%3600/60),o%60].map((e=>e.toString().padStart(2,"0"))).join(":")}(a.timestamp,s.timestamp);return"leave"===s.type?`🛑 ${e} stayed in chat for ${i}`:`✅ ${e} was absent for ${i}`}function Ue(e,t){const n=JSON.parse(localStorage.getItem("toggle"))||[],o={notifications:{static:"showChatStaticNotifications",dynamic:"showGlobalDynamicNotifications"},sound:{presence:"enableBeepOnChatJoinLeave",gTTS:"switchToGoogleTTSEngine"}}[e];return!(!o||!o[t])&&n.some((e=>e.name===o[t]&&"yes"===e.option))}let Re=!0;function _e(e="generalMessages"){const t={generalMessages:".messages-content",chatlogsMessages:".chat-logs-container",personalMessages:".messages-container-wrapper"}[e];if(!t)return;const n=document.querySelector(t);if(n)if(Re)n.scrollTop=n.scrollHeight,Re=!1;else{n.scrollHeight-n.scrollTop-n.clientHeight<=600&&(n.scrollTop=n.scrollHeight)}}function Ke(){return(new Date).toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})}function Ve(e){try{const t=new URL(e),n=t.hostname.toLowerCase().split("."),o=n.length>2?n.slice(-2).join("."):t.hostname;return{isTrusted:ve.includes(o),domain:o}}catch(t){return console.error("Error in isTrustedDomain:",t.message),{isTrusted:!1,domain:e}}}function Xe(e="generalMessages"){const t={generalMessages:{container:".messages-content div",messageElement:"p",exclude:[".time",".username"]},chatlogsMessages:{container:".chat-logs-container",messageElement:".message-text"},personalMessages:{container:".messages-container",messageElement:".message-text"}}[e];if(!t)return void console.error("Invalid container type");const n=document.querySelectorAll(t.container),o=new WeakSet;n.forEach((n=>{n.querySelectorAll(t.messageElement).forEach((n=>{[...n.querySelectorAll(".private"),...n.querySelectorAll(".system-message"),n].forEach((n=>{const s=document.createTreeWalker(n,NodeFilter.SHOW_TEXT,{acceptNode:n=>{if(o.has(n))return NodeFilter.FILTER_SKIP;const s=n.parentElement;return s.closest(".mention, .time, .username")||"generalMessages"===e&&s.closest(t.exclude.join(","))?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT}},!1),r=[];let a;for(;a=s.nextNode();)r.push(a);r.forEach((e=>{o.has(e)||(!function(e){const t=/[\s]+|[^\s\wа-яА-ЯёЁ]+|[\wа-яА-ЯёЁ]+/g,n=e.textContent.match(t);if(!n)return;const o=document.createDocumentFragment();n.forEach((e=>{if(de.map((e=>e.toLowerCase())).includes(e.toLowerCase())){const t=document.createElement("span");t.className="mention",t.textContent=e,o.appendChild(t)}else o.appendChild(document.createTextNode(e))})),e.parentNode.replaceChild(o,e)}(e),o.add(e))}))}))}))}))}let Ge=localStorage.personalMessages&&Object.keys(JSON.parse(localStorage.personalMessages)).length||0;function Ye(){const e=document.querySelector(".personal-messages-button .total-message-count"),t=document.querySelector(".personal-messages-button .new-message-count");if(!e||!t)return;const n=JSON.parse(localStorage.getItem("personalMessages"))||{},o=Object.keys(n).length;let s=Number(localStorage.getItem("newMessagesCount"))||0;o>Ge&&(s++,localStorage.setItem("newMessagesCount",s),Ce(t),addJumpEffect(t,50,50)),e.textContent=o,t.textContent=s,t.style.visibility=s>0?"visible":"hidden",o!==Ge&&Ce(e),Ge=o}let{bigImageEvents:We}=fe,Ze=null;const Qe=[];let et=0;let tt=!1;const nt=["jpg","jpeg","png","gif","webp"];function ot(e){const t=document.querySelector({generalMessages:".messages-content div",chatlogsMessages:".chat-logs-container",personalMessages:".messages-container-wrapper"}[e]);if(!t)return;const n=t.querySelectorAll("a:not(.skipped):not(.processed-image)");function o(t,n){const o=document.createElement("div");o.classList.add("clickable-thumbnail");const s=document.createElement("img");s.src=t.href,s.onload=()=>{o.appendChild(s),t.parentNode.insertBefore(o,t.nextSibling),Qe.push({link:t,imgSrc:t.href}),_e(e)},s.onerror=()=>{console.error("Failed to load image:",t.href),t.classList.add("skipped")},n?t.querySelector(".clickable-thumbnail")||t.addEventListener("click",(e=>{t.querySelector(".clickable-thumbnail")||(o.appendChild(s),t.parentNode.insertBefore(o,t.nextSibling))})):(o.appendChild(s),t.parentNode.insertBefore(o,t.nextSibling)),o.addEventListener("click",(e=>{e.stopPropagation(),Ze=function(e){const t=document.createElement("img");t.src=e,t.classList.add("scaled-thumbnail"),document.body.appendChild(t);const n=e=>{je(e,"hide"),document.querySelector(".popup-panel")||Ae("hide"),Le()};We.unfocusedClick=function(e){t.contains(e.target)||(t.remove(),Le())},document.addEventListener("click",We.unfocusedClick),We.keydown=function(e){"Escape"===e.code||"Space"===e.code?(e.preventDefault(),n(t)):"ArrowLeft"===e.code?st(-1):"ArrowRight"===e.code&&st(1)},document.addEventListener("keydown",We.keydown);let o=1,s=.1,r=!1,a=0,i=0,l=-50,c=-50;const d=5;return We.wheel=function(e){const n=e.deltaY;o+=(n<0?1:-1)*s*o,o=Math.max(o,1),t.style.transform=`translate(${l}%, ${c}%) scale(${o})`,e.preventDefault()},We.mousemove=function(e){if(r){const n=(e.clientX-a)/o*d,s=(e.clientY-i)/o*d;l+=n/t.clientWidth*100,c+=s/t.clientHeight*100,t.style.transform=`translate(${l}%, ${c}%) scale(${o})`,a=e.clientX,i=e.clientY}},We.mousedown=function(e){const{button:o,clientX:s,clientY:l,target:c,ctrlKey:d}=e;if((0===o||2===o)&&c!==t)return;let u=c.src;0===o?d?window.open(u,"_blank"):st(-1):2===o?(e.preventDefault(),d?(navigator.clipboard.writeText(u).catch(console.error),n(t)):st(1)):1===o&&(r=!0,[a,i]=[s,l])},We.mouseup=function(){r=!1},We.contextmenu=function(e){e.preventDefault()},function(){Object.entries(xe).forEach((([e,t])=>{document.addEventListener(e,t)}))}(),t}(s.src),je(Ze,"show"),Ae("show")}))}n.length&&n.forEach((e=>{if(!e.href||!e.href.startsWith("http"))return;const{allowed:t,extension:n}=function(e){const t=e=>e.match(/\.([^?#.]+)(?:[?#]|$)/i)?.[1]?.toLowerCase()||"";try{const n=t(e);return{allowed:nt.includes(n),extension:n}}catch(n){return console.error("Error in isAllowedImageExtension:",n.message),{allowed:!1,extension:t(String(e))}}}(e.href);if(!t)return;e.classList.add("media");const{isTrusted:s,domain:r}=Ve(e.href);e.title=Oe(e.href)?He(e.href):e.href,s?(e.textContent=`📸 Image (${n.toUpperCase()}) 🖥️ Hostname (${r})`,e.classList.add("processed-image"),o(e,!1)):(e.classList.add("skipped"),e.textContent=`📸 Image (${n.toUpperCase()}) 🖥️ Hostname (${r}) 💀️️ Untrusted`,e.addEventListener("click",(t=>{e.classList.contains("processed-image")||(t.preventDefault(),e.classList.remove("skipped"),e.classList.add("processed-image"),o(e,!0))})))}))}function st(e){const t=et+e;if(t>=0&&t<Qe.length){if(tt)return;tt=!0,Ze&&(Ze.src=Qe[t].imgSrc),setTimeout((()=>{tt=!1}),50),et=t}}const rt="🎥",at="🖥️",it=["mp4","webm","ogg","mov","avi"];function lt(e){const t={generalMessages:".messages-content div",chatlogsMessages:".chat-logs-container",personalMessages:".messages-container-wrapper"}[e];if(!t)return void console.error("Invalid container type specified");const n=document.querySelector(t);if(!n)return;const o=n.querySelectorAll("a:not(.skipped):not(.processed-video)");function s(t,n,o,s){const{youtubeMatch:r,videoType:a,videoId:i}=s,l=function(e){const t=e=>e.match(/\.([^?#.]+)(?:[?#]|$)/i)?.[1]?.toLowerCase()||"";try{const n=t(e);return{allowed:it.includes(n),extension:n}}catch(n){return console.error("Error in isAllowedVideoExtension:",n.message),{allowed:!1,extension:t(String(e))}}}(n);if(!r&&!l.allowed)return;t.classList.add("processed-video");const c=document.createElement("div");c.classList.add("video-wrapper");let d=document.createElement(r?"iframe":"video");d.classList.add("video-container"),r?(t.textContent=`${rt} ${a} ${at} Hostname (${o})`,d.src=`https://www.youtube.com/embed/${i}`,d.allowFullscreen=!0):(t.textContent=`${rt} ${a} ${at} Hostname (${o})`,d.src=n,d.controls=!0),t.title=Oe(n)?He(n):n,t.style.display="inline-flex",t.parentNode.insertBefore(c,t),c.append(t,d),_e(e)}o.length&&o.forEach((e=>{const t=e.href;if(!t)return;const n=function(e){const t=e.match(/(?:shorts\/|live\/|watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/i);if(t){return{youtubeMatch:!0,videoId:t[1],videoType:e.includes("shorts/")?"Shorts":e.includes("live/")?"Live":e.includes("watch?v=")?"Watch":e.includes("youtu.be/")?"Share":"YouTube"}}const n=e.split(".").pop().toLowerCase();if(it.includes(n))return{youtubeMatch:!1,videoType:`Video (${n.toUpperCase()})`};return!1}(t);if(!n)return;e.classList.add("media");const{isTrusted:o,domain:r}=Ve(t);if(!o)return e.classList.add("skipped"),e.textContent=`${rt} ${n.videoType} ${at} Hostname (${r}) 💀️️ Untrusted`,void e.addEventListener("click",(o=>{e.classList.contains("processed-video")||(o.preventDefault(),e.classList.remove("skipped"),s(e,t,r,n))}));s(e,t,r,n)}))}let ct=null,dt=null,ut=null,mt=!1,pt=!1,gt=null;const ht=e=>{ct&&(ct.style.left=`${e.clientX+0}px`,ct.style.top=`${e.clientY+18}px`)},ft=()=>{mt=!1,gt=null,clearTimeout(ut),ut=null,clearTimeout(dt),dt=setTimeout((()=>{ct&&(ct.style.opacity="0",pt=!1,setTimeout((()=>{!mt&&ct&&(ct.style.display="none",document.removeEventListener("mousemove",ht))}),50))}),100)};function yt(e,t){if(e.classList.contains("events-included"))return;e.classList.add("events-included"),ct||=(()=>{const e=document.createElement("div");return e.classList.add("custom-tooltip-popup"),document.body.appendChild(e),e})();e.addEventListener("mouseenter",(n=>{mt=!0,gt=e,clearTimeout(ut),clearTimeout(dt),ct.textContent=t,document.addEventListener("mousemove",ht),ht(n),pt||(ut=setTimeout((()=>{ct.style.display="flex",ct.style.opacity="1",pt=!0}),600))})),e.addEventListener("mouseleave",ft)}function vt(e){const t=document.createElement("div");return t.classList.add("action-icon"),t.style.margin="0 4px",t.style.setProperty("border","none","important"),t.innerHTML=e,t}function bt(e,t,n,o,s){const r={generalChat:".messages-content div",cachePanel:".fetched-users .action-log"}[s];if(!r)return void console.error("Invalid or missing container. Please provide 'generalChat' or 'cachePanel'.");const a=document.querySelector(r);if(!a)return void console.error("Container not found in DOM.");a.classList.add("generalChat"===s?"static-chat-notifications-container":"static-cache-notifications-container");const i=document.createElement("div");i.classList.add("static-chat-notification"),"generalChat"===s&&i.addEventListener("dblclick",(()=>{!async function(e=40,t=600,n=140){const o=document.querySelector(".messages-content");if(!o)return;const s=o.style.scrollBehavior;o.style.scrollBehavior="smooth";const r=[...document.querySelectorAll(".static-chat-notification")].reverse();for(const s of r){!St(s,o)&&(o.scrollTop=s.offsetTop-o.offsetTop-o.clientHeight/2,await wt(t)),Object.assign(s.style,{transition:[`opacity ${n/1e3}s cubic-bezier(.3,.1,1,.1)`,`transform ${n/1e3}s cubic-bezier(0,.7,.3,0.95)`].join(","),opacity:0,transformOrigin:"left",transform:"translateX(8em) skewX(-20deg)"}),await wt(n),s.remove(),await wt(e)}o.scrollHeight-o.scrollTop<=o.clientHeight||(o.scrollTop=o.scrollHeight,await wt(t));o.style.scrollBehavior=s}()}));const l=document.createElement("span");l.classList.add("action-user"),l.textContent=e;const c=vt(t),d=document.createElement("span");d.classList.add("action-time"),d.textContent=n,i.appendChild(l),i.appendChild(c),i.appendChild(d),i.dataset.username=e,i.dataset.time=n,o?i.classList.add("user-enter"):i.classList.add("user-left"),a.appendChild(i),i.addEventListener("mouseover",(()=>{const e=Je(i.dataset.username,i.dataset.time);yt(i,e)}))}function xt(e,t,n){const o=ce.some((t=>t.name===e&&"thawed"===t.state)),s=o&&Ue("notifications","static"),r=Ue("notifications","dynamic");if(!s&&!r)return;const a=Ke();s&&o&&(bt(e,t,a,n,"generalChat"),_e()),r&&function(e,t,n,o){let s=document.querySelector(".dynamic-chat-notifications-container");s||(s=document.createElement("div"),s.classList.add("dynamic-chat-notifications-container"),document.body.appendChild(s));const r=document.createElement("div");r.classList.add("dynamic-chat-notification");const a=document.createElement("span");a.classList.add("action-user"),a.textContent=e;const i=vt(t),l=document.createElement("span");l.classList.add("action-time"),l.textContent=n,r.appendChild(a),r.appendChild(i),r.appendChild(l),r.dataset.username=e,r.dataset.time=n,o?r.classList.add("user-enter"):r.classList.add("user-left"),s.appendChild(r),r.addEventListener("mouseover",(()=>{const e=Je(r.dataset.username,r.dataset.time);yt(r,e)})),setTimeout((()=>{r.style.transform="translateX(0)",setTimeout((()=>{r.style.transform="translateX(-100%)",setTimeout((()=>{s.removeChild(r)}),300)}),5e3)}),300)}(e,t,a,n)}new MutationObserver((()=>{gt&&!document.contains(gt)&&ft()})).observe(document,{childList:!0,subtree:!0});const wt=e=>new Promise((t=>setTimeout(t,e)));function St(e,t){const n=t.getBoundingClientRect(),o=e.getBoundingClientRect();return o.top>=n.top&&o.bottom<=n.bottom}let kt=JSON.parse(localStorage.getItem("fetchedUsers"))||{};const Et={Экстракибер:1,Кибергонщик:2,Супермен:3,Маньяк:4,Гонщик:5,Профи:6,Таксист:7,Любитель:8,Новичок:9},Ct={Экстракибер:"#06B4E9",Кибергонщик:"#5681ff",Супермен:"#B543F5",Маньяк:"#DA0543",Гонщик:"#FF8C00",Профи:"#C1AA00",Таксист:"#2DAB4F",Любитель:"#61B5B3",Новичок:"#AFAFAF"};function Lt(){const e=document.querySelector(".cached-users-panel");if(e)return e.remove(),void Ae("hide");Te();let t=kt;const n=document.createElement("div");n.className="cached-users-panel popup-panel",fe.panelsEvents.handleCacheKeydown=e=>{"Escape"===e.key&&(je(n,"hide"),Ae("hide"),document.removeEventListener("keydown",fe.panelsEvents.handleCacheKeydown))},document.addEventListener("keydown",fe.panelsEvents.handleCacheKeydown);const o=document.createElement("div");o.className="panel-header";const s=document.createElement("div");s.className="drop-time";const r=document.createElement("span");r.className="drop-time-threshold-description",r.textContent="🚧 Threshold";const a=document.createElement("span");a.className="drop-time-threshold";const i=localStorage.getItem("cacheRefreshThresholdHours");a.innerHTML=i||"00:00:00",a.addEventListener("click",(function(){let e=!1;for(;!e;){const t=prompt("Enter a cache refresh time (e.g., HH, HH:mm, or HH:mm:ss):"),n=document.querySelector(".drop-time-threshold");if(null===t)e=!0;else if(/^([0-9]+|[01][0-9]|2[0-4])(:([0-5]?[0-9])(:([0-5]?[0-9]))?)?$/.test(t)){const o=t.split(":"),s=("0"+o[0]).slice(-2),r=("0"+(o[1]||"00")).slice(-2),a=("0"+(o[2]||"00")).slice(-2);n.textContent=`${s}:${r}:${a}`;const i=`${s}:${r}:${a}`;localStorage.setItem("cacheRefreshThresholdHours",i),localStorage.removeItem("fetchedUsers"),localStorage.removeItem("lastClearTime"),localStorage.removeItem("nextClearTime"),setTimeout((()=>location.reload()),1e3),e=!0}else alert("Invalid time format. Please enter a valid time in the format HH, HH:mm, or HH:mm:ss.")}}));const l=document.createElement("span");l.className="drop-time-expiration-description",l.textContent="💣 Countdown";const c=document.createElement("span");c.className="drop-time-expiration",s.appendChild(r),s.appendChild(a),s.appendChild(l),s.appendChild(c),o.appendChild(s);const d=document.createElement("div");d.className="search-for-cached-users";const u=document.createElement("input");u.className="cached-users-search-input",u.type="text",d.appendChild(u),u.addEventListener("click",(()=>ke&&(u.value=""))),u.addEventListener("keydown",(async e=>{const t=document.querySelector(".old-users"),n=document.querySelector(".new-users"),o=document.querySelector(".fetched-users");if("Backspace"===e.key&&0===e.target.value.length){t.style.display="grid",n.style.display="grid";const e=document.querySelector(".search-results");e&&o&&o.removeChild(e)}else if("Enter"===e.key){0===e.target.value.trim().length&&(e.preventDefault(),e.target.value="user ")}}));const m=async e=>{const t=document.querySelector(".old-users"),n=document.querySelector(".new-users"),o=document.querySelector(".fetched-users");if(e){t.style.display="none",n.style.display="none";let s=document.querySelector(".search-results");s?s.innerHTML=null:(s=k("search-results"),o.appendChild(s));const r=[];try{const t=await async function(e){const t=`https://klavogonki.ru/api/profile/search-users?query=${e}`,n=(await De(t)).all;if(!n||0===n.length)throw new Error(`User ${e} not found.`);return n.map((e=>e.id))}(e);await Promise.all(t.map((async e=>{const t=await Fe(e,!1),n={rank:t.rank,login:t.login,registered:t.registeredDate,bestSpeed:t.bestSpeed,ratingLevel:t.ratingLevel,friends:t.friends,cars:t.cars,avatarTimestamp:t.avatarTimestamp,avatar:t.avatar},o=I(e,n);o&&r.push(o)}))),r.sort(((e,t)=>e.order!==t.order?e.order-t.order:t.bestSpeed-e.bestSpeed)),r.forEach((({userElement:e})=>{s.appendChild(e)}));const n=L(`Search Results for: ${e}`,"search-results-description");s.prepend(n)}catch(e){console.error("Error fetching user profile:",e);const t=document.createElement("div");t.className="error-message",t.textContent=`Error fetching user profile: ${e.message}`,s.appendChild(t)}}};u.addEventListener("input",qe((e=>{const t=e.target.value.trim(),n=localStorage.getItem("cachePanelSearchMode"),o=t.startsWith("user ")?t.substring(5).trim():"fetch"===n?t:"";o&&m(o)}),300)),o.appendChild(d);const p=new MutationObserver((e=>{if(e.some((e=>"childList"===e.type&&e.addedNodes.length>0))){const e=document.querySelector(".cached-users-search-input"),t=Array.from(document.querySelectorAll(".fetched-users .login")),n=(e,t)=>{let n=0,o=0;for(const s of t.toLowerCase())o<e.length&&s===e[o].toLowerCase()&&(n+=2,o++);return o===e.length?n:0},o=e=>{t.forEach((t=>{t.closest(".user-item").style.display=!e||n(e,t.textContent)>0?"grid":"none"}))};e.focus(),e.addEventListener("input",(()=>o(e.value.trim()))),p.disconnect()}}));p.observe(o,{childList:!0,subtree:!0});const g=document.createElement("div");g.className="panel-control-buttons",g.style.display="flex";const h=document.createElement("div");h.className="large-button user-mode-button",h.innerHTML=W;const f=localStorage.getItem("cachePanelSearchMode")||(localStorage.setItem("cachePanelSearchMode","cache"),"cache");function y(e){const t=h;t.classList.toggle("cache-mode-button","cache"===e),t.classList.toggle("fetch-mode-button","cache"!==e)}h.title=`Current active mode: ${f}`,y(f),h.addEventListener("click",(()=>{const e="cache"===localStorage.getItem("cachePanelSearchMode")?"fetch":"cache";localStorage.setItem("cachePanelSearchMode",e),y(e),h.title=`Current active mode: ${e}`})),g.appendChild(h);const x=document.createElement("div");x.className="large-button panel-header-clear-button",x.title="Clear cache",x.innerHTML=Y,x.addEventListener("click",(()=>{Tt(),ze(!0,ye);const e=document.querySelector(".cache-panel-load-button .cache-user-count");e&&(e.textContent="0")})),g.appendChild(x);const w=document.createElement("div");w.className="large-button panel-header-close-button",w.title="Close panel",w.innerHTML=P,w.addEventListener("click",(()=>{Tt()})),g.appendChild(w),o.appendChild(g);const S=document.createElement("div");function k(e){const t=document.createElement("div");return t.className="users-container",t.classList.add(e?"old-users":"new-users"),t}S.className="fetched-users";const E=k(!0),C=k(!1);function L(e,t){const n=document.createElement("span");return n.className=`description ${t}`,n.textContent=e,n}const T=L("Active Users","old-users-description"),M=L("New Registrations","new-users-description");E.appendChild(T),C.appendChild(M),S.appendChild(E),S.appendChild(C);const $=[];let N=!0;const q=new Date,I=(e,t)=>{const n=document.createElement("div");n.className="user-item";const o=document.createElement("div");o.className="avatar";const s=kt[e]?.avatarTimestamp,r=`/storage/avatars/${e}_big.png`;if(s&&"00"!==s||t.avatar&&Object.keys(t.avatar).length>0){const e=`${r}?updated=${s}`,n=document.createElement("img");n.src=e,n.alt=`${t.login}'s avatar`,n.style.objectFit="cover",o.appendChild(n)}else o.innerHTML=Be();const a=document.createElement("div");a.className="user-data";const i=document.createElement("div");i.className="login-container";const l=document.createElement("a");l.className="login",l.textContent=t.login,l.href=`https://klavogonki.ru/profile/${e}`,i.appendChild(l);const c=re+e,d=`${re}${ie}/messages/${e}/`;if(l.addEventListener("click",(function(e){if(e.preventDefault(),e.ctrlKey&&e.shiftKey){const e=window.open(d,"_blank");e&&e.focus()}else e.ctrlKey?loadProfileIntoIframe(d):loadProfileIntoIframe(c)})),void 0!==t.visits){const n=document.createElement("span");n.className="visits",n.classList.add(t.tracked?"tracked":"untracked"),n.textContent=t.visits,n.dataset.userId=e,function(e){const t=Number(e.textContent);if(isNaN(t))return console.warn("Invalid visits count!");const n=t<=10?"💧":t<=20?"💦":t<=30?"🌊":"🔥";e.textContent=`${n} ${t}`}(n),i.appendChild(n),n.addEventListener("click",(e=>{N=!0;const o=n.dataset.userId,s=kt[o],r=s?s.actionLog:null;if(s){let n=document.querySelector(".action-log");if(n?n.replaceChildren():(n=document.createElement("div"),n.className="action-log",S.appendChild(n),Ie(n,"show",1)),r&&N)for(let e=0;e<r.length&&N;e++){const n=r[e];if("object"!=typeof n||null===n)continue;const{type:o,timestamp:s}=n,a=t?.login||"Unknown User",i="enter"===o?v:b,l="enter"===o;(t=>{setTimeout((()=>{t&&bt(a,i,s,l,"cachePanel")}),10*(e+1))})(N)}const o=e=>{n.contains(e.target)&&"Space"!==e.code||("Space"===e.code&&e.preventDefault(),Ie(n,"hide",0),N=!1,["click","keydown"].forEach((e=>document.removeEventListener(e,o))))};["click","keydown"].forEach((e=>document.addEventListener(e,o))),e.stopPropagation()}else console.error("User data not found")}))}a.appendChild(i);const u=document.createElement("div");u.className="rank",u.textContent=t.rank||"N/A",u.style.color=Ct[t.rank]||"white",a.appendChild(u);const m=document.createElement("div");let p;m.className="registered",m.textContent=t.registered||"N/A";const g=m.textContent;m.addEventListener("mouseover",(()=>{clearTimeout(p),p=setTimeout((()=>{m.textContent=calculateTimeOnSite(t.registered)}),300)})),m.addEventListener("mouseout",(()=>{clearTimeout(p),m.textContent=g})),a.appendChild(m);const h=(e,t,n,o,s,r)=>{const a=document.createElement("span");return a.className=e,a.style.color=t,a.innerHTML=`${n}${o||0}&nbsp;&nbsp;`,a.title=s,a.style.cursor="pointer",a.addEventListener("click",(()=>loadProfileIntoIframe(r))),a},f=h("best-speed","cyan","🚀",t.bestSpeed,"Best speed",`https://klavogonki.ru/u/#/${e}/stats/normal/`),y=h("rating-level","gold","⭐",t.ratingLevel,"Rating level",`https://klavogonki.ru/top/rating/today?s=${t.login}`),x=h("cars-count","lightblue","🚖",t.cars,"Cars count",`https://klavogonki.ru/u/#/${e}/car/`),w=h("friends-count","lightgreen","🤝",t.friends,"Friends count",`https://klavogonki.ru/u/#/${e}/friends/list/`),k=document.createElement("div");return k.className="user-metrics",k.append(f,y,x,w),n.append(o,a,k),{userElement:n,order:Et[t.rank]||10,bestSpeed:t.bestSpeed||0,registered:t.registered}};"cache"===localStorage.getItem("cachePanelSearchMode")&&(Object.keys(t).forEach((async e=>{const n=t[e],o=I(e,n);$.push(o)})),$.sort(((e,t)=>e.order!==t.order?e.order-t.order:t.bestSpeed-e.bestSpeed)),$.forEach((({userElement:e,registered:t})=>{const n=(e=>{const t=new Date(e);return q-t<=864e5})(t)?C:E;n.appendChild(e)}))),n.appendChild(o),n.appendChild(S),document.body.appendChild(n);const{scrollButtonsContainer:A}=Ne(S);function j(){const e=localStorage.getItem("lastClearTime"),t=localStorage.getItem("nextClearTime"),n=document.querySelector(".drop-time-expiration");if(e&&t&&n){const e=t-(new Date).getTime();e<=0?ze(!0,ye):function(e,t){const n=String(Math.floor(t/36e5)).padStart(2,"0"),o=String(Math.floor(t%36e5/6e4)).padStart(2,"0"),s=String(Math.floor(t%6e4/1e3)).padStart(2,"0"),r=`${n}:${o}:${s}`,a=parseInt(s,10),i=5*Math.ceil(a/5),l=O[i]||O[0];e.textContent=`${r} ${l}`}(n,e)}}n.appendChild(A),je(n,"show"),Ae("show");const O={0:"🕛",5:"🕐",10:"🕑",15:"🕒",20:"🕓",25:"🕔",30:"🕕",35:"🕖",40:"🕗",45:"🕘",50:"🕙",55:"🕚"};setInterval(j,1e3),j()}function Tt(){const e=document.querySelector(".cached-users-panel");e&&(je(e,"hide"),Ae("hide"))}let{panelsEvents:Mt}=fe;function $t(e){const t=document.createElement("div");t.classList.add("empowerment-button","personal-messages-button"),t.innerHTML=A;const n=document.createElement("div");n.classList.add("message-count","total-message-count");const o=JSON.parse(localStorage.getItem("personalMessages"))||{};n.textContent=Object.keys(o).length,t.appendChild(n);const s=document.createElement("div");s.classList.add("message-count","new-message-count");let r=Number(localStorage.getItem("newMessagesCount"))||(localStorage.setItem("newMessagesCount","0"),0);s.textContent=r,s.style.visibility=r>0?"visible":"hidden",t.appendChild(s),t.title="Show Personal Messages",t.addEventListener("click",(function(){Ce(t),jt();Object.keys(JSON.parse(localStorage.getItem("personalMessages"))||{}).length>0&&(localStorage.setItem("newMessagesCount","0"),r=0,s.textContent=r)})),e.appendChild(t)}async function Nt(e,t,n){const o=document.querySelector(".messages-content");if(!o)return null;const s=e=>e.replace(/[\[\]]/g,"").split(":").reduce(((e,t,n)=>e+Number(t)*60**(2-n)),0),r=s(e),a=e=>Array.from(o.querySelectorAll("p")).find((n=>{const o=n.querySelector(".time"),r=n.querySelector(".username span[data-user]");if(o&&r){const n=s(o.textContent.trim()),a=r.textContent.trim();return e(n)&&a===t}return!1}));let i=a((e=>e===r));return i||(i=a((e=>Math.abs(e-r)<=2))),i&&n&&await scrollMessagesToMiddle(o,i),i||!1}function qt(e){const t=180- -(new Date).getTimezoneOffset(),[n,o,s]=e.split(":").map(Number);let r=60*n+o+t;r=(r%1440+1440)%1440;const a=r%60;return`${Math.floor(r/60).toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`}function It(e,t="single"){const n=e.querySelector(".message-time").textContent,o=e.querySelector(".message-username").textContent;let s=JSON.parse(localStorage.getItem("personalMessagesBackup"))||{};if(0===Object.keys(s).length){s={...JSON.parse(localStorage.getItem("personalMessages"))||{}},localStorage.setItem("personalMessagesBackup",JSON.stringify(s))}let r={...s};if("all"===t)document.querySelectorAll(".message-item").forEach((e=>{const t=e.querySelector(".message-username").textContent;if(t===o){e.remove();const n=e.querySelector(".message-time").textContent;delete r[`[${n}]_${t}`]}}));else if("from"===t){const t=Array.from(document.querySelectorAll(".message-item"));for(let n=t.indexOf(e);n<t.length;n++){const e=t[n],s=e.querySelector(".message-username").textContent;if(s===o){e.remove();const t=e.querySelector(".message-time").textContent;delete r[`[${t}]_${s}`]}}}else{const t=`[${n}]_${o}`;r[t]&&(delete r[t],e.remove())}localStorage.setItem("personalMessagesBackup",JSON.stringify(r));const a=document.querySelector(".personal-messages-button .total-message-count");a&&(a.textContent=Object.keys(r).length)}function At(){const e=Object.keys(JSON.parse(localStorage.getItem("personalMessages")||"{}")).length;document.querySelector(".personal-messages-button .total-message-count").textContent=e}async function jt(){const e=document.querySelector(".cached-messages-panel");if(e)return e.remove(),void Ae("hide");let t=!0,n=!1;At(),localStorage.getItem("personalMessagesBackup")&&localStorage.removeItem("personalMessagesBackup"),Te();const o=document.querySelector(".personal-messages-button .new-message-count");function s(){const e=localStorage.getItem("personalMessages");return JSON.parse(e)||{}}o&&(o.textContent="0"),o.style.visibility="hidden",localStorage.removeItem("newMessagesCount");let r=s();const a=document.createElement("div");a.className="cached-messages-panel popup-panel";const i=document.createElement("div");i.className="panel-header";const l=document.createElement("div");l.className="search-for-personal-messages";const c=document.createElement("input");c.className="personal-messages-search-input",c.type="search",l.appendChild(c);const d=document.createElement("div");d.className="panel-control-buttons";const u=document.createElement("div");u.className="large-button panel-header-save-button",u.innerHTML=ee,u.title="Save messages",u.style.opacity="0",u.addEventListener("click",(()=>{const e=localStorage.getItem("personalMessagesBackup"),n=localStorage.getItem("personalMessages"),o=e&&n;if(o&&o&&n!==e&&!t){window.confirm("Do you want to apply changes?")&&(localStorage.setItem("personalMessages",e),localStorage.removeItem("personalMessagesBackup"),u.style.setProperty("display","none","important"),u.style.opacity="0",u.addEventListener("transitionend",(function(){u.style.display="none"})))}}));const m=document.createElement("div");m.className="large-button panel-header-import-button",m.innerHTML=Z,m.title="Import messages",m.addEventListener("click",(()=>{n=!0;const e=document.createElement("input");e.type="file",e.accept=".json",e.addEventListener("change",(e=>{const t=e.target.files[0];if(t){const e=new FileReader;e.onload=async()=>{try{const t=JSON.parse(e.result),n={...JSON.parse(localStorage.getItem("personalMessages")||"{}"),...t},o=Object.fromEntries(Object.entries(n).sort((([,e],[,t])=>{const n=e.time.replace(/[[\]]/g,""),o=t.time.replace(/[[\]]/g,""),s=`${e.date} ${n}`,r=`${t.date} ${o}`;return new Date(s)-new Date(r)})));localStorage.setItem("personalMessages",JSON.stringify(o)),At();const r=s();await L(r)}catch(e){alert("Failed to import messages. The file may be corrupted.")}},e.readAsText(t)}})),e.click()}));const p=document.createElement("div");p.className="large-button panel-header-export-button",p.innerHTML=Q,p.title="Export messages",p.addEventListener("click",(()=>{const e=localStorage.getItem("personalMessages");if(e&&"{}"!==e){const t=new Intl.DateTimeFormat("en-CA").format(new Date),n=JSON.parse(e),o=JSON.stringify(n,null,2),s=new Blob([o],{type:"application/json"}),r=document.createElement("a");r.href=URL.createObjectURL(s),r.download=`Personal_Messages_${t}.json`,r.click()}else alert("No messages to export.")}));const g=document.createElement("div");g.className="large-button panel-header-copy-button",g.innerHTML=K,g.title="Copy Personal Messages",g.addEventListener("click",(()=>{addJumpEffect(g,0,0);const e=Array.from(document.querySelector(".messages-container").children).filter((e=>{const t=window.getComputedStyle(e);return"hidden"!==t.contentVisibility&&"none"!==t.display})).map((e=>e.classList.contains("date-item")?e.textContent.trim():[e.querySelector(".message-time"),e.querySelector(".message-username"),e.querySelector(".message-text")].map((e=>e?.textContent.trim())).filter(Boolean).join(" "))).filter(Boolean).join(" \n");e.trim()?navigator.clipboard.writeText(e).then((()=>addJumpEffect(g,0,0))).catch(console.error):alert("No messages to copy.")}));const h=document.createElement("div");h.className="large-button panel-header-clear-button",h.title="Clear personal messages",h.innerHTML=Y,h.addEventListener("click",(()=>{n=!0;const e=JSON.parse(localStorage.getItem("personalMessages")||"{}");if(0===Object.keys(e).length)return void alert("No messages to delete.");y.innerHTML=null,localStorage.setItem("personalMessages",JSON.stringify({})),je(a,"hide"),Ae("hide");const t=document.querySelector(".personal-messages-button .total-message-count");t&&(t.textContent="0")}));const f=document.createElement("div");f.className="large-button panel-header-close-button",f.title="Close panel",f.innerHTML=P,f.addEventListener("click",(()=>{je(a,"hide"),Ae("hide")})),i.appendChild(l),d.appendChild(u),d.appendChild(m),d.appendChild(p),d.appendChild(g),d.appendChild(h),d.appendChild(f),i.appendChild(d),a.appendChild(i);const y=document.createElement("div");y.className="messages-container";let v=null,b=0,x=100,w=!1,S=null;const k=[],E={private:"coral",mention:"darkseagreen"},C={private:"coral",mention:"lightsteelblue",default:"slategray"};async function L(e){y.children.length&&y.replaceChildren(),Object.entries(e).forEach((([,{time:e,date:t,username:n,usernameColor:o,message:s,type:r,userId:i}])=>{if(S!==t){const e=document.createElement("div");e.className="date-item",e.textContent=t===le?"Today ⏳":`${t} 📅`,e.dataset.date=t,y.appendChild(e),S=t}const l=document.createElement("div");l.className="message-item",n!==v&&(l.style.marginTop="0.6em",v=n);const c=e.replace(/[\[\]]/g,"").trim(),d=document.createElement("span");if(d.className="message-time",d.textContent=c,d.title=`Moscow Time: ${qt(c)}`,d.style.color=E[r]||"slategray","mention"===r||"private"===r){const e="mention"===r?"lightgreen":"peachpuff";d.addEventListener("mouseover",(()=>{d.style.color=e})),d.addEventListener("mouseout",(()=>{d.style.color=E[r]})),d.addEventListener("click",(e=>{if(e.ctrlKey)It(l,"from");else if("mention"===r){const e=`https://klavogonki.ru/chatlogs/${t}.html#${qt(c)}`;window.open(e,"_blank","noopener,noreferrer")}}))}const u=document.createElement("span");u.className="message-username",u.textContent=n,u.style.color=o,u.addEventListener("click",(e=>{if(e.ctrlKey)It(l,"all");else if(i){const e=`https://klavogonki.ru/u/#/${i}/`;window.open(e,"_blank","noopener,noreferrer")}else addShakeEffect(u)}));const m=document.createElement("span");m.className="message-text",m.innerHTML=s.replace(/:(?=\w*[a-zA-Z])(\w+):/g,((e,t)=>`<img src="/img/smilies/${t}.gif" alt=":${t}:" title=":${t}:" class="smile">`)).replace(/(https?:\/\/[^\s]+)/gi,(e=>`<a href="${e}" target="_blank" rel="noopener noreferrer">${e}</a>`)),m.addEventListener("click",(async function(t){if(t.ctrlKey)return void It(l,"single");if(await Nt(e,n,!0))je(a,"hide"),Ae("hide");else{let e=m.parentElement.previousElementSibling;for(;e&&!e.classList.contains("date-item");)e=e.previousElementSibling;if(e){await showChatLogsPanel(e.dataset.date);const t=qt(c);requestAnimationFrame((async()=>{setTimeout((async()=>{const e=await async function(e,t,n){const o=document.querySelector(".chat-logs-container");if(!o)return null;const s=e=>e.replace(/[\[\]]/g,"").split(":").reduce(((e,t,n)=>e+Number(t)*60**(2-n)),0),r=s(e),a=e=>Array.from(o.querySelectorAll(".message-item")).find((n=>{const o=n.querySelector(".message-time"),r=n.querySelector(".message-username");if(o&&r){const n=s(o.textContent.trim()),a=r.textContent.trim();return e(n)&&a===t}return!1}));let i=a((e=>e===r));return i||(i=a((e=>Math.abs(e-r)<=2))),i&&n&&await scrollMessagesToMiddle(o,i),i||!1}(t,n,!0);if(!e){je(document.querySelector(".chat-logs-panel"),"hide"),jt()}}),500)}))}}}));const p={messageTextElement:m,time:e,username:n,type:r};k.push(p),l.appendChild(d),l.appendChild(u),l.appendChild(m),y.appendChild(l)})),requestAnimationFrame((()=>{ot("personalMessages"),lt("personalMessages"),Pe("personalMessages"),Xe("personalMessages"),y.scrollTop=y.scrollHeight,new MutationObserver((e=>{n||e.find((e=>"childList"===e.type&&e.removedNodes.length>0))&&"0"===u.style.opacity&&(t=!1,u.style.visibility="visible",u.style.display="flex",u.offsetHeight,u.style.opacity="1",u.style.transition="opacity 0.5s ease")})).observe(y,{childList:!0,subtree:!0}),setTimeout((()=>{n=!1}),500)})),k.reverse().forEach((async({messageTextElement:e,time:t,username:n,type:o})=>{b<x&&(w=await Nt(t,n,!1),b++,b>=x&&(w=!1,console.log("Reached maximum ping checks, resetting pingMessages."))),e.style.color=w&&"mention"===o?"lightgreen":w&&"private"===o?"lemonchiffon":C[o]||"slategray"}))}await L(r),a.appendChild(y),document.body.appendChild(a);const{scrollButtonsContainer:T}=Ne(y);a.appendChild(T),je(a,"show"),Ae("show"),c.addEventListener("click",(()=>ke&&(c.value=""))),c.addEventListener("input",(()=>{const e=c.value.toLowerCase().replace(/_/g," ");y.querySelectorAll(".date-item").forEach((t=>{let n=!1,o=t.nextElementSibling;for(;o&&!o.classList.contains("date-item");){const t=(o.querySelector(".message-time")?.textContent.toLowerCase().replace(/_/g," ")+" "+o.querySelector(".message-username")?.textContent.toLowerCase().replace(/_/g," ")+" "+o.querySelector(".message-text")?.textContent.toLowerCase().replace(/_/g," ")).includes(e);o.style.contentVisibility=t?"visible":"hidden",o.style.fontSize=t?"":"0",n=n||t,o=o.nextElementSibling}t.style.display=n?"":"none"}))})),requestAnimationFrame((function(){c.focus()})),Mt.handlePersonalMessagesKeydown=e=>{"Escape"===e.key&&(je(a,"hide"),Ae("hide"),document.removeEventListener("keydown",Mt.handlePersonalMessagesKeydown))},document.addEventListener("keydown",Mt.handlePersonalMessagesKeydown)}let{panelsEvents:Ot,isCtrlKeyPressed:Ht}=fe;function Pt(e){const t=document.createElement("div");t.classList.add("empowerment-button","chat-logs-button"),t.style.position="relative",t.style.zIndex="1",t.innerHTML=j,t.title="Show Chat Logs",t.addEventListener("click",(async function(){Ce(t),await async function(e){const t=document.querySelector(".chat-logs-panel");if(t)return t.remove(),void Ae("hide");Te();const n=document.createElement("div");n.className="chat-logs-panel popup-panel";const o=document.createElement("div");o.className="panel-header";const s=document.createElement("div");s.className="panel-control-buttons";const r=document.createElement("div");r.className="search-for-chatlogs-messages";const a=document.createElement("input");function i(){requestAnimationFrame((function(){a.focus()}))}a.className="chatlogs-search-input",a.type="text",r.appendChild(a),o.appendChild(r),a.addEventListener("input",(()=>Z(a.value))),a.addEventListener("click",(e=>{e.ctrlKey&&(a.value="",Z(a.value))})),a.addEventListener("keydown",(async e=>{const t=a.value;if("Enter"===e.key){let e=t;/^\d{8}$/.test(t)?(e=6===t.length?"20"+t:t,e=e.replace(/(\d{4})(\d{2})(\d{2})/,"$1-$2-$3")):/^\d{6}$/.test(t)&&(e="20"+t.replace(/(\d{2})(\d{2})(\d{2})/,"$1-$2-$3"));/^\d{2,4}[:\-]\d{2}[:\-]\d{2}$/.test(e.replace(/:/g,"-"))&&!isNaN(new Date(e.replace(/:/g,"-")).getTime())?(await z(e),d(u)):alert("Please enter a valid date.\n\nValid formats include:\n1. yyyy-mm-dd\n2. yyyy:mm:dd\n3. yy-mm-dd\n4. yy:mm:dd\n5. yyyymmdd\n6. yymmdd\n\n"),a.value=""}})),i();const l=document.createElement("div");function c(e){e.style.display="none"===e.style.display?"flex":"none"}function d(e){"none"===e.style.display&&(e.style.display="flex")}l.className="large-button panel-header-date-button",l.innerHTML=_,l.addEventListener("click",(()=>{c(u)}));const u=document.createElement("input");u.type="date",u.className="chatlogs-date-input",u.style.display="none",s.appendChild(l),s.appendChild(u);const m=document.createElement("div");m.className="large-button toggle-mention-messages-button",m.innerHTML=A,m.title="Toggle Mention Messages",m.addEventListener("click",(async()=>{await Jt("mention")}));const p=document.createElement("div");p.className="toggle-mention-messages-counter",p.textContent="0",m.appendChild(p),s.appendChild(m);const g=document.createElement("div");g.className="large-button panel-header-toggle-media-messages",g.innerHTML=O,g.title="Toggle Media Messages",g.addEventListener("click",(async()=>{await Jt("media")}));const h=document.createElement("div");function f(){h.textContent=document.querySelectorAll(".chat-logs-container .media").length,p.textContent=document.querySelectorAll(".chat-logs-container .mention").length}h.className="toggle-media-messages-counter",h.textContent="0",g.appendChild(h),s.appendChild(g);const y=document.createElement("div");y.className="large-button panel-header-copy-button",y.innerHTML=K,y.title="Copy Chat Logs Url";const v=e=>{const t=/(\d{4}-\d{2}-\d{2})/,n=e.match(t);return n?n[1]:null};function b(e,t){t&&(t.replaceChildren(),e.forEach((({url:n,title:o})=>{const s=v(n),r=document.createElement("div");r.classList.add("saved-chatlog-url-wrapper");const a=document.createElement("a");a.classList.add("saved-chatlog-url"),a.textContent=s,a.href=n,a.addEventListener("click",(async t=>{if(t.preventDefault(),t.ctrlKey){const n=t.target.href,o=e.filter((e=>e.url!==n));if(o.length!==e.length){e=o,localStorage.setItem("savedChatlogs",JSON.stringify(e));t.target.closest(".saved-chatlog-url-wrapper").remove()}}else await z(s)}));const i=document.createElement("span");i.classList.add("saved-chatlog-url-title"),i.textContent=o||"➕",i.addEventListener("click",(()=>{const t=prompt("Enter a new title for this chat log:",i.textContent);if(null!==t&&t!==i.textContent){i.textContent=t;const o=e.findIndex((e=>e.url===n));-1!==o&&(e[o].title=t,localStorage.setItem("savedChatlogs",JSON.stringify(e)))}})),r.appendChild(a),r.appendChild(i),t.appendChild(r)})))}y.addEventListener("click",(e=>{let t=document.querySelector(".saved-chatlog-container");!t&&!e.shiftKey&&addJumpEffect(y,0,0),!t||e.ctrlKey||t.contains(e.target)||t.remove();let n=JSON.parse(localStorage.getItem("savedChatlogs"))||[];if(e.ctrlKey&&!e.target.closest(".saved-chatlog-url")){const e=v(D);if(!e)return;const o=prompt("Enter a title for this chat log:","➕");n.some((t=>v(t.url)===e))||(n.push({url:D,title:o||"➕"}),n.sort(((e,t)=>{const n=v(e.url),o=v(t.url);return new Date(n)-new Date(o)})),localStorage.setItem("savedChatlogs",JSON.stringify(n))),b(n,t)}else e.shiftKey?n.length>0&&!t&&(t=document.createElement("div"),t.classList.add("saved-chatlog-container"),b(n,t),y.appendChild(t)):navigator.clipboard.writeText(D).catch((e=>console.error("Failed to copy: ",e)))})),s.appendChild(y);const x=localStorage.getItem("shouldShowActiveUsers")||(localStorage.setItem("shouldShowActiveUsers","shown"),"shown"),w=document.createElement("div");function S(e){w.innerHTML="shown"===e?R:U,w.title="shown"===e?"Hide User List":"Show User List"}function k(){const e="shown"===localStorage.getItem("shouldShowActiveUsers")?"hidden":"shown";if(localStorage.setItem("shouldShowActiveUsers",e),S(e),"shown"===e)J(B,n);else{const e=n.querySelector(".active-users");e&&n.removeChild(e)}}w.className="large-button panel-header-toggle-button",S(x),w.title="shown"===x?"Hide User List":"Show User List",w.addEventListener("click",k),s.appendChild(w);const E=document.createElement("div");E.className="large-button panel-header-one-day-back-button",E.title="Previous Day",E.innerHTML=V;const C=document.createElement("div");C.className="large-button panel-header-one-day-forward-button",C.title="Next Day",C.innerHTML=X;const L=document.createElement("div");function T(){return u.value?new Date(u.value):new Date}L.className="large-button panel-header-shuffle-button",L.title="Random Date",L.innerHTML=G;const M=e=>{u.value=e,l.title=`Current date: ${e}`};E.addEventListener("click",(async()=>{const e=T();e.setDate(e.getDate()-1),await z(e),d(u),i(),zt()})),C.addEventListener("click",(async()=>{const e=T();e.setDate(e.getDate()+1),await z(e),d(u),i(),zt()})),L.addEventListener("click",(async()=>{const e=function(){const e=new Date(Dt),t=new Date-e,n=Math.floor(Math.random()*t),o=new Date(e.getTime()+n),s=new Intl.DateTimeFormat("en-CA").format(o);return s}();await z(e),d(u),i(),zt()})),s.appendChild(E),s.appendChild(C),s.appendChild(L);const $=document.createElement("div");$.className="large-button panel-header-close-button",$.title="Close panel",$.innerHTML=P,$.addEventListener("click",(()=>{je(n,"hide"),Ae("hide")})),s.appendChild($),o.appendChild(s);const N=document.createElement("div");N.className="chat-logs-container",n.appendChild(o),n.appendChild(N);const{scrollButtonsContainer:q}=Ne(N);n.appendChild(q),document.body.appendChild(n),je(n,"show"),Ae("show");const I={},j=15;let H=null;const B=new Map;let D="";function F(){N.childElementCount>0&&(a.placeholder+=` | Total messages: ${N.childElementCount}`)}const z=async e=>{const t=e=>/^\d{4}:\d{2}:\d{2}$/.test(e)?e.replace(/:/g,"-"):e,o=new Intl.DateTimeFormat("en-CA").format(new Date(t(e)));if(o<Dt||o>le)return void alert(o<Dt?`The selected date cannot be earlier than ${Dt}.`:"You cannot load a future date.");M(o);const{chatlogs:s,url:r,size:i,info:l,error:c}=await Bt(o,N),d=(i/1024).toFixed(2);a.placeholder=c?`Error: ${c}`:l?`Limit reached: ${d} KB`:l||`Size: ${d} KB`,D=r,B.clear(),s.forEach((async({time:t,username:n,message:o})=>{B.set(n,(B.get(n)||0)+1);const s=document.createElement("div");s.classList.add("message-item"),s.addEventListener("click",(async e=>{e.target.closest("a")||(Ft&&await Jt(),a.value.length>0&&(a.value=""),await scrollMessagesToMiddle(N,s))}));const r=document.createElement("span");r.className="message-time",r.textContent=t,r.addEventListener("click",(function(){const n=`https://klavogonki.ru/chatlogs/${e}.html#${t}`;window.open(n,"_blank","noopener,noreferrer")}));const i=document.createElement("span");i.className="message-username",i.textContent=n,i.addEventListener("click",(async()=>{const e=await async function(e){const t=JSON.parse(localStorage.getItem("userIdsCache")||"{}");if(t[e])return t[e];try{const n=await getExactUserIdByName(e);if(n)return t[e]=n,localStorage.setItem("userIdsCache",JSON.stringify(t)),n}catch(t){console.error(`Error fetching user ID for ${e}:`,t)}return null}(n);if(e){const t=`https://klavogonki.ru/u/#/${e}/`;window.open(t,"_blank","noopener,noreferrer")}else addShakeEffect(i)}));let l=I[n];l||(l=Math.floor(Math.random()*(210/j))*j,I[n]=l),i.style.color=`hsl(${l}, 80%, 50%)`;const c=document.createElement("span");c.className="message-text",c.innerHTML=o.replace(/:(?=\w*[a-zA-Z])(\w+):/g,((e,t)=>`<img src="/img/smilies/${t}.gif" alt=":${t}:" title=":${t}:" class="smile">`)).replace(/(https?:\/\/[^\s]+)/gi,(e=>`<a href="${e}" target="_blank" rel="noopener noreferrer">${e}</a>`)),s.style.marginTop=H!==n?"0.6em":"",H=n,s.appendChild(r),s.appendChild(i),s.appendChild(c),N.appendChild(s)})),J(B,n,a),requestAnimationFrame((()=>{ot("chatlogsMessages"),lt("chatlogsMessages"),Pe("chatlogsMessages"),Xe("chatlogsMessages"),N.scrollTop=N.scrollHeight,f(),F(),a.value.length>0&&Z(a.value)}))};function J(e,t,n){if("shown"===localStorage.getItem("shouldShowActiveUsers")){let n=t.querySelector(".active-users");n||(n=document.createElement("div"),n.className="active-users",t.appendChild(n));const o=Array.from(e.entries()).sort((([,e],[,t])=>t-e));n.innerHTML="",o.forEach((([e,t])=>{const o=document.createElement("div");o.className="active-user-item",o.addEventListener("click",(()=>{const t=a.value.trim(),n=Ht?`, ${e}`:e;a.value=t===e?"":Ht&&!t.includes(e)?t+n:e,Z(a.value)}));const s=document.createElement("span");s.className="active-user-name",s.textContent=e;const r=I[e]||0;s.style.color=`hsl(${r}, 80%, 50%)`;const i=document.createElement("span");i.className="active-user-messages-count",i.textContent=t,i.style.color=`hsl(${r}, 80%, 50%)`,i.style.backgroundColor=`hsla(${r}, 80%, 50%, 0.2)`,o.appendChild(i),o.appendChild(s),n.appendChild(o)}))}}const Y=e||le;await z(Y),e&&d(u);function W(e){return e.map((e=>{const t=e.querySelector(".message-username"),n=t?t.textContent.toLowerCase().trim():"",o=e.querySelector(".message-text");return{username:n,messageText:o?o.textContent.toLowerCase().trim():""}}))}function Z(e){if(/^[\d-:]+$/.test(e.trim()))return;function t(e){return e.replace(/[_-]/g," ").toLowerCase()}const n=t(e).trim(),o=Array.from(document.querySelectorAll(".chat-logs-container > .message-item")),s=W(o),r=!n,a=n.split(",").map((e=>e.trim())).filter(Boolean),i=a.filter((e=>s.some((n=>t(n.username)===e)))).length>=2;o.forEach(((e,o)=>{const l=e.closest(".message-item"),c=s[o];let d=!1;const u=t(c.username),m=t(c.messageText);d=!!r||(i?a.some((e=>u===e)):u.includes(n)||m.includes(n)),l.style.contentVisibility=d?"visible":"hidden",l.style.fontSize=d?"":"0"}))}u.max=le,u.min=Dt,u.value=Y,l.title=`Current date: ${Y}`,u.addEventListener("change",(async e=>{const t=e.target.value;await z(t),l.title=`Current date: ${t}`})),Ot.handleChatLogsKeydown=e=>{"Escape"===e.key&&(je(n,"hide"),Ae("hide"),document.removeEventListener("keydown",Ot.handleChatLogsKeydown))},document.addEventListener("keydown",Ot.handleChatLogsKeydown)}()})),e.appendChild(t)}const Bt=async(e,t)=>{t&&(t.innerHTML="");const n=`https://klavogonki.ru/chatlogs/${e}.html?rand=${Math.floor(Math.random()*10**20)}`;try{const e=await fetch(n);if(!e.ok)throw new Error("Network response was not ok");const t=await e.text(),o=1024*1e3,s=t.length>o?t.slice(0,o):t,r=(e=>[...(new DOMParser).parseFromString(e,"text/html").querySelectorAll(".ts")].map((e=>{const t=e.nextElementSibling,n=t?.nextSibling,o=e=>e?[...e.childNodes].reduce(((e,t)=>{if(t.nodeType===Node.TEXT_NODE)e+=t.textContent;else if(t.nodeType===Node.ELEMENT_NODE)if("A"===t.tagName)e+=t.getAttribute("href");else if("BR"===t.tagName)return e;return e}),"").trim():"";if(t?.classList.contains("mn")&&n){let s="";if(n.nodeType===Node.ELEMENT_NODE)s=o(n);else if(n.nodeType===Node.TEXT_NODE){const e=t.nextElementSibling;s=e&&"A"===e.tagName?`${n.textContent.trim()} ${e.getAttribute("href")}`:n.textContent.trim()}return s||(s=o(t.nextSibling)),{time:e.textContent.trim().replace(/[\[\]]/g,""),username:t.textContent.trim().replace(/<|>/g,""),message:s||null}}const s=e.nextElementSibling;if(s&&s.classList.contains("mne")){const t=s.textContent.trim();return{time:e.textContent.trim().replace(/[\[\]]/g,""),username:"SYSTEM",message:t||null}}return null})).filter(Boolean))(s),a=t.length>o,i=[];let l=null;for(const e of r){const t=e.message!==l?.message,n=e.username!==l?.username;(t||n)&&(i.push(e),l=e)}return{chatlogs:i.filter((e=>!pe.includes(e.username))),url:n,size:s.length,info:a,error:null}}catch(e){return{chatlogs:[],url:n,size:0,error:e.message}}},Dt="2012-02-12";let Ft={media:!1,mention:!1};const zt=()=>{Ft={media:!1,mention:!1}};async function Jt(e){const t="mention"===e;Ft={media:!!("media"===e)&&!Ft.media,mention:!!t&&!Ft.mention},document.querySelectorAll(".message-item").forEach((e=>{const t=e.querySelector(".media"),n=e.querySelector(".mention");Ft.media?(e.style.contentVisibility=t?"visible":"hidden",e.style.fontSize=t?"":"0"):Ft.mention?(e.style.contentVisibility=n?"visible":"hidden",e.style.fontSize=n?"":"0"):(e.style.contentVisibility="visible",e.style.fontSize="")}))}let{panelsEvents:Ut}=fe;async function Rt(e){const t=e.target.files[0];if(t){const e=new FileReader;return new Promise(((n,o)=>{e.onload=function(e){const t=e.target.result;try{Xt(JSON.parse(t)),n()}catch(e){console.error("Error parsing JSON data:",e.message),console.error("Invalid JSON:",t),alert("Failed to parse JSON data. Please check the format and try again."),o(e)}},e.onerror=function(e){console.error("Error reading file:",e.target.error),o(e.target.error)},e.readAsText(t)}))}}function _t(e){if(!e||"object"!=typeof e)return console.error("Invalid settings data for download."),void alert("Cannot export settings. Please try again.");try{const t="  ",n="    ",o=e.usersToTrack.map((e=>`${n}${JSON.stringify(e)}`)).join(",\n"),s=e.usernameReplacements?.map((e=>`${n}${JSON.stringify(e)}`)).join(",\n")||"",r=e.toggle.map((e=>`${n}${JSON.stringify(e)}`)).join(",\n"),a=`{\n${t}"usersToTrack": [\n${o}\n${t}],\n${t}"mentionKeywords": [\n${e.mentionKeywords.map((e=>`${n}"${e}"`)).join(",\n")}\n${t}],\n${t}"usernameReplacements": [\n${s}\n${t}],\n${t}"moderator": [\n${e.moderator.map((e=>`${n}"${e}"`)).join(",\n")}\n${t}],\n${t}"ignored": [\n${e.ignored.map((e=>`${n}"${e}"`)).join(",\n")}\n${t}],\n${t}"toggle": [\n${r}\n${t}]\n}`,i=`KG_Chat_Empowerment_Settings_${new Intl.DateTimeFormat("en-CA").format(new Date)}.json`,l=new Blob([a],{type:"application/json"}),c=URL.createObjectURL(l),d=document.createElement("a");d.href=c,d.download=i,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(c)}catch(e){console.error("Error exporting settings:",e),alert("Failed to export settings. Please try again.")}}function Kt(){return{usersToTrack:JSON.parse(localStorage.getItem("usersToTrack"))||[],mentionKeywords:JSON.parse(localStorage.getItem("mentionKeywords"))||[],usernameReplacements:JSON.parse(localStorage.getItem("usernameReplacements"))||[],moderator:JSON.parse(localStorage.getItem("moderator"))||[],ignored:JSON.parse(localStorage.getItem("ignored"))||[],toggle:JSON.parse(localStorage.getItem("toggle"))||[]}}function Vt(e){const t=document.createElement("div");t.classList.add("empowerment-button","settings-button"),t.title="Show Settings Panel",t.style.position="relative",t.innerHTML=H;const n=document.createElement("input");n.type="file",n.accept=".json",n.style.display="none",n.addEventListener("change",Rt),t.addEventListener("click",(e=>{Ce(t),Ee&&_t(Kt()),ke&&n.click(),Ee||ke||function(){const e=document.querySelector(".settings-panel");if(e)return e.remove(),void Ae("hide");Te();const t=document.createElement("div");t.className="settings-panel popup-panel",Ut.handleSettingsKeydown=e=>{"Escape"===e.key&&(je(t,"hide"),Ae("hide"),document.removeEventListener("keydown",Ut.handleSettingsKeydown))},document.addEventListener("keydown",Ut.handleSettingsKeydown);const n=document.createElement("div");n.className="panel-header";const o=document.createElement("div");o.classList.add("panel-control-buttons");const s=document.createElement("div");s.className="large-button panel-header-close-button",s.innerHTML=P,s.title="Close panel",s.addEventListener("click",(()=>{je(t,"hide"),Ae("hide")}));const r=document.createElement("div");r.className="large-button panel-header-clear-button",r.innerHTML=Y,r.title="Clear settings",r.addEventListener("click",(()=>{d()}));const a=document.createElement("div");a.className="large-button panel-header-import-button",a.innerHTML=Z,a.title="Import settings";const i=document.createElement("div");function l(e){const t=document.querySelector(".settings-content-container");if(!t)return console.error("Container not found.");const n=()=>{e.style.visibility="visible",e.style.display="flex",setTimeout((()=>{e.style.opacity="1"}),10)},o=()=>{e.style.opacity="0",setTimeout((()=>{e.style.visibility="hidden",e.style.display="none"}),300)},s=Kt(),r=()=>{const e={usersToTrack:[],mentionKeywords:[],usernameReplacements:[],moderator:[],ignored:[],toggle:[]};t.querySelectorAll(".settings-tracked-container .tracked-item").forEach((t=>{const n=t.querySelector(".tracked-username-field"),o=t.querySelector(".tracked-gender-select"),s=t.querySelector(".tracked-pronunciation-field"),r=t.querySelector(".assigned-thawed-config, .assigned-frozen-config"),a=n?n.value.trim():"",i=o?o.value.trim():"",l=s?s.value.trim():"",c=r.classList.contains("assigned-frozen-config")?"frozen":"thawed";e.usersToTrack.push({name:a,gender:i,pronunciation:l,state:c})}));const r=new Set(e.usersToTrack.map((e=>e.name.toLowerCase())));t.querySelectorAll(".settings-mention-container .mention-item").forEach((t=>{const n=t.querySelector(".mention-field"),o=n?n.value.trim():"";e.mentionKeywords.push(o)})),t.querySelectorAll(".settings-replacement-container .replacement-item").forEach((t=>{const n=t.querySelector(".replacement-original-field"),o=t.querySelector(".replacement-field"),s=n?n.value.trim():"",a=o?o.value.trim():"";if(r.has(s.toLowerCase()))return n.classList.add("input-error"),void addShakeEffect(n);n.classList.remove("input-error"),e.usernameReplacements.push({original:s,replacement:a})})),t.querySelectorAll(".settings-moderator-container .moderator-item").forEach((t=>{const n=t.querySelector(".moderator-field"),o=n?n.value.trim():"";e.moderator.push(o)})),t.querySelectorAll(".settings-ignored-container .ignored-item").forEach((t=>{const n=t.querySelector(".ignored-field"),o=n?n.value.trim():"";e.ignored.push(o)})),t.querySelectorAll(".settings-toggle-container .toggle-item").forEach((t=>{const n=t.querySelector(".toggle-description"),o=t.querySelector(".toggle-select"),s=o?o.value.trim():"no",r=n.getAttribute("data-toggle-name");r&&e.toggle.push({name:r,option:s})}));return JSON.stringify(s)!==JSON.stringify(e)?n():o(),e};e.addEventListener("click",(()=>{const e=r();Xt(e),Object.assign(s,e),o()})),t.querySelectorAll("input, select").forEach((e=>{e.addEventListener("input",r)}));const a=e=>{"INPUT"===e.tagName||"SELECT"===e.tagName?e.addEventListener("input",r):e.querySelectorAll("input, select").forEach((e=>{e.addEventListener("input",r)}))};new MutationObserver(qe((e=>{e.forEach((e=>{"childList"===e.type&&(e.addedNodes.forEach((e=>{e.nodeType===Node.ELEMENT_NODE&&a(e)})),e.removedNodes.forEach((e=>{e.nodeType===Node.ELEMENT_NODE&&r()})))}))}),se)).observe(t,{childList:!0,subtree:!0})}i.className="large-button panel-header-save-button",i.innerHTML=ee,i.title="Save settings";const c=document.createElement("input");function d(){[".settings-tracked-container",".settings-mention-container",".settings-replacement-container",".settings-moderator-container",".settings-ignored-container",".settings-toggle-container"].forEach((e=>{const t=document.querySelector(e);t&&t.replaceChildren();const n=t.querySelector(".add-settings-button");n&&t.appendChild(n)}))}c.type="file",c.accept=".json",c.style.display="none",c.addEventListener("change",(async e=>{await Rt(e),d(),M()})),a.addEventListener("click",(()=>{c.click()})),a.appendChild(c);const u=document.createElement("div");u.className="large-button panel-header-export-button",u.innerHTML=Q,u.title="Export settings",u.addEventListener("click",(function(){_t(Kt())})),o.appendChild(i),o.appendChild(a),o.appendChild(u),o.appendChild(r),o.appendChild(s),n.appendChild(o),t.appendChild(n);const m=document.createElement("div");m.className="settings-content-container";function p(e){e.style.height="30px",e.style.maxWidth="120px",e.style.minWidth="105px",e.style.padding="0.4em",e.style.font="1em Montserrat",e.style.fontFamily="Montserrat",e.style.setProperty("color","bisque","important"),e.style.setProperty("border-radius","0.2em","important"),e.style.boxSizing="border-box",e.style.setProperty("background-color","rgb(17,17,17)","important"),e.style.setProperty("border","1px solid rgb(34,34,34)","important"),Array.from(e.options).forEach((e=>{e.style.height="30px",e.style.setProperty("background-color","rgb(17,17,17)","important"),e.style.setProperty("color","bisque","important"),e.style.fontFamily="Montserrat"}))}function g(e,t){e.addEventListener("click",(()=>{t.remove()}))}function h(e,t){e.addEventListener("click",(()=>{const n=e.classList.toggle("assigned-frozen-config");e.classList.toggle("assigned-thawed-config"),e.style.opacity=n?"1":"0.3",x(t,n?"frozen":"thawed")}))}function f(e,t="inline-flex"){const n=document.createElement("div");return n.className=`${e}-item`,n.style.display=t,n.style.gap="0.5em",n.style.padding="0.25em",n}function y(e,t="",n=""){const o=document.createElement("input");return o.className=`settings-field ${e}-field`,o.value=t,o.placeholder=n,o}function v(e,t){const n=document.createElement("div");return n.className=`settings-button remove-settings-button remove-${e}-word`,n.innerHTML=te,g(n,t),n}function b(e="thawed",t){const n=document.createElement("div");return n.className=`settings-button assigned-settings-button assigned-${e}-config`,n.style.opacity="thawed"===e?"0.3":"1",n.innerHTML=ne,h(n,t),n}function x(e,t){const n=localStorage.getItem("usersToTrack");if(n){const o=JSON.parse(n).map((n=>n.name===e?{...n,state:t}:n));localStorage.setItem("usersToTrack",JSON.stringify(o))}}function w(e,t={}){const n=document.createElement("div");n.classList.add("settings-spoiler");const o=document.createElement("button");return o.textContent=t.showText||"Show Content",e.style.display="none",o.addEventListener("click",(()=>{const n="none"===e.style.display;e.style.display=n?"flex":"none",o.textContent=n?t.hideText||"Hide Content":t.showText||"Show Content"})),n.appendChild(o),n.appendChild(e),n}function S(e){const t=f("tracked","flex"),n=y("tracked-username",e.name,"Username"),o=y("tracked-pronunciation",e.pronunciation,"Pronunciation"),s=v("tracked",t),r=b("frozen"===e.state?"frozen":"thawed",e.name),a=document.createElement("select");a.className="tracked-gender-select";return[{value:"Male",emoji:"👨"},{value:"Female",emoji:"👩"}].forEach((({value:t,emoji:n})=>{const o=document.createElement("option");o.value=t,o.textContent=`${n} ${t}`,e.gender===t&&(o.selected=!0),a.appendChild(o)})),p(a),t.appendChild(n),t.appendChild(a),t.appendChild(o),t.appendChild(s),t.appendChild(r),t}function k(e){const t=f("mention"),n=y("mention",e,"Mention Keyword"),o=v("mention",t);return t.appendChild(n),t.appendChild(o),t}function E(e={original:"",replacement:""}){const t=f("replacement"),n=y("replacement-original",e.original,"Original username"),o=y("replacement",e.replacement,"Replacement name"),s=v("replacement",t);return t.appendChild(n),t.appendChild(o),t.appendChild(s),t}function C(e){const t=f("moderator"),n=y("moderator",e,"Moderator Name"),o=v("moderator",t);return t.appendChild(n),t.appendChild(o),t}function L(e){const t=f("ignored"),n=y("ignored",e,"Ignored User"),o=v("ignored",t);return t.appendChild(n),t.appendChild(o),t}function T(e,t,n){const o=f("toggle","flex");o.style.alignItems="center";const s=document.createElement("select");s.className="toggle-select";const r=document.createElement("span");r.className="toggle-description",r.innerText=e.description,r.setAttribute("data-toggle-name",t),r.style.cursor="pointer",r.style.color="burlywood",r.style.transition="color 0.15s ease-in-out",r.addEventListener("click",(()=>{e.image&&window.open(e.image,"_blank")})),r.addEventListener("mouseover",(function(){r.style.color="lightgoldenrodyellow"})),r.addEventListener("mouseout",(function(){r.style.color="burlywood"}));return[{value:"yes",emoji:"✔️"},{value:"no",emoji:"❌"}].forEach((({value:e,emoji:t})=>{const n=document.createElement("option");n.value=e,n.textContent=`${t} ${e}`,s.appendChild(n)})),s.value=n,p(s),o.appendChild(s),o.appendChild(r),o}function M(){const e={usersToTrack:".settings-tracked-container",mentionKeywords:".settings-mention-container",usernameReplacements:".settings-replacement-container",moderator:".settings-moderator-container",ignored:".settings-ignored-container"},t={usersToTrack:{name:"tracked",createItem:S},mentionKeywords:{name:"mention",createItem:k},usernameReplacements:{name:"replacement",createItem:E},moderator:{name:"moderator",createItem:C},ignored:{name:"ignored",createItem:L}},n=Kt();Object.entries(n).forEach((([n,o])=>{const s=document.querySelector(e[n]);if(!s)return;s.classList.add("settings-container"),"mentionKeywords"!==n&&"moderator"!==n&&"ignored"!==n||(s.style.flexDirection="row");const r=s.querySelector(".add-settings-button");for(;s.firstChild&&s.firstChild!==r;)s.removeChild(s.firstChild);o.forEach((e=>s.appendChild(t[n].createItem(e))));const a=$(e[n],t[n].createItem);s.appendChild(a);if(!(null!==s.closest(".settings-spoiler"))){const e=s.parentNode;if(e){const o=Array.from(e.childNodes).indexOf(s);e.removeChild(s);const r=w(s,{showText:`Show ${t[n].name} settings`,hideText:`Hide ${t[n].name} settings`});r.classList.add("settings-spoiler-wrapper"),o>=e.childNodes.length?e.appendChild(r):e.insertBefore(r,e.childNodes[o])}}}));const o=JSON.parse(localStorage.getItem("toggle"))||[],s=document.querySelector(".settings-toggle-container");[{name:"showChatStaticNotifications",description:"👀 Show chat static notifications",image:"https://i.imgur.com/oUPSi9I.jpeg"},{name:"showGlobalDynamicNotifications",description:"👀 Show global dynamic notifications",image:"https://i.imgur.com/8ffCdUG.jpeg"},{name:"enabledBeepOnChatJoinLeave",description:"🔊 Play a beep sound and speak feedback when the user enters or leaves the chat",image:"https://i.imgur.com/6PXFIES.jpeg"},{name:"switchToGoogleTTSEngine",description:"🔊 Switch to google TTS engine if available",image:"https://i.imgur.com/0H94LII.jpeg"}].forEach((e=>{const t=o.find((t=>t.name===e.name)),n=t?t.option:"yes",r=T(e,e.name,n);s.appendChild(r)}))}function $(e,t){const n=e.split("-")[1],o=document.querySelector(`.add-${n}-item`);o&&o.remove();const s=document.createElement("div");return s.className=`settings-button add-settings-button add-${n}-item`,s.innerHTML=oe,s.style.margin="0.4em",s.addEventListener("click",(()=>{const o=document.querySelector(e),r=o.querySelectorAll(`.${n}-item`),a=r.length>0?r[r.length-1]:null,i=a?a.querySelectorAll("input"):[],l=Array.from(i).some((e=>0===e.value.trim().length));if(!a||!l){const e=t(t===S?{name:"",pronunciation:""}:"");e instanceof HTMLElement?o.insertBefore(e,s):console.error("Invalid item created.")}else alert("Please fill in the previous item before adding a new one.")})),s}[{type:"tracked",emoji:"👀"},{type:"mention",emoji:"📢"},{type:"replacement",emoji:"♻️"},{type:"moderator",emoji:"⚔️"},{type:"ignored",emoji:"🛑"},{type:"toggle",emoji:"🔘"}].forEach((({type:e,emoji:t})=>{const n=document.createElement("div");n.className=`settings-${e}-description settings-description`;const o=document.createElement("div");o.className=`settings-${e}-container`,n.textContent=`${e.charAt(0).toUpperCase()}${e.slice(1).toLowerCase()} ${t}`,m.appendChild(n),m.appendChild(o)})),t.appendChild(m);const{scrollButtonsContainer:N}=Ne(m);t.appendChild(N),document.body.appendChild(t),M(),l(i),je(t,"show"),Ae("show")}()})),t.appendChild(n),e.appendChild(t)}function Xt({usersToTrack:e=[],mentionKeywords:t=[],usernameReplacements:n=[],moderator:o=[],ignored:s=[],toggle:r=[]}){ce=Array.isArray(e)?e:ce,de=Array.isArray(t)?t:de,ue=Array.isArray(n)?n:ue,me=Array.isArray(o)?o:me,pe=Array.isArray(s)?s:pe,ge=Array.isArray(r)?r:ge,localStorage.setItem("usersToTrack",JSON.stringify(ce)),localStorage.setItem("mentionKeywords",JSON.stringify(de)),localStorage.setItem("usernameReplacements",JSON.stringify(ue)),localStorage.setItem("moderator",JSON.stringify(me)),localStorage.setItem("ignored",JSON.stringify(pe)),localStorage.setItem("toggle",JSON.stringify(ge)),console.log("Uploaded settings applied:",{usersToTrack:ce,mentionKeywords:de,usernameReplacements:ue,moderator:me,ignored:pe,toggle:ge})}[["usersToTrack",ce],["mentionKeywords",de],["usernameReplacements",ue],["moderator",me],["ignored",pe]].forEach((([e,t])=>{const n=JSON.parse(localStorage.getItem(e))||[];n.length&&t.splice(0,t.length,...n)})),de.push(ae);const Gt="Вы не можете отправлять сообщения",Yt="Связь с сервером потеряна",Wt=()=>{const e=localStorage.getItem("activeChatTab")||"game",t=window.location.href.includes("gmid"),n=t&&"game"===e?'[id^="chat-game"] .text':"#chat-general .text",o=t&&"game"===e?'[id^="chat-game"] .send':"#chat-general .send",s=document.querySelector(t?"game"===e?".game.c":".general.c":"general"===e?".general.c":".game.c"),r=document.querySelector(t?document.querySelector(".game.c.active")?".general.c":".game.c":document.querySelector(".general.c.active")?".game.c":".general.c");return{chatField:document.querySelector(n),chatSend:document.querySelector(o),activeChatTab:s,nextChatTab:r,chatHidden:document.querySelector("#chat-wrapper.chat-hidden")}};function Zt(e){if(!e)return null;const t=e.value;return t.includes(Gt)?Gt:t.includes(Yt)?Yt:null}if(Qt="gamelist",window.location.href.includes(Qt)){function sn(e,t,n){if(t.disabled){const o=Zt(t);o===Gt?(t.disabled=n.disabled=!1,n.style.setProperty("background-color","rgb(160, 35, 35)","important"),n.style.setProperty("background-image",`url("data:image/svg+xml,${encodeURIComponent(icons.deniedSVG)}")`,"important"),n.style.setProperty("background-repeat","no-repeat","important"),n.style.setProperty("background-position","center","important"),n.style.setProperty("color","transparent","important"),t.value=null,console.log("Chat field was blocked, re-enabled.")):o===Yt&&(console.log("Lost connection, reloading..."),setTimeout((()=>{window.location.reload()}),e))}}const rn=new MutationObserver((()=>{const{chatField:e,chatSend:t}=Wt();sn(5e3,e,t)})),{chatField:an}=Wt();an&&rn.observe(an,{attributes:!0,attributeFilter:["disabled"]}),document.addEventListener("visibilitychange",(()=>{if("visible"===document.visibilityState){const{chatField:e,chatSend:t}=Wt();sn(1e3,e,t)}}))}var Qt;function en(){const{chatHidden:e,chatField:t}=Wt();!e&&t&&t.focus()}function tn(e){console.log("Clicked element:",e.target);const t=e.target.classList.contains("general")?"general":"game";localStorage.setItem("activeChatTab",t)}function nn(){const{chatField:e}=Wt();e.setAttribute("maxlength","1000"),e.addEventListener("paste",(t=>{t.preventDefault();const n=t.clipboardData.getData("text");let o=n;Oe(n)&&(o=decodeURL(n));const s=e.selectionStart,r=e.selectionEnd;e.value=e.value.slice(0,s)+o+e.value.slice(r),e.setSelectionRange(s+o.length,s+o.length)})),e.addEventListener("keydown",(t=>{const n=e.value;"Enter"===t.key&&(n.length>300?(t.preventDefault(),async function(e){const t=e.split(" ").reduce(((e,t)=>{const n=e[e.length-1];return(n+" "+t).trim().length>300?[...e,t]:[...e.slice(0,-1),(n+" "+t).trim()]}),[""]),{chatField:n,chatSend:o}=Wt(),s=e.length>300;s&&(n.disabled=!0);for(let e=0;e<t.length;e++){const s=t[e];if(n.value=s,console.log(`Sending piece ${e+1}: "${s}" (Length: ${s.length})`),o.click(),e<t.length-1){const e=Math.floor(500*Math.random())+500;console.log(`Waiting for ${e} ms before sending the next piece.`),await new Promise((t=>setTimeout(t,e)))}}s&&(n.disabled=!1)}(n),console.log(`Long message processed: "${n}"`),e.value=""):console.log(`Short message processed: "${n}"`))}))}[...document.querySelectorAll(".general.c, .game.c")].forEach((e=>e.addEventListener("click",tn))),document.addEventListener("keydown",(e=>{"Tab"===e.key&&(!function(){const{nextChatTab:e,chatField:t,chatHidden:n}=Wt();!n&&e&&(e.click(),t?.focus())}(),e.preventDefault())}));let on=JSON.parse(localStorage.getItem("fetchedUsers"))||{};!function(){function e(e,t){if(!document.querySelector(`.font-${e.replace(/\s/g,"-")}`)){const n=document.createElement("link");n.rel="stylesheet",n.href=`https://fonts.googleapis.com/css2?family=${e.replace(/\s/g,"+")}:wght@${t.join(";")}&display=swap`,n.classList.add(`font-${e.replace(/\s/g,"-")}`),document.head.appendChild(n)}}e("Montserrat",["100","200","300","400","500","600","700","800","900"]),e("Orbitron",["400","500","600","700","800","900"]),e("Roboto Mono",["100","200","300","400","500","600","700"]);const t=2.5;let n=JSON.parse(localStorage.getItem("KG_Chat_Empowerment"));n||(n={voiceSettings:{voiceSpeed:1.5,voicePitch:1},messageSettings:{}},localStorage.setItem("KG_Chat_Empowerment",JSON.stringify(n)));let o=null!==n.voiceSettings.voiceSpeed?n.voiceSettings.voiceSpeed:1.5,s=null!==n.voiceSettings.voicePitch?n.voiceSettings.voicePitch:1;const r=function(){const e=new AudioContext;return new Promise((t=>{e.onstatechange=function(){"running"===e.state&&t(e)}}))}(),a=[300,600],i=[600,300],l=[500],c=[600,800],d=100;function u(e,t){r.then((n=>{for(let o=0;o<e.length;o++){const s=e[o];if(0===s)setTimeout((()=>{}),80);else{const e=n.createOscillator(),r=n.createGain();e.connect(r),e.frequency.value=s,e.type="sine";const a=n.createBiquadFilter();a.type="lowpass",a.frequency.value=250,e.connect(a);const i=n.createBiquadFilter();i.type="highpass",i.frequency.value=16e3,a.connect(i),r.connect(n.destination),r.gain.setValueAtTime(0,n.currentTime),r.gain.linearRampToValueAtTime(t,n.currentTime+.01),e.start(n.currentTime+o*d/1e3),e.stop(n.currentTime+(o*d+80)/1e3),r.gain.setValueAtTime(t,n.currentTime+(o*d+70)/1e3),r.gain.linearRampToValueAtTime(0,n.currentTime+(o*d+80)/1e3)}}}))}const m=new Promise((e=>{const t=window.speechSynthesis;let n=t.getVoices();const o="Microsoft Pavel - Russian (Russia)",s="Microsoft Irina - Russian (Russia)";let r=n.find((e=>e.name===o)),a=n.find((e=>e.name===s));if(r&&a&&0!==n.length){const o=new SpeechSynthesisUtterance;o.lang="ru-RU",o.voice=a,e({synth:t,utterance:o,voices:n,pavelVoice:r,irinaVoice:a})}else t.addEventListener("voiceschanged",(()=>{if(n=t.getVoices(),r=n.find((e=>e.name===o)),a=n.find((e=>e.name===s)),r&&a){const o=new SpeechSynthesisUtterance;o.lang="ru-RU",o.voice=a,e({synth:t,utterance:o,voices:n,pavelVoice:r,irinaVoice:a})}}))}));async function p(e,t=t){const n=Ue("sound","gTTS"),o=await async function(e){return e.replace(/[-−_]/g," ").replace(/https?:\/\/(?:www\.)?([a-zA-Z0-9.-]+)(\/.*)?/g,((e,t)=>t)).replace(/\s(?=[?!,.:;@])/g,"").replace(/["#$%&'()*+\/<=>[\\\]^`{|}~]/g,"").split(" ").filter(Boolean).join(" ").trim()}(e);if(n){const e=(e=>e.split(/\s+/).reduce(((e,t)=>{const n=/[А-Яа-яЁё0-9]/.test(t)?"ru":"en";return e.length&&e[e.length-1].lang===n?e[e.length-1].text+=" "+t:e.push({lang:n,text:t}),e}),[]))(o);try{for(const{lang:t,text:n}of e)await new Promise(((e,o)=>{fetch(`http://127.0.0.1:5000/speak?text=${encodeURIComponent(n)}&lang=${t}`).then((e=>{if(!e.ok)throw new Error(`HTTP ${e.status}`);return e.arrayBuffer()})).then((t=>{const n=new(window.AudioContext||window.webkitAudioContext),s=new Audio(URL.createObjectURL(new Blob([t],{type:"audio/mp3"}))),r=n.createMediaElementSource(s),a=n.createGain();a.gain.value=2,r.connect(a),a.connect(n.destination),s.onended=e,s.onerror=o,s.play()})).catch(o)}))}catch(e){console.error("Server TTS failed:",e)}}else await async function(e,t=t){const{synth:n,utterance:o,voice:r}=await m;return Object.assign(o,{text:e,rate:t,volume:.8,pitch:s,voice:r}),new Promise((e=>{o.onend=e,n.speak(o)}))}(e,t)}const g={Male:{enter:"зашёл",leave:"вышел"},Female:{enter:"зашла",leave:"вышла"}};const h=document.querySelector("body"),f=document.createElement("div");f.classList.add("empowerment-panel");const y=document.createElement("div");function A(e){const t={class:"unknown",icon:"❓",color:"#000000"},n={Экстракибер:{class:"extra",icon:"🚀",color:"#06B4E9"},Кибергонщик:{class:"cyber",icon:"🤖",color:"#5681ff"},Супермен:{class:"superman",icon:"👊",color:"#B543F5"},Маньяк:{class:"maniac",icon:"🔪",color:"#DA0543"},Гонщик:{class:"racer",icon:"⚡️️",color:"#FF8C00"},Профи:{class:"profi",icon:"️💼️",color:"#C1AA00"},Таксист:{class:"driver",icon:"🚖️",color:"#2DAB4F"},Любитель:{class:"amateur",icon:"🍆️",color:"#61B5B3"},Новичок:{class:"newbie",icon:"🐥",color:"#AFAFAF"}}[e]||t;return n.class===t.class&&console.log(`Class not found for status title: ${e}. Using default class: ${t.class}`),n}function j(e,t,n,o,s){const r=on[e]?.avatarTimestamp,a="00"!==r?`/storage/avatars/${e}_big.png?updated=${r}`:"",i=document.createElement("div"),l=A(t),c=l.class,d=l.color,u=l.icon;i.classList.add(`user${e}`,c);const m=document.createElement("div");if(m.classList.add("avatar"),"00"!==r){const e=document.createElement("img");e.src=a,m.appendChild(e)}else m.style.fontSize="1.8rem",m.innerHTML=Be();const p=document.createElement("a");p.classList.add("name"),p.title="Написать в приват",p.dataset.user=e,p.textContent=n,p.style.setProperty("color",d,"important");const g=document.createElement("a");g.classList.add("profile");yt(g,`${u} ${t} - ${o}`),g.target="_blank",g.href=`/profile/${e}/`;let h=function(e,t,n){const o="http://www.w3.org/2000/svg",s=20,r=10,a=Math.random().toString(36).substring(2,22),i=n||0!==e?1:.6,l=document.createElementNS(o,"svg");if(Object.entries({width:s,height:s,viewBox:"0 0 20 20",xmlns:o}).forEach((([e,t])=>l.setAttribute(e,t))),l.classList.add("circularProgress"),n||0===e){if(!n){const e=document.createElementNS(o,"circle");Object.entries({cx:r,cy:r,r:8,fill:"none",stroke:t,"stroke-width":2}).forEach((([t,n])=>e.setAttribute(t,n))),e.classList.add("outerCircle"),l.appendChild(e)}const e=s/24*i,a=r-12*e,c=document.createElementNS(o,"g");c.setAttribute("transform",`translate(${a}, ${a}) scale(${e})`),c.classList.add("closeIconGroup");const d=document.createElementNS(o,"path");Object.entries({d:"M18.364 5.636a1 1 0 0 1 0 1.414L13.414 12l4.95 4.95a1 1 0 0 1-1.414 1.414L12 13.414l-4.95 4.95a1 1 0 0 1-1.414-1.414L10.586 12l-4.95-4.95a1 1 0 0 1 1.414-1.414L12 10.586l4.95-4.95a1 1 0 0 1 1.414 0z",fill:t}).forEach((([e,t])=>d.setAttribute(e,t))),c.appendChild(d),l.appendChild(c)}else{const n=document.createElementNS(o,"defs");n.classList.add("defs");const s=document.createElementNS(o,"clipPath");s.setAttribute("id",`clipInner-${a}`),s.classList.add("clipPath");const i=document.createElementNS(o,"rect");Object.entries({x:2,y:2,width:16,height:0,transform:"rotate(180, 10, 10)"}).forEach((([e,t])=>i.setAttribute(e,t))),i.classList.add("clipRect");const c=document.createElementNS(o,"animate");Object.entries({attributeName:"height",from:0,to:e/100*16,begin:"indefinite",dur:"1s",fill:"freeze",calcMode:"spline",keySplines:"0.4 0 0.2 1",keyTimes:"0;1"}).forEach((([e,t])=>c.setAttribute(e,t))),c.classList.add("animateProfileProgress"),i.appendChild(c),s.appendChild(i),n.appendChild(s),l.appendChild(n);const d=document.createElementNS(o,"circle");Object.entries({cx:r,cy:r,r:8,fill:"none",stroke:t,"stroke-width":2}).forEach((([e,t])=>d.setAttribute(e,t))),d.classList.add("outerCircle"),l.appendChild(d);const u=document.createElementNS(o,"circle");Object.entries({cx:r,cy:r,r:8,fill:t,"clip-path":`url(#clipInner-${a})`}).forEach((([e,t])=>u.setAttribute(e,t))),u.classList.add("innerCircle"),l.appendChild(u)}return l.outerHTML}(function(e){const t=100*Math.floor(e/100);return(e-t)/(t+100-t)*100}(o),d,s);g.innerHTML=h,setTimeout((()=>{const e=g.querySelector(".animateProfileProgress");e&&e.beginElement()}),10),g.addEventListener("click",(function(t){t.preventDefault(),ke?window.open(re+e,"_blank"):loadProfileIntoIframe(re+e)}));const f=`${re}${ie}/messages/${e}/`;p.addEventListener("click",(function(t){if(t.ctrlKey&&t.shiftKey){const e=window.open(f,"_blank");e&&e.focus()}else t.ctrlKey?loadProfileIntoIframe(f):function(e){const t=`<${document.querySelector(`.name[data-user="${e}"]`).textContent}>`,n=document.querySelector(".messages .text");n.value=t,n.focus(),n.selectionEnd=n.value.length}(e)})),i.appendChild(m),i.appendChild(p),i.appendChild(g);if(ce.find((e=>e.name===n&&"thawed"===e.state))){const e=document.createElement("div");e.title="Tracked user",e.classList.add("tracked"),e.innerHTML=w,i.appendChild(e)}if(pe.includes(n)){const e=document.createElement("div");e.title="Ignored user",e.classList.add("ignored"),e.innerHTML=S,i.appendChild(e)}const y=document.querySelector(`.userlist-content ins.user${e} img[src*="moderator"]`),v=me.includes(n);if(y||v){const e=document.createElement("div");e.classList.add("moderator"),e.innerHTML=x,i.appendChild(e)}return i}async function O(e,t){try{const n=document.querySelector(".userlist-content");let o=document.querySelector(".chat-user-list");if(!o){o=document.createElement("div"),o.classList.add("chat-user-list");const e=document.querySelector(".userlist");e&&e.appendChild(o)}const s={};["extra","cyber","superman","maniac","racer","profi","driver","amateur","newbie"].forEach((e=>{const t=o.querySelector(`.rank-group-${e}`);t?s[e]=t:(s[e]=document.createElement("div"),s[e].classList.add(`rank-group-${e}`),o.appendChild(s[e]))}));const r=new Set;for(const o of n.querySelectorAll("ins")){const n=o.querySelector(".name"),a=n.getAttribute("data-user"),i=n.textContent;if(!r.has(a))try{const{rank:n,login:l,registeredDate:c,bestSpeed:d,ratingLevel:u,friends:m,cars:p,avatarTimestamp:g}=await Fe(a);on[a]?(on[a].rank=n,on[a].login=l,on[a].registered=c,on[a].bestSpeed=d,on[a].ratingLevel=u,on[a].friends=m,on[a].cars=p,on[a].avatarTimestamp=g):on[a]={rank:n,login:l,registered:c,bestSpeed:d,ratingLevel:u,friends:m,cars:p,avatarTimestamp:g},e===i&&"enter"===t&&(on[a].visits=(on[a].visits||0)+1,on[a].tracked=ce.some((t=>t.name===e)));const{class:h}=A(n);if(!s[h].querySelector(`.user${a}`)){const e=j(a,n,i,d,o.classList.contains("revoked"));s[h].appendChild(e),D||Me(e)}r.add(a)}catch(e){console.error(`Error fetching profile summary for user ${a}:`,e)}}o.querySelectorAll('.chat-user-list [class^="user"]').forEach((e=>{const t=e.querySelector(".name").getAttribute("data-user");r.has(t)||e.remove()})),Object.values(s).forEach((e=>[...e.children].sort(((e,t)=>(on[t.querySelector(".name")?.getAttribute("data-user")]?.bestSpeed||0)-(on[e.querySelector(".name")?.getAttribute("data-user")]?.bestSpeed||0))).forEach((t=>e.appendChild(t))))),localStorage.setItem("fetchedUsers",JSON.stringify(on)),function(){const e=document.querySelector(".cache-panel-load-button .cache-user-count");if(!e)return;const t=Object.keys(kt).length.toString();t!==e.textContent&&(e.textContent=t,Ce(e))}()}catch(e){console.error("Error refreshing user list:",e)}}y.classList.add("chat-user-count"),y.title="Current Chat Users Count",y.innerHTML="0",f.appendChild(y),h.appendChild(f),function(){const e=document.createElement("style");e.classList.add("userlist-dynamic-background");const t=getComputedStyle(document.querySelector(".chat .messages")).backgroundColor,n=`\n    #chat-general .smile-tab {\n      background-color: ${t};\n    }\n    .chat-user-list {\n      background-color: ${t};\n    }\n  `;e.innerHTML=n,document.head.appendChild(e)}();const H=document.querySelector(".userlist-content");let P=new Map,B=0,D=!0,F=!1;function z(e,t){if(!e)return;const n=t.toString().length;e.textContent=t,e.style.fontSize=Math.max(24-2*(n-1),12)+"px"}const J=new MutationObserver(qe((e=>{e.forEach((e=>{if("childList"===e.type){const t=document.querySelector("#voice, #beep, #silence"),n=t&&"silence"===t.id,s=document.querySelector("#chat-wrapper.chat-hidden"),r=document.querySelector(".chat-user-count");if(s)return r.style.filter="grayscale(100%)",void(r.textContent="0");const l=new Map(Array.from(H.children).map((e=>{const t=e.querySelector(".name"),n=t?.getAttribute("data-user"),o=t?.textContent?.trim();return n?[n,{userName:o}]:null})).filter(Boolean));if(D)return r&&0===Number(r.textContent)&&!F&&function(e,t){let n=0;const o=()=>{if(n<=e){const s=Math.min(n/(e||1),1);z(t,n++),t.style.filter=`grayscale(${100-100*s}%)`,setTimeout(o,20)}else Ce(t),F=!0};setTimeout(o,20)}(l.size,r),l.forEach(((e,t)=>P.set(t,e))),void setTimeout((()=>{D=!1}),2e3);let c=[...l].filter((([e])=>!P.has(e))).map((([e,t])=>({userId:e,...t}))),d=[...P].filter((([e])=>!l.has(e))).map((([e,t])=>({userId:e,userName:t.userName})));P=new Map(l);const m=P.size;function h(e,t){const{userName:s,userId:r}=e,l=function(e){const t=ce.find((t=>t.name===e));return t?t.gender:null}(s),c=ce.some((e=>e.name===s&&"thawed"===e.state));xt(s,"enter"===t?v:b,"enter"===t),O(s,t),function(e,t){e&&t?(on[e]=on[e]||{},on[e].actionLog=on[e].actionLog||[],on[e].actionLog.push({type:t,timestamp:Ke()})):console.error("Missing userId or actionType")}(r,t),!n&&c&&function(e,t,n){if(!Ue("sound","presence"))return;const s=n||"Male",r=ce.find((t=>t.name===e)),l="enter"===t?g[s].enter:g[s].leave;u("enter"===t?a:i,.2),setTimeout((()=>p(`${r.pronunciation} ${l}`,o)),300)}(s,t,l)}m!==B&&F&&(z(r,m),r.style.filter=m>0?"none":"grayscale(100%)",Ce(r)),c.forEach((e=>h(e,"enter"))),d.forEach((e=>h(e,"leave"))),B=m}}))}),se));J.observe(H,{childList:!0});document.querySelector(".mostright").addEventListener("click",(()=>{setTimeout((()=>{document.querySelector("#chat-wrapper.chat-hidden")?he=!1:(tt(),en(),he=!1,setTimeout((()=>he=!1),3e3))}),300)})),function(){const e=document.querySelector("#chat-fixed-placeholder");if("shouldShowPopupMessage"in localStorage){const t=JSON.parse(localStorage.getItem("shouldShowPopupMessage"));e.style.display=t?"none":"unset"}else e.style.display="none"}(),"shouldShowPopupMessage"in localStorage||localStorage.setItem("shouldShowPopupMessage",!1),document.addEventListener("keydown",(e=>{if(e.ctrlKey&&"Space"===e.code){const e=document.querySelector("#chat-fixed-placeholder"),t=e.hasAttribute("style"),n="unset"===e.style.display,o=document.querySelector(".popup-messages-container");if(t)if(n)e.style.display="none",localStorage.setItem("shouldShowPopupMessage",!0);else{e.style.display="unset",localStorage.setItem("shouldShowPopupMessage",!1);const{inputField:t}=He();t?t.focus():console.error("Input field not found. Cannot set focus.")}else e.style.display="none",localStorage.setItem("shouldShowPopupMessage",!0);o&&t&&n&&o.remove()}}));let U=null,R=!1;function _(e){if(null===e)return e;const t=[...ce.map((e=>e.name)),...ue.map((e=>e.original))],n=new RegExp(`(${t.join("|")})`,"gu");return e.replace(n,(e=>{const t=ue.find((t=>t.original===e));if(t)return t.replacement;const n=ce.find((t=>t.name===e));return n?.pronunciation||e}))}function K(e){const[t,n,o]=e.match(/\d+/g).map(Number),{h:s,s:r,l:a}=((e,t,n)=>{e/=255,t/=255,n/=255;const o=Math.max(e,t,n),s=Math.min(e,t,n);let r,a,i=(o+s)/2;if(o===s)r=a=0;else{const l=o-s;a=i<.5?l/(o+s):l/(2-o-s),r=(o===e?(t-n)/l+(t<n?6:0):o===t?(n-e)/l+2:(e-t)/l+4)/6}return r=Math.round(360*r),a=Math.min(Math.round(100*a),90),i=Math.round(100*i),r>215&&r<280&&(r=r<255?215:280),{h:r,s:a,l:i}})(t,n,o),i=((e,t,n)=>{let o,s,r;if(n/=100,0==(t/=100))o=s=r=255*n;else{const a=n<.5?n*(1+t):n+t-n*t,i=2*n-a,l=(e,t,n)=>(n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e);o=Math.round(255*l(i,a,e/360+1/3)),s=Math.round(255*l(i,a,e/360)),r=Math.round(255*l(i,a,e/360-1/3))}return`rgb(${o}, ${s}, ${r})`})(s,r,a<50?50:a);return i}async function V(){const e=document.querySelector(".messages-content div p:last-of-type");if(!e)return null;const t=async e=>Array.from(e.childNodes).map((e=>e.nodeType===Node.TEXT_NODE&&e.textContent.trim()?e.textContent.trim():"IMG"===e.nodeName&&e.getAttribute("title")?e.getAttribute("title"):"A"===e.nodeName&&e.getAttribute("href")?e.getAttribute("href"):"")).filter(Boolean);let n=(await t(e)).join(" ").trim(),o="common";const s=e.querySelector(".room.private");if(s&&s.textContent.includes("[шепчет ")){const s=e.querySelector("span.private");s&&(n=(await t(s)).join(" ").trim(),o="private")}const r=e.querySelector(".system-message");if(r){let e=(await t(r)).join(" ").trim();e=e.replace(/<Клавобот>\s*/g,""),n=e,o="system"}"common"===o&&function(e){const t=e.toLowerCase();return de.some((e=>t.includes(e.toLowerCase())))}(n)&&(o="mention");const a=JSON.parse(localStorage.getItem("personalMessages"))||{},i=e.querySelector(".time")?.textContent||"N/A",l=e.querySelector(".username span[data-user]"),c=l?l.getAttribute("data-user"):null,d=l?l.textContent:"SYSTEM",u=K(l?l.parentElement.style.color:"rgb(180,180,180)"),m=`${i}_${d}`;("mention"===o||"private"===o)&&!pe.includes(d)&&(a[m]={time:i,date:(new Date).toLocaleDateString("en-CA"),username:d,usernameColor:u,message:n,type:o,userId:c},localStorage.setItem("personalMessages",JSON.stringify(a)));const p=e.querySelector(".username"),g=p?p.textContent.replace(/[<>]/g,""):"SYSTEM";Xe();let h="mention"===o||"private"===o?`${_(g)} обращается: `:g!==U?`${_(g)} пишет: `:"";U=g;return{messageText:h+_(n),usernameText:g}}let X=!1;const G=new Set;function Y(e){G.has(e)||(G.add(e),X||(X=!0,async function(){for(let e of G)await p(e,o),G.delete(e);X=!1}()))}function W(){const e=document.getElementById("chat-content").querySelectorAll(".messages-content div p");let t=null,n=!0,o="14px";for(let s=0;s<e.length;s++){const r=e[s],a=r.querySelector("span.username");if(r.querySelector(".system-message"))r.style.marginTop=o,r.style.marginBottom=o;else if(a){const i=a.querySelector("span[data-user]");if(!i)continue;let l=i.textContent;l=l.replace(/</g,"").replace(/>/g,""),null===t||l!==t?n||(r.style.marginTop=o):n||r.style.removeProperty("margin-bottom");if(s<e.length-1){const t=e[s+1].querySelector("span.username");if(t){const e=t.querySelector("span[data-user]");if(!e)continue;l!==e.textContent&&(r.style.marginBottom=o)}}t=l,n=!1}}}W();let Z={};function Q(e){document.querySelectorAll(`.messages-content span[data-user="${e}"]`).forEach((e=>{const t=e.closest("p");t&&t.remove()}))}let ee=null;function te(e,t){Z[e].thresholdMaxTries>=10&&(Z[e].banned=!0,console.log(t(),"color: pink"),console.log(`%c${Z[e].userName} cannot send messages anymore`,"color: pink"))}function ne(){const e=(new Date).getTime(),t=document.querySelector(".messages-content p:last-child");if(t){const n=t.querySelector("span[data-user]"),o=n?n.getAttribute("data-user"):null;Z[o]||(Z[o]={messagesCount:0,thresholdMaxTries:0,time:e,userName:n?n.textContent:"Unknown User",previousTime:null,firstInteraction:!0,banned:!1});const s=e-Z[o].time;function r(){return`%cID: ${o}, Name: ${Z[o].userName}, Time Difference: ${function(e){const t=["hour","minute","second","millisecond"];return[Math.floor(e/36e5),Math.floor(e/6e4%60),Math.floor(e/1e3%60),e%1e3].map(((e,n)=>e>0?`${e} ${t[n]}${e>1?"s":""}`:"")).filter(Boolean).join(" ")}(s)}, Messages Count: ${Z[o].messagesCount}, Spam Tries: ${Z[o].thresholdMaxTries}, Banned: ${Z[o].banned}`}(function(e){const t=new RegExp("[0-9a-zA-Zа-яА-ЯёЁ\\s!@#$%^&*()-_=+[\\]{}|;:'\",.<>/?`~\\u00A9\\u2122\\u00AE\\u00AB\\u00BB\\u00B1\\u00D7\\u00F7\\u00B0\\u2260\\u2264\\u2265\\u221E\\u20AC\\u00A3\\u00A5\\u00A7\\u2022\\u2026\\u2212\\u2013\\u2014\\u2190\\u2192\\u2191\\u2193\\u00BD\\u2153\\u2154\\u2211\\u00B4\\uD83C-\\uDBFF\\uDC00-\\uDFFF]+","gu"),n=e.match(t);return!(!n||n.join("")!==e)||(ee=e.replace(t,""),!1)})(t.textContent)||Z[o].banned||(Z[o].thresholdMaxTries++,console.log(`%c${Z[o].userName} has sent a message with not allowed characters ${ee}.\n          Threshold: ${Z[o].thresholdMaxTries}.`,"color: orange;"),te(o,r)),Z[o].firstInteraction?(console.log(`%c${Z[o].userName} posted the first message for the current chat session.`,"color: yellow"),Z[o].firstInteraction=!1):Z[o].banned?Q(o):s<400?(Z[o].messagesCount++,Z[o].messagesCount>1?(Q(o),Z[o].thresholdMaxTries++,te(o,r),Z[o].banned||console.log(r(),"color: red")):console.log(r(),"color: green")):(Z[o].previousTime=Z[o].time,Z[o].time=e,Z[o].messagesCount=1,console.log(r(),"color: green"))}}const oe={};function le(){if("true"!==localStorage.getItem("shouldShowPopupMessage"))return;const e=document.querySelector(".messages-content p:last-of-type");if(e){const t=e.querySelector(".time"),n=e.querySelector(".username"),o=Array.from(e.childNodes).map((e=>{if(e.nodeType===Node.TEXT_NODE)return{type:"text",value:e.nodeValue.replace(/ /g," ")};if(e.nodeType===Node.ELEMENT_NODE){if("a"===e.tagName.toLowerCase()&&e.classList.contains("private"))return{type:"text",value:"📢 "};if("span"===e.tagName.toLowerCase()&&e.classList.contains("private"))return{type:"text",value:e.textContent.replace(/ /g," ")};if("img"===e.tagName.toLowerCase())return{type:"img",title:e.getAttribute("title")};if("a"===e.tagName.toLowerCase())return{type:"anchor",href:e.getAttribute("href")}}})).filter(Boolean),s=t.textContent.replace(/[\[\]]/g,""),r=n.textContent.replace(/[<>]/g,"");let a=oe[r];a||(a=15*Math.floor(24*Math.random()),oe[r]=a);let i=document.querySelector(".popup-messages-container");if(i||(i=document.createElement("div"),i.classList.add("popup-messages-container"),document.body.appendChild(i)),i.childElementCount>=10){const e=i.firstChild;e.classList.add("fade-out"),setTimeout((()=>{i.removeChild(e)}),300)}const l=document.createElement("div");l.classList.add("popup-chat-message"),l.style.filter=`hue-rotate(${a}deg)`;const c=document.createElement("div");c.classList.add("time-icon"),c.innerHTML=k;const d=document.createElement("div");d.classList.add("time"),d.textContent=s;const u=document.createElement("div");u.classList.add("user-icon"),u.innerHTML=C;const m=document.createElement("div");m.classList.add("username"),m.textContent=r;const p=document.createElement("div");p.classList.add("action-icon"),p.innerHTML=E;const g=document.createElement("div");g.classList.add("message"),l.appendChild(c),l.appendChild(d),l.appendChild(u),l.appendChild(m),l.appendChild(p),l.appendChild(g),o.forEach((e=>{const t=document.createElement("div");"text"===e.type?t.textContent=e.value:"img"===e.type?t.innerHTML=`&nbsp;${e.title}&nbsp;`:"anchor"===e.type&&(t.innerHTML=`&nbsp;${e.href}&nbsp;`),g.appendChild(t)})),i.appendChild(l)}}function ge(e){return function(e){const t={А:"A",Б:"B",В:"V",Г:"G",Д:"D",Е:"E",Ё:"Yo",Ж:"Zh",З:"Z",И:"I",Й:"Y",К:"K",Л:"L",М:"M",Н:"N",О:"O",П:"P",Р:"R",С:"S",Т:"T",У:"U",Ф:"F",Х:"Kh",Ц:"Ts",Ч:"Ch",Ш:"Sh",Щ:"Shch",Ъ:"y",Ы:"Y",Ь:"i",Э:"E",Ю:"Yu",Я:"Ya",а:"a",б:"b",в:"v",г:"g",д:"d",е:"e",ё:"yo",ж:"zh",з:"z",и:"i",й:"y",к:"k",л:"l",м:"m",н:"n",о:"o",п:"p",р:"r",с:"s",т:"t",у:"u",ф:"f",х:"kh",ц:"ts",ч:"ch",ш:"sh",щ:"shch",ъ:"y",ы:"y",ь:"i",э:"e",ю:"yu",я:"ya"};return e.split("").map((e=>t[e]||e)).join("")}(e)}let he=!1;function fe(e){return!!e&&["Клавобот","Пользователь","заблокирован"].every((t=>e.includes(t)))}function ve(e,t){if(e)if("one"===t){const t=e.querySelector("span[data-user]");if(!t)return;const n=K(getComputedStyle(e).color);e.style.setProperty("color",n,"important"),t.style.setProperty("filter","invert(0)","important")}else"all"===t?Array.from(e).forEach((e=>{if(!e)return;const t=e.querySelector("span[data-user]");if(!t)return;const n=K(getComputedStyle(e).color);e.style.setProperty("color",n,"important"),t.style.setProperty("filter","invert(0)","important")})):console.error("Invalid mode. Use 'one' or 'all'.")}const be=new MutationObserver((async e=>{if(he){for(let t of e)if("childList"===t.type)for(let e of t.addedNodes)if(e.nodeType===Node.ELEMENT_NODE&&"P"===e.tagName){const t=e.querySelector(".username");t&&ve(t,"one");const n=localStorage.getItem("previousMessageText"),o=await V(),s=o?.messageText||null,r=o?.usernameText||null;console.log(s);const a=ge(r);if(fe(s)&&(console.log("Ban message detected:",s),new Audio("https://github.com/VimiummuimiV/Sounds/raw/refs/heads/main/Mario_Game_Over.mp3").play()),r&&pe.includes(r)){e.classList.add("ignored-user",a),e.style.display="none";continue}const i=document.querySelector("#voice, #beep, #silence"),d=i&&"voice"===i.id,m=i&&"beep"===i.id,p=document.querySelector("#every-message, #mention-message"),g=p&&"every-message"===p.id,h=p&&"mention-message"===p.id,f="[шепчет вам]",y=e.querySelector(".room.private"),v=y&&y.textContent.includes(f);if(d&&he&&s&&s!==n&&(localStorage.setItem("previousMessageText",s),r&&!r.includes(ae))){(g||h&&R||v)&&Y(s)}if(m&&he&&s&&s!==n&&(localStorage.setItem("previousMessageText",s),r&&!r.includes(ae))){if(g||h&&R||v){u(!g||R?c:l,.2),R&&(R=!1)}}he&&(ct(),ot("generalMessages"),lt("generalMessages"),Pe("generalMessages"),W(),_e(),ne(),le(),Ye())}}else{he=!0;ve(document.querySelectorAll(".username"),"all")}})),xe=document.querySelector(".messages-content div");let we,Se,Le,Te;function Me(e){e.classList.add("shake-effect"),setTimeout((()=>{e.classList.remove("shake-effect")}),500)}function $e(){switch(we.id){case"silence":Se.innerHTML=L;break;case"beep":Se.innerHTML=T;break;case"voice":Se.innerHTML=M}}function Ne(){return{speed:`${(o-0)/2.5*100}%`,pitch:`${(s-0)/2*100}%`}}be.observe(xe,{childList:!0,subtree:!0}),function(){we=document.createElement("div");const e=n.messageSettings.messageNotificationState||"silence";we.classList.add("empowerment-button","sound-switcher-button"),we.id=e;const t=n.messageSettings.messageNotificationTitle||"Do not disturb";we.title=t,Se=document.createElement("span"),Se.classList.add("sound-switcher-icon"),we.appendChild(Se),f.appendChild(we)}(),we.addEventListener("click",(function(e){if(!ke&&!Ee){let e=document.querySelector(".current-voice-speed"),t=document.querySelector(".current-voice-pitch");switch(e&&e.remove(),t&&t.remove(),Ce(this),this.id){case"silence":this.id="beep",this.title="Notify with beep signal",n.messageSettings.messageNotificationState="beep",n.messageSettings.messageNotificationTitle="Notify with beep signal";break;case"beep":this.id="voice",this.title="Notify with voice API",n.messageSettings.messageNotificationState="voice",n.messageSettings.messageNotificationTitle="Notify with voice API";break;case"voice":this.id="silence",this.title="Do not disturb",n.messageSettings.messageNotificationState="silence",n.messageSettings.messageNotificationTitle="Do not disturb"}localStorage.setItem("KG_Chat_Empowerment",JSON.stringify(n)),$e()}})),$e();let Ie=null,Ae=null;function je(e,r){const a=parseFloat(n.voiceSettings[e]),[i,l]="voiceSpeed"===e?[0,t]:[0,2],c=a+r,d=Math.min(l,Math.max(i,c));return a!==d&&(function(e,r){const a=parseFloat(r.toFixed(1));n.voiceSettings[e]=a,"voiceSpeed"===e?o=a:"voicePitch"===e&&(s=a);localStorage.setItem("KG_Chat_Empowerment",JSON.stringify(n)),function(){let e=document.querySelector(".voice-settings"),n=document.querySelector(".current-voice-speed"),r=document.querySelector(".current-voice-pitch");if(ke){e||(e=document.createElement("div"),e.classList.add("voice-settings"),we.appendChild(e),e.offsetWidth,e.style.opacity="1"),r&&r.remove(),n||(n=document.createElement("span"),n.classList.add("current-voice-speed"),e.appendChild(n));let s=e.querySelector(".current-voice-speed .voice-value-info");s||(s=document.createElement("span"),s.classList.add("voice-speed","voice-value-info"),e.querySelector(".current-voice-speed").appendChild(s)),s&&(s.innerHTML=o<=0||o>=t?q:`SPEED ${Number(o).toFixed(1)}`);let a=e.querySelector(".current-voice-speed .voice-speed-progress");if(!a){a=document.createElement("span"),a.classList.add("voice-speed-progress");let t=document.createElement("span");t.classList.add("voice-speed-progress-fill"),a.appendChild(t),e.querySelector(".current-voice-speed").appendChild(a)}a.querySelector(".voice-speed-progress-fill").style.width=Ne().speed,e.timeoutId&&clearTimeout(e.timeoutId),e.timeoutId=setTimeout((()=>{e.style.opacity="0",setTimeout((()=>{e.remove()}),500)}),2e3)}else if(Ee){e||(e=document.createElement("div"),e.classList.add("voice-settings"),we.appendChild(e),e.offsetWidth,e.style.opacity="1"),n&&n.remove(),r||(r=document.createElement("span"),r.classList.add("current-voice-pitch"),e.appendChild(r));let t=e.querySelector(".current-voice-pitch .voice-value-info");t||(t=document.createElement("span"),t.classList.add("voice-pitch","voice-value-info"),e.querySelector(".current-voice-pitch").appendChild(t)),t&&(t.innerHTML=s<=0||s>=2?q:`PITCH ${s.toFixed(1)}`);let o=e.querySelector(".current-voice-pitch .voice-pitch-progress");if(!o){o=document.createElement("span"),o.classList.add("voice-pitch-progress");let t=document.createElement("span");t.classList.add("voice-pitch-progress-fill"),o.appendChild(t),e.querySelector(".current-voice-pitch").appendChild(o)}o.querySelector(".voice-pitch-progress-fill").style.width=Ne().pitch,e.timeoutId&&clearTimeout(e.timeoutId),e.timeoutId=setTimeout((()=>{e.style.opacity="0",setTimeout((()=>{e.remove()}),500)}),2e3)}else e&&e.remove()}()}(e,d),r>0?d<l:d>i)}function Oe(){switch(Le.id){case"every-message":Te.innerHTML=$;break;case"mention-message":Te.innerHTML=N}}function He(){const e=window.location.href;let t,n;if(e.includes("gamelist"))t=document.querySelector("#chat-general .text"),n=document.querySelector("#chat-general .messages");else{if(!e.includes("gmid"))return console.error("No matching room type found in the URL."),null;t=document.querySelector('[id^="chat-game"] .text'),n=document.querySelector('[id^="chat-game"] .messages')}return{inputField:t,lengthPopupContainer:n}}we.addEventListener("mousedown",(function(e){e.preventDefault();const o=function(e){const o=0===e.button,s=e.ctrlKey||e.metaKey,r=e.altKey;if(!s&&!r)return null;const a=s?"voiceSpeed":"voicePitch",i=o?-.1:.1,l=n.voiceSettings[a],[c,d]="voiceSpeed"===a?[0,t]:[0,2];return i<0&&l<=c||i>0&&l>=d?null:{prop:a,step:i}}(e);if(!o)return;const{prop:s,step:r}=o;je(s,r),Ie=setTimeout((()=>{Ae=setInterval((()=>{je(s,r)||clearInterval(Ae)}),100)}),500);const a=()=>{clearTimeout(Ie),clearInterval(Ae),we.removeEventListener("mouseup",a),we.removeEventListener("mouseleave",a)};we.addEventListener("mouseup",a),we.addEventListener("mouseleave",a)})),we.addEventListener("contextmenu",(e=>e.preventDefault())),function(){Le=document.createElement("div");const e=n.messageSettings.messageModeState||"every-message";Le.classList.add("empowerment-button","message-mode-button"),Le.id=e;const t=n.messageSettings.messageModeTitle||"Notify about every message";Le.title=t,Te=document.createElement("span"),Te.classList.add("message-mode-icon"),Le.appendChild(Te),f.appendChild(Le)}(),Le.addEventListener("click",(function(e){if(!ke||!Ee){switch(Ce(this),this.id){case"every-message":this.id="mention-message",this.title="Notify about mention message",n.messageSettings.messageModeState="mention-message",n.messageSettings.messageModeTitle="Notify about mention message";break;case"mention-message":this.id="every-message",this.title="Notify about every message",n.messageSettings.messageModeState="every-message",n.messageSettings.messageModeTitle="Notify about every message"}localStorage.setItem("KG_Chat_Empowerment",JSON.stringify(n)),Oe()}})),Oe(),function(e){const t=document.createElement("div");t.classList.add("empowerment-button","cache-panel-load-button"),t.style.position="relative",t.style.zIndex="3",t.innerHTML=I;const n=document.createElement("div");n.classList.add("cache-user-count");const o=Object.keys(kt).length;n.textContent=o,t.appendChild(n),t.title="Show Cache Panel",t.addEventListener("click",(function(){Ce(t),Lt()})),e.appendChild(t)}(f),$t(f),Pt(f),Vt(f);const{inputField:De,lengthPopupContainer:Je}=He(),Re=document.createElement("div");Re.className="length-field-popup",Je.appendChild(Re);const Ve=document.createElement("canvas").getContext("2d");let Ge,We=!1,Ze=0;function Qe(e){let t;t=e>Ze?`${e} 🡆`:e<Ze?`🡄 ${e}`:`${e}`,Re.textContent=t,function(e){if(!Re)return void console.error("lengthPopup is not defined");let t;if(0===e)t="hsl(200, 20%, 50%)";else if(e>=1&&e<=90)t="hsl(120, 100%, 40%)";else if(e>90&&e<=100){const n=(e-90)/10;t=`hsl(${Math.round(120+-60*n)}, 100%, 40%)`}else if(e>100&&e<=190)t="hsl(60, 100%, 50%)";else if(e>190&&e<=200){const n=(e-190)/10;t=`hsl(${Math.round(60+-30*n)}, 100%, 50%)`}else if(e>200&&e<=250)t="hsl(40, 100%, 50%)";else if(e>250&&e<=300){const n=(e-250)/50;t=`hsl(${Math.round(40+-40*n)}, 100%, 70%)`}else t="hsl(0, 100%, 70%)";Re.style.color=t}(e),Ze=e}function et(e){We!==e&&(Re.classList.toggle("bounce-in",e),Re.classList.toggle("bounce-out",!e),We=e,e||setTimeout((()=>Re.classList.remove("bounce-out")),500))}function tt(){ct(),mt(),ut()}function nt(e){e.style.setProperty("background-color","hsla(0, 50%, 30%, .5)","important"),e.style.setProperty("box-shadow","inset 0px 0px 0px 1px rgb(191, 64, 64)","important"),e.style.setProperty("background-clip","padding-box","important")}De.addEventListener("input",(()=>{clearTimeout(Ge),Qe(De.value.length),function(e){const t=getComputedStyle(De);Ve.font=`${t.fontWeight} ${t.fontSize} ${t.fontFamily}`;const n=Ve.measureText(e).width,o=De.offsetLeft+n+5,s=De.offsetLeft+De.offsetWidth-Re.offsetWidth;Re.style.left=`${Math.min(o,s)}px`}(De.value),et(!0),Ge=setTimeout((()=>et(!1)),1e3)})),De.addEventListener("keydown",(e=>{"Enter"===e.key&&(Qe(0),Object.assign(Re.style,{left:"0px",color:"hsl(200, 20%, 50%)"}),et(!0),Ge=setTimeout((()=>et(!1)),1e3))}));const st=new Set;let rt,at=!1,it=!1;function ct(){const e=document.querySelectorAll(".messages-content div p");let t=null;e.forEach((e=>{e.hasAttribute("id")&&"contextmenu"===e.getAttribute("id")||(e.addEventListener("mousedown",(n=>{if(it=2===n.button,it){at=!0,clearTimeout(t);const n=dt(e);st.has(n)||(st.add(n),console.log("Added new message inside the selectedMessages Set:",n)),nt(e)}})),e.addEventListener("mouseup",(e=>{it=2===e.button,it&&(at=!1)})),e.addEventListener("mouseover",(t=>{if(at&&it){const t=dt(e);st.has(t)||(st.add(t),console.log("Added new message inside the selectedMessages Set:",t)),nt(e)}})),e.setAttribute("id","contextmenu"),e.addEventListener("contextmenu",(n=>{n.preventDefault(),nt(e);const o=document.querySelector(".delete-message");o&&o.remove();const s=document.createElement("button");function r(){t=setTimeout((()=>{s.matches(":hover")||(s.remove(),document.querySelectorAll(".messages-content div p").forEach((e=>{e.style.removeProperty("background-color"),e.style.removeProperty("box-shadow"),e.style.removeProperty("background-clip")})),st.clear())}),1e3)}s.innerText="Delete",s.classList.add("delete-message"),s.addEventListener("click",(()=>{!function(){const e=[...st],t=document.querySelectorAll(".messages-content div p");e.forEach((e=>{const n=Array.from(t).find((t=>dt(t)===e));if(n){const t=JSON.parse(localStorage.getItem("deletedChatMessagesContent")||"[]");t.includes(e)||t.push(e),localStorage.setItem("deletedChatMessagesContent",JSON.stringify(t)),st.delete(e)}})),ut()}(),s.remove(),mt(),st.clear()})),function(e,t){e.style.position="fixed",e.style.top=`${t.clientY}px`,e.style.left=`${t.clientX}px`,e.style.zIndex=999,e.style.padding="8px 16px",e.style.backgroundColor="hsl(0, 50%, 20%)",e.style.color="hsl(0, 60%, 70%)",e.style.border="1px solid hsl(0, 50%, 35%)",e.style.transition="all 0.3s",e.style.filter="brightness(1)",e.addEventListener("mouseenter",(()=>{e.style.filter="brightness(1.5)"})),e.addEventListener("mouseleave",(()=>{e.style.filter="brightness(1)"}))}(s,n),s.addEventListener("mouseenter",(()=>{s.style.filter="brightness(1.5)"})),s.addEventListener("mouseleave",(()=>{s.style.filter="brightness(1)"})),document.body.appendChild(s),r(),s.addEventListener("mouseleave",(()=>{r()})),s.addEventListener("mouseenter",(()=>{clearTimeout(t)}))})))}))}function dt(e){const t=e.querySelector(".time"),n=e.querySelector(".username");return[t?t.textContent.trim():"",n?` ${n.textContent.trim()} `:"",...Array.from(e.childNodes).filter((e=>e!==t&&e!==n)).map((e=>e.nodeType===Node.TEXT_NODE?e.textContent:"A"===e.tagName?e.getAttribute("href").trim():"IMG"===e.tagName?e.title.trim():"IFRAME"===e.tagName?e.getAttribute("src").trim():""))].join("")}function ut(){const e=JSON.parse(localStorage.getItem("deletedChatMessagesContent")||"[]");if(0===e.length)return;const t=document.querySelectorAll(".messages-content div p"),n=new Set(e),o=Array.from(t).map((e=>dt(e))),s=e.filter((e=>o.includes(e)));t.forEach((e=>{n.has(dt(e))&&(e.style.display="none")})),localStorage.setItem("deletedChatMessagesContent",JSON.stringify(s))}function mt(){if(JSON.parse(localStorage.getItem("deletedChatMessagesContent")||"[]").length>0&&(rt=document.getElementById("toggleButton"),null===rt)){rt=document.createElement("button"),rt.id="toggleButton",rt.classList.add("toggle-button-hidden"),rt.addEventListener("click",pt),rt.style.position="absolute",rt.style.top="0",rt.style.right="0",rt.style.padding="8px 16px",rt.innerText="Hidden",rt.style.transition="filter 300ms",rt.style.filter="hue-rotate(0) brightness(1)";let e=rt.textContent;rt.addEventListener("mouseenter",(()=>{ke?(e=rt.textContent,rt.textContent="Restore",rt.style.filter="hue-rotate(180deg) brightness(2)"):rt.style.filter="hue-rotate(0) brightness(2)"})),rt.addEventListener("mouseleave",(()=>{const t="Restore"===rt.textContent;(ke||!ke&&t)&&(rt.textContent=e),rt.style.filter="hue-rotate(0) brightness(1)"})),xe.appendChild(rt)}}function pt(){const e=document.querySelectorAll(".messages-content div p"),t=JSON.parse(localStorage.getItem("deletedChatMessagesContent")||"[]");if(ke&&(localStorage.setItem("deletedChatMessagesContent",JSON.stringify([])),e.forEach((e=>{e.style.display="block",e.style.removeProperty("background-color"),e.style.removeProperty("box-shadow"),e.style.removeProperty("background-clip")})),rt.remove()),!ke){if(0===t.length)return void(rt.style.display="none");rt.style.display="block",e.forEach((e=>{const n=dt(e);t.includes(n)&&("Hidden"===rt.innerText||"Show"===rt.innerText?"none"===e.style.display&&(e.style.display="block",e.style.setProperty("background-color","hsla(0, 50%, 30%, .5)","important"),e.style.setProperty("box-shadow","inset 0px 0px 0px 1px rgb(191, 64, 64)","important"),e.style.setProperty("background-clip","padding-box","important")):"Hide"===rt.innerText&&"block"===e.style.display&&(e.style.display="none",e.style.removeProperty("background-color"),e.style.removeProperty("box-shadow"),e.style.removeProperty("background-clip")))})),"Hide"===rt.innerText?(rt.innerText="Show",rt.className="toggle-button-show"):(rt.innerText="Hide",rt.className="toggle-button-hide")}}let gt=new MutationObserver((()=>{const e=document.querySelector(".messages-content div"),t=document.querySelectorAll(".messages-content div p");document.contains(e)&&t.length>=20&&(gt.disconnect(),document.querySelectorAll(".messages-content p").forEach((e=>{const t=e.querySelector(".username"),n=t?.textContent?.replace(/[<>]/g,"")||null;if(n&&pe.includes(n)){const t=ge(n);e.classList.add("ignored-user",t),e.style.display="none"}})),ot("generalMessages"),lt("generalMessages"),Pe("generalMessages"),function(){const{activeChatTab:e,chatField:t}=Wt();e?.click(),t?.focus()}(),function(){const{chatField:e}=Wt();e&&(e.value=localStorage.getItem("inputBackup")||"",e.addEventListener("input",qe((()=>{Zt(e)||localStorage.setItem("inputBackup",e.value)}),250)),e.addEventListener("keydown",(e=>{"Enter"===e.key&&localStorage.removeItem("inputBackup")})))}(),Xe(),W(),_e(),ze(!1,ye),O(),en(),tt(),nn())}));gt.observe(document,{childList:!0,subtree:!0})}()})();