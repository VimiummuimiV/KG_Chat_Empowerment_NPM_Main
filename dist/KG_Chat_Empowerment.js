// ==UserScript==
// @name         KG_Chat_Empowerment
// @namespace    klavogonki
// @version      1.3.3 
// @description  Enhance the chat abilities
// @author       Patcher
// @match        *://klavogonki.ru/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=klavogonki.ru
// @grant        none
// ==/UserScript==

(()=>{"use strict";var e={11:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(601),s=n.n(o),r=n(314),a=n.n(r)()(s());a.push([e.id,'.tracked-marker{display:inline-flex;width:2px;height:10px;border-radius:1px !important}.empowerment-button{display:flex;justify-content:center;align-items:center;width:48px;height:48px;cursor:pointer;background-color:#212226;border:1px solid #45474b}.previous-message,.focused-message{background-color:hsla(60,80%,60%,.05) !important;border:1px solid hsla(60,80%,60%,.1) !important;border-radius:.2em !important}.popup-panel .fetched-users,.popup-panel .messages-container,.popup-panel .chat-logs-container,.popup-panel .active-users,.popup-panel .settings-content-container{scrollbar-width:thin !important;scrollbar-color:#2f2f2f #1b1b1b}.popup-panel .fetched-users::-webkit-scrollbar,.popup-panel .messages-container::-webkit-scrollbar,.popup-panel .chat-logs-container::-webkit-scrollbar,.popup-panel .active-users::-webkit-scrollbar,.popup-panel .settings-content-container::-webkit-scrollbar{width:6px;background:#1b1b1b}.popup-panel .fetched-users::-webkit-scrollbar-thumb,.popup-panel .messages-container::-webkit-scrollbar-thumb,.popup-panel .chat-logs-container::-webkit-scrollbar-thumb,.popup-panel .active-users::-webkit-scrollbar-thumb,.popup-panel .settings-content-container::-webkit-scrollbar-thumb{background:#2f2f2f}.popup-panel .fetched-users::-webkit-scrollbar-thumb:hover,.popup-panel .messages-container::-webkit-scrollbar-thumb:hover,.popup-panel .chat-logs-container::-webkit-scrollbar-thumb:hover,.popup-panel .active-users::-webkit-scrollbar-thumb:hover,.popup-panel .settings-content-container::-webkit-scrollbar-thumb:hover{background:#4f4f4f}.popup-panel .hidden-message,.popup-panel .hidden-date{display:none !important}.popup-panel .input-error{transition:background-color 300ms ease-in-out;background-color:hsl(0,40%,30%) !important;color:hsl(0,40%,80%) !important;border:1px solid hsl(0,40%,40%) !important}.popup-panel .input-warning{transition:background-color 300ms ease-in-out;background-color:hsl(60,40%,30%) !important;color:hsl(60,40%,80%) !important;border:1px solid hsl(60,40%,40%) !important}.popup-panel .date-item{position:relative;font:1em Montserrat,sans-serif;color:#deb887;background-color:rgba(222,184,135,.1);width:fit-content;margin:2em 1em 1em;padding:.4em .8em;text-align:center;border-radius:.4em !important;left:50%;transform:translateX(-50%)}.popup-panel .search-messages-info,.popup-panel .search-results-info,.popup-panel .search-messages-date,.popup-panel .no-messages-info,.popup-panel .error-message-info{padding:.5em;border-radius:.4em !important;width:fit-content;margin:.5em;grid-column:1/-1}.popup-panel .search-messages-info,.popup-panel .search-results-info{color:hsl(80,60%,70%);background:hsla(80,60%,70%,.1)}.popup-panel .search-messages-date{color:hsl(40,60%,70%);background:hsla(40,60%,70%,.1)}.popup-panel .no-messages-info,.popup-panel .error-message-info{color:hsl(0,60%,70%);background:hsla(0,60%,70%,.1)}.popup-panel .parse-match-message,.popup-panel .search-match-username,.popup-panel .search-match-message{text-decoration:underline}.popup-panel .parse-match-message{color:hsl(120,75%,75%)}.popup-panel .search-match-message{color:hsl(30,75%,75%)}.length-field-popup{position:absolute;font:bold 12px Montserrat;bottom:40px;transition:left 100ms ease-out;height:20px;display:flex;align-items:center;justify-content:center;padding:2px 4px;margin:2px;opacity:0;border:none !important}.bounce-in{animation:bounceIn 500ms forwards}@keyframes bounceIn{0%{transform:translateY(0);opacity:0}50%{transform:translateY(-10px);opacity:1}100%{transform:translateY(0);opacity:1}}.bounce-out{animation:bounceOut 500ms forwards}@keyframes bounceOut{0%{transform:translateY(0);opacity:1}50%{transform:translateY(-10px);opacity:1}100%{transform:translateY(0);opacity:0}}.userlist .avatar,.user-item .avatar{width:24px;height:24px;display:inline-flex}.userlist .avatar img,.user-item .avatar img{border-radius:.2em !important;transform-origin:left;transition:transform .15s}.userlist .avatar img:hover,.user-item .avatar img:hover{transform:scale(2);z-index:2}.chat-logs-panel .message-text a,.cached-messages-panel .message-text a{color:#deb887 !important;transition:color .15s ease-in-out}.chat-logs-panel .message-text a:hover,.cached-messages-panel .message-text a:hover{color:#fafad2 !important}.empowerment-panel{position:fixed;width:48px;top:200px;right:15px;display:flex;flex-direction:column;z-index:1000;gap:.2em;align-items:start}.empowerment-panel .empowerment-panel-move-handle{display:flex;justify-content:center;align-items:center;opacity:0;background-color:rgba(0,0,0,.2);border-radius:.2em !important;width:20px;height:20px;cursor:pointer;transition:opacity .2s,background-color .2s;pointer-events:auto}.empowerment-panel:hover .empowerment-panel-move-handle,.empowerment-panel .empowerment-panel-move-handle:focus,.empowerment-panel .empowerment-panel-move-handle:hover{opacity:1}.participant-count{filter:grayscale(100%);transition:.2s ease-in-out;font-family:"Orbitron",sans-serif;font-size:24px;color:#83cf40;background-color:#2b4317;width:48px;height:48px;display:flex;justify-content:center;align-items:center;border:1px solid #4b7328;cursor:default}.pulse-effect{animation:pulse 500ms ease-out}@keyframes pulse{0%{filter:brightness(1)}50%{filter:brightness(1.5)}100%{filter:brightness(1)}}.shake-effect{animation:shake 500ms cubic-bezier(0.36, 0.07, 0.19, 0.97) both}@keyframes shake{0%{transform:translateX(0)}10%{transform:translateX(-4px)}20%{transform:translateX(6px)}30%{transform:translateX(-8px)}40%{transform:translateX(8px)}50%{transform:translateX(-6px)}60%{transform:translateX(5px)}70%{transform:translateX(-3px)}80%{transform:translateX(2px)}90%{transform:translateX(-1px)}100%{transform:translateX(0)}}.custom-tooltip-popup{position:fixed;background:#161616;color:#dedede;padding:.5em;z-index:1200;font-size:.9em;pointer-events:none;white-space:nowrap;opacity:0;transition:opacity .1s;display:none;flex-direction:column;left:0;top:0;border:1px solid #3c3c3c !important;border-radius:4px !important;box-shadow:0 2px 5px rgba(0,0,0,.3) !important}.custom-tooltip-popup .tooltip-item{display:inline-flex !important;align-items:center !important}.custom-tooltip-popup .tooltip-action{font-weight:500 !important;color:hsl(100,50%,50%) !important}.static-chat-notification{cursor:default;white-space:nowrap;padding:8px;display:inline-flex;flex:0 auto;justify-content:center;margin:4px;font-size:1em;align-items:center;border-radius:4px !important}.dynamic-chat-notifications-container{z-index:1000;width:0;position:fixed;display:flex;flex-direction:column;top:0;bottom:0;left:0;right:0;padding-top:160px}.dynamic-chat-notification{cursor:default;white-space:nowrap;position:relative;align-items:center;width:fit-content;display:flex;margin-bottom:.2em;padding:8px 16px 8px 12px;border-radius:0 4px 4px 0 !important;left:0;transform:translateX(-100%);opacity:1;transition:transform .3s cubic-bezier(0.83, 0, 0.17, 1),opacity .3s cubic-bezier(0.83, 0, 0.17, 1)}.user-enter{color:hsl(100,50%,50%) !important;background-color:hsl(100,50%,10%) !important;border:1px solid hsl(100,50%,25%) !important}.user-left{color:hsl(0,50%,70%) !important;background-color:hsl(0,50%,15%) !important;border:1px solid #933 !important}.clickable-thumbnail{display:flex !important;opacity:1;transition:opacity .15s ease-in-out;border:none !important;max-width:150px;max-height:150px;cursor:pointer;background-color:rgba(0,0,0,0);margin:6px;overflow:hidden !important}.clickable-thumbnail img{max-height:100%;max-width:100%;background-color:rgba(0,0,0,0);object-fit:contain}.clickable-thumbnail:hover{opacity:.8}.scaled-thumbnail{top:50%;left:50%;transform-origin:center center;transform:translate(-50%, -50%) scale(1);position:fixed;opacity:0;z-index:1000;transform-origin:center center;max-height:90vh;max-width:90vw;cursor:pointer;border-radius:.6em !important;box-shadow:0 4px 6px rgba(0,0,0,.3),0 1px 3px rgba(0,0,0,.28) !important}.video-wrapper{display:flex;flex-direction:column}.video-wrapper .processed-video{margin-bottom:.2em !important}.video-wrapper .youtube-info{display:flex;flex-direction:column;margin-bottom:.2em;font-family:"Montserrat",sans-serift;font-size:.9em;color:#8ede87;font-weight:500;white-space:break-spaces}.video-container,.youtube-thumb{border-radius:.4em !important;display:flex;border:none;height:200px !important;width:356px !important}.youtube-thumb{cursor:pointer !important;object-fit:cover !important}.dimming-background{background:#000;top:0;left:0;right:0;bottom:0;position:fixed;opacity:0;z-index:998}.profile-iframe-container{opacity:0;border:none;display:flex;position:fixed;z-index:1001;width:1080px !important;min-width:1080px !important;height:80vh;top:48.5vh;left:50vw;transform:translate(-50%, -50%);box-shadow:0 4px 6px rgba(0,0,0,.1),0 1px 3px rgba(0,0,0,.08) !important;border-radius:.6em !important}.scroll-buttons-container{display:flex;justify-content:center;grid-area:scroll;flex-direction:column;height:calc(100% - 1em);padding:1em}.scroll-buttons-container .scroll-button{margin:.25em 0;background-color:rgba(222,222,222,.1)}.large-button{width:48px;height:48px;display:flex;justify-content:center;align-items:center;cursor:pointer;border-radius:.2em !important;filter:brightness(1);transition:filter .3s ease,opacity .3s ease}.large-button:hover{filter:brightness(0.8)}.panel-control-buttons{display:flex}.panel-control-buttons>div:not(:last-child){margin-right:.5em}.panel-header-parse-button{background-color:hsl(150,40%,25%)}.panel-header-clear-button{background-color:brown}.panel-header-close-button{background-color:#556b2f}.panel-header-save-button{display:none;opacity:0;visibility:hidden;background-color:#2f6b63}.panel-header-import-button{background-color:#502f6b}.panel-header-export-button{background-color:#2f4c6b}.panel-header-copy-button,.panel-header-date-button{background-color:#4682b4}.panel-header-toggle-button{background-color:#144e9d}.panel-header-toggle-media-messages-button{background-color:#2f4f4f !important}.panel-header-toggle-media-messages-button svg{stroke:#71c4c4 !important}.panel-header-toggle-media-messages-button.active{background-color:#71c4c4 !important}.panel-header-toggle-media-messages-button.active svg{stroke:#2f4f4f !important}.panel-header-toggle-mention-messages-button{background-color:#8b4513 !important}.panel-header-toggle-mention-messages-button svg{stroke:#ffa07a !important}.panel-header-toggle-mention-messages-button.active{background-color:#ffa07a !important}.panel-header-toggle-mention-messages-button.active svg{stroke:#8b4513 !important}.panel-header-one-day-back-button,.panel-header-one-day-forward-button{background-color:#008b8b}.panel-header-shuffle-button{background-color:hsl(250,40%,40%)}.panel-header-shuffle-button.today{background-color:hsl(50,100%,15%)}#chat-general .userlist-content{opacity:0}#chat-general .smile-tab{position:relative;z-index:1}.chat-user-list{display:flex;flex-direction:column;position:absolute;top:20px;padding-top:8px;width:200px;height:calc(100% - 35px) !important;overflow-y:auto;overflow-x:hidden}.chat-user-list [class^=rank-group]{display:flex;flex-direction:column}.chat-user-list [class^=user]{display:inline-flex;margin:2px 0}.chat-user-list .name{text-decoration:none;display:inline-flex;width:auto;height:24px;line-height:24px;padding:0 8px;max-width:124px;overflow:hidden;text-overflow:ellipsis}.chat-user-list .name:hover{text-decoration:underline}.chat-user-list .profile,.chat-user-list .tracked,.chat-user-list .ignored,.chat-user-list .moderator{display:inline-flex;width:24px;height:24px;justify-content:center;align-items:center}.mention{display:inline-flex;color:#83cf40;font-family:Roboto Mono,monospace;font-weight:bold}.popup-messages-container{display:flex;flex-direction:column;justify-content:flex-end;align-items:start;user-select:none;pointer-events:none;position:fixed;left:0;right:0;top:50px;bottom:0}.popup-chat-message{display:flex;align-items:center;background-color:hsl(100,50%,10%);position:relative;max-width:70vw;border-radius:.2em !important;color:hsl(100,50%,50%);border:1px solid hsl(100,50%,25%);padding:4px;margin:6px 15vw;opacity:0;transform:translateY(20px);transition:opacity .3s ease-in-out,transform .3s ease-in-out;animation:fadeIn .3s ease-in-out forwards}.popup-chat-message>div{padding:2px;display:inline-flex;flex-wrap:wrap;font-family:"Montserrat",sans-serif}.popup-chat-message .time,.popup-chat-message .time-icon{opacity:.7}.popup-chat-message.fade-out{animation:fadeOut .3s ease-in-out forwards}@media(max-width: 1000px){.popup-chat-message{flex-wrap:wrap;align-items:flex-start}.popup-chat-message .message{flex-basis:100%;order:1}}@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes fadeOut{from{opacity:1;transform:translateY(0)}to{opacity:0;transform:translateY(-20px)}}.voice-settings{position:absolute;top:65px;right:70px;opacity:0;transition:opacity .3s ease;font-family:Orbitron,sans-serif}.voice-settings .voice-value-info{display:flex;width:100%;justify-content:center;margin-bottom:6px}.voice-settings .voice-speed{color:hsl(100,50%,50%)}.voice-settings .voice-speed-progress{display:block;width:120px;height:12px;background-color:hsl(90,60%,30%)}.voice-settings .voice-speed-progress .voice-speed-progress-fill{display:block;height:100%;background-color:hsl(90,60%,50%)}.voice-settings .voice-pitch{color:#3cc}.voice-settings .voice-pitch-progress{display:block;width:120px;height:12px;background-color:hsl(180,60%,30%)}.voice-settings .voice-pitch-progress .voice-pitch-progress-fill{display:block;height:100%;background-color:#3cc}@media(max-width: 991px){.scroll-buttons-container{position:absolute !important;right:.5em !important;justify-content:end !important}}@media(max-width: 630px){.scroll-buttons-container{display:none !important}}',""]);const i=a},56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72:e=>{var t=[];function n(e){for(var n=-1,o=0;o<t.length;o++)if(t[o].identifier===e){n=o;break}return n}function o(e,o){for(var r={},a=[],i=0;i<e.length;i++){var l=e[i],c=o.base?l[0]+o.base:l[0],d=r[c]||0,u="".concat(c," ").concat(d);r[c]=d+1;var m=n(u),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==m)t[m].references++,t[m].updater(p);else{var g=s(p,o);o.byIndex=i,t.splice(i,0,{identifier:u,updater:g,references:1})}a.push(u)}return a}function s(e,t){var n=t.domAPI(t);n.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,s){var r=o(e=e||[],s=s||{});return function(e){e=e||[];for(var a=0;a<r.length;a++){var i=n(r[a]);t[i].references--}for(var l=o(e,s),c=0;c<r.length;c++){var d=n(r[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}r=l}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",o=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),o&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),o&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,o,s,r){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(o)for(var i=0;i<this.length;i++){var l=this[i][0];null!=l&&(a[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);o&&a[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),s&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=s):d[4]="".concat(s)),t.push(d))}},t}},324:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(601),s=n.n(o),r=n(314),a=n.n(r)()(s());a.push([e.id,'.toggle-button-hidden{background-color:hsl(0,20%,10%);color:hsl(0,50%,50%);border:1px solid hsl(0,50%,50%)}.toggle-button-show{background-color:hsl(90,20%,10%);color:hsl(90,50%,50%);border:1px solid hsl(90,50%,50%)}.toggle-button-hide{background-color:hsl(50,20%,10%);color:hsl(50,50%,50%);border:1px solid hsl(50,50%,50%)}.delete-btn{z-index:999;padding:8px 16px;transition:all .3s;cursor:pointer;filter:brightness(1);border-radius:.2em !important}.delete-btn.message-mode{background-color:hsl(0,50%,20%);color:hsl(0,60%,70%);border:1px solid hsl(0,50%,35%)}.delete-btn.username-mode{background-color:hsl(145,50%,20%);color:hsl(145,60%,70%);border:1px solid hsl(145,50%,35%)}.delete-btn.time-mode{background-color:hsl(200,50%,20%);color:hsl(200,60%,70%);border:1px solid hsl(200,50%,35%)}.delete-btn:hover{filter:brightness(1.5)}.selected-message{background-clip:padding-box !important}.selected-message.message-mode{background-color:hsla(0,50%,50%,.2) !important;box-shadow:inset 0px 0px 0px 1px hsla(0,50%,50%,.4) !important}.selected-message.username-mode{background-color:hsla(145,50%,30%,.2) !important;box-shadow:inset 0px 0px 0px 1px hsla(145,50%,50%,.4) !important}.selected-message.time-mode{background-color:hsla(200,50%,30%,.2) !important;box-shadow:inset 0px 0px 0px 1px hsla(200,50%,50%,.4) !important}.shown-message{background-color:hsla(30,60%,30%,.2) !important;box-shadow:inset 0px 0px 0px 1px hsla(30,60%,50%,.4) !important;background-clip:padding-box !important}.hidden-message{display:none}.toggle-button{font:bold .9em "Montserrat",sans-serif;position:absolute;top:0;right:2em;padding:8px 16px;transition:filter .3s;border-radius:0 0 .2em .2em !important;border-top:none;min-width:4em}.toggle-button.toggle-hidden{background:linear-gradient(to top, hsl(0, 50%, 20%), hsl(0, 50%, 25%));color:hsl(0,60%,70%);border-left:1px solid hsl(0,50%,35%);border-right:1px solid hsl(0,50%,35%);border-bottom:1px solid hsl(0,50%,35%)}.toggle-button.toggle-shown{background:linear-gradient(to top, hsl(30, 50%, 20%), hsl(30, 50%, 25%));color:hsl(30,60%,70%);border-left:1px solid hsl(30,50%,35%);border-right:1px solid hsl(30,50%,35%);border-bottom:1px solid hsl(30,50%,35%)}.toggle-button:hover{filter:brightness(1.5)}',""]);const i=a},336:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(601),s=n.n(o),r=n(314),a=n.n(r)()(s());a.push([e.id,'.messages-parser-date-indicator{transition:.2s ease-in-out;font-family:"Montserrat",sans-serif;font-size:1.5em;font-weight:500;font-variant-numeric:tabular-nums;padding:8px 12px;min-width:60px;display:flex;justify-content:center;align-items:center;cursor:default;border-radius:.2em !important}.messages-parser-progress-container{position:fixed;display:flex;flex-direction:column;top:50px;right:5px;gap:10px;user-select:none;pointer-events:none;z-index:3000;background:none;background-color:rgba(0,0,0,.5);padding:1em;border-radius:.5em !important}.messages-parser-date-indicator{color:hsl(88,50%,55%);background-color:hsl(88,40%,20%);border:1px solid hsl(88,45%,35%);min-width:120px;justify-content:flex-start}.messages-parser-progress-bar{height:18px;width:100%;background:hsl(50,0%,15%);border:1px solid hsl(50,0%,30%);border-radius:.2em !important;overflow:hidden;display:flex;align-items:center}.messages-parser-progress-bar-inner{height:100%;background:linear-gradient(90deg, hsl(88, 50%, 55%) 0%, hsl(208, 50%, 70%) 100%);transition:width .3s cubic-bezier(0.4, 0, 0.2, 1);border-radius:.2em !important}.messages-parser-progress-label{display:inline-flex;justify-content:center;color:hsl(88,50%,55%);font-size:1em;font-weight:400}',""]);const i=a},365:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(601),s=n.n(o),r=n(314),a=n.n(r)()(s());a.push([e.id,'.cached-users-panel{opacity:0;background-color:#1b1b1b;border-radius:.6em !important;position:fixed;top:100px;left:50%;transform:translateX(-50%);width:80vw;height:80vh;z-index:1000;display:grid;grid-template-columns:1fr;grid-template-rows:auto auto 1fr;grid-template-areas:"header header" "sort sort" "cache scroll"}.cached-users-panel .panel-header{display:flex;flex-direction:row;justify-content:space-between;padding:.6em;grid-area:header}.cached-users-panel .drop-time{display:flex;justify-content:center;align-items:center;min-width:fit-content}.cached-users-panel .drop-time-threshold-description{padding:.6em;color:#c6b209}.cached-users-panel .drop-time-threshold{padding:.6em;color:#f08080;font-family:"Roboto Mono",monospace;font-size:1.1em;font-weight:bold;border-radius:.2em !important;border:1px solid rgba(240,128,128,.2);background-color:rgba(240,128,128,.05);transition:filter .3s;filter:sepia(0);cursor:pointer}.cached-users-panel .drop-time-threshold:hover{filter:sepia(1)}.cached-users-panel .drop-time-expiration-description{padding:.6em;color:#d0562c}.cached-users-panel .drop-time-expiration{padding:.6em;color:#faebd7;font-family:"Roboto Mono",monospace;font-size:1.1em}.cached-users-panel .search-for-cached-users{width:100%;margin:0 .5em;display:flex}.cached-users-panel .cached-users-search-input{outline:none;height:48px;width:100%;padding:10px;font-size:1em !important;font-family:"Montserrat" !important;color:bisque !important;border-radius:.2em !important;box-sizing:border-box;background-color:#111 !important;border:1px solid #222 !important}.cached-users-panel .sort-buttons-container{display:flex;gap:5px;margin:0 .6em .6em;height:fit-content;grid-area:sort}.cached-users-panel .sort-buttons-container .sort-button{padding:5px 10px;background-color:#333;border:none !important;cursor:pointer;border-radius:3px !important;height:fit-content}.cached-users-panel .sort-buttons-container .sort-button.active{background-color:#555}.cached-users-panel .fetched-users{display:grid;grid-template-rows:1fr 1fr;height:fit-content;max-height:calc(100% - .5em);overflow-y:auto;grid-area:cache}.cached-users-panel .users-container{display:grid;grid-template-columns:repeat(auto-fill, minmax(220px, 1fr));gap:12px;padding:1em;height:fit-content}.cached-users-panel .description{color:bisque;font-family:Montserrat;font-size:1em;margin:0;padding:.4em .2em;grid-column:1/-1;height:fit-content}.cached-users-panel .user-item{display:grid;grid-template-columns:auto 1fr;align-items:center;height:fit-content;gap:.6em;margin-bottom:1em}.cached-users-panel .visits{margin-left:8px;padding:4px 6px;border-radius:2px !important;cursor:pointer;white-space:pre}.cached-users-panel .visits.tracked{color:#adff2f;background-color:#003500;border:1px solid #006400;font-weight:bold}.cached-users-panel .visits.untracked{color:orange;background-color:#111;font-weight:normal}.cached-users-panel .action-log{position:fixed;opacity:0;padding:8px;gap:4px;top:50%;left:50%;transform:translate(-50%, -50%);max-height:85vh;overflow-y:auto;scrollbar-width:none;overflow-x:hidden;display:flex;flex-wrap:wrap;background-color:#111;justify-content:center;border:3px dashed #212121;box-shadow:0 4px 6px rgba(0,0,0,.1),0 1px 3px rgba(0,0,0,.08) !important;border-radius:.2em !important}.cached-users-panel .rank{padding:2px 0}.cached-users-panel .registered{color:#5f9ea0;font-size:12px}.cached-users-panel .user-metrics{display:inline-flex;grid-column:span 2;white-space:nowrap}.cached-users-panel .user-metrics span{margin-right:.2em !important}.cached-users-panel .avatar{font-size:2rem}.cached-users-panel .avatar img{height:24px;width:24px}.cached-users-panel .present-marker{display:inline-flex;width:8px;height:8px;margin-right:4px;border-radius:50% !important;position:relative}.cached-users-panel .present-marker::before{content:"";position:absolute;top:0;left:40%;transform:translateX(-50%);width:6px;height:6px;border-radius:50% !important;background:radial-gradient(circle, hsla(0, 0%, 100%, 0.7) 20%, hsla(0, 0%, 100%, 0) 100%);pointer-events:none}.cached-users-panel .present-marker.waiting{background-color:hsl(0,0%,50%);box-shadow:0 1px 3px 0 hsla(0,0%,15%,.5),0 0 0 1px hsla(0,0%,15%,.1) inset,0 2px 6px 0 hsla(0,0%,15%,.25) !important}.cached-users-panel .present-marker.online{background-color:hsl(80,80%,50%);box-shadow:0 1px 3px 0 hsla(80,80%,15%,.5),0 0 0 1px hsla(80,80%,15%,.1) inset,0 2px 6px 0 hsla(80,80%,15%,.25) !important}.cached-users-panel .present-marker.offline{background-color:hsl(350,80%,50%);box-shadow:0 1px 3px 0 hsla(350,80%,15%,.5),0 0 0 1px hsla(350,80%,15%,.1) inset,0 2px 6px 0 hsla(350,80%,15%,.25) !important}.cached-users-panel .login{color:skyblue !important;text-decoration:none;font-family:"Montserrat",sans-serif;transition:color .3s ease}.cached-users-panel .login:hover{color:#fff8dc !important}@media(max-width: 1199px){.cached-users-panel{width:90vw;height:85vh;min-width:unset}}@media(max-width: 991px){.cached-users-panel{width:95vw;height:90vh;grid-template-columns:1fr;grid-template-rows:min-content auto;grid-template-areas:"header" "cache"}.cached-users-panel .panel-header{flex-wrap:wrap}.cached-users-panel .search-for-cached-users{margin:.5em 0;order:1}.cached-users-panel .users-container{grid-template-columns:repeat(auto-fill, minmax(180px, 1fr))}}@media(max-width: 576px){.cached-users-panel{width:100vw;height:100vh;top:0;left:0;transform:none;border-radius:0 !important}.cached-users-panel .panel-header{padding:.5em}.cached-users-panel .drop-time-threshold,.cached-users-panel .drop-time-expiration{padding:.4em}.cached-users-panel .users-container{grid-template-columns:repeat(auto-fill, minmax(140px, 1fr));gap:8px;padding:.5em}.cached-users-panel .user-item{gap:.4em;margin-bottom:1em}.cached-users-panel .avatar{font-size:1.4rem}.cached-users-panel .avatar img{height:20px;width:20px}.cached-users-panel .login{font-size:.9em}.cached-users-panel .visits{font-size:.8em;padding:2px 4px}.cached-users-panel .registered{font-size:10px}}@media(max-width: 576px)and (max-width: 520px){.cached-users-panel .drop-time-threshold-description,.cached-users-panel .drop-time-expiration-description{display:none !important}}@media(max-width: 576px)and (max-width: 320px){.cached-users-panel .drop-time{display:none !important}.cached-users-panel .panel-control-buttons{width:100% !important;justify-content:end !important}}.fetch-mode-button{background-color:#b2a4f9}.fetch-mode-button svg{stroke:#483d8b}.cache-mode-button{background-color:#483d8b}.cache-mode-button svg{stroke:#b2a4f9}.cache-user-count{display:flex;position:absolute;justify-content:center;align-items:center;left:0;bottom:0;transform:translate(-50%, 50%);z-index:1;height:20px;padding:0 4px;border-radius:2px !important;background-color:#9db380;color:#020202;font-size:12px;font-family:Roboto,sans-serif;font-weight:bold}',""]);const i=a},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},601:e=>{e.exports=function(e){return e[1]}},629:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(601),s=n.n(o),r=n(314),a=n.n(r)()(s());a.push([e.id,'.settings-panel{opacity:0;background-color:#1b1b1b;border-radius:.6em !important;position:fixed;top:100px;left:50%;transform:translateX(-50%);width:50vw;height:80vh;z-index:1000;min-width:1000px;display:grid;grid-template-columns:1fr;grid-template-rows:min-content;grid-template-areas:"header header" "settings scroll"}.settings-panel .panel-header{display:flex;flex-direction:row;justify-content:flex-end;padding:.6em;grid-area:header}.settings-panel .settings-content-container{overflow-y:auto;height:calc(100% - .5em);padding:1em;grid-area:settings}.settings-panel .settings-description{position:relative;font:1em Montserrat;color:#deb887;background-color:rgba(222,184,135,.1);width:fit-content;margin:0 0 1em;padding:.4em .8em;border-radius:.4em !important;left:50%;transform:translateX(-50%)}.settings-panel .settings-spoiler button{display:inline-flex !important;position:relative;font:1em Montserrat;color:#90ee90;background-color:rgba(222,184,135,.1);margin:0 0 3em 0;padding:.4em .8em;border-radius:.4em !important;left:50%;transform:translateX(-50%);cursor:pointer;transition:background-color .3s ease;border:none}.settings-panel .settings-spoiler button:hover{background-color:rgba(222,184,135,.25)}.settings-panel .replacement-item{background-color:#111 !important;padding:.5em !important;border-radius:.4em !important}.settings-panel .settings-field{height:30px;max-width:200px;min-width:150px;padding:.4em;font:1em Montserrat;font-family:Montserrat;color:bisque;border-radius:.2em !important;box-sizing:border-box;background-color:#111;border:1px solid #222}.settings-panel .settings-button{width:30px;height:30px;display:flex;justify-content:center;align-items:center;border-radius:.2em !important;cursor:pointer;transition:filter .3s;filter:brightness(1)}.settings-panel .settings-button:hover{filter:brightness(0.8)}.settings-panel .settings-button.disabled{filter:grayscale(1);pointer-events:none;opacity:.5}.settings-panel select{height:30px;min-width:105px;max-width:120px;padding:.4em;font:1em Montserrat,sans-serif;color:bisque !important;border-radius:.2em !important;box-sizing:border-box;background-color:#111 !important;border:1px solid #222 !important}.settings-panel option{height:30px;background-color:#111 !important;color:bisque !important;font-family:"Montserrat",sans-serif}.settings-panel .confirm-settings-button{stroke:hsl(60,40%,80%);background-color:hsl(60,40%,30%);border:1px solid hsl(60,40%,40%)}.settings-panel .remove-settings-button{stroke:hsl(0,40%,80%);background-color:hsl(0,40%,30%);border:1px solid hsl(0,40%,40%)}.settings-panel .assigned-settings-button{stroke:hsl(215,40%,80%);background-color:hsl(215,40%,30%);border:1px solid hsl(215,40%,40%)}.settings-panel .add-settings-button{stroke:hsl(280,40%,80%);background-color:hsl(280,40%,30%);border:1px solid hsl(280,40%,40%)}.settings-panel .toggle-item{display:inline-flex;align-items:center;gap:1em}.settings-panel .toggle-description{cursor:pointer;color:#deb887;transition:color .15s ease-in-out}.settings-panel .toggle-description:hover{color:#fafad2}.settings-panel .settings-container{width:100%;gap:.4em;display:inline-flex;flex-wrap:wrap;align-items:center;margin-bottom:4em}.settings-panel .settings-userColors-container{display:flex;flex-direction:column;gap:.6em}.settings-panel .settings-userColors-container .userColors-search-container{display:flex;align-items:center;gap:.4em;width:100%}.settings-panel .settings-userColors-container .userColors-search-container .userColors-search-field{width:100%;max-width:100%;margin:0}.settings-panel .settings-userColors-container .settings-userColors-items-container{width:100%;max-width:100%;display:grid;grid-template-columns:repeat(auto-fit, minmax(255px, 1fr));gap:.6em;align-items:start}.settings-panel .settings-userColors-container .settings-userColors-items-container .userColors-item{display:flex !important;flex-direction:column;width:100%;background-color:#111 !important;padding:.8em !important;border-radius:.4em !important;gap:.6em}.settings-panel .settings-userColors-container .settings-userColors-items-container .userColors-item.userColors-hidden{display:none !important}.settings-panel .settings-userColors-container .settings-userColors-items-container .userColors-item .userColors-content-wrapper{display:flex;flex-direction:column;gap:.6em}.settings-panel .settings-userColors-container .settings-userColors-items-container .userColors-item .userColors-content-wrapper .userColors-username-display{font:1em Montserrat;color:#deb887;font-weight:500}.settings-panel .settings-userColors-container .settings-userColors-items-container .userColors-item .userColors-controls-row{display:inline-flex;gap:.4em;align-items:center;flex-wrap:wrap}.settings-panel .settings-userColors-container .settings-userColors-items-container .userColors-item .userColors-header-row{display:flex;align-items:center;gap:.6em}.settings-panel .settings-userColors-container .settings-userColors-items-container .userColors-item .userColors-user-badge{margin-left:.2em;background:hsl(200,30%,20%);color:bisque;display:inline-flex;align-items:center;justify-content:center;width:24px;height:24px;padding:0;border-radius:.2em}.settings-panel .settings-userColors-container .settings-userColors-items-container .userColors-item .userColors-user-badge svg{width:14px;height:14px;display:block}.settings-panel .settings-userColors-container .settings-userColors-items-container .userColors-item .userColors-avatar{width:24px;height:24px;border-radius:.2em !important;overflow:hidden;display:inline-flex;align-items:center;justify-content:center;background-color:rgba(0,0,0,0)}.settings-panel .settings-userColors-container .settings-userColors-items-container .userColors-item .userColors-avatar-img{width:100%;height:100%;display:block;object-fit:cover}.settings-panel .settings-userColors-container .settings-userColors-items-container .userColors-item .userColors-avatar-emoji{width:100%;height:100%;display:inline-flex;align-items:center;justify-content:center;font-size:2rem}.settings-panel .settings-userColors-container .settings-userColors-items-container .userColors-item .userColors-color-swatch{width:30px;height:30px;border-radius:.2em !important;cursor:pointer;transition:transform .08s ease}.settings-panel .settings-userColors-container .settings-userColors-items-container .userColors-item .userColors-color-swatch:hover{transform:scale(1.05)}.settings-panel .settings-toggle-container{align-items:start !important;flex-direction:column}.settings-panel [class$=item]{display:inline-flex;gap:.4em}@media(max-width: 1199px){.settings-panel{width:90vw;height:85vh;min-width:unset}.settings-panel .settings-field,.settings-panel select{max-width:180px}}@media(max-width: 991px){.settings-panel{width:95vw;height:90vh;grid-template-columns:1fr;grid-template-rows:min-content auto;grid-template-areas:"header" "settings"}.settings-panel .panel-header{flex-wrap:wrap}.settings-panel .settings-field,.settings-panel select{max-width:160px;min-width:120px}.settings-panel .settings-container{flex-direction:column;align-items:flex-start}}@media(max-width: 576px){.settings-panel{width:100vw;height:100vh;top:0;left:0;transform:none;border-radius:0 !important}.settings-panel .settings-description,.settings-panel .toggle-description{font-size:.9em}.settings-panel .settings-container{flex-direction:column;gap:.2em;margin-bottom:2em}.settings-panel .toggle-item{gap:.5em}.settings-panel [class$=item]{gap:.2em}}',""]);const i=a},659:e=>{var t={};e.exports=function(e,n){var o=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},805:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(601),s=n.n(o),r=n(314),a=n.n(r)()(s());a.push([e.id,'.chat-logs-button{position:relative;z-index:1}.chat-logs-panel{opacity:0;background-color:#1b1b1b;border-radius:.6em !important;position:fixed;top:100px;left:50%;transform:translateX(-50%);width:80vw;height:80vh;z-index:1000;min-width:1000px;display:grid;grid-template-columns:1fr;grid-template-rows:min-content;grid-template-areas:"header header header" "messages scroll users"}.chat-logs-panel .panel-header{display:flex;flex-direction:row;grid-area:header;justify-content:flex-end;padding:.6em}.chat-logs-panel .panel-control-buttons{display:flex}.chat-logs-panel .search-for-chatlogs-messages{width:100%;margin:0 .5em 0 0;display:flex}.chat-logs-panel .chatlogs-search-input{outline:none;height:48px;width:100%;padding:10px;font-size:1em;font-family:Montserrat;color:bisque !important;border-radius:.2em !important;box-sizing:border-box;background-color:#111;border:1px solid #222 !important}.chat-logs-panel .chatlogs-date-input{background-color:#111;color:bisque;border:1px solid #222;width:fit-content;height:48px;padding:10px;font-size:1em;font-family:Montserrat;border-radius:.2em !important;box-sizing:border-box;margin-right:.5em}.chat-logs-panel .chat-logs-container{overflow-y:auto;overflow-x:hidden;height:calc(100% - .5em);padding:1em;display:flex;grid-area:messages;flex-direction:column}.chat-logs-panel .message-item{padding:.2em;display:inline-flex;cursor:pointer;align-items:start}.chat-logs-panel .message-time{color:#8fbc8f;margin:0 .4em;cursor:pointer;transition:color .2s ease;height:fit-content}.chat-logs-panel .message-time:hover{color:#90ee90}.chat-logs-panel .message-username{cursor:pointer;margin:0 .4em;height:fit-content}.chat-logs-panel .message-text{color:hsl(0,10%,70%);margin:0 .4em;overflow-wrap:anywhere;height:fit-content}.chat-logs-panel .active-users{padding:1em;height:calc(100% - 1em);width:fit-content;overflow-y:auto;overflow-x:hidden;grid-area:users;display:flex;flex-direction:column}.chat-logs-panel .active-users .active-user-item{display:flex;height:fit-content;align-items:center;justify-content:left;margin:.2em 0;cursor:pointer;transition:filter .15s}.chat-logs-panel .active-users .active-user-item:hover{filter:brightness(0.8)}.chat-logs-panel .active-users .active-user-item .active-user-name{padding:.4em}.chat-logs-panel .active-users .active-user-item .active-user-messages-count{padding:.4em;border-radius:.2em !important}.chat-logs-panel .saved-chatlog-url{color:#8fbc8f !important;text-decoration:none;display:inline-flex;padding:.5em}.chat-logs-panel .saved-chatlog-url-title{color:#b0c4de;padding:.5em}.chat-logs-panel .saved-chatlog-container{display:flex;flex-direction:column;overflow-y:auto;background-color:#1e282d;border:1px solid #3c4650 !important;border-radius:.2em !important;position:absolute;padding:.5em;height:fit-content;width:max-content;max-height:400px;top:calc(50px + 1em);right:0}@media(max-width: 1199px){.chat-logs-panel{width:90vw;height:85vh;min-width:unset}.chat-logs-panel .active-users{width:200px}}@media(max-width: 991px){.chat-logs-panel{width:95vw;height:90vh;grid-template-columns:1fr;grid-template-rows:min-content auto auto;grid-template-areas:"header" "messages" "users"}.chat-logs-panel .active-users{width:100%;height:auto;max-height:200px;overflow-y:auto}.chat-logs-panel .panel-header{flex-direction:column;align-items:flex-start}.chat-logs-panel .search-for-chatlogs-messages{width:100%;margin-bottom:.5em}.chat-logs-panel .panel-control-buttons{width:100%;justify-content:center}.chat-logs-panel .active-users,.chat-logs-panel .panel-header-toggle-button{display:none !important}}@media(max-width: 576px){.chat-logs-panel{width:100vw;height:100vh;top:0;left:0;transform:none;border-radius:0 !important}.chat-logs-panel .panel-header{padding:.5em}.chat-logs-panel .active-users{display:none}.chat-logs-panel .message-item{padding:.1em}.chat-logs-panel .message-time,.chat-logs-panel .message-username,.chat-logs-panel .message-text{margin:0 .2em;font-size:.9em}.chat-logs-panel .video-container,.chat-logs-panel .youtube-thumb{transform-origin:top left;transform:scale(0.8)}.chat-logs-panel .toggle-mention-messages-counter,.chat-logs-panel .toggle-media-messages-counter{font-size:10px}.chat-logs-panel .saved-chatlog-container{max-height:300px}}.toggle-mention-messages-counter,.toggle-media-messages-counter{display:flex;position:absolute;justify-content:center;align-items:center;padding:2px 4px;border-radius:2px !important;font-size:12px;font-family:Roboto;font-weight:bold;bottom:0px;left:0px;transform:translate(-50%, 50%);color:#020202;pointer-events:none;user-select:none}.toggle-mention-messages-counter{background-color:#ffa07a;box-shadow:0 0 4px rgba(0,0,0,.5) !important}.toggle-media-messages-counter{background-color:#71c4c4;box-shadow:0 0 4px rgba(0,0,0,.5) !important}',""]);const i=a},807:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(601),s=n.n(o),r=n(314),a=n.n(r)()(s());a.push([e.id,'.personal-messages-button{position:relative;z-index:2}.personal-messages-button .message-count{display:flex;position:absolute;justify-content:center;align-items:center;height:20px;padding:0 4px;border-radius:2px !important;color:#020202;font-size:12px;font-family:Roboto,sans-serif;font-weight:bold;bottom:0}.personal-messages-button .total-message-count{left:0;transform:translate(-50%, 50%);background-color:salmon}.personal-messages-button .new-message-count{right:0;transform:translate(50%, 50%);background-color:gold}.cached-messages-panel{opacity:0;background-color:#1b1b1b;border-radius:.6em !important;position:fixed;top:100px;left:50%;transform:translateX(-50%);width:50vw;height:80vh;z-index:1000;min-width:1000px;display:grid;grid-template-columns:1fr;grid-template-rows:min-content;grid-template-areas:"header header" "messages scroll"}.cached-messages-panel .panel-header{display:flex;flex-direction:row;justify-content:flex-end;padding:.6em;grid-area:header}.cached-messages-panel .search-for-personal-messages{width:100%;margin:0 .5em 0 0;display:flex}.cached-messages-panel .personal-messages-search-input{outline:none;height:48px;width:100%;padding:10px;font-size:1em;font-family:Montserrat,sans-serif;color:bisque !important;border-radius:.2em !important;box-sizing:border-box;background-color:#111;border:1px solid #222 !important}.cached-messages-panel .messages-container{overflow-y:auto;height:calc(100% - .5em);padding:1em;grid-area:messages}.cached-messages-panel .message-item{padding:.2em}.cached-messages-panel .message-time{display:inline-flex;margin:0px .4em;height:fit-content;cursor:pointer;transition:color .2s ease}.cached-messages-panel .message-username{display:inline-flex;cursor:pointer;margin:0px .4em;height:fit-content}.cached-messages-panel .message-text{cursor:pointer;margin:0px .4em;height:fit-content}@media(max-width: 1199px){.cached-messages-panel{width:90vw;height:85vh;min-width:unset}}@media(max-width: 991px){.cached-messages-panel{width:95vw;height:90vh;grid-template-columns:1fr;grid-template-rows:min-content auto;grid-template-areas:"header" "messages"}.cached-messages-panel .panel-header{flex-direction:column;align-items:flex-start}.cached-messages-panel panel-control-buttons .search-for-personal-messages{width:100%;margin-right:0;margin-bottom:.5em}.cached-messages-panel .panel-control-buttons{width:100%;justify-content:center}}@media(max-width: 630px){.cached-messages-panel .panel-header-date-button,.cached-messages-panel .chatlogs-date-input{display:none !important}}@media(max-width: 576px){.cached-messages-panel{width:100vw;height:100vh;top:0;left:0;transform:none;border-radius:0 !important}.cached-messages-panel .panel-header{padding:.5em}.cached-messages-panel .message-item{padding:.1em}.cached-messages-panel .message-time,.cached-messages-panel .message-username,.cached-messages-panel .message-text{margin:0 .2em;font-size:.9em}.cached-messages-panel .video-container,.cached-messages-panel .youtube-thumb{transform-origin:top left;transform:scale(0.8)}.cached-messages-panel .message-count{font-size:10px;height:16px;padding:0 3px}}',""]);const i=a},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var s=void 0!==n.layer;s&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,s&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function n(o){var s=t[o];if(void 0!==s)return s.exports;var r=t[o]={id:o,exports:{}};return e[o](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0;var o=n(72),s=n.n(o),r=n(825),a=n.n(r),i=n(659),l=n.n(i),c=n(56),d=n.n(c),u=n(540),m=n.n(u),p=n(113),g=n.n(p),h=n(11),f={};f.styleTagTransform=g(),f.setAttributes=d(),f.insert=l().bind(null,"head"),f.domAPI=a(),f.insertStyleElement=m();s()(h.A,f);h.A&&h.A.locals&&h.A.locals;const y="https://klavogonki.ru/u/#/",v=document.querySelector(".userpanel .user-block .user-dropdown .name span").textContent,b=document.querySelector("a.drop-btn.mail")?.href?.match(/\/u\/#\/(\d+)\/messages\//)?.[1],x=new Intl.DateTimeFormat("en-CA").format(new Date),w="2012-12-02",C="userData",S=2.5,k=["ðŸ˜€","ðŸ˜","ðŸ˜‚","ðŸ¤£","ðŸ˜ƒ","ðŸ˜„","ðŸ˜…","ðŸ˜†","ðŸ˜‰","ðŸ˜Š","ðŸ˜‹","ðŸ˜Ž","ðŸ˜","ðŸ˜","ðŸ˜‘","ðŸ˜’","ðŸ˜“","ðŸ˜”","ðŸ˜•","ðŸ˜–","ðŸ˜—","ðŸ˜˜","ðŸ˜™","ðŸ˜š","ðŸ˜œ","ðŸ˜","ðŸ˜›","ðŸ¤‘","ðŸ¤—","ðŸ¤”","ðŸ¤","ðŸ¤¨","ðŸ˜£","ðŸ˜¥","ðŸ˜®","ðŸ¤¯","ðŸ˜³","ðŸ˜±","ðŸ˜¨","ðŸ˜°","ðŸ˜¢","ðŸ¤ª","ðŸ˜µ","ðŸ˜²","ðŸ¤¤","ðŸ˜·","ðŸ¤’","ðŸ¤•","ðŸ¤¢","ðŸ¤§","ðŸ˜‡","ðŸ¥³","ðŸ¥º","ðŸ˜¬","ðŸ˜´","ðŸ˜Œ","ðŸ¤¥","ðŸ¥´","ðŸ¥µ","ðŸ¥¶","ðŸ¤§","ðŸ¤­","ðŸ¤«","ðŸ˜ ","ðŸ˜¡","ðŸ˜³","ðŸ˜ž","ðŸ˜Ÿ","ðŸ˜•","ðŸ±","ðŸ˜º","ðŸ˜¸","ðŸ˜¹","ðŸ˜»","ðŸ˜¼","ðŸ˜½","ðŸ™€","ðŸ˜¿","ðŸ˜¾","ðŸ¶","ðŸ­","ðŸ¹","ðŸ°","ðŸ¦Š","ðŸ»","ðŸ¼","ðŸ¨","ðŸ¯","ðŸ¦","ðŸ®","ðŸ·","ðŸ¸","ðŸµ","ðŸ™ˆ","ðŸ™‰","ðŸ™Š","ðŸ”","ðŸ¦„"];let E={bigImageEvents:{},panelsEvents:{},fetchedUsers:JSON.parse(localStorage.getItem("fetchedUsers"))||{},isInitializedChat:!1};const $=function(e){const[t,n=0,o=0]=e.split(":").map(Number);return t+n/60+o/3600}(localStorage.getItem("cacheRefreshThresholdHours")||(localStorage.setItem("cacheRefreshThresholdHours",24),24)),L=["klavogonki.ru","youtube.com","youtu.be","imgur.com","pikabu.ru","userapi.com","ibb.co","yaplakal.com","freepik.com","fastpic.org"],T={Ð­ÐºÑÑ‚Ñ€Ð°ÐºÐ¸Ð±ÐµÑ€:1,ÐšÐ¸Ð±ÐµÑ€Ð³Ð¾Ð½Ñ‰Ð¸Ðº:2,Ð¡ÑƒÐ¿ÐµÑ€Ð¼ÐµÐ½:3,ÐœÐ°Ð½ÑŒÑÐº:4,Ð“Ð¾Ð½Ñ‰Ð¸Ðº:5,ÐŸÑ€Ð¾Ñ„Ð¸:6,Ð¢Ð°ÐºÑÐ¸ÑÑ‚:7,Ð›ÑŽÐ±Ð¸Ñ‚ÐµÐ»ÑŒ:8,ÐÐ¾Ð²Ð¸Ñ‡Ð¾Ðº:9},M={Ð­ÐºÑÑ‚Ñ€Ð°ÐºÐ¸Ð±ÐµÑ€:"#06B4E9",ÐšÐ¸Ð±ÐµÑ€Ð³Ð¾Ð½Ñ‰Ð¸Ðº:"#5681ff",Ð¡ÑƒÐ¿ÐµÑ€Ð¼ÐµÐ½:"#B543F5",ÐœÐ°Ð½ÑŒÑÐº:"#DA0543",Ð“Ð¾Ð½Ñ‰Ð¸Ðº:"#FF8C00",ÐŸÑ€Ð¾Ñ„Ð¸:"#C1AA00",Ð¢Ð°ÐºÑÐ¸ÑÑ‚:"#2DAB4F",Ð›ÑŽÐ±Ð¸Ñ‚ÐµÐ»ÑŒ:"#61B5B3",ÐÐ¾Ð²Ð¸Ñ‡Ð¾Ðº:"#AFAFAF"},N={private:"coral",mention:"darkseagreen"},I={private:"coral",mention:"hsl(0, 10%, 70%)",default:"slategray"};function A(e){if("string"!=typeof e)return null;const t=e.match(/^#([0-9a-fA-F]{6})\b/);return t?`#${t[1]}`:null}function q(e){if(!e||!e.sec)return null;return new Date(1e3*e.sec).toISOString().split("T")[0]}function D(e,t){return null!=e&&null!=t?e.toString()+Math.floor(t/1e3).toString():null}async function j(e){const t=await fetch(e);if(!t.ok)throw new Error(`Failed to fetch ${e}`);return t.json()}async function O(e){try{const t=`https://klavogonki.ru/api/profile/search-users?query=${e}`,n=await j(t);if(!n.all?.length)return null;const o=n.all.find((t=>t.login===e));return o?o.id:null}catch(e){return console.error("Error getting user ID:",e),null}}const B=new Set(["bio","bioText","bioOldText","bioEditedDate","stats","registered","achievesCount","totalRaces","bestSpeed","ratingLevel","friendsCount","vocsCount","carsCount","achieves","allIndexData"]),H=new Set(["usernamesHistory","currentLogin","userId","level","status","title","car","carColor","isOnline","avatar","blocked","isFriend","publicPrefs","allUserData"]);async function P(e,t){try{const n=await O(e);if(!n)throw new Error(`User with username "${e}" not found`);return await F(n,t)}catch(n){return console.error(`Error getting ${t} for user ${e}:`,n),null}}async function F(e,t){try{if(B.has(t)){const n=await async function(e){try{const t=`https://klavogonki.ru/api/profile/get-index-data?userId=${e}`;return await j(t)}catch(e){throw console.error("Error getting user index data:",e),e}}(e);return _(n,t,"index")}if(H.has(t)){const n=await async function(e){try{const t=`https://klavogonki.ru/api/profile/get-summary?id=${e}`;return await j(t)}catch(e){throw console.error("Error getting user summary:",e),e}}(e);return _(n,t,"summary")}throw new Error(`Unknown data type: ${t}`)}catch(n){return console.error(`Error getting ${t} for user ID ${e}:`,n),null}}function _(e,t,n){if(!e)return null;if("summary"===n){const n={...e.user||{},...e};switch(t){case"usernamesHistory":return Array.isArray(n.history)?n.history.map((e=>e.login)):[];case"currentLogin":return n.login||null;case"userId":return n.id||null;case"level":return n.level||null;case"status":return n.status||null;case"title":return n.title||(n.status?.title??null);case"car":return n.car||null;case"carColor":return n.car?A(n.car.color):null;case"isOnline":return n.is_online??!1;case"avatar":return n.avatar||null;case"avatarTimestamp":{const e=n.avatar;return e&&"number"==typeof e.sec&&"number"==typeof e.usec?D(e.sec,e.usec):null}case"blocked":return n.blocked??null;case"isFriend":return n.is_friend??!1;case"publicPrefs":return n.public_prefs||null;case"allUserData":return n;default:return null}}if("index"===n)switch(t){case"bio":return e.bio||null;case"bioText":return e.bio?.text||null;case"bioOldText":return e.bio?.old_text||null;case"bioEditedDate":return e.bio?.edited_date||null;case"stats":return e.stats||null;case"registered":return q(e.stats?.registered);case"achievesCount":return e.stats?.achieves_cnt||null;case"totalRaces":return e.stats?.total_num_races||null;case"bestSpeed":return e.stats?.best_speed||null;case"ratingLevel":return e.stats?.rating_level||null;case"friendsCount":return e.stats?.friends_cnt||null;case"vocsCount":return e.stats?.vocs_cnt||null;case"carsCount":return e.stats?.cars_cnt||null;case"achieves":return e.achieves||null;case"allIndexData":return e;default:return null}return null}function z(e,t,n){e/=255,t/=255,n/=255;const o=Math.max(e,t,n),s=Math.min(e,t,n);let r,a,i=(o+s)/2;if(o===s)r=a=0;else{const l=o-s;a=i<.5?l/(o+s):l/(2-o-s),r=(o===e?(t-n)/l+(t<n?6:0):o===t?(n-e)/l+2:(e-t)/l+4)/6}return r=Math.round(360*r),a=Math.min(Math.round(100*a),90),i=Math.round(100*i),r>215&&r<280&&(r=r<255?215:280),{h:r,s:a,l:i}}function R(e){if(!e||"string"!=typeof e)return"#808080";const t=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/i);if(!t)return"#808080";const[,n,o,s]=t.map(Number);return`#${((1<<24)+(Math.max(0,Math.min(255,n))<<16)+(Math.max(0,Math.min(255,o))<<8)+Math.max(0,Math.min(255,s))).toString(16).slice(1).padStart(6,"0")}`}function U(e,t="rgb",n=65){let o,s,r,a,i,l;if("hex"===t){const t=function(e){const t=e.replace(/^#/,"");if(!/^[0-9A-Fa-f]{6}$/.test(t))throw new Error(`Invalid hex color: "${e}"`);return{r:parseInt(t.slice(0,2),16),g:parseInt(t.slice(2,4),16),b:parseInt(t.slice(4,6),16)}}(e);o=t.r,s=t.g,r=t.b,({h:a,s:i,l}=z(o,s,r))}else if("rgb"===t)"string"==typeof e?[o,s,r]=e.match(/\d+/g).map(Number):"object"==typeof e&&void 0!==e.r&&(o=e.r,s=e.g,r=e.b),({h:a,s:i,l}=z(o,s,r));else{if("hsl"!==t)throw new Error("Unsupported inputType for normalizeUsernameColor: "+t);"string"==typeof e?[a,i,l]=e.match(/\d+/g).map(Number):"object"==typeof e&&void 0!==e.h&&(a=e.h,i=e.s,l=e.l)}const c=function(e,t,n){let o,s,r;if(n/=100,0==(t/=100))o=s=r=255*n;else{const a=n<.5?n*(1+t):n+t-n*t,i=2*n-a,l=(e,t,n)=>(n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e);o=Math.round(255*l(i,a,e/360+1/3)),s=Math.round(255*l(i,a,e/360)),r=Math.round(255*l(i,a,e/360-1/3))}return`rgb(${o}, ${s}, ${r})`}(a,i,l<n?n:l);return R(c)}async function J(e,t=C){let n=JSON.parse(localStorage.getItem(t)||"{}");const o=e.filter((e=>!(e in n)));if(o.length){const e=await Promise.all(o.map((e=>P(e,"allUserData"))));o.forEach(((t,o)=>{const s=e[o];if(s){const e=s.car?A(s.car.color):null;n[t]={id:s.id||null,color:e&&e.startsWith("#")?U(e,"hex"):"#808080",change:"auto"}}else n[t]={id:null,color:"#808080",change:"auto"}})),localStorage.setItem(t,JSON.stringify(n))}return n}function K(e,t=0,n=0){const o=[{transform:`translate(${t}%, calc(${n}%)) scale(1)`},{transform:`translate(${t}%, calc(${n}% - 60%)) scale(1.1)`},{transform:`translate(${t}%, calc(${n}% + 15%)) scale(1)`},{transform:`translate(${t}%, calc(${n}% - 20%)) scale(1.05)`},{transform:`translate(${t}%, calc(${n}% + 8%)) scale(1)`},{transform:`translate(${t}%, calc(${n}% - 10%)) scale(1.05)`},{transform:`translate(${t}%, calc(${n}% + 4%)) scale(1)`},{transform:`translate(${t}%, calc(${n}%)) scale(1)`}];return e.animate(o,{duration:500,easing:"ease",iterations:1}).finished}function Y(e){e.classList.add("shake-effect"),setTimeout((()=>{e.classList.remove("shake-effect")}),500)}function X(e){e.classList.add("pulse-effect"),setTimeout((()=>{e.classList.remove("pulse-effect")}),500)}let{panelsEvents:V,bigImageEvents:G,fetchedUsers:W}=E;const Z=e=>window.location.href.includes(e);function Q(){Object.entries(G).forEach((([e,t])=>{document.removeEventListener(e,t)}))}function ee(e=!1){Object.values(V).forEach((e=>{document.removeEventListener("keydown",e)})),Object.keys(V).forEach((e=>delete V[e]));const t=document.querySelector(".popup-panel");if(t&&t.remove(),e){const e=document.querySelector(".dimming-background");e&&e.remove()}}const te=(e,t=300)=>{let n;return function(...o){clearTimeout(n),n=setTimeout((()=>e.apply(this,o)),t)}};let ne=null;function oe(){let e;do{e=k[Math.floor(Math.random()*k.length)]}while(e===ne);return ne=e,e}function se(e,t){const n=(JSON.parse(localStorage.getItem("toggle"))||[]).find((n=>n.category===e&&n.type===t));return!n||"yes"===n.option}function re(){return(new Date).toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})}const ae=e=>{try{const{hostname:t}=new URL(e),n=t.toLowerCase().split(".").slice(-2).join(".");return{isTrusted:L.includes(n),domain:n}}catch(t){return console.error("Error in isTrustedDomain:",t.message),{isTrusted:!1,domain:e}}};function ie(){const e=document.querySelector(".personal-messages-button .total-message-count"),t=document.querySelector(".personal-messages-button .new-message-count");if(!e||!t)return;const n=JSON.parse(localStorage.getItem("personalMessages"))||{},o=Object.keys(n).length;ie.previousTotalCount||(ie.previousTotalCount=o);let s=Number(localStorage.getItem("newMessagesCount"))||0;o>ie.previousTotalCount&&(s++,localStorage.setItem("newMessagesCount",s),X(t),K(t,50,50)),e.textContent=o,t.textContent=s,t.style.visibility=s>0?"visible":"hidden",o!==ie.previousTotalCount&&X(e),ie.previousTotalCount=o}function le(e){return!!e&&["ÐšÐ»Ð°Ð²Ð¾Ð±Ð¾Ñ‚","ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ","Ð·Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ð½"].every((t=>e.includes(t)))}function ce(e,t){if(e)if("one"===t){if(!e.querySelector("span[data-user]"))return;const t=U(getComputedStyle(e).color,"rgb");e.style.setProperty("color",t,"important")}else"all"===t?Array.from(e).forEach((e=>{if(!e)return;if(!e.querySelector("span[data-user]"))return;const t=U(getComputedStyle(e).color,"rgb");e.style.setProperty("color",t,"important")})):console.error("Invalid mode. Use 'one' or 'all'.")}function de(e,t,n){const o=`https://klavogonki.ru/chatlogs/${e}.html#${t}`;navigator.clipboard&&navigator.clipboard.writeText(o).then((()=>{Y(n),function(){if(window.getSelection){const e=window.getSelection();e&&e.removeAllRanges&&e.removeAllRanges()}}()}))}function ue(){return window.getSelection().toString().length>0}function me(e){let t="";for(const n of e.childNodes)if(n.nodeType===Node.TEXT_NODE)t+=n.textContent;else if(n.nodeType===Node.ELEMENT_NODE){if(n.classList&&n.classList.contains("video-wrapper")){n.querySelectorAll("a.media").forEach((e=>{e.href&&(t+=e.href+" ")}));continue}"IMG"===n.tagName?t+=n.title||n.alt||"":"A"===n.tagName?t+=n.href?n.href:n.textContent:t+=me(n)}return t.trim()}function pe(){try{const e=(JSON.parse(localStorage.getItem("toggle"))||[]).find((e=>"ui"===e.category&&"language"===e.type));return e?.option||"en"}catch{return"en"}}function ge(e,t="alert",...n){const o=e[pe()]||e.en;return"alert"===t?alert(o):"confirm"===t?confirm(o):"prompt"===t?prompt(o,...n):alert(o)}function he(e){let t,n,o;if(/^\d{4}[:\-]\d{2}[:\-]\d{2}$/.test(e))[t,n,o]=e.replace(/:/g,"-").split("-");else if(/^\d{8}$/.test(e))t=e.slice(0,4),n=e.slice(4,6),o=e.slice(6,8);else if(/^\d{6}$/.test(e))t="20"+e.slice(0,2),n=e.slice(2,4),o=e.slice(4,6);else{if(!/^\d{2}-\d{2}-\d{2}$/.test(e))return null;t="20"+e.slice(0,2),n=e.slice(3,5),o=e.slice(6,8)}return function(e,t,n){const o=(new Date).getFullYear();return e=parseInt(e,10),t=parseInt(t,10),n=parseInt(n,10),!(e>o||t<1||t>12||n<1||n>31)}(t,n,o)?`${t}-${n.padStart(2,"0")}-${o.padStart(2,"0")}`:null}var fe=n(629),ye={};ye.styleTagTransform=g(),ye.setAttributes=d(),ye.insert=l().bind(null,"head"),ye.domAPI=a(),ye.insertStyleElement=m();s()(fe.A,ye);fe.A&&fe.A.locals&&fe.A.locals;const ve="http://www.w3.org/2000/svg",be=`\n  <svg xmlns="${ve}"\n      width="16"\n      height="16"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="currentColor"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="icon-enter icon-feather icon-log-in">\n    <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>\n    <polyline points="10 17 15 12 10 7"></polyline>\n    <line x1="15" y1="12" x2="3" y2="12"></line>\n  </svg>`,xe=`\n  <svg xmlns="${ve}"\n      width="16"\n      height="16"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="currentColor" stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="icon-leave icon-feather icon-log-out">\n    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>\n    <polyline points="16 17 21 12 16 7"></polyline>\n    <line x1="21" y1="12" x2="9" y2="12"></line>\n  </svg>`,we=`\n  <svg xmlns="${ve}"\n      width="18"\n      height="18"\n      viewBox="0 0 24 24"\n      fill="url(#moderatorGradient)"  \x3c!-- Use a gradient fill --\x3e\n      stroke="none"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-shield">\n    \x3c!-- Define the gradient --\x3e\n    <defs>\n        <linearGradient id="moderatorGradient" x1="0%" y1="0%" x2="0%" y2="100%">\n            <stop offset="0%" style="stop-color: rgb(255, 215, 0); stop-opacity: 1" />\n            <stop offset="100%" style="stop-color: rgb(255, 140, 0); stop-opacity: 1" />\n        </linearGradient>\n    </defs>\n    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>\n  </svg>`,Ce=`\n  <svg xmlns="${ve}"\n       width="16"\n       height="16"\n       viewBox="0 0 24 24"\n       fill="url(#trackedGradient)"  \x3c!-- Use a gradient fill --\x3e\n       class="feather feather-star">\n      \x3c!-- Define the gradient for the fill --\x3e\n    <defs>\n      <linearGradient id="trackedGradient" x1="0%" y1="0%" x2="0%" y2="100%">\n        <stop offset="0%" style="stop-color: rgb(135, 206, 250); stop-opacity: 1" />\n        <stop offset="100%" style="stop-color: rgb(0, 191, 255); stop-opacity: 1" />\n      </linearGradient>\n    </defs>\n    \x3c!-- Use the gradient for the fill --\x3e\n    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"\n      stroke="url(#trackedGradient)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round">\n    </polygon>\n  </svg>`,Se=`\n  <svg xmlns="${ve}"\n      width="16"\n      height="16"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(255, 160, 122)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-slash">\n    <circle cx="12" cy="12" r="10"></circle>\n    <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line>\n  </svg>`,ke=`\n  <svg xmlns="${ve}"\n       width="16"\n       height="16"\n       viewBox="0 0 24 24"\n       fill="none"\n       stroke="currentColor"\n       stroke-width="2"\n       stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">\n    <circle cx="12" cy="12" r="10"></circle>\n    <polyline points="12 6 12 12 16 14"></polyline>\n  </svg>`,Ee=`\n    <svg xmlns="${ve}"\n        width="16"\n        height="16"\n        viewBox="0 0 24 24"\n        fill="none"\n        stroke="currentColor"\n        stroke-width="2"\n        stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">\n      <polyline points="9 18 15 12 9 6"></polyline>\n    </svg>`,$e=`\n  <svg xmlns="${ve}"\n      width="16"\n      height="16"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="currentColor"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-user">\n    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>\n    <circle cx="12" cy="7" r="4"></circle>\n  </svg>`,Le=`\n  <svg xmlns="${ve}"\n      width="28"\n      height="28"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="hsl(355, 80%, 65%)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round">\n    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>\n    <line x1="23" y1="9" x2="17" y2="15"></line>\n    <line x1="17" y1="9" x2="23" y2="15"></line>\n  </svg>`,Te=`\n  <svg xmlns="${ve}"\n      width="28"\n      height="28"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="hsl(55, 80%, 65%)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round">\n    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>\n    <path d="M19.07 4.93a10 10 0 0 1 0 14.14" opacity="0.3"></path>\n    <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>\n  </svg>`,Me=`\n  <svg xmlns="${ve}"\n      width="28"\n      height="28"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="hsl(80, 80%, 40%)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round">\n    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>\n    <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>\n    <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>\n  </svg>`,Ne=`\n  <svg xmlns="${ve}"\n      width="28"\n      height="28"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="hsl(100, 50%, 50%)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round">\n    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>\n    <circle cx="9" cy="7" r="4"></circle>\n    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>\n    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>\n  </svg>`,Ie=`\n  <svg xmlns="${ve}"\n      width="28"\n      height="28"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="hsl(180, 60%, 50%)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round">\n    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>\n    <circle cx="12" cy="7" r="4"></circle>\n  </svg>`,Ae=`\n  <svg xmlns="${ve}"\n      width="16"\n      height="16"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="currentColor"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-slash">\n    <circle cx="12" cy="12" r="10"></circle>\n    <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line>\n  </svg>`,qe=`\n  <svg xmlns="${ve}"\n      width="28"\n      height="28"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(180, 213, 131)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-database">\n    <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>\n    <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>\n    <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>\n  </svg>`,De=`\n  <svg xmlns="${ve}"\n      width="28"\n      height="28"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(255, 160, 122)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail">\n    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>\n    <polyline points="22,6 12,13 2,6"></polyline>\n  </svg>`,je=`\n  <svg xmlns="${ve}"\n      width="28"\n      height="28"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(100, 149, 237)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-message-circle">\n      <path \n          d="M21 11.5 a8.38 8.38 0 0 1 -.9 3.8 a8.5 8.5 0 0 1 -7.6 4.7 a8.38 8.38 0 0 1 -3.8 -.9\n          L3 21 l1.9 -5.7 a8.38 8.38 0 0 1 -.9 -3.8 a8.5 8.5 0 0 1 4.7 -7.6\n          a8.38 8.38 0 0 1 3.8 -.9 h.5 a8.48 8.48 0 0 1 8 8 v.5 z">\n      </path>\n  </svg>`,Oe=`\n  <svg xmlns="${ve}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="currentColor"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-film">\n    <rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect>\n    <line x1="7" y1="2" x2="7" y2="22"></line>\n    <line x1="17" y1="2" x2="17" y2="22"></line>\n    <line x1="2" y1="12" x2="22" y2="12"></line>\n    <line x1="2" y1="7" x2="7" y2="7"></line>\n    <line x1="2" y1="17" x2="7" y2="17"></line>\n    <line x1="17" y1="17" x2="22" y2="17"></line>\n    <line x1="17" y1="7" x2="22" y2="7"></line>\n  </svg>`,Be=`\n  <svg xmlns="${ve}"\n      width="16"\n      height="16"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(255, 100, 100)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-slash">\n    <circle cx="12" cy="12" r="10"></circle>\n    <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line>\n  </svg>`,He=`\n  <svg xmlns="${ve}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(255, 228, 196)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-sliders">\n    <line x1="4" y1="21" x2="4" y2="14"></line>\n    <line x1="4" y1="10" x2="4" y2="3"></line>\n    <line x1="12" y1="21" x2="12" y2="12"></line>\n    <line x1="12" y1="8" x2="12" y2="3"></line>\n    <line x1="20" y1="21" x2="20" y2="16"></line>\n    <line x1="20" y1="12" x2="20" y2="3"></line>\n    <line x1="1" y1="14" x2="7" y2="14"></line>\n    <line x1="9" y1="8" x2="15" y2="8"></line>\n    <line x1="17" y1="16" x2="23" y2="16"></line>\n  </svg>`,Pe=`\n  <svg xmlns="${ve}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(144, 238, 144)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-x">\n    <line x1="18" y1="6" x2="6" y2="18"></line>\n    <line x1="6" y1="6" x2="18" y2="18"></line>\n  </svg>`,Fe="rgb(211, 211, 211)",_e=`\n  <svg xmlns="${ve}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="${Fe}"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevrons-up">\n    <polyline points="17 11 12 6 7 11"></polyline>\n    <polyline points="17 18 12 13 7 18"></polyline>\n  </svg>`,ze=`\n  <svg xmlns="${ve}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="${Fe}"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-up">\n    <polyline points="18 15 12 9 6 15"></polyline>\n  </svg>`,Re=`\n  <svg xmlns="${ve}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="${Fe}"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down">\n    <polyline points="6 9 12 15 18 9"></polyline>\n  </svg>`,Ue=`\n  <svg xmlns="${ve}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="${Fe}"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevrons-down">\n    <polyline points="7 13 12 18 17 13"></polyline>\n    <polyline points="7 6 12 11 17 6"></polyline>\n  </svg>`,Je=`\n  <svg xmlns="${ve}"\n      width="24"\n      height="24"\n      viewBox="0 0 25 25"\n      fill="none"\n      stroke="rgb(137, 187, 255)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-toggle-right">\n    <rect x="1" y="5" width="22" height="14" rx="7" ry="7"></rect>\n    <circle cx="16" cy="12" r="3"></circle>\n  </svg>`,Ke=`\n  <svg xmlns="${ve}"\n      width="24"\n      height="24"\n      viewBox="0 0 25 25"\n      fill="none"\n      stroke="rgb(137, 187, 255)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-toggle-left">\n    <rect x="1" y="5" width="22" height="14" rx="7" ry="7"></rect>\n    <circle cx="8" cy="12" r="3"></circle>\n  </svg>`,Ye=`\n  <svg xmlns="${ve}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(176, 196, 222)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">\n    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>\n    <line x1="16" y1="2" x2="16" y2="6"></line>\n    <line x1="8" y1="2" x2="8" y2="6"></line>\n    <line x1="3" y1="10" x2="21" y2="10"></line>\n  </svg>`,Xe=`\n  <svg xmlns="${ve}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(176, 196, 222)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard">\n    <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>\n    <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>\n  </svg>`,Ve=`\n  <svg xmlns="${ve}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(28, 229, 229)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-left">\n    <polyline points="15 18 9 12 15 6"></polyline>\n  </svg>`,Ge=`\n  <svg xmlns="${ve}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(28, 229, 229)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">\n      <polyline points="9 18 15 12 9 6"></polyline>\n  </svg>`,We=`\n  <svg xmlns="${ve}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="hsl(250, 40%, 80%)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-shuffle">\n    <polyline points="16 3 21 3 21 8"></polyline>\n    <line x1="4" y1="20" x2="21" y2="3"></line>\n    <polyline points="21 16 21 21 16 21"></polyline>\n    <line x1="15" y1="15" x2="21" y2="21"></line>\n    <line x1="4" y1="4" x2="9" y2="9"></line>\n  </svg>`,Ze=`\n  <svg xmlns="${ve}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="hsl(50, 100%, 50%)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun">\n    <circle cx="12" cy="12" r="5"></circle>\n    <line x1="12" y1="1" x2="12" y2="3"></line>\n    <line x1="12" y1="21" x2="12" y2="23"></line>\n    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>\n    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>\n    <line x1="1" y1="12" x2="3" y2="12"></line>\n    <line x1="21" y1="12" x2="23" y2="12"></line>\n    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>\n    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>\n  </svg>`,Qe=`\n  <svg xmlns="${ve}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(255, 140, 0)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2">\n    <polyline points="3 6 5 6 21 6"></polyline>\n    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>\n    <line x1="10" y1="11" x2="10" y2="17"></line>\n    <line x1="14" y1="11" x2="14" y2="17"></line>\n  </svg>`,et=`\n  <svg xmlns="${ve}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="currentColor"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-users">\n    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>\n    <circle cx="9" cy="7" r="4"></circle>\n    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>\n    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>\n  </svg>`,tt=`\n  <svg xmlns="${ve}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(209, 144, 238)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-download">\n    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>\n    <polyline points="7 10 12 15 17 10"></polyline>\n    <line x1="12" y1="15" x2="12" y2="3"></line>\n  </svg>`,nt=`\n  <svg xmlns="${ve}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(144, 185, 238)"\n      stroke-width="2" stroke-linecap="round"\n      stroke-linejoin="round" class="feather feather-upload">\n    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>\n    <polyline points="17 8 12 3 7 8"></polyline>\n    <line x1="12" y1="3" x2="12" y2="15"></line>\n  </svg>`,ot=`\n  <svg xmlns="${ve}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(144, 238, 220)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-save">\n    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>\n    <polyline points="17 21 17 13 7 13 7 21"></polyline>\n    <polyline points="7 3 7 8 15 8"></polyline>\n  </svg>`,st=`\n  <svg xmlns="${ve}"\n      width="16"\n      height="16"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(238, 144, 144)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash">\n    <polyline points="3 6 5 6 21 6"></polyline>\n    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>\n  </svg>`,rt=`\n  <svg xmlns="${ve}"\n      width="16"\n      height="16"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="hsl(60, 40%, 80%)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-refresh-cw">\n    <polyline points="23 4 23 10 17 10"></polyline>\n    <polyline points="1 20 1 14 7 14"></polyline>\n    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>\n  </svg>`,at=`\n  <svg xmlns="${ve}"\n      width="20"\n      height="20"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(176, 196, 222)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-snowflake">\n    <g id="snowflake">\n      <line x1="12.06" y1="2.74" x2="12.06" y2="12.06" />\n      <line x1="20.12" y1="7.4" x2="12.06" y2="12.06" />\n      <line x1="20.12" y1="16.71" x2="12.06" y2="12.06" />\n      <line x1="12.06" y1="21.37" x2="12.06" y2="12.06" />\n      <line x1="3.99" y1="16.71" x2="12.06" y2="12.06" />\n      <line x1="3.99" y1="7.4" x2="12.06" y2="12.06" />\n      <polyline points="8.96,4.67 12.06,7.77 15.16,4.67"/>\n      <polyline points="16.9,5.68 15.76,9.92 20,11.05"/>\n      <polyline points="20,13.06 15.76,14.2 16.9,18.43"/>\n      <polyline points="15.16,19.44 12.06,16.34 8.96,19.44"/>\n      <polyline points="7.21,18.43 8.35,14.2 4.11,13.06"/>\n      <polyline points="4.11,11.05 8.35,9.92 7.21,5.68"/>\n    </g>\n  </svg>`,it=`\n  <svg xmlns="${ve}"\n      width="16"\n      height="16"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(209, 144, 238)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus">\n    <line x1="12" y1="5" x2="12" y2="19"></line>\n    <line x1="5" y1="12" x2="19" y2="12"></line>\n  </svg>`,lt=`\n  <svg xmlns="${ve}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="hsl(150, 70%, 60%)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-play">\n    <polygon points="5 3 19 12 5 21 5 3"></polygon>\n  </svg>`,ct=`\n  <svg xmlns="${ve}"\n      width="24"\n      height="24"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="hsl(150, 70%, 60%)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-pause">\n    <rect x="6" y="4" width="4" height="16"></rect>\n    <rect x="14" y="4" width="4" height="16"></rect>\n  </svg>`,dt=`\n  <svg xmlns="${ve}"\n      width="14"\n      height="14"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="rgb(255, 228, 196)"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-move">\n    <circle cx="5" cy="12" r="1"></circle>\n    <circle cx="12" cy="5" r="1"></circle>\n    <circle cx="19" cy="12" r="1"></circle>\n    <circle cx="12" cy="19" r="1"></circle>\n    <circle cx="12" cy="12" r="1"></circle>\n  </svg>`,ut=`\n  <svg xmlns="${ve}"\n      width="12"\n      height="12"\n      viewBox="0 0 24 24"\n      fill="none"\n      stroke="currentColor"\n      stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round" class="feather feather-check">\n    <polyline points="20 6 9 17 4 12"></polyline>\n  </svg>`;let mt=null,pt=null,gt=null,ht=!1,ft=!1,yt=null;const vt=(e,t)=>{if(!mt)return;let n=e+10;const o=mt.offsetWidth,s=window.innerWidth;n=Math.min(Math.max(n,10),s-o-10),mt.style.left=`${n}px`,mt.style.top=`${t+18}px`},bt=e=>mt&&vt(e.clientX,e.clientY),xt=()=>{ht=!1,yt=null,clearTimeout(gt),clearTimeout(pt),pt=setTimeout((()=>{mt&&(mt.style.opacity="0",ft=!1,setTimeout((()=>{!ht&&mt&&(mt.style.display="none",mt.textContent="",document.removeEventListener("mousemove",bt))}),50))}),100)};new MutationObserver((()=>{yt&&!document.contains(yt)&&xt()})).observe(document,{childList:!0,subtree:!0});const wt=new WeakMap;function Ct(e){if("object"==typeof e&&null!==e&&!Array.isArray(e)){return e[pe()]||e.en||Object.values(e)[0]}return e}function St(e,t){return e.replace(/\$\{([^}]+)\}/g,((e,n)=>t.hasAttribute&&t.hasAttribute(n)?t.getAttribute(n):n in t?t[n]:"text"===n||"textContent"===n?t.textContent||"":e))}function kt(e,t,n=!1){if(null!=t&&""!==t)if(mt||=(()=>{const e=document.createElement("div");return e.classList.add("custom-tooltip-popup"),e.style.display="none",e.style.opacity="0",document.body.appendChild(e),e})(),n){const n=e,o=t,s=arguments[2];wt.has(o)||wt.set(o,new Set);const r=wt.get(o);if(!r.has(n)){r.add(n);const e=e=>{const t=e.target.closest(n);if(!t)return;ht=!0,yt=t,clearTimeout(pt),clearTimeout(gt);let o=s;"function"==typeof o&&(o=o(t)),o=Ct(o),"string"==typeof o&&(o=St(o,t)),mt.innerHTML=$t(o),mt.style.display="flex",mt.style.opacity="0",mt.offsetHeight,vt(e.clientX,e.clientY),document.addEventListener("mousemove",bt),gt=setTimeout((()=>{mt.style.opacity="1",ft=!0}),600)},t=e=>{e.target.closest(n)&&(xt(),document.removeEventListener("mousemove",bt))},a=e=>{e.target.closest(n)&&xt()};o.addEventListener("mouseenter",e,!0),o.addEventListener("mouseleave",t,!0),o.addEventListener("click",a,!0)}}else{let n=t;if("function"==typeof n&&(n=n(e)),n=Ct(n),"string"==typeof n&&(n=St(n,e)),!n)return void(e._tooltipContent="");e._tooltipContent=n,e._tooltipInitialized||(e._tooltipInitialized=!0,e.addEventListener("mouseenter",(t=>{e._tooltipContent&&(ht=!0,yt=e,clearTimeout(pt),clearTimeout(gt),mt.innerHTML=$t(e._tooltipContent),mt.style.display="flex",mt.style.opacity="0",mt.offsetHeight,vt(t.clientX,t.clientY),document.addEventListener("mousemove",bt),gt=setTimeout((()=>{mt.style.opacity="1",ft=!0}),600))})),e.addEventListener("mouseleave",(()=>{xt(),document.removeEventListener("mousemove",bt)})),e.addEventListener("click",xt))}}function Et(e){e&&(e._tooltipContent="")}function $t(e){if("string"!=typeof e)return"";const t=/\[([^\]]+)\]([^\[]*)/g;let n,o="",s=0;for(;null!==(n=t.exec(e));)n.index>s&&(o+=e.slice(s,n.index)),o+=`\n    <div class="tooltip-item">\n      <span class="tooltip-action">${n[1]}</span>&nbsp;\n      <span class="tooltip-message">${n[2].trim()}</span>\n    </div>`,s=t.lastIndex;return s<e.length&&(o+=e.slice(s)),o}let Lt=!1,Tt=!1;function Mt(e,t,n){e&&(e.offsetHeight,e.style.transition="opacity 0.3s",e.style.opacity="show"===t?n:"0","hide"===t&&e.addEventListener("transitionend",(()=>{"0"===e.style.opacity&&e.remove()}),{once:!0}))}function Nt(e,t){e&&(Mt(e,t,1),e.addEventListener("dblclick",(t=>{const n=document.querySelector(".popup-panel");(t.target===e||t.target.parentElement===e||t.target.parentElement&&t.target.parentElement.parentElement===e)&&(n&&t.target.closest(".scaled-thumbnail")||It("hide"),Mt(e,"hide",1))})))}function It(e){const t=document.querySelector(".chat-logs-panel");"hide"===e&&t&&window.chatlogsParserState&&"function"==typeof window.chatlogsParserState.isRunning&&window.chatlogsParserState.isRunning()&&("function"==typeof window.stopChatlogsParser&&window.stopChatlogsParser(),delete window.chatlogsParserState,delete window.stopChatlogsParser);let n=document.querySelector(".dimming-background"),o=document.querySelector(".scaled-thumbnail");("hide"!==e||n)&&(n||(n=document.createElement("div"),n.classList.add("dimming-background"),document.body.appendChild(n),n.addEventListener("click",(function(){const e=document.querySelector(".popup-panel")||n.previousElementSibling;e&&Mt(e,"hide",0),It("hide"),o&&Q()}))),Mt(n,e,.5),"hide"===e&&o&&(Q(),Nt(o,"hide")))}function At({container:e,buttons:t}){const n=0===e.scrollTop,o=e.scrollTop+e.clientHeight>=e.scrollHeight-3;[t.fullScrollUpButton,t.partialScrollUpButton].forEach((e=>{e.style.opacity=n?"0.3":"1",e.style.pointerEvents=n?"none":"auto"})),[t.fullScrollDownButton,t.partialScrollDownButton].forEach((e=>{e.style.opacity=o?"0.3":"1",e.style.pointerEvents=o?"none":"auto"}))}function qt({container:e,scrollButtonsContainer:t}){e.scrollHeight>e.clientHeight?t.style.display="flex":t.style.display="none"}function Dt(e){const t=document.createElement("div");t.className="scroll-buttons-container";const n=document.createElement("div");n.innerHTML=_e,kt(n,{en:"Scroll Up (Full)",ru:"ÐŸÑ€Ð¾ÐºÑ€ÑƒÑ‚Ð¸Ñ‚ÑŒ Ð²Ð²ÐµÑ€Ñ… (Ð²ÑÑ‘)"});const o=document.createElement("div");o.innerHTML=ze,kt(o,{en:"Scroll Up (Partial)",ru:"ÐŸÑ€Ð¾ÐºÑ€ÑƒÑ‚Ð¸Ñ‚ÑŒ Ð²Ð²ÐµÑ€Ñ… (Ñ‡Ð°ÑÑ‚Ð¸Ñ‡Ð½Ð¾)"});const s=document.createElement("div");s.innerHTML=Re,kt(s,{en:"Scroll Down (Partial)",ru:"ÐŸÑ€Ð¾ÐºÑ€ÑƒÑ‚Ð¸Ñ‚ÑŒ Ð²Ð½Ð¸Ð· (Ñ‡Ð°ÑÑ‚Ð¸Ñ‡Ð½Ð¾)"});const r=document.createElement("div");r.innerHTML=Ue,kt(r,{en:"Scroll Down (Full)",ru:"ÐŸÑ€Ð¾ÐºÑ€ÑƒÑ‚Ð¸Ñ‚ÑŒ Ð²Ð½Ð¸Ð· (Ð²ÑÑ‘)"});const a={fullScrollUpButton:n,partialScrollUpButton:o,partialScrollDownButton:s,fullScrollDownButton:r};function i(t,n){const o=n?e.scrollHeight:e.clientHeight;e.scrollBy({top:"up"===t?-o:o,behavior:"smooth"}),At({container:e,buttons:a})}Object.values(a).forEach((e=>{e.classList.add("large-button","scroll-button"),t.appendChild(e)})),n.addEventListener("click",(()=>i("up",!0))),o.addEventListener("click",(()=>i("up",!1))),s.addEventListener("click",(()=>i("down",!1))),r.addEventListener("click",(()=>i("down",!0))),At({container:e,buttons:a}),qt({container:e,scrollButtonsContainer:t});const l=()=>{qt({container:e,scrollButtonsContainer:t}),At({container:e,buttons:a})};e.addEventListener("scroll",l);const c=new ResizeObserver(l);c.observe(e);const d=new MutationObserver(l);d.observe(e,{childList:!0,subtree:!0,characterData:!0,attributes:!0});return{scrollButtonsContainer:t,cleanup:()=>{c.disconnect(),d.disconnect(),e.removeEventListener("scroll",l)}}}["keydown","keyup"].forEach((e=>document.addEventListener(e,(t=>{return n=t.key,o="keydown"===e,"Control"===n&&(Lt=o),void("Alt"===n&&(Tt=o));var n,o})))),["blur","focus"].forEach((e=>document.addEventListener(e,(()=>{(Lt||Tt)&&(console.log(`${Lt?"Ctrl ":""}${Tt?"Alt ":""}key was true`),Lt=!1,Tt=!1)}))));const jt={spoilerTitles:{tracked:{en:{show:"Show tracked users",hide:"Hide tracked users"},ru:{show:"ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°ÐµÐ¼Ñ‹Ñ… Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹",hide:"Ð¡ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°ÐµÐ¼Ñ‹Ñ… Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹"}},mention:{en:{show:"Show mention keywords",hide:"Hide mention keywords"},ru:{show:"ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ ÑÐ»Ð¾Ð²Ð° ÑƒÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ð¹",hide:"Ð¡ÐºÑ€Ñ‹Ñ‚ÑŒ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ ÑÐ»Ð¾Ð²Ð° ÑƒÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ð¹"}},replacement:{en:{show:"Show username replacements",hide:"Hide username replacements"},ru:{show:"ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð·Ð°Ð¼ÐµÐ½Ñ‹ Ð¸Ð¼ÐµÐ½ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹",hide:"Ð¡ÐºÑ€Ñ‹Ñ‚ÑŒ Ð·Ð°Ð¼ÐµÐ½Ñ‹ Ð¸Ð¼ÐµÐ½ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹"}},moderator:{en:{show:"Show moderators",hide:"Hide moderators"},ru:{show:"ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¼Ð¾Ð´ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð²",hide:"Ð¡ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¼Ð¾Ð´ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð²"}},ignored:{en:{show:"Show ignored users",hide:"Hide ignored users"},ru:{show:"ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¸Ð³Ð½Ð¾Ñ€Ð¸Ñ€ÑƒÐµÐ¼Ñ‹Ñ… Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹",hide:"Ð¡ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¸Ð³Ð½Ð¾Ñ€Ð¸Ñ€ÑƒÐµÐ¼Ñ‹Ñ… Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹"}},userColors:{en:{show:"Show user colors",hide:"Hide user colors"},ru:{show:"ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ñ†Ð²ÐµÑ‚Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹",hide:"Ð¡ÐºÑ€Ñ‹Ñ‚ÑŒ Ñ†Ð²ÐµÑ‚Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹"}},toggle:{en:{show:"Show toggle options",hide:"Hide toggle options"},ru:{show:"ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°Ñ‚ÐµÐ»Ð¸",hide:"Ð¡ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°Ñ‚ÐµÐ»Ð¸"}}},toggleTitles:{static:{en:"Show static chat notifications",ru:"ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°Ñ‚ÑŒ ÑÑ‚Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ Ñ‡Ð°Ñ‚Ð°"},dynamic:{en:"Show global dynamic notifications",ru:"ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°Ñ‚ÑŒ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð´Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ"},activity:{en:"Play sound and voice notifications, messages only when the tab is inactive",ru:"Ð’Ð¾ÑÐ¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÑŒ Ð·Ð²ÑƒÐº Ð¸ Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²Ñ‹Ðµ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ, ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐºÐ¾Ð³Ð´Ð° Ð²ÐºÐ»Ð°Ð´ÐºÐ° Ð½ÐµÐ°ÐºÑ‚Ð¸Ð²Ð½Ð°"},presence:{en:"Play sound and voice feedback when a user enters or leaves the chat",ru:"Ð’Ð¾ÑÐ¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÑŒ Ð·Ð²ÑƒÐº Ð¸ Ð¿Ñ€Ð¾Ð³Ð¾Ð²Ð°Ñ€Ð¸Ð²Ð°Ñ‚ÑŒ, ÐºÐ¾Ð³Ð´Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð·Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ Ð¸Ð»Ð¸ Ð²Ñ‹Ñ…Ð¾Ð´Ð¸Ñ‚ Ð¸Ð· Ñ‡Ð°Ñ‚Ð°"},gTTS:{en:"Switch to Google TTS engine if available",ru:"ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒÑÑ Ð½Ð° Google TTS, ÐµÑÐ»Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾"},counter:{en:"Create participants counter",ru:"Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ ÑÑ‡ÐµÑ‚Ñ‡Ð¸Ðº ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð²"},language:{en:"Interface language",ru:"Ð¯Ð·Ñ‹Ðº Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ°"}},placeholderTitles:{tracked:{id:{en:"User ID",ru:"ID Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ"},name:{en:"Username",ru:"ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ"},notFoundName:{en:"User not found",ru:"ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½"},pronunciation:{en:"Pronunciation",ru:"ÐŸÑ€Ð¾Ð¸Ð·Ð½Ð¾ÑˆÐµÐ½Ð¸Ðµ"}},mention:{en:"Alias",ru:"ÐŸÑÐµÐ²Ð´Ð¾Ð½Ð¸Ð¼"},replacement:{find:{en:"Original",ru:"ÐžÑ€Ð¸Ð³Ð¸Ð½Ð°Ð»"},replace:{en:"Replacement",ru:"Ð—Ð°Ð¼ÐµÐ½Ð°"}},moderator:{en:"Moderator",ru:"ÐœÐ¾Ð´ÐµÑ€Ð°Ñ‚Ð¾Ñ€"},ignored:{en:"Ignored",ru:"Ð˜Ð³Ð½Ð¾Ñ€Ð¸Ñ€ÑƒÐµÐ¼Ñ‹Ð¹"},userColors:{search:{en:"Search user",ru:"ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ"},hex:{en:"Hex color",ru:"Ð¦Ð²ÐµÑ‚ HEX"}}}};function Ot(e,t=null){const n=pe(),o=jt.placeholderTitles[e];return o?t&&"object"==typeof o&&o[t]?o[t][n]||o[t].en||"":"object"!=typeof o||t?"":o[n]||o.en||"":""}function Bt(e,t){e.addEventListener("click",(()=>{const n=e.classList.toggle("assigned-frozen-config");e.classList.toggle("assigned-thawed-config"),e.style.opacity=n?"1":"0.3",function(e,t){const n=localStorage.getItem("usersToTrack");if(n){const o=JSON.parse(n).map((n=>n.name===e?{...n,state:t}:n));localStorage.setItem("usersToTrack",JSON.stringify(o))}}(t,n?"frozen":"thawed"),kt(e,{en:n?"Unfreeze user":"Freeze user",ru:n?"Ð Ð°Ð·Ð¼Ð¾Ñ€Ð¾Ð·Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ":"Ð—Ð°Ð¼Ð¾Ñ€Ð¾Ð·Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ"})}))}function Ht(e){const t=document.createElement("div");return t.className=`${e}-item`,t}function Pt(e,t="",n=""){const o=document.createElement("input");return o.className=`settings-field ${e}-field`,o.value=t,o.placeholder=n,o}function Ft(e,t){const n=document.createElement("div");return n.className=`settings-button remove-settings-button remove-${e}-word`,n.innerHTML=st,function(e,t){e.addEventListener("click",(()=>{t.remove()}))}(n,t),kt(n,{en:"Remove user",ru:"Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ"}),n}function _t(e){const t=Ht("tracked"),n=Pt("tracked-id",e.id||"",Ot("tracked","id")),o=Pt("tracked-username",e.name,Ot("tracked","name"));o.disabled=!0;const s=Pt("tracked-pronunciation",e.pronunciation,Ot("tracked","pronunciation")),r=Ft("tracked",t),a=function(e="thawed",t){const n=document.createElement("div");return n.className=`settings-button assigned-settings-button assigned-${e}-config`,n.style.opacity="thawed"===e?"0.3":"1",n.innerHTML=at,Bt(n,t),kt(n,{en:"thawed"===e?"Freeze user":"Unfreeze user",ru:"thawed"===e?"Ð—Ð°Ð¼Ð¾Ñ€Ð¾Ð·Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ":"Ð Ð°Ð·Ð¼Ð¾Ñ€Ð¾Ð·Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ"}),n}("frozen"===e.state?"frozen":"thawed",e.name),i={en:`Username has changed. Previous name: ${e.name}`,ru:`Ð˜Ð¼Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ð»Ð¾ÑÑŒ. ÐŸÑ€Ð¾ÑˆÐ»Ð¾Ðµ Ð¸Ð¼Ñ: ${e.name}`};if(n.addEventListener("input",te((async function(e){const t=e.target.value.trim();if(t){const e=await F(t,"currentLogin");e?(o.value=e,o.placeholder=Ot("tracked","name")):(o.value="",o.placeholder=Ot("tracked","notFoundName"))}else o.value="",o.placeholder=Ot("tracked","name")}),500)),(!e.id||""===e.id)&&e.name&&""!==e.name.trim()){const e=o.value.trim();e&&P(e,"userId").then((e=>{e&&""===n.value.trim()&&(n.value=e,n.dispatchEvent(new Event("input",{bubbles:!0})))}))}e.id&&F(e.id,"currentLogin").then((t=>{const n=a.parentNode&&a.parentNode.querySelector(".confirm-settings-button");if(t&&t!==e.name){if(o.value=t,o.placeholder=Ot("tracked","name"),o.classList.add("input-warning"),kt(o,i[pe()]||i.en),!n){const t=function(e,t){const n=document.createElement("div");return n.className="settings-button confirm-settings-button",n.innerHTML=rt,kt(n,{en:"Confirm username change",ru:"ÐŸÐ¾Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¸Ñ‚ÑŒ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¸Ð¼ÐµÐ½Ð¸"}),n.addEventListener("click",(()=>{let o=[];try{o=JSON.parse(localStorage.getItem("usersToTrack"))||[]}catch{}const s=n.closest(".tracked-item"),r=s&&s.querySelector(".tracked-username-field"),a=r&&r.value,i=o.findIndex((t=>t.id===e.id));-1!==i&&a&&(o[i].name=a,localStorage.setItem("usersToTrack",JSON.stringify(o)),r.classList.remove("input-warning"),r&&Et(r)),n.remove(),"function"==typeof t&&t()})),n}(e);a.insertAdjacentElement("afterend",t)}}else o.classList.remove("input-warning"),Et(o),n&&n.remove()}));const l=document.createElement("select");l.className="tracked-gender-select";return[{value:"Male",emoji:"ðŸ‘¨"},{value:"Female",emoji:"ðŸ‘©"}].forEach((({value:t,emoji:n})=>{const o=document.createElement("option");o.value=t,o.textContent=`${n} ${t}`,e.gender===t&&(o.selected=!0),l.appendChild(o)})),t.appendChild(n),t.appendChild(o),t.appendChild(l),t.appendChild(s),t.appendChild(r),t.appendChild(a),t}function zt(e,t,n,o=!1){if(o)try{n[t]||(n[t]={}),n[t].change="user",n[t].changeDate=Date.now(),localStorage.setItem("userData",JSON.stringify(n));const o=e.closest(".settings-userColors-items-container");o&&o.firstChild!==e&&o.insertBefore(e,o.firstChild)}catch(e){}const s=e.querySelector(".userColors-header-row");if(s&&!s.querySelector(".userColors-user-badge")){const e=document.createElement("span");e.className="userColors-user-badge",e.innerHTML=ut,s.appendChild(e)}}const Rt=[{emoji:"ðŸ‘€",description:"Show chat static notifications",image:"https://i.imgur.com/oUPSi9I.jpeg",category:"notifications",type:"static"},{emoji:"ðŸ‘€",description:"Show global dynamic notifications",image:"https://i.imgur.com/8ffCdUG.jpeg",category:"notifications",type:"dynamic"},{emoji:"ðŸ”Š",description:"Play sound and voice notifications, messages only when the tab is inactive",image:"https://i.imgur.com/6PXFIES.jpeg",category:"sound",type:"activity"},{emoji:"ðŸ”Š",description:"Play a beep sound and speak feedback when the user enters or leaves the chat",image:"https://i.imgur.com/6PXFIES.jpeg",category:"sound",type:"presence"},{emoji:"ðŸ”Š",description:"Switch to google TTS engine if available",image:"https://i.imgur.com/0H94LII.jpeg",category:"sound",type:"gTTS"},{emoji:"ðŸ“¦ï¸",description:"Create participants counter",image:"https://i.imgur.com/rqIVAgH.jpeg",category:"elements",type:"counter"},{emoji:"ðŸŒ",description:"Interface language",image:"",category:"ui",type:"language",languages:[{value:"en",label:"ðŸ‡¬ðŸ‡§ English"},{value:"ru",label:"ðŸ‡·ðŸ‡º Ð ÑƒÑÑÐºÐ¸Ð¹"}]}],Ut=[{type:"tracked",emoji:"ðŸ‘€",key:"usersToTrack",selector:".settings-tracked-container",creator:_t},{type:"mention",emoji:"ðŸ“¢",key:"mentionKeywords",selector:".settings-mention-container",creator:function(e){const t=Ht("mention"),n=Pt("mention",e,Ot("mention")),o=Ft("mention",t);return t.appendChild(n),t.appendChild(o),t}},{type:"replacement",emoji:"â™»ï¸",key:"usernameReplacements",selector:".settings-replacement-container",creator:function(e={original:"",replacement:""}){const t=Ht("replacement"),n=Pt("replacement-original",e.original,Ot("replacement","find")),o=Pt("replacement",e.replacement,Ot("replacement","replace")),s=Ft("replacement",t);return t.appendChild(n),t.appendChild(o),t.appendChild(s),t}},{type:"moderator",emoji:"âš”ï¸",key:"moderator",selector:".settings-moderator-container",creator:function(e){const t=Ht("moderator"),n=Pt("moderator",e,Ot("moderator")),o=Ft("moderator",t);return t.appendChild(n),t.appendChild(o),t}},{type:"ignored",emoji:"ðŸ›‘",key:"ignored",selector:".settings-ignored-container",creator:function(e){const t=Ht("ignored"),n=Pt("ignored",e,Ot("ignored")),o=Ft("ignored",t);return t.appendChild(n),t.appendChild(o),t}},{type:"userColors",emoji:"ðŸŽ¨",key:"userData",selector:".settings-userColors-container",creator:function(e,t=null){const n=Ht("userColors");t||(t=JSON.parse(localStorage.getItem("userData")||"{}"));const o=t[e]||{id:"",color:"#808080"},s=n=>{t[e].color=n,localStorage.setItem("userData",JSON.stringify(t))},r=document.createElement("div");r.className="userColors-avatar";const a=o.id||"";let i="";if(a&&(i=E?.fetchedUsers?.[a]?.avatarTimestamp||"",!i))try{const e=JSON.parse(localStorage.getItem("fetchedUsers")||"{}");i=e?.[a]?.avatarTimestamp||""}catch{}if(a){const t=i&&"00"!==i?`/storage/avatars/${a}_big.png?updated=${i}`:`/storage/avatars/${a}_big.png`,n=document.createElement("img");n.alt=`${e}'s avatar`,n.className="userColors-avatar-img",n.onerror=()=>{r.innerHTML="";const e=document.createElement("div");e.className="userColors-avatar-emoji",e.textContent=oe(),r.appendChild(e)},n.src=t,r.appendChild(n)}else{r.innerHTML="";const e=document.createElement("div");e.className="userColors-avatar-emoji",e.textContent=oe(),r.appendChild(e)}const l=document.createElement("span");l.className="userColors-username-display",l.textContent=e;const c=Pt("userColors",o.color,Ot("userColors","hex"));Object.assign(c,{pattern:"^#[0-9A-Fa-f]{6}$",maxLength:7}),c.addEventListener("input",(e=>{let t=e.target.value.toUpperCase();t&&!t.startsWith("#")&&(t="#"+t),e.target.value=t,c.classList.toggle("input-warning",!/^#[0-9A-Fa-f]{6}$/.test(t))})),c.addEventListener("change",(r=>{if(/^#[0-9A-Fa-f]{6}$/.test(r.target.value)){const a=r.target.value;if(a===(t[e]&&t[e].color||o.color))return void(u&&(u.style.backgroundColor=a));s(a),zt(n,e,t,!0),u&&(u.style.backgroundColor=a)}}));const d=document.createElement("input");d.type="color",d.className="userColors-color-input-hidden",d.value=o.color,d.style.display="none";const u=document.createElement("div");u.className="userColors-color-swatch",u.style.backgroundColor=o.color,u.addEventListener("click",(()=>{d.click()})),d.addEventListener("change",(r=>{const a=r.target.value,i=t[e]&&t[e].color||o.color;c.value=a,c.classList.remove("input-warning"),u.style.backgroundColor=a,a!==i&&(s(a),zt(n,e,t,!0))}));const m=document.createElement("div");m.className="settings-button remove-settings-button remove-userColors-item",m.innerHTML=st,m.addEventListener("click",(()=>{delete t[e],localStorage.setItem("userData",JSON.stringify(t)),n.remove()})),kt(m,{en:"Remove user color",ru:"Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ñ†Ð²ÐµÑ‚ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ"});const p=document.createElement("div");p.className="userColors-content-wrapper";const g=document.createElement("div");g.className="userColors-controls-row",g.append(c,u,d,m);const h=document.createElement("div");return h.className="userColors-header-row",h.appendChild(r),h.appendChild(l),p.append(h,g),n.appendChild(p),"user"===t[e]?.change&&zt(n,e,t),n}},{type:"toggle",emoji:"ðŸ”˜",key:"toggle",selector:".settings-toggle-container",creator:function(e,t,n){const o=Ht("toggle");if("language"===e.type){const s=document.createElement("select");s.className="language-toggle-select",(e.languages||[]).forEach((e=>{const t=document.createElement("option");t.value=e.value,t.textContent=e.label,s.appendChild(t)})),s.value=t;const r=document.createElement("span");return r.className="toggle-description",r.textContent=`${e.emoji} ${n}`,o.appendChild(s),o.appendChild(r),o}const s=document.createElement("select");s.className="toggle-select";const r=document.createElement("span");return r.className="toggle-description",r.dataset.category=e.category,r.dataset.type=e.type,r.textContent=`${e.emoji} ${n}`,r.style.cursor="pointer",r.style.transition="color 0.15s ease-in-out",r.addEventListener("click",(()=>{e.image&&window.open(e.image,"_blank")})),[{value:"yes",emoji:"âœ”ï¸"},{value:"no",emoji:"âŒ"}].forEach((({value:e,emoji:t})=>{const n=document.createElement("option");n.value=e,n.textContent=`${t} ${e}`,s.appendChild(n)})),s.value=t,o.appendChild(s),o.appendChild(r),o}}];async function Jt(e){const t=e.target.files[0];if(t){const e=new FileReader;return new Promise(((n,o)=>{e.onload=function(e){const t=e.target.result;try{Xt(JSON.parse(t)),n()}catch(e){console.error("Error parsing JSON data:",e.message),console.error("Invalid JSON:",t),ge({en:"Failed to parse JSON data. Please check the format and try again.",ru:"ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ñ€Ð°Ð·Ð¾Ð±Ñ€Ð°Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ JSON. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ð¸ Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÑÐ½Ð¾Ð²Ð°."},"alert"),o(e)}},e.onerror=function(e){console.error("Error reading file:",e.target.error),o(e.target.error)},e.readAsText(t)}))}}function Kt(e){if(!e||"object"!=typeof e)return console.error("Invalid settings data for download."),void ge({en:"Cannot import settings. Please try again.",ru:"ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÑÐ½Ð¾Ð²Ð°."},"alert");try{const t="  ",n="    ";let o="{\n";Ut.forEach(((s,r)=>{const a=s.key,i=e[a];let l="";l=Array.isArray(i)?`[\n${i.map((e=>`${n}${JSON.stringify(e)}`)).join(",\n")}\n${t}]`:JSON.stringify(i),o+=`${t}"${a}": ${l}`,r<Ut.length-1?o+=",\n":o+="\n"})),o+="}";const s=`KG_Chat_Empowerment_Settings_${new Intl.DateTimeFormat("en-CA").format(new Date)}.json`,r=new Blob([o],{type:"application/json"}),a=URL.createObjectURL(r),i=document.createElement("a");i.href=a,i.download=s,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a)}catch(e){console.error("Error exporting settings:",e),ge({en:"Failed to export settings. Please try again.",ru:"ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ ÑÐºÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÑÐ½Ð¾Ð²Ð°."},"alert")}}function Yt(){return Object.fromEntries(Ut.map((e=>[e.key,JSON.parse(localStorage.getItem(e.key))||[]])))}function Xt(e){Ut.forEach((t=>{Array.isArray(e[t.key])&&(tn[t.key]=e[t.key]),Ut.forEach((e=>{localStorage.setItem(e.key,JSON.stringify(tn[e.key]))})),console.log(`Updated setting for ${t.key}:`,tn[t.key])}))}function Vt(e){const t=document.querySelector(".settings-content-container");if(!t)return console.error("Container not found.");const n=()=>{e.style.opacity="0",setTimeout((()=>{e.style.visibility="hidden",e.style.display="none"}),300)},o=Yt(),s=()=>{const s={};Ut.forEach((e=>{s[e.key]=[]}));let r=!1;const a={en:"Duplicate: this ID is already used.",ru:"Ð”ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ‚: ÑÑ‚Ð¾Ñ‚ ID ÑƒÐ¶Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ."},i=new Map;t.querySelectorAll(".settings-tracked-container .tracked-item").forEach((e=>{const t=e.querySelector(".tracked-id-field"),n=e.querySelector(".tracked-username-field"),o=e.querySelector(".tracked-gender-select"),l=e.querySelector(".tracked-pronunciation-field"),c=e.querySelector(".assigned-thawed-config, .assigned-frozen-config");let d=t?t.value:"";if(t&&d){let e=d.replace(/[^\d]/g,"");e=e.replace(/^\s+/,""),d!==e?(t.value=e,d=e,t.classList.add("input-error"),Y(t),kt(t,{en:"ID must contain digits only.",ru:"ID Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ†Ð¸Ñ„Ñ€Ñ‹."})):(t.classList.remove("input-error"),Et(t))}const u=n?n.value.trim():"",m=o?o.value.trim():"",p=l?l.value.trim():"",g=c.classList.contains("assigned-frozen-config")?"frozen":"thawed";if(d)if(i.has(d)){[i.get(d)[0],t].forEach((e=>{e&&(e.classList.add("input-error"),Y(e),e._customTooltipDuplicate||(kt(e,a),e._customTooltipDuplicate=!0))})),i.get(d).push(t),r=!0}else i.set(d,[t]),t.classList.remove("input-error"),Et(t);else t.classList.remove("input-error"),Et(t),t._customTooltipDuplicate&&delete t._customTooltipDuplicate;s.usersToTrack.push({id:d,name:u,gender:m,pronunciation:p,state:g})}));const l=new Set(s.usersToTrack.map((e=>e.name.toLowerCase())));t.querySelectorAll(".settings-mention-container .mention-item").forEach((e=>{const t=e.querySelector(".mention-field"),n=t?t.value.trim():"";if(n&&void 0!==v&&v&&n.toLowerCase()===v.toLowerCase())return t.classList.add("input-error"),Y(t),void kt(t,{en:"You cannot add your own nickname as a mention keyword.",ru:"ÐÐµÐ»ÑŒÐ·Ñ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÑÐ²Ð¾Ð¹ ÑÐ¾Ð±ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¹ Ð½Ð¸Ðº Ð² ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ ÑÐ»Ð¾Ð²Ð° ÑƒÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ð¹."});t.classList.remove("input-error"),Et(t),s.mentionKeywords.push(n)})),t.querySelectorAll(".settings-replacement-container .replacement-item").forEach((e=>{const t=e.querySelector(".replacement-original-field"),n=e.querySelector(".replacement-field"),o=t?t.value.trim():"",r=n?n.value.trim():"";if(l.has(o.toLowerCase()))return t.classList.add("input-error"),Y(t),void kt(t,{en:"You cannot create a replacement for a user you are already tracking.",ru:"ÐÐµÐ»ÑŒÐ·Ñ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ð·Ð°Ð¼ÐµÐ½Ñƒ Ð´Ð»Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ ÑƒÐ¶Ðµ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°ÐµÑ‚ÑÑ."});t.classList.remove("input-error"),Et(t),s.usernameReplacements.push({original:o,replacement:r})})),t.querySelectorAll(".settings-moderator-container .moderator-item").forEach((e=>{const t=e.querySelector(".moderator-field"),n=t?t.value.trim():"";s.moderator.push(n)})),t.querySelectorAll(".settings-ignored-container .ignored-item").forEach((e=>{const t=e.querySelector(".ignored-field"),n=t?t.value.trim():"";s.ignored.push(n)})),t.querySelectorAll(".settings-toggle-container .toggle-item").forEach((e=>{const t=e.querySelector("select");if(t.classList.contains("language-toggle-select"))s.toggle.push({category:"ui",type:"language",option:t.value});else if(t.classList.contains("toggle-select")){const n=e.querySelector(".toggle-description"),o=t.value.trim()||"no";s.toggle.push({category:n.dataset.category,type:n.dataset.type,option:o})}}));if(!s.toggle.some((e=>"language"===e.type))){const e=o.toggle?.find((e=>"language"===e.type));e&&s.toggle.push(e)}return JSON.stringify(o)!==JSON.stringify(s)&&!r?(e.style.visibility="visible",e.style.display="flex",setTimeout((()=>{e.style.opacity="1"}),10)):n(),s};e.addEventListener("click",(()=>{const e=s();Xt(e),Object.assign(o,e),n()})),t.querySelectorAll("input, select").forEach((e=>{e.addEventListener("input",s)}));new MutationObserver(te((e=>{e.forEach((e=>{"childList"===e.type&&(e.addedNodes.forEach((e=>{var t;e.nodeType===Node.ELEMENT_NODE&&("INPUT"===(t=e).tagName||"SELECT"===t.tagName?t.addEventListener("input",s):t.querySelectorAll("input, select").forEach((e=>{e.addEventListener("input",s)})))})),e.removedNodes.forEach((e=>{e.nodeType===Node.ELEMENT_NODE&&s()})))}))}),300)).observe(t,{childList:!0,subtree:!0})}function Gt(){Ut.forEach((e=>{const t=document.querySelector(e.selector);if(t){const e=t.querySelector(".add-settings-button");t.replaceChildren(),e&&t.appendChild(e)}}))}function Wt(){const e=Yt(),t=document.querySelector(".settings-content-container");t.innerHTML="",Ut.forEach((n=>{const{key:o,creator:s,type:r}=n,a=document.createElement("div");if(a.className=`settings-${r}-container`,a.classList.add("settings-container"),"userColors"===r){const e=JSON.parse(localStorage.getItem("userData")||"{}");let t=Object.keys(e);t.sort(((t,n)=>{const o=e[t]&&"user"===e[t].change,s=e[n]&&"user"===e[n].change;if(o&&s){const o=e[t].changeDate||0,s=e[n].changeDate||0;return o!==s?s-o:t.localeCompare(n)}return o!==s?o?-1:1:t.localeCompare(n)}));const n=document.createElement("div");n.className="userColors-search-container";const o=document.createElement("input");o.type="search",o.className="settings-field userColors-search-field",o.placeholder=jt.placeholderTitles.userColors?.search?.[pe()]||"Search",n.appendChild(o),a.appendChild(n);const r=document.createElement("div");r.className="settings-userColors-items-container",t.forEach((t=>{const n=s(t,e);n&&n instanceof HTMLElement&&(n.dataset.username=t),r.appendChild(n)})),a.appendChild(r);const i=te((e=>{const t=(e.target.value||"").trim().toLowerCase();r.querySelectorAll(".userColors-item").forEach((e=>{const n=(e.dataset.username||"").toLowerCase();""===t||n.includes(t)?e.classList.remove("userColors-hidden"):e.classList.add("userColors-hidden")}))}),150);o.addEventListener("input",i)}else if("toggle"!==r){(e[o]||[]).forEach((e=>a.appendChild(s(e))));const t=function(e,t){const n=e.split("-")[1],o=document.querySelector(`.add-${n}-item`);o&&o.remove();const s=document.createElement("div");return s.className=`settings-button add-settings-button add-${n}-item`,s.innerHTML=it,kt(s,{en:"Add new user",ru:"Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ"}),s.addEventListener("click",(()=>{const o=document.querySelector(e),r=o.querySelectorAll(`.${n}-item`),a=r.length>0?r[r.length-1]:null,i=a?a.querySelectorAll("input"):[],l=Array.from(i).some((e=>0===e.value.trim().length));if(a&&l)ge({en:"Please fill in the previous field before adding a new one.",ru:"ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð·Ð°Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐµ Ð¿Ð¾Ð»Ðµ Ð¿ÐµÑ€ÐµÐ´ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸ÐµÐ¼ Ð½Ð¾Ð²Ð¾Ð³Ð¾."},"alert");else{const e=t(t===_t?{name:"",pronunciation:""}:"");e instanceof HTMLElement?o.insertBefore(e,s):console.error("Invalid item created.")}})),s}(`.settings-${r}-container`,s);a.appendChild(t)}else{const e=JSON.parse(localStorage.getItem(o))||[],t=pe();Rt.forEach((n=>{const o=e.find((e=>e.category===n.category&&e.type===n.type));let r="yes";if("language"===n.type){const t=e.find((e=>"ui"===e.category&&"language"===e.type));r=t?t.option:"en"}else r=o?o.option:"yes";const i=jt.toggleTitles[n.type][t],l=s(n,r,i);a.appendChild(l)}))}const i=function(e,t={}){const n=document.createElement("div");n.classList.add("settings-spoiler");const o=document.createElement("button"),s=t.type,r=pe(),a=Ut.find((e=>e.type===s)),i=a&&a.emoji?a.emoji+" ":"",l=jt.spoilerTitles[s]||jt.spoilerTitles.toggle;return o.textContent=t.showText||i+l[r].show,e.style.display="none",o.addEventListener("click",(()=>{const n="none"===e.style.display;o.textContent=n?t.hideText||i+l[r].hide:t.showText||i+l[r].show,e.style.display=n?"flex":"none"})),n.appendChild(o),n.appendChild(e),n}(a,{type:r,showText:void 0,hideText:void 0});t.appendChild(i)}))}let{panelsEvents:Zt}=E;const Qt=localStorage.getItem("KG_Chat_Empowerment"),en=Qt?JSON.parse(Qt):{voiceSettings:{voiceSpeed:1.5,voicePitch:1},messageSettings:{}};Qt||localStorage.setItem("KG_Chat_Empowerment",JSON.stringify(en));const tn=Object.fromEntries(Ut.map((e=>[e.key,[]])));Ut.forEach((e=>{const t=e.key,n=JSON.parse(localStorage.getItem(t))||[];n.length&&tn[t].splice(0,tn[t].length,...n)}));const nn=Ut.find((e=>"mention"===e.type));function on(e){const t=document.createElement("div");t.classList.add("empowerment-button","settings-button"),kt(t,{en:"Open Settings",ru:"ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸"}),t.style.position="relative",t.innerHTML=He;const n=document.createElement("input");n.type="file",n.accept=".json",n.style.display="none",n.addEventListener("change",Jt),t.addEventListener("click",(e=>{X(t),Tt&&Kt(Yt()),Lt&&n.click(),Tt||Lt||function(){const e=document.querySelector(".settings-panel");if(e)return e.remove(),void It("hide");ee();const t=document.createElement("div");t.className="settings-panel popup-panel",Zt.handleSettingsKeydown=e=>{"Escape"===e.key&&(Nt(t,"hide"),It("hide"),document.removeEventListener("keydown",Zt.handleSettingsKeydown))},document.addEventListener("keydown",Zt.handleSettingsKeydown);const n=document.createElement("div");n.className="panel-header";const o=document.createElement("div");o.classList.add("panel-control-buttons");const s=document.createElement("div");s.className="large-button panel-header-close-button",s.innerHTML=Pe,kt(s,{en:"Close panel",ru:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ð°Ð½ÐµÐ»ÑŒ"}),s.addEventListener("click",(()=>{Nt(t,"hide"),It("hide")}));const r=document.createElement("div");r.className="large-button panel-header-clear-button",r.innerHTML=Qe,kt(r,{en:"Clear settings",ru:"ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸"}),r.addEventListener("click",(()=>{Gt()}));const a=document.createElement("div");a.className="large-button panel-header-import-button",a.innerHTML=tt,kt(a,{en:"Import settings",ru:"Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸"});const i=document.createElement("div");i.className="large-button panel-header-save-button",i.innerHTML=ot,kt(i,{en:"Save settings",ru:"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸"});const l=document.createElement("input");l.type="file",l.accept=".json",l.style.display="none",l.addEventListener("change",(async e=>{await Jt(e),Gt(),Wt()})),a.addEventListener("click",(()=>{l.click()})),a.appendChild(l);const c=document.createElement("div");c.className="large-button panel-header-export-button",c.innerHTML=nt,kt(c,{en:"Export settings",ru:"Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸"}),c.addEventListener("click",(function(){Kt(Yt())})),o.append(i,a,c,r,s),n.appendChild(o),t.appendChild(n);const d=document.createElement("div");d.className="settings-content-container",Ut.forEach((({type:e})=>{const t=document.createElement("div");t.className=`settings-${e}-container`,d.appendChild(t)})),t.appendChild(d);const{scrollButtonsContainer:u}=Dt(d);t.appendChild(u),document.body.appendChild(t),Wt(),Vt(i),Nt(t,"show"),It("show")}()})),t.appendChild(n),e.appendChild(t)}void 0!==v&&v&&nn&&tn[nn.key].push(v);const{ignored:sn,mentionKeywords:rn,usernameReplacements:an,usersToTrack:ln}=tn;function cn(e){const t=e.toLowerCase();return rn.some((e=>t.includes(e.toLowerCase())))}function dn(e){if(null===e)return e;const t=[...ln.map((e=>e.name)),...an.map((e=>e.original))],n=new RegExp(`(${t.join("|")})`,"gu");return e.replace(n,(e=>{const t=an.find((t=>t.original===e));if(t)return t.replacement;const n=ln.find((t=>t.name===e));return n?.pronunciation||e}))}function un(e="generalMessages"){const t={generalMessages:{container:".messages-content div",messageElement:"p",exclude:[".time",".username"]},chatlogsMessages:{container:".chat-logs-container",messageElement:".message-text"},personalMessages:{container:".messages-container",messageElement:".message-text"}}[e];if(!t)return void console.error("Invalid container type");const n=document.querySelectorAll(t.container),o=new WeakSet;n.forEach((n=>{n.querySelectorAll(t.messageElement).forEach((n=>{[...n.querySelectorAll(".private"),...n.querySelectorAll(".system-message"),n].forEach((n=>{const s=document.createTreeWalker(n,NodeFilter.SHOW_TEXT,{acceptNode:n=>{if(o.has(n))return NodeFilter.FILTER_SKIP;const s=n.parentElement;return s.closest(".mention, .time, .username")||"generalMessages"===e&&s.closest(t.exclude.join(","))?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT}},!1),r=[];let a;for(;a=s.nextNode();)r.push(a);r.forEach((e=>{o.has(e)||(!function(e){const t=/[\s]+|[^\s\wÐ°-ÑÐ-Ð¯Ñ‘Ð]+|[\wÐ°-ÑÐ-Ð¯Ñ‘Ð]+/g,n=e.textContent.match(t);if(!n)return;const o=document.createDocumentFragment();n.forEach((e=>{if(rn.map((e=>e.toLowerCase())).includes(e.toLowerCase())){const t=document.createElement("span");t.className="mention",t.textContent=e,o.appendChild(t)}else o.appendChild(document.createTextNode(e))})),e.parentNode.replaceChild(o,e)}(e),o.add(e))}))}))}))}))}let mn=null;async function pn(){const e=document.querySelector(".messages-content div p:last-of-type");if(!e)return null;const t=async e=>Array.from(e.childNodes).map((e=>e.nodeType===Node.TEXT_NODE&&e.textContent.trim()?e.textContent.trim():"IMG"===e.nodeName&&e.getAttribute("title")?e.getAttribute("title"):"A"===e.nodeName&&e.getAttribute("href")?e.getAttribute("href"):"")).filter(Boolean);let n=(await t(e)).join(" ").trim(),o="common";const s=e.querySelector(".room.private");if(s&&s.textContent.includes("[ÑˆÐµÐ¿Ñ‡ÐµÑ‚ ")){const s=e.querySelector("span.private");s&&(n=(await t(s)).join(" ").trim(),o="private")}const r=e.querySelector(".system-message");if(r){let e=(await t(r)).join(" ").trim();e=e.replace(/<ÐšÐ»Ð°Ð²Ð¾Ð±Ð¾Ñ‚>\s*/g,""),n=e,o="system"}"common"===o&&cn(n)&&(o="mention");const a=JSON.parse(localStorage.getItem("personalMessages"))||{},i=e.querySelector(".time")?.textContent||"N/A",l=e.querySelector(".username span[data-user]"),c=l?l.getAttribute("data-user"):null,d=l?l.textContent:"SYSTEM",u=U(l?l.parentElement.style.color:"rgb(180,180,180)","rgb"),m=`${i}_${d}_${x}`;if(("mention"===o||"private"===o)&&!sn.includes(d)){a[m]={time:i,date:x,username:d,usernameColor:u,message:n,type:o,userId:c},localStorage.setItem("personalMessages",JSON.stringify(a));const e=`${x}|${i}|${d}`;localStorage.setItem("lastClickedMessage",e)}const p=e.querySelector(".username"),g=p?p.textContent.replace(/[<>]/g,""):"SYSTEM";un();let h="mention"===o||"private"===o?`${dn(g)} Ð¾Ð±Ñ€Ð°Ñ‰Ð°ÐµÑ‚ÑÑ: `:g!==mn?`${dn(g)} Ð¿Ð¸ÑˆÐµÑ‚: `:"";mn=g;return{messageText:h+dn(n),usernameText:g}}function gn(e){return/^https?:\/\//.test(e)&&/%[0-9A-Fa-f]{2}/.test(e)}function hn(e){const[t]=e.split("#");return decodeURIComponent(t).replace(/ /g,"_")}function fn(e){document.querySelector({generalMessages:".messages-content div",chatlogsMessages:".chat-logs-container",personalMessages:".messages-container-wrapper"}[e])?.querySelectorAll("a:not(.media):not(.decoded)").forEach((e=>{try{if(gn(e.href)){let t=hn(e.href);e.href=e.textContent=t,e.classList.add("decoded")}}catch(t){console.error("Error decoding link:",t,e.href)}}))}var yn=n(365),vn={};vn.styleTagTransform=g(),vn.setAttributes=d(),vn.insert=l().bind(null,"head"),vn.domAPI=a(),vn.insertStyleElement=m();s()(yn.A,vn);yn.A&&yn.A.locals&&yn.A.locals;const bn={online:"âœ…",offline:"ðŸ›‘",rankSpeed:"ðŸš€",ratingLevel:"â­",carsCount:"ðŸš–",friendsCount:"ðŸ¤",visitsCount:"ðŸ‘ï¸",alpha:"ðŸ…°ï¸",registered:"ðŸ“…"};function xn(e,t,n,o,s,r){let a="rankSpeed",i=null;const l=document.createElement("div");l.className="sort-buttons-container";function c(){var i;e.sort((i=a,(e,t)=>{if("online"===i){if(e.sortData.isOnline&&!t.sortData.isOnline)return-1;if(!e.sortData.isOnline&&t.sortData.isOnline)return 1}else if("offline"===i){if(!e.sortData.isOnline&&t.sortData.isOnline)return-1;if(e.sortData.isOnline&&!t.sortData.isOnline)return 1}else if("ratingLevel"===i){if(e.sortData.ratingLevel!==t.sortData.ratingLevel)return t.sortData.ratingLevel-e.sortData.ratingLevel}else if("carsCount"===i){if(e.sortData.cars!==t.sortData.cars)return t.sortData.cars-e.sortData.cars}else if("friendsCount"===i){if(e.sortData.friends!==t.sortData.friends)return t.sortData.friends-e.sortData.friends}else if("visitsCount"===i){if(e.sortData.visits!==t.sortData.visits)return t.sortData.visits-e.sortData.visits}else{if("alpha"===i){const n=e=>/^[\u0400-\u04FF]/.test(e)?0:/^[A-Za-z]/.test(e)?1:2,o=n(e.userElement.querySelector(".login")?.textContent||""),s=n(t.userElement.querySelector(".login")?.textContent||"");if(o!==s)return o-s;const r=(e.userElement.querySelector(".login")?.textContent||"").toLocaleLowerCase(),a=(t.userElement.querySelector(".login")?.textContent||"").toLocaleLowerCase();return r.localeCompare(a)}if("registered"===i)return new Date(e.registered)-new Date(t.registered)}return e.sortData.order!==t.sortData.order?e.sortData.order-t.sortData.order:t.sortData.bestSpeed-e.sortData.bestSpeed})),t.replaceChildren(),n.replaceChildren(),t.appendChild(s),n.appendChild(r),e.forEach((({userElement:e,registered:s})=>{(o(s)?n:t).appendChild(e)}))}return["online","offline","rankSpeed","ratingLevel","carsCount","friendsCount","visitsCount","alpha","registered"].forEach((t=>{const n=document.createElement("button");n.className=`sort-button ${t}`,n.textContent=bn[t],n.dataset.mode=t,n.addEventListener("click",(()=>{if("online"===t||"offline"===t){if(e.some((e=>e.userElement.querySelector(".present-marker.waiting"))))return void ge({en:"Some user statuses are still loading.",ru:"Ð¡Ñ‚Ð°Ñ‚ÑƒÑÑ‹ Ð½ÐµÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ñ… Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ ÐµÑ‰Ñ‘ Ð·Ð°Ð³Ñ€ÑƒÐ¶Ð°ÑŽÑ‚ÑÑ."})}i&&i.classList.remove("active"),n.classList.add("active"),i=n,a=t,c()})),t===a&&(n.classList.add("active"),i=n),l.appendChild(n)})),c(),l}async function wn(e,t=!0){let n=t&&JSON.parse(localStorage.getItem("fetchedUsers"))||{};const o=n[e];if(t&&function(e){return e&&"object"==typeof e&&["rank","login","registered","bestSpeed","ratingLevel","friends","cars","avatarTimestamp"].every((t=>void 0!==e?.[t]))}(o))return{rank:o.rank,login:o.login,registeredDate:o.registered,bestSpeed:o.bestSpeed,ratingLevel:o.ratingLevel,friends:o.friends,cars:o.cars,avatar:o.avatar,avatarTimestamp:o.avatarTimestamp};try{const[o,s]=await Promise.all([F(e,"allUserData"),F(e,"allIndexData")]);if(!o||!s)throw new Error("Invalid data format received from the API.");const r=o.title||(o.status?.title??null),a=o.login||null,i=q(s.stats?.registered),l=s.stats?.best_speed||0,c=s.stats?.rating_level||0,d=s.stats?.friends_cnt||0,u=s.stats?.cars_cnt||0,m=o.avatar||null,p=m?.sec||0,g=m?.usec||0,h=null!=p&&null!=g?D(p,g):null;if(a&&r&&i)return t&&(n[e]={rank:r,login:a,registered:i,bestSpeed:l,ratingLevel:c,friends:d,cars:u,avatar:m,avatarTimestamp:h},localStorage.setItem("fetchedUsers",JSON.stringify(n))),{rank:r,login:a,registeredDate:i,bestSpeed:l,ratingLevel:c,friends:d,cars:u,avatar:m,avatarTimestamp:h};throw new Error("Invalid data format received from the API.")}catch(t){throw console.error(`Error fetching user profile data for ${e}:`,t),t}}function Cn(e,t){const n=document.createElement("div");n.className="user-item";const o=document.createElement("div");o.className="avatar";const s=t.avatarTimestamp,r=`/storage/avatars/${e}_big.png`;if(s&&"00"!==s||t.avatar&&Object.keys(t.avatar).length){const e=document.createElement("img");e.src=`${r}?updated=${s}`,e.alt=`${t.login}'s avatar`,e.style.objectFit="cover",o.appendChild(e)}else o.innerHTML=oe();const a=document.createElement("div");a.className="user-data";const i=document.createElement("div");i.className="login-container";const l=document.createElement("span");l.className="present-marker waiting";const c={isOnline:null,ratingLevel:t.ratingLevel,cars:t.cars,friends:t.friends,bestSpeed:t.bestSpeed||0,order:T[t.rank]||10,visits:void 0!==t.visits?t.visits:0};F(e,"isOnline").then((e=>{l.classList.remove("waiting"),l.className="present-marker "+(e?"online":"offline"),c.isOnline=e})).catch((()=>{console.error(`Failed to fetch online status for user ${e}`),l.classList.remove("waiting"),l.className="present-marker offline",c.isOnline=!1})),i.appendChild(l);const d=document.createElement("a");if(d.className="login",d.textContent=t.login,d.href=`https://klavogonki.ru/profile/${e}`,i.appendChild(d),void 0!==t.visits){const n=document.createElement("span");n.className="visits "+(t.tracked?"tracked":"untracked"),n.textContent=t.visits,n.dataset.userId=e,function(e){const t=Number(e.textContent);if(isNaN(t))return console.warn("Invalid visits count!");const n=t<=10?"ðŸ’§":t<=20?"ðŸ’¦":t<=30?"ðŸŒŠ":"ðŸ”¥";e.textContent=`${n} ${t}`}(n),i.appendChild(n)}a.appendChild(i);const u=document.createElement("div");u.className="rank",u.textContent=t.rank||"N/A",u.style.color=M[t.rank]||"white",a.appendChild(u);const m=document.createElement("div");m.className="registered",m.textContent=t.registered||"N/A",a.appendChild(m);const p=(e,t,n,o,s,r)=>{const a=document.createElement("span");return a.className=e,a.style.color=t,a.innerHTML=`${n}${o||0}`,a.style.cursor="pointer",a.dataset.url=r,a},g=document.createElement("div");return g.className="user-metrics",g.append(p("best-speed","cyan","ðŸš€",t.bestSpeed,0,`https://klavogonki.ru/u/#/${e}/stats/normal/`),p("rating-level","gold","â­",t.ratingLevel,0,`https://klavogonki.ru/top/rating/today?s=${t.login}`),p("cars-count","lightblue","ðŸš–",t.cars,0,`https://klavogonki.ru/u/#/${e}/car/`),p("friends-count","lightgreen","ðŸ¤",t.friends,0,`https://klavogonki.ru/u/#/${e}/friends/list/`)),n.append(o,a,g),{userElement:n,sortData:c,registered:t.registered}}const Sn=pe();function kn(e){const t=document.createElement("div");return"old"===e?t.className="users-container old-users":"new"===e?t.className="users-container new-users":"search"===e&&(t.className="users-container search-results"),t}function En(e,t){const n=document.createElement("span");return n.className=`description ${t}`,n.textContent=e,n}async function $n(e,t=Cn){const n=document.querySelector(".old-users"),o=document.querySelector(".new-users"),s=document.querySelector(".fetched-users");if(e){n.style.display="none",o.style.display="none";let r=document.querySelector(".search-results")||kn("search");r.parentElement||s.appendChild(r),r.replaceChildren();const a=[];try{const n=await async function(e){try{const t=`https://klavogonki.ru/api/profile/search-users?query=${e}`,n=await j(t);return n.all?.length?n.all.map((e=>e.id)):[]}catch(e){return console.error("Error getting user IDs:",e),[]}}(e);await Promise.all(n.map((async e=>{const n=await wn(e,!1),o={rank:n.rank,login:n.login,registered:n.registeredDate,bestSpeed:n.bestSpeed,ratingLevel:n.ratingLevel,friends:n.friends,cars:n.cars,avatarTimestamp:n.avatarTimestamp,avatar:n.avatar},s=t(e,o);s&&a.push(s)}))),a.sort(((e,t)=>e.sortData.order!==t.sortData.order?e.sortData.order-t.sortData.order:t.sortData.bestSpeed-e.sortData.bestSpeed));const o="ru"===Sn?"Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¿Ð¾Ð¸ÑÐºÐ° Ð´Ð»Ñ:":"Search Results for:";let s=document.querySelector(".search-results-info");s||(s=document.createElement("div"),s.className="search-results-info"),s.textContent=`${o} ${e}`,r.appendChild(s),a.forEach((({userElement:e})=>r.appendChild(e)))}catch(e){console.error("Error fetching user profile:",e);const t=document.createElement("div");t.className="error-message-info",t.textContent=`Error: ${e.message}`,r.appendChild(t)}}}const Ln=e=>{let t=document.querySelector(".profile-iframe-container");if(t)return void(t.src=e);t=document.createElement("iframe"),t.classList.add("profile-iframe-container"),t.src=e,document.body.appendChild(t),Mt(t,"show",1);const n=()=>{Mt(t,"hide",0),document.removeEventListener("keydown",o),document.removeEventListener("mousedown",o)},o=e=>{if("keydown"===e.type&&"Space"===e.code){if(window.lastFocusedIframeTextarea)return void e.stopPropagation();e.preventDefault(),n()}if("mousedown"===e.type&&!t.contains(e.target)){let t=e.target;for(;t&&t!==document.body;){if(t.classList&&(t.classList.contains("profile")||t.classList.contains("name")||t.classList.contains("login")))return;t=t.parentElement}n()}};document.addEventListener("keydown",o),document.addEventListener("mousedown",o),t.onload=()=>{try{const e=t.contentWindow,s=e.document;s.addEventListener("focusin",(e=>{"TEXTAREA"===e.target.tagName&&(window.lastFocusedIframeTextarea=e.target)})),s.addEventListener("focusout",(()=>{setTimeout((()=>{s.activeElement&&"TEXTAREA"===s.activeElement.tagName||(window.lastFocusedIframeTextarea=null)}),0)})),e.addEventListener("keydown",o),e.addEventListener("dblclick",n),new MutationObserver(((e,t)=>{e.some((e=>[...e.removedNodes].some((e=>1===e.nodeType&&(e.classList.contains("dimming-background")||e.classList.contains("cached-users-panel"))))))&&(n(),t.disconnect())})).observe(document.body,{childList:!0,subtree:!0})}catch(e){console.warn("Unable to access iframe contents:",e)}}};let Tn=pe();const Mn="ðŸ™Œ",Nn="âŒ",In="âœ…",An="ðŸ›‘";function qn(e,t){const n=Object.values(JSON.parse(localStorage.getItem("fetchedUsers")||"[]")).find((t=>t?.login===e));if(!n)return;const o=n.actionLog||[],s=o.find((e=>e.timestamp===t));if(!s)return;const r=o.indexOf(s);if(0===r)return"en"===Tn?`${Mn} ${e}'s first action`:`${Mn} ${e} Ð¿ÐµÑ€Ð²Ð¾Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ`;const a=o.slice(0,r).reverse().find((e=>e.type!==s.type));if(!a)return"en"===Tn?`${Nn} No valid previous action found for ${t}`:`${Nn} ÐÐµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ³Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ Ð´Ð»Ñ ${t}`;const i=function(e,t){const n=e=>e.split(":").reduce(((e,t,n)=>e+t*[3600,60,1][n]),0),o=Math.abs(n(t)-n(e));return[Math.floor(o/3600),Math.floor(o%3600/60),o%60].map((e=>e.toString().padStart(2,"0"))).join(":")}(a.timestamp,s.timestamp);return"leave"===s.type?"en"===Tn?`${An} ${e} stayed in chat for ${i}`:`${An} ${e} Ð¿Ñ€Ð¸ÑÑƒÑ‚ÑÑ‚Ð²Ð¾Ð²Ð°Ð» Ð² Ñ‡Ð°Ñ‚Ðµ ${i}`:"en"===Tn?`${In} ${e} was absent from chat for ${i}`:`${In} ${e} Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²Ð¾Ð²Ð°Ð» Ð² Ñ‡Ð°Ñ‚Ðµ ${i}`}function Dn(e,t){const n=t.getBoundingClientRect(),o=e.getBoundingClientRect();return o.top>=n.top&&o.bottom<=n.bottom}function jn(e="generalMessages",t=600){const n={generalMessages:".messages-content",chatlogsMessages:".chat-logs-container",personalMessages:".messages-container-wrapper"}[e];if(!n)return;const o=document.querySelector(n);if(o)if(void 0===jn.firstTime&&(jn.firstTime=!0),jn.firstTime)o.scrollTop=o.scrollHeight,jn.firstTime=!1;else{o.scrollHeight-o.scrollTop-o.clientHeight<=t&&(o.scrollTop=o.scrollHeight)}}async function On(e,t){const{top:n,height:o}=t.getBoundingClientRect(),{top:s,height:r}=e.getBoundingClientRect(),a=n-(s+r/2)+o/2;e.scrollBy({top:a,behavior:"smooth"}),await new Promise((e=>setTimeout(e,500))),e.style.scrollBehavior="auto";const i=e.querySelector(".focused-message");i&&i.classList.remove("focused-message"),Y(t),t.classList.add("focused-message")}const{usersToTrack:Bn}=tn,Hn=e=>new Promise((t=>setTimeout(t,e)));function Pn(e){const t=document.createElement("span");return t.classList.add("action-icon"),t.style.margin="0 4px",t.style.setProperty("border","none","important"),t.innerHTML=e,t}function Fn(e,t,n,o,s){const r={generalChat:".messages-content div",cachePanel:".fetched-users .action-log"}[s];if(!r)return void console.error("Invalid or missing container. Please provide 'generalChat' or 'cachePanel'.");const a=document.querySelector(r);if(!a)return void console.error("Container not found in DOM.");a.classList.add("generalChat"===s?"static-chat-notifications-container":"static-cache-notifications-container");const i=document.createElement("span");i.classList.add("static-chat-notification"),"generalChat"===s&&i.addEventListener("dblclick",(()=>{!async function(e=40,t=600,n=140){const o=document.querySelector(".messages-content");if(!o)return;const s=o.style.scrollBehavior;o.style.scrollBehavior="smooth";const r=[...document.querySelectorAll(".static-chat-notification")].reverse();for(const s of r){!Dn(s,o)&&(o.scrollTop=s.offsetTop-o.offsetTop-o.clientHeight/2,await Hn(t)),Object.assign(s.style,{transition:[`opacity ${n/1e3}s cubic-bezier(.3,.1,1,.1)`,`transform ${n/1e3}s cubic-bezier(0,.7,.3,0.95)`].join(","),opacity:0,transformOrigin:"left",transform:"translateX(8em) skewX(-20deg)"}),await Hn(n),s.remove(),await Hn(e)}o.scrollHeight-o.scrollTop<=o.clientHeight||(o.scrollTop=o.scrollHeight,await Hn(t));o.style.scrollBehavior=s}()}));const l=document.createElement("span");l.classList.add("action-user"),l.textContent=e;const c=Pn(t),d=document.createElement("span");d.classList.add("action-time"),d.textContent=n,i.appendChild(l),i.appendChild(c),i.appendChild(d),i.dataset.username=e,i.dataset.time=n,o?i.classList.add("user-enter"):i.classList.add("user-left"),a.appendChild(i),i.addEventListener("mouseover",(()=>{const e=qn(i.dataset.username,i.dataset.time);kt(i,e)}))}const _n=[];let zn=!1;function Rn(){if(0===_n.length)return void(zn=!1);zn=!0;const{user:e,iconType:t,time:n,presence:o}=_n.shift();!function(e,t,n,o){let s=document.querySelector(".dynamic-chat-notifications-container");s||(s=document.createElement("div"),s.classList.add("dynamic-chat-notifications-container"),document.body.appendChild(s));const r=document.createElement("span");r.classList.add("dynamic-chat-notification");const a=document.createElement("span");a.classList.add("action-user"),a.textContent=e;const i=Pn(t),l=document.createElement("span");l.classList.add("action-time"),l.textContent=n,r.appendChild(a),r.appendChild(i),r.appendChild(l),r.dataset.username=e,r.dataset.time=n,o?r.classList.add("user-enter"):r.classList.add("user-left"),s.appendChild(r),r.addEventListener("mouseover",(()=>{const e=qn(r.dataset.username,r.dataset.time);kt(r,e)})),setTimeout((()=>{r.style.transform="translateX(0)",setTimeout((()=>{r.style.transform="translateX(-100%)",setTimeout((()=>{s.removeChild(r)}),300)}),5e3)}),300)}(e,t,n,o),setTimeout(Rn,500)}function Un(e,t,n){const o=Bn.some((t=>t.name===e&&"thawed"===t.state)),s=o&&se("notifications","static"),r=se("notifications","dynamic");if(!s&&!r)return;const a=re();s&&o&&(Fn(e,t,a,n,"generalChat"),jn("generalMessages",350)),r&&function(e,t,n,o){_n.push({user:e,iconType:t,time:n,presence:o}),zn||Rn()}(e,t,a,n)}function Jn(e){e.addEventListener("click",(t=>{const n=t.target.closest(".best-speed, .rating-level, .cars-count, .friends-count");if(n){const e=n.dataset.url;return void(e&&Ln(e))}const o=t.target.closest(".login");if(o){t.preventDefault();const e=o.href.split("/").pop(),n=y+e,s=`${y}${b}/messages/${e}/`;if(t.ctrlKey&&t.shiftKey){const e=window.open(s,"_blank");e&&e.focus()}else t.ctrlKey?Ln(s):Ln(n);return}const s=t.target.closest(".visits");if(s){t.stopPropagation();let n=!0;const o=s.dataset.userId,r=(JSON.parse(localStorage.getItem("fetchedUsers"))||{})[o],a=r?.actionLog;if(r){let t=document.querySelector(".action-log");t?t.replaceChildren():(t=document.createElement("div"),t.className="action-log",e.appendChild(t),Mt(t,"show",1)),a&&n&&a.forEach(((e,t)=>{if(!n||"object"!=typeof e||!e)return;const{type:o,timestamp:r}=e,a=s.closest(".user-item").querySelector(".login").textContent||"Unknown User",i="enter"===o?be:xe,l="enter"===o;setTimeout((()=>{n&&Fn(a,i,r,l,"cachePanel")}),10*(t+1))}));const o=e=>{t.contains(e.target)&&"Space"!==e.code||("Space"===e.code&&e.preventDefault(),Mt(t,"hide",0),n=!1,["click","keydown"].forEach((e=>document.removeEventListener(e,o))))};["click","keydown"].forEach((e=>document.addEventListener(e,o)))}else console.error("User data not found")}})),e.addEventListener("mouseover",(t=>{const n=t.target.closest(".registered");n&&e.contains(n)&&(n._originalContent=n.textContent,n._hoverTimer=setTimeout((()=>{const e=n.closest(".user-item"),t=e?.querySelector(".login"),o=t?.href?.split("/").pop(),s=(JSON.parse(localStorage.getItem("fetchedUsers"))||{})[o]||{registered:n.textContent};n.textContent=function(e){const t=Math.floor((new Date-new Date(e))/1e3),n=Math.floor(t/31536e3),o=Math.floor(t%31536e3/(30.44*24*60*60)),s=Math.floor(t%(30.44*24*60*60)/86400),r=Math.floor(t%86400/3600),a=Math.floor(t%3600/60),i=t%60,l=[];n>0?(l.push(`${n} year${n>1?"s":""}`),o>0&&l.push(`${o} month${o>1?"s":""}`)):o>1||1===o&&s>0?(l.push(`${o} month${o>1?"s":""}`),s>0&&l.push(`${s} day${s>1?"s":""}`)):s>0?(l.push(`${s} day${s>1?"s":""}`),r>0&&l.push(`${r} hour${r>1?"s":""}`),a>0&&l.push(`${a} minute${a>1?"s":""}`)):r>0?(l.push(`${r} hour${r>1?"s":""}`),a>0&&l.push(`${a} minute${a>1?"s":""}`)):a>0?(l.push(`${a} minute${a>1?"s":""}`),i>0&&l.push(`${i} second${i>1?"s":""}`)):l.push(`${i} second${i>1?"s":""}`);return l.filter(Boolean).join(" ")}(s.registered)}),300))})),e.addEventListener("mouseout",(t=>{const n=t.target.closest(".registered");n&&e.contains(n)&&(clearTimeout(n._hoverTimer),n._originalContent&&(n.textContent=n._originalContent))}))}const Kn={icon:"ðŸš§",en:"Threshold",ru:"ÐŸÐ¾Ñ€Ð¾Ð³"},Yn={icon:"ðŸ’£",en:"Countdown",ru:"ÐžÐ±Ñ€Ð°Ñ‚Ð½Ñ‹Ð¹ Ð¾Ñ‚ÑÑ‡Ñ‘Ñ‚"},Xn=pe();function Vn(){const e=document.querySelector(".cached-users-panel");if(e)return e.remove(),void It("hide");ee();let t=JSON.parse(localStorage.getItem("fetchedUsers"))||{};const n=document.createElement("div");n.className="cached-users-panel popup-panel",E.panelsEvents.handleCacheKeydown=e=>{"Escape"===e.key&&(Nt(n,"hide"),It("hide"),document.removeEventListener("keydown",E.panelsEvents.handleCacheKeydown))},document.addEventListener("keydown",E.panelsEvents.handleCacheKeydown);const o=document.createElement("div");o.className="panel-header";const s=document.createElement("div");s.className="drop-time";const r=document.createElement("span");r.className="drop-time-threshold-description",r.textContent=`${Kn.icon} ${Kn[Xn]}`;const a=document.createElement("span");a.className="drop-time-threshold";const i=localStorage.getItem("cacheRefreshThresholdHours");a.innerHTML=i||"00:00:00",a.addEventListener("click",Qn),kt(a,{en:"Click to set cache refresh time",ru:"ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð²Ñ€ÐµÐ¼Ñ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ ÐºÑÑˆÐ°"});const l=document.createElement("span");l.className="drop-time-expiration-description",l.textContent=`${Yn.icon} ${Yn[Xn]}`;const c=document.createElement("span");c.className="drop-time-expiration",kt(c,{en:"Time until cache refresh",ru:"Ð’Ñ€ÐµÐ¼Ñ Ð´Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ ÐºÑÑˆÐ°"}),s.append(r,a,l,c),o.appendChild(s);const d=document.createElement("div");d.className="search-for-cached-users";const u=document.createElement("input");u.className="cached-users-search-input",u.type="text",kt(u,{en:"\n      [Ctrl + Click] to clear the input and display all users\n      [Enter] to activate user search mode on the site\n    ",ru:" \n      [Ctrl + ÐšÐ»Ð¸Ðº] Ð¾Ñ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»Ðµ Ð¸ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð²ÑÐµÑ… Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹\n      [Enter] Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ñ€ÐµÐ¶Ð¸Ð¼ Ð¿Ð¾Ð¸ÑÐºÐ° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð½Ð° ÑÐ°Ð¹Ñ‚Ðµ\n    "}),d.appendChild(u),u.addEventListener("click",(e=>{e.ctrlKey&&(u.value="",u.dispatchEvent(new Event("input",{bubbles:!0})))})),u.addEventListener("input",(()=>{const e=document.querySelector(".old-users"),t=document.querySelector(".new-users"),n=document.querySelector(".fetched-users");if(!u.value.trim()){e.style.display="grid",t.style.display="grid";const o=document.querySelector(".search-results");o&&n&&n.removeChild(o)}})),u.addEventListener("keydown",(e=>{"Enter"!==e.key||e.target.value.trim()||(e.preventDefault(),e.target.value="user ")})),u.addEventListener("input",te((e=>{const t=e.target.value.trim(),n=localStorage.getItem("cachePanelSearchMode"),o=t.startsWith("user ")?t.substring(5).trim():"fetch"===n?t:"";o&&$n(o,Cn)}),300)),o.appendChild(d);const m=new MutationObserver((e=>{if(e.some((e=>"childList"===e.type&&e.addedNodes.length))){const e=document.querySelector(".cached-users-search-input"),t=Array.from(document.querySelectorAll(".fetched-users .login")),n=(e,t)=>{let n=0,o=0;for(const s of t.toLowerCase())o<e.length&&s===e[o].toLowerCase()&&(n+=2,o++);return o===e.length?n:0},o=e=>{t.forEach((t=>{t.closest(".user-item").style.display=!e||n(e,t.textContent)>0?"grid":"none"}))};e.focus(),e.addEventListener("input",(()=>o(e.value.trim()))),m.disconnect()}}));m.observe(o,{childList:!0,subtree:!0});const p=document.createElement("div");p.className="panel-control-buttons",p.style.display="flex";const g=document.createElement("div");g.className="large-button user-mode-button",g.innerHTML=et;const h=localStorage.getItem("cachePanelSearchMode")||(localStorage.setItem("cachePanelSearchMode","cache"),"cache");var f;function y(e){g.classList.toggle("cache-mode-button","cache"===e),g.classList.toggle("fetch-mode-button","cache"!==e)}kt(g,{en:(f=h,`Current active mode: ${f}`),ru:(e=>"Ð¢ÐµÐºÑƒÑ‰Ð¸Ð¹ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼: "+("cache"===e?"ÐºÑÑˆ":"Ð¿Ð¾Ð¸ÑÐº"))(h)}),y(h),g.addEventListener("click",(()=>{const e="cache"===localStorage.getItem("cachePanelSearchMode")?"fetch":"cache";localStorage.setItem("cachePanelSearchMode",e),y(e),kt(g,{en:`Current active mode: ${e}`,ru:"Ð¢ÐµÐºÑƒÑ‰Ð¸Ð¹ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼: "+("cache"===e?"ÐºÑÑˆ":"Ð¿Ð¾Ð¸ÑÐº")});const t=document.querySelector(".old-users"),n=document.querySelector(".new-users");let o=document.querySelector(".search-results");"fetch"===e?(t.style.display="none",n.style.display="none",o||(o=document.createElement("div"),o.className="users-container search-results",x.appendChild(o)),o.style.display="grid"):(t.style.display="grid",n.style.display="grid",o&&(o.style.display="none"))})),p.appendChild(g);const v=document.createElement("div");v.className="large-button panel-header-clear-button",kt(v,{en:"Clear cache",ru:"ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ ÐºÑÑˆ"}),v.innerHTML=Qe,v.addEventListener("click",(()=>{Gn(),eo(!0,$);const e=document.querySelector(".cache-panel-load-button .cache-user-count");e&&(e.textContent="0")}));const b=document.createElement("div");b.className="large-button panel-header-close-button",kt(b,{en:"Close panel",ru:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ð°Ð½ÐµÐ»ÑŒ"}),b.innerHTML=Pe,b.addEventListener("click",Gn),p.append(v,b),o.appendChild(p);const x=document.createElement("div");x.className="fetched-users";const w=kn("old"),C=kn("new"),S=En("en"===Xn?"Old Residents":"ÐŸÐ¾ÑÑ‚Ð¾ÑÐ»ÑŒÑ†Ñ‹","old-users-description");w.appendChild(S);const k=En("en"===Xn?"New Residents":"ÐÐ¾Ð²Ð¾Ð±Ñ€Ð°Ð½Ñ†Ñ‹","new-users-description");C.appendChild(k),x.append(w,C);const L=[],T=new Date,M=e=>T-new Date(e)<=864e5;"cache"===localStorage.getItem("cachePanelSearchMode")&&(Object.keys(t).forEach((e=>{const n=t[e];L.push(Cn(e,n))})),L.sort(((e,t)=>e.sortData.order!==t.sortData.order?e.sortData.order-t.sortData.order:t.sortData.bestSpeed-e.sortData.bestSpeed)),L.forEach((({userElement:e,registered:t})=>{(M(t)?C:w).appendChild(e)})));const N=xn(L,w,C,M,S,k);n.append(o,N,x);const{scrollButtonsContainer:I}=Dt(x);n.appendChild(I),document.body.appendChild(n),Nt(n,"show"),It("show"),setInterval(to,1e3),to(),function(e,t){kt(".sort-button",e,(e=>e.classList.contains("online")?{en:"Sort by online status",ru:"Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾ ÑÑ‚Ð°Ñ‚ÑƒÑÑƒ Ð¾Ð½Ð»Ð°Ð¹Ð½"}:e.classList.contains("offline")?{en:"Sort by offline status",ru:"Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾ ÑÑ‚Ð°Ñ‚ÑƒÑÑƒ Ð¾Ñ„Ñ„Ð»Ð°Ð¹Ð½"}:e.classList.contains("rankSpeed")?{en:"Sort by rank and speed",ru:"Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾ Ñ€Ð°Ð½Ð³Ñƒ Ð¸ ÑÐºÐ¾Ñ€Ð¾ÑÑ‚Ð¸"}:e.classList.contains("ratingLevel")?{en:"Sort by rating level",ru:"Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾ ÑƒÑ€Ð¾Ð²Ð½ÑŽ Ñ€ÐµÐ¹Ñ‚Ð¸Ð½Ð³Ð°"}:e.classList.contains("carsCount")?{en:"Sort by cars count",ru:"Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ñƒ Ð¼Ð°ÑˆÐ¸Ð½"}:e.classList.contains("friendsCount")?{en:"Sort by friends count",ru:"Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ñƒ Ð´Ñ€ÑƒÐ·ÐµÐ¹"}:e.classList.contains("visitsCount")?{en:"Sort by visits count",ru:"Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ñƒ Ð¿Ð¾ÑÐµÑ‰ÐµÐ½Ð¸Ð¹"}:e.classList.contains("alpha")?{en:"Sort alphabetically",ru:"Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾ Ð°Ð»Ñ„Ð°Ð²Ð¸Ñ‚Ñƒ"}:e.classList.contains("registered")?{en:"Sort by registration date",ru:"Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾ Ð´Ð°Ñ‚Ðµ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸"}:void 0)),kt(".waiting,.online,.offline,.login,.visits,.best-speed,.rating-level,.cars-count,.friends-count",t,(e=>{if(e.classList.contains("waiting"))return{en:"Waiting for presence status",ru:"ÐžÐ¶Ð¸Ð´Ð°Ð½Ð¸Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑÐ° Ð¿Ñ€Ð¸ÑÑƒÑ‚ÑÑ‚Ð²Ð¸Ñ"};if(e.classList.contains("online"))return{en:"Online",ru:"ÐžÐ½Ð»Ð°Ð¹Ð½"};if(e.classList.contains("offline"))return{en:"Offline",ru:"ÐžÑ„Ñ„Ð»Ð°Ð¹Ð½"};if(e.classList.contains("login"))return{en:" \n            [Click] to open profile in iframe (summary)\n            [Ctrl + Click] to open profile in iframe (messages)\n            [Ctrl + Shift + Click] to open profile in a new tab (messages)\n          ",ru:" \n            [ÐšÐ»Ð¸Ðº] Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»ÑŒ Ð² iframe (ÑÐ²Ð¾Ð´ÐºÐ°)\n            [Ctrl + ÐšÐ»Ð¸Ðº] Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»ÑŒ Ð² iframe (ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ)\n            [Ctrl + Shift + ÐšÐ»Ð¸Ðº] Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»ÑŒ Ð² Ð½Ð¾Ð²Ð¾Ð¹ Ð²ÐºÐ»Ð°Ð´ÐºÐµ (ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ)\n          "};if(e.classList.contains("visits")){const t=e.closest(".user-item"),n=t?.querySelector(".login"),o=n?.textContent||"";return{en:`View action log for ${o}`,ru:`ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ Ð¶ÑƒÑ€Ð½Ð°Ð» Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ Ð´Ð»Ñ ${o}`}}return e.classList.contains("best-speed")?{en:"Best speed",ru:"Ð›ÑƒÑ‡ÑˆÐ°Ñ ÑÐºÐ¾Ñ€Ð¾ÑÑ‚ÑŒ"}:e.classList.contains("rating-level")?{en:"Rating level",ru:"Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ Ñ€ÐµÐ¹Ñ‚Ð¸Ð½Ð³Ð°"}:e.classList.contains("cars-count")?{en:"Cars count",ru:"ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¼Ð°ÑˆÐ¸Ð½"}:e.classList.contains("friends-count")?{en:"Friends count",ru:"ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð´Ñ€ÑƒÐ·ÐµÐ¹"}:{en:"",ru:""}}),!0)}(N,x),Jn(x)}function Gn(){const e=document.querySelector(".cached-users-panel");e&&(Nt(e,"hide"),It("hide"))}let{fetchedUsers:Wn}=E;const Zn=pe();function Qn(){let e=!1;for(;!e;){const t=prompt("ru"===Zn?"Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð²Ñ€ÐµÐ¼Ñ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ ÐºÑÑˆÐ° (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, HH, HH:mm Ð¸Ð»Ð¸ HH:mm:ss):":"Enter a cache refresh time (e.g., HH, HH:mm, or HH:mm:ss):"),n=document.querySelector(".drop-time-threshold");if(null===t)e=!0;else if(/^([0-9]+|[01][0-9]|2[0-4])(:([0-5]?[0-9])(:([0-5]?[0-9]))?)?$/.test(t)){const[o,s="00",r="00"]=t.split(":").map((e=>e.padStart(2,"0")));n.textContent=`${o}:${s}:${r}`,localStorage.setItem("cacheRefreshThresholdHours",`${o}:${s}:${r}`),localStorage.removeItem("fetchedUsers"),localStorage.removeItem("lastClearTime"),localStorage.removeItem("nextClearTime"),setTimeout((()=>location.reload()),1e3),e=!0}else alert("ru"===Zn?"ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ HH, HH:mm Ð¸Ð»Ð¸ HH:mm:ss.":"Invalid time format. Please use HH, HH:mm, or HH:mm:ss.")}}function eo(e=!1,t=24){const n=localStorage.getItem("lastClearTime"),o=n?((new Date).getTime()-n)/36e5:1/0;if(e||o>=t){localStorage.removeItem("fetchedUsers"),Object.keys(Wn).forEach((e=>delete Wn[e]));const e=(new Date).getTime()+60*t*60*1e3;localStorage.setItem("lastClearTime",(new Date).getTime().toString()),localStorage.setItem("nextClearTime",e.toString())}}function to(){const e=localStorage.getItem("lastClearTime"),t=localStorage.getItem("nextClearTime"),n=document.querySelector(".drop-time-expiration");if(e&&t&&n){const e=t-Date.now();e<=0?eo(!0,cacheRefreshThresholdHours):function(e,t){const n=String(Math.floor(t/36e5)).padStart(2,"0"),o=String(Math.floor(t%36e5/6e4)).padStart(2,"0"),s=String(Math.floor(t%6e4/1e3)).padStart(2,"0"),r=5*Math.ceil(parseInt(s)/5);e.textContent=`${n}:${o}:${s} ${no[r]||no[0]}`}(n,e)}}const no={0:"ðŸ•›",5:"ðŸ•",10:"ðŸ•‘",15:"ðŸ•’",20:"ðŸ•“",25:"ðŸ•”",30:"ðŸ••",35:"ðŸ•–",40:"ðŸ•—",45:"ðŸ•˜",50:"ðŸ•™",55:"ðŸ•š"};const oo=()=>{const e=localStorage.getItem("activeChatTab")||"game",t=window.location.href.includes("gmid"),n=t&&"game"===e?'[id^="chat-game"] .text':"#chat-general .text",o=t&&"game"===e?'[id^="chat-game"] .send':"#chat-general .send",s=t&&"game"===e?'[id^="chat-game"] .messages':"#chat-general .messages",r={game:document.querySelector('[id^="chat-game"] .userlist-content'),general:document.querySelector("#chat-general .userlist-content")},a=document.querySelector(t?"game"===e?".game.c":".general.c":"general"===e?".general.c":".game.c"),i=document.querySelector(t?document.querySelector(".game.c.active")?".general.c":".game.c":document.querySelector(".general.c.active")?".game.c":".general.c"),l=document.querySelectorAll(".messages-content p"),c=l.length>0?l[l.length-1]:null,d=document.querySelector(s);return{chatField:document.querySelector(n),chatSend:document.querySelector(o),activeChatTab:a,nextChatTab:i,chatHidden:document.querySelector("#chat-wrapper.chat-hidden"),allMessages:l,latestMessage:c,messagesContainer:d,userList:r}},{ignored:so}=tn;function ro(e){return function(e){const t={Ð:"A",Ð‘:"B",Ð’:"V",Ð“:"G",Ð”:"D",Ð•:"E",Ð:"Yo",Ð–:"Zh",Ð—:"Z",Ð˜:"I",Ð™:"Y",Ðš:"K",Ð›:"L",Ðœ:"M",Ð:"N",Ðž:"O",ÐŸ:"P",Ð :"R",Ð¡:"S",Ð¢:"T",Ð£:"U",Ð¤:"F",Ð¥:"Kh",Ð¦:"Ts",Ð§:"Ch",Ð¨:"Sh",Ð©:"Shch",Ðª:"y",Ð«:"Y",Ð¬:"i",Ð­:"E",Ð®:"Yu",Ð¯:"Ya",Ð°:"a",Ð±:"b",Ð²:"v",Ð³:"g",Ð´:"d",Ðµ:"e",Ñ‘:"yo",Ð¶:"zh",Ð·:"z",Ð¸:"i",Ð¹:"y",Ðº:"k",Ð»:"l",Ð¼:"m",Ð½:"n",Ð¾:"o",Ð¿:"p",Ñ€:"r",Ñ:"s",Ñ‚:"t",Ñƒ:"u",Ñ„:"f",Ñ…:"kh",Ñ†:"ts",Ñ‡:"ch",Ñˆ:"sh",Ñ‰:"shch",ÑŠ:"y",Ñ‹:"y",ÑŒ:"i",Ñ:"e",ÑŽ:"yu",Ñ:"ya"};return e.split("").map((e=>t[e]||e)).join("")}(e)}const ao=new Set(tn.usersToTrack.map((e=>String(e.id))));function io(e="all"){const{allMessages:t,latestMessage:n}=oo();function o(e){const t=e.querySelector(".username");if(!t)return;const n=t.querySelector("span[data-user]"),o=n?n.getAttribute("data-user"):null;if(!o||!ao.has(String(o)))return;if(t.parentElement&&t.parentElement.querySelector(".tracked-marker"))return;const s=document.createElement("span");s.className="tracked-marker";const r=window.getComputedStyle(t).color;s.style.backgroundColor=r,t.parentNode.insertBefore(s,t)}"latest"===e?n&&o(n):t.forEach(o)}var lo=n(336),co={};co.styleTagTransform=g(),co.setAttributes=d(),co.insert=l().bind(null,"head"),co.domAPI=a(),co.insertStyleElement=m();s()(lo.A,co);lo.A&&lo.A.locals&&lo.A.locals;const uo="chatlogs";function mo(){return new Promise(((e,t)=>{const n=indexedDB.open("chatlogsDB",1);n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(uo)||t.createObjectStore(uo,{keyPath:"date"})},n.onsuccess=()=>e(n.result),n.onerror=()=>t(n.error)}))}async function po(e){const t=await mo();return new Promise(((n,o)=>{const s=t.transaction(uo,"readwrite"),r=s.objectStore(uo),a=r.get(e.date);a.onsuccess=()=>{const t=a.result,i=t&&t.html?new Blob([t.html]).size:0,l=e.html?new Blob([e.html]).size:0;r.put(e),s.oncomplete=()=>{let e=ho();e+=(l-i)/1024,fo(e),n()},s.onerror=()=>o(s.error)},a.onerror=()=>o(a.error)}))}const go="chatlogsTotalSizeKB";function ho(){return parseFloat(localStorage.getItem(go)||"0")}function fo(e){localStorage.setItem(go,Number(e).toFixed(2))}const yo=Math.floor(Math.random()*10**20);function vo(e){const t=e.match(/(\d{4}-\d{2}-\d{2})/);return t?t[1]:null}const{ignored:bo}=tn,xo=1024e3,wo=pe(),Co=async(e,t)=>{t&&(t.innerHTML="");const n=`https://klavogonki.ru/chatlogs/${e}.html`,o={chatlogs:[],url:n,size:0,error:null,info:"ru"===wo?"ÐŸÑ€Ð¾Ð¿ÑƒÑ‰ÐµÐ½Ð¾: ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ð¹ Ð»Ð¾Ð³.":"Skipped: chatlog too large.",placeholder:"ru"===wo?"ÐŸÑ€Ð¾Ð¿ÑƒÑ‰ÐµÐ½Ð¾: ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ð¹ Ð»Ð¾Ð³.":"Skipped: chatlog too large."},s=`${n}?rand=${yo}`;let r,a=!1;const i=await async function(e){const t=await mo();return new Promise(((n,o)=>{const s=t.transaction(uo,"readonly").objectStore(uo).get(e);s.onsuccess=()=>n(s.result),s.onerror=()=>o(s.error)}))}(e);if(i){if(i.skipped)return o;i.html&&(r=i.html,a=!0)}if(!r)try{const t=await fetch(s);if(!t.ok)throw new Error("Network response was not ok");const n=t.body.getReader();let a=0,i=[],l=!1;for(;!l;){const{value:t,done:s}=await n.read();if(t){if(a+=t.length,a>xo)return n.cancel(),e!==x&&await po({date:e,skipped:!0,reason:"too large"}),o;i.push(t)}l=s}let c=new Uint8Array(a),d=0;for(let e of i)c.set(e,d),d+=e.length;r=new TextDecoder("utf-8").decode(c),e!==x&&await po({date:e,html:r})}catch(e){return{chatlogs:[],url:s,size:0,error:e.message,info:null,placeholder:"ru"===wo?"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ Ð»Ð¾Ð³Ð¾Ð².":"Error processing logs."}}const l=r.length>xo?r.slice(0,xo):r,c=(e=>[...(new DOMParser).parseFromString(e,"text/html").querySelectorAll(".ts")].map((e=>{const t=e.nextElementSibling,n=t?.nextSibling,o=e=>e?[...e.childNodes].reduce(((e,t)=>{if(t.nodeType===Node.TEXT_NODE)e+=t.textContent;else if(t.nodeType===Node.ELEMENT_NODE)if("A"===t.tagName)e+=t.getAttribute("href");else if("BR"===t.tagName)return e;return e}),"").trim():"";if(t?.classList.contains("mn")&&n){let s="";if(n.nodeType===Node.ELEMENT_NODE)s=o(n);else if(n.nodeType===Node.TEXT_NODE){const e=t.nextElementSibling;s=e&&"A"===e.tagName?`${n.textContent.trim()} ${e.getAttribute("href")}`:n.textContent.trim()}if(!s){s=o(t.nextSibling)}return{time:e.textContent.trim().replace(/[\[\]]/g,""),username:t.textContent.trim().replace(/<|>/g,""),message:s||null}}const s=e.nextElementSibling;if(s&&s.classList.contains("mne")){const t=s.textContent.trim();return{time:e.textContent.trim().replace(/[\[\]]/g,""),username:"SYSTEM",message:t||null}}return null})).filter(Boolean))(l),d=r.length>xo,u=[];let m=null;for(const e of c){const t=e.message!==m?.message,n=e.username!==m?.username;(t||n)&&(u.push(e),m=e)}const p=u.filter((e=>!bo.includes(e.username))),g=(l.length/1024).toFixed(2),h=ho();let f="ru"===wo?`Ð Ð°Ð·Ð¼ÐµÑ€: ${g} ÐšÐ‘`:`Size: ${g} KB`;if(f+=d?"ru"===wo?" (Ð”Ð¾ÑÑ‚Ð¸Ð³Ð½ÑƒÑ‚ Ð»Ð¸Ð¼Ð¸Ñ‚ Ñ„Ð°Ð¹Ð»Ð°)":" (File limit reached)":a?"ru"===wo?" (ÐšÑÑˆ)":" (Cache)":"",null!==h&&!isNaN(h)){const e=function(e){const t=parseFloat(e);return isNaN(t)?e:t>=1048576?(t/1048576).toFixed(2)+("ru"===wo?" Ð“Ð‘":" GB"):t>=1024?(t/1024).toFixed(2)+("ru"===wo?" ÐœÐ‘":" MB"):t.toFixed(2)+("ru"===wo?" ÐšÐ‘":" KB")}(h);f+="ru"===wo?` | ÐšÑÑˆ: ${e}`:` | Cache: ${e}`}return{chatlogs:p,url:n,size:l.length,info:d?"ru"===wo?"Ð”Ð¾ÑÑ‚Ð¸Ð³Ð½ÑƒÑ‚ Ð»Ð¸Ð¼Ð¸Ñ‚ Ñ€Ð°Ð·Ð¼ÐµÑ€Ð° Ñ„Ð°Ð¹Ð»Ð°.":"File size limit reached.":a?"ru"===wo?"Ð—Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð¾ Ð¸Ð· ÐºÑÑˆÐ°.":"Loaded from cache.":null,error:null,placeholder:f}};var So=n(807),ko={};ko.styleTagTransform=g(),ko.setAttributes=d(),ko.insert=l().bind(null,"head"),ko.domAPI=a(),ko.insertStyleElement=m();s()(So.A,ko);So.A&&So.A.locals&&So.A.locals;const Eo=["jpg","jpeg","png","gif","webp"],$o="ðŸ“¸",Lo="ðŸ–¥ï¸",To="ðŸ’€ï¸ï¸",Mo=.2,No=10,Io=.1;let Ao=0,qo=!1,Do=[],jo=null;const{bigImageEvents:Oo}=E,Bo=e=>{const t=(e=>{try{return e.match(/\.([^?#.]+)(?:[?#]|$)/i)?.[1]?.toLowerCase()||""}catch(e){return console.error("Error extracting extension:",e.message),""}})(e);return{allowed:Eo.includes(t),extension:t}},Ho=(e,t)=>{const n=document.createElement("img");n.src=e,n.classList.add("scaled-thumbnail"),document.body.appendChild(n),Ao=t;let o=1,s=!1,r=0,a=0,i=-50,l=-50;const c=e=>{Nt(e,"hide"),document.querySelector(".popup-panel")||It("hide"),Q()};return Oo.unfocusedClick=e=>{n.contains(e.target)||(n.remove(),Q())},Oo.keydown=e=>{"Escape"===e.code||"Space"===e.code?(e.preventDefault(),c(n)):"ArrowLeft"===e.code?Po(-1):"ArrowRight"===e.code&&Po(1)},Oo.wheel=e=>{const t=e.deltaY<0?1:-1;o+=t*Io*o,o=Math.max(Mo,Math.min(o,No)),n.style.transform=`translate(${i}%, ${l}%) scale(${o})`},Oo.mousemove=e=>{if(s){if(e.ctrlKey){const t=e.clientY-a,n=t<0?1:-1,s=Math.abs(t)*Io*.05;o+=n*s*o,o=Math.max(Mo,Math.min(o,No))}else{const t=(e.clientX-r)/o*5,s=(e.clientY-a)/o*5;i+=t/n.clientWidth*100,l+=s/n.clientHeight*100}n.style.transform=`translate(${i}%, ${l}%) scale(${o})`,r=e.clientX,a=e.clientY}},Oo.mousedown=e=>{const{button:t,clientX:o,clientY:i,target:l,ctrlKey:d}=e;if((0===t||2===t)&&l!==n)return;const u=l.src;0===t?Po(-1):2===t?(e.preventDefault(),d?(navigator.clipboard.writeText(u).catch(console.error),c(n)):Po(1)):1===t&&(s=!0,r=o,a=i,e.preventDefault())},Oo.mouseup=e=>{1===e.button&&(s=!1)},Oo.contextmenu=e=>e.preventDefault(),Object.entries(G).forEach((([e,t])=>{document.addEventListener(e,t)})),n},Po=e=>{const t=Ao+e;t>=0&&t<Do.length&&!qo&&(qo=!0,jo&&(jo.src=Do[t].imgSrc),setTimeout((()=>qo=!1),50),Ao=t)};function Fo(e){const t=document.querySelector({generalMessages:".messages-content div",chatlogsMessages:".chat-logs-container",personalMessages:".messages-container"}[e]);if(!t)return;const n=t.querySelectorAll("a:not(.skipped):not(.processed-image)");function o(n,o){const s=document.createElement("div");s.classList.add("clickable-thumbnail"),s.dataset.sourceLink=n.href;const r=document.createElement("img");r.src=n.href,r.onload=()=>{s.appendChild(r),n.parentNode.insertBefore(s,n.nextSibling),jn(e,600)},r.onerror=()=>{console.error("Failed to load image:",n.href),n.classList.add("skipped")},o?n.querySelector(".clickable-thumbnail")||n.addEventListener("click",(e=>{n.querySelector(".clickable-thumbnail")||(s.appendChild(r),n.parentNode.insertBefore(s,n.nextSibling))})):(s.appendChild(r),n.parentNode.insertBefore(s,n.nextSibling)),s.addEventListener("click",(e=>{e.stopPropagation(),Do=[],t.querySelectorAll(".clickable-thumbnail").forEach(((e,t)=>{const n=e.querySelector("img");n&&e.dataset.sourceLink&&Do.push({link:e.dataset.sourceLink,imgSrc:n.src,index:t})}));const o=Do.findIndex((e=>e.link===n.href||e.imgSrc===r.src));jo=Ho(r.src,o>=0?o:0),Nt(jo,"show"),It("show")}))}n.length&&n.forEach((e=>{if(!e.href||!e.href.startsWith("http"))return;const{allowed:t,extension:n}=Bo(e.href);if(!t)return;e.classList.add("media");const{isTrusted:s,domain:r}=ae(e.href);kt(e,gn(e.href)?hn(e.href):e.href),s?function(e,t,n){e.textContent=`${$o} ${t.toUpperCase()} ${Lo} ${n}`,e.classList.add("processed-image"),o(e,!1)}(e,n,r):function(e,t,n){e.classList.add("skipped"),e.textContent=`${$o} ${t.toUpperCase()} ${Lo} ${n} ${To} Untrusted`,e.addEventListener("click",(t=>{e.classList.contains("processed-image")||(t.preventDefault(),e.classList.remove("skipped"),e.classList.add("processed-image"),o(e,!0))}))}(e,n,r)}))}const _o="ðŸ“º",zo="ðŸ“¹",Ro="ðŸŽ¬ï¸",Uo="ðŸ–¥ï¸",Jo="ðŸ’€ï¸ï¸",Ko=["mp4","webm","ogg","mov","avi"];let Yo=null,Xo=null;async function Vo(e,t,n,o,s){e.innerHTML="",t.innerHTML="";const r=await async function(e){const t=`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${e}&format=json`;try{const e=await fetch(t),n=await e.json();return{title:n.title||"Title not found",channel:n.author_name||"Channel not found"}}catch(e){return console.error("Error fetching YouTube metadata:",e),{title:"Error",channel:"Error"}}}(n),a=document.createElement("span");a.classList.add("channel-name"),a.textContent=`${_o} ${r.channel}`;const i=document.createElement("span");i.classList.add("video-title"),i.textContent=`${zo} ${r.title}`,e.append(a,i);const l=document.createElement("img");l.src=`https://img.youtube.com/vi/${n}/hqdefault.jpg`,l.alt=o,l.classList.add("youtube-thumb"),t.appendChild(l),l.addEventListener("load",(()=>{jn(s,600)}))}function Go(e){if(!e)return void console.warn("containerType parameter is required");const t={generalMessages:".messages-content div",chatlogsMessages:".chat-logs-container",personalMessages:".messages-container"};if(!t[e])return void console.warn(`Invalid containerType: ${e}`);const n=document.querySelector(t[e]);if(!n)return;const o=n.querySelectorAll("a:not(.skipped):not(.processed-video)");function s(e,t,n,o,s){const{youtubeMatch:r,videoType:a,videoId:i}=o,l=(e=>{const t=e.match(/\.([^?#.]+)(?:[?#]|$)/i)?.[1]?.toLowerCase()||"";return{allowed:Ko.includes(t),extension:t}})(t);if(!r&&!l.allowed)return;e.classList.add("processed-video");const c=document.createElement("div");if(c.classList.add("video-wrapper"),e.textContent=`${Ro} ${a} ${Uo} ${n}`,kt(e,gn(t)?hn(t):t),e.style.display="inline-flex",r){const t=document.createElement("div");t.classList.add("youtube-info");const n=document.createElement("div");n.classList.add("youtube-placeholder"),n.dataset.videoId=i,n.dataset.videoType=a,n.dataset.containerType=s,e.parentNode.insertBefore(c,e),c.append(e,t,n),Vo(t,n,i,a,s),n.addEventListener("click",(()=>{if(Xo&&Xo!==n){const e=Xo.dataset.videoId,t=Xo.dataset.videoType,n=Xo.dataset.containerType,o=Xo.previousElementSibling;o&&o.classList.contains("youtube-info")&&Vo(o,Xo,e,t,n)}Xo=n;const e=(Yo||(Yo=document.createElement("iframe"),Yo.classList.add("video-container"),Yo.allowFullscreen=!0,Yo.setAttribute("allow","fullscreen")),Yo);e.src=`https://www.youtube.com/embed/${i}?autoplay=1`,n.innerHTML="",n.appendChild(e)}))}else{const n=document.createElement("video");n.classList.add("video-container"),n.src=t,n.controls=!0,e.parentNode.insertBefore(c,e),c.append(e,n)}}o.length&&o.forEach((t=>{const n=t.href;if(!n)return;const o=function(e){const t=e.match(/(?:shorts\/|live\/|watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/i);if(t)return{youtubeMatch:!0,videoId:t[1],videoType:e.includes("shorts/")?"Shorts":e.includes("live/")?"Live":e.includes("watch?v=")?"Watch":e.includes("youtu.be/")?"Share":"YouTube"};const n=e.split(".").pop().toLowerCase();return!!Ko.includes(n)&&{youtubeMatch:!1,videoType:`Video (${n.toUpperCase()})`}}(n);if(!o)return;t.classList.add("media");const{isTrusted:r,domain:a}=ae(n);if(!r)return t.classList.add("skipped"),t.textContent=`${Ro} ${o.videoType} ${Uo} ${a} ${Jo} Untrusted`,void t.addEventListener("click",(r=>{t.classList.contains("processed-video")||(r.preventDefault(),t.classList.remove("skipped"),s(t,n,a,o,e))}));s(t,n,a,o,e)}))}function Wo(e){return e.replace(/[_\-\s]/g,"").toLowerCase()}function Zo(e,t,n,o="search-match"){if(t.length){e.querySelectorAll(`.${o}`).forEach((e=>{e.replaceWith(document.createTextNode(e.textContent))})),e.normalize();for(const s of t)s.length<2||Qo(e,s,n,o)}}function Qo(e,t,n,o){const s=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),r=[];let a,i="";for(;a=s.nextNode();)a.textContent.trim()&&(r.push({node:a,start:i.length,text:a.textContent}),i+=a.textContent);if(!i.trim())return;const l=[],c=n?i:i.toLowerCase(),d=n?t:t.toLowerCase();let u=0;for(;-1!==(u=c.indexOf(d,u));)l.push({start:u,end:u+d.length}),u++;if(!n){Wo(i);const e=Wo(t);for(let t=0;t<=i.length-e.length;t++)for(let n=e.length;n<=Math.min(i.length-t,2*e.length);n++)if(Wo(i.substring(t,t+n))===e){l.push({start:t,end:t+n});break}}if(0===l.length)return;const m=l.sort(((e,t)=>e.start-t.start));m.filter(((e,t)=>!m.slice(0,t).some((t=>e.start<t.end&&e.end>t.start)))).reverse().forEach((e=>{!function(e,t,n){const o=e.filter((e=>{const n=e.start+e.text.length;return t.start<n&&t.end>e.start}));o.forEach((e=>{e.start,e.text.length;const o=Math.max(0,t.start-e.start),s=Math.min(e.text.length,t.end-e.start);if(o<s&&e.node.parentNode){const t=e.node.textContent,r=document.createDocumentFragment();o>0&&r.appendChild(document.createTextNode(t.substring(0,o)));const a=document.createElement("span");a.className=n,a.textContent=t.substring(o,s),r.appendChild(a),s<t.length&&r.appendChild(document.createTextNode(t.substring(s))),e.node.parentNode.replaceChild(r,e.node)}}))}(r,e,o)}))}function es(e){if(/^[\d-:]+$/.test(e.trim()))return void ts();const t={user:{en:["user","username","nick","name","nickname"],ru:["Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ","Ð½Ð¸Ðº","Ð¸Ð¼Ñ","Ð½Ð¸ÐºÐ½ÐµÐ¹Ð¼"]},word:{en:["msg","message","text","word","content"],ru:["ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ","Ñ‚ÐµÐºÑÑ‚","ÑÐ»Ð¾Ð²Ð¾","ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚"]}},n=[...t.user.en,...t.user.ru],o=[...t.word.en,...t.word.ru],s=new RegExp(`^(${n.join("|")})::`,"i"),r=new RegExp(`^(${n.join("|")}):(?!:)`,"i"),a=new RegExp(`^(${o.join("|")})::`,"i"),i=new RegExp(`^(${o.join("|")}):(?!:)`,"i");let l=!1,c=!1,d=!1,u=e.trim();s.test(u)?(l=!0,d=!0,u=u.replace(s,"")):a.test(u)?(c=!0,d=!0,u=u.replace(a,"")):r.test(u)?(l=!0,u=u.replace(r,"")):i.test(u)&&(c=!0,u=u.replace(i,""));let m=[],p=[],g=!1;if(u.includes(","))m=u.split(",").map((e=>{const t=e.trim();return d?t.toLowerCase():Wo(t)})).filter(Boolean),p=u.split(",").map((e=>e.trim())).filter(Boolean),g=!0;else if([".","|","\\","/"].some((e=>u.includes(e))))m=u.split(/[.|\\/]/).map((e=>{const t=e.trim();return d?t.toLowerCase():Wo(t)})).filter(Boolean),p=u.split(/[.|\\/]/).map((e=>e.trim())).filter(Boolean),g=!0,c=!0;else{const e=u.trim();m=[d?e.toLowerCase():Wo(e)].filter(Boolean),p=[e].filter(Boolean),g=!1}const h=".messages-search-container",f=Array.from(document.querySelectorAll(`${h} > .date-item, ${h} > .message-item`)),y=f.filter((e=>e.classList.contains("message-item"))),v=function(e){return e.map((e=>{const t=e.querySelector(".message-username"),n=t?t.textContent.toLowerCase().trim():"",o=e.querySelector(".message-text");return{username:n,messageText:o?me(o).toLowerCase().trim():"",usernameElement:t,messageTextElement:o,originalUsername:t?t.textContent.trim():"",originalMessageText:o?me(o).trim():""}}))}(y),b=!m.length;function x(e,t){return!(t.length<2)&&(!!e.includes(t)||(t.length>=3&&1===function(e,t){if(0===e.length)return t.length;if(0===t.length)return e.length;const n=[];for(let e=0;e<=t.length;e++)n[e]=[e];for(let t=0;t<=e.length;t++)n[0][t]=t;for(let o=1;o<=t.length;o++)for(let s=1;s<=e.length;s++)t.charAt(o-1)===e.charAt(s-1)?n[o][s]=n[o-1][s-1]:n[o][s]=Math.min(n[o-1][s-1]+1,n[o][s-1]+1,n[o-1][s]+1);return n[t.length][e.length]}(e,t)||!!(t.length>=3&&function(e,t){let n=0,o=0;for(;n<e.length&&o<t.length;)e[n]===t[o]&&n++,o++;return n===e.length}(t,e))))}b&&ts(),y.forEach(((e,t)=>{const n=e.closest(".message-item"),o=v[t],s=Wo(o.username),r=Wo(o.messageText),a=b||function(e,t,n,o,s=!1){const r=o?(e,t)=>function(e,t,n=!1){const o=e.toLowerCase();return n?o===t:o.includes(t)}(e,t,s):x;return t[n?"some":"every"]((t=>e.some((e=>r(e,t)))))}(function(e,t,n,o){return d?l?[e]:c?[t]:[e,t]:l?[n]:c?[o]:[n,o]}(o.username,o.messageText,s,r),m,g,d,l);n.classList.toggle("hidden-message",!a),a&&!b?(!c&&o.usernameElement&&Zo(o.usernameElement,p,d,"search-match-username"),!l&&o.messageTextElement&&Zo(o.messageTextElement,p,d,"search-match-message")):a||(o.usernameElement&&o.usernameElement.querySelectorAll(".search-match-username").forEach((e=>{e.replaceWith(document.createTextNode(e.textContent))})),o.messageTextElement&&o.messageTextElement.querySelectorAll(".search-match-message").forEach((e=>{e.replaceWith(document.createTextNode(e.textContent))})))}));const w=f.filter((e=>e.classList.contains("date-item")));for(let e=0;e<w.length;e++){const t=w[e];let n=f.indexOf(t)+1,o=!1;for(;n<f.length&&!f[n].classList.contains("date-item");){const e=f[n];if(e.classList.contains("message-item")&&!e.classList.contains("hidden-message")){o=!0;break}n++}t.classList.toggle("hidden-date",!o)}}function ts(){document.querySelectorAll(".search-match-username, .search-match-message").forEach((e=>{e.replaceWith(document.createTextNode(e.textContent))}))}function ns(e){let t=e.previousElementSibling;for(;t&&!t.classList.contains("date-item");)t=t.previousElementSibling;return t&&t.classList.contains("date-item")?t.dataset.date:null}async function os(e,t,n){const o=document.querySelector(".messages-content");if(!o)return null;const s=e=>String(e||"").replace(/\s+/g,"").trim().toLowerCase(),r=s(t),a=s(e),i=Array.from(o.querySelectorAll("p")).find((e=>{const t=e.querySelector(".username span[data-user]");if(t){const n=s(t.textContent),o=s(function(e){const t=e.cloneNode(!0);return t.querySelectorAll(".time, .username, .room.private").forEach((e=>e.remove())),t.textContent.trim()}(e));if(n===r&&o===a)return!0}return!1}));return i&&n&&await On(o,i),i||!1}function ss(e){const t=180- -(new Date).getTimezoneOffset(),[n,o,s]=e.split(":").map(Number);let r=60*n+o+t;r=(r%1440+1440)%1440;const a=r%60;return`${Math.floor(r/60).toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`}function rs(e,t="single"){const n=e.querySelector(".message-time").textContent,o=e.querySelector(".message-username").textContent,s=ns(e);let r=JSON.parse(localStorage.getItem("personalMessagesBackup"))||{};if(0===Object.keys(r).length){r={...JSON.parse(localStorage.getItem("personalMessages"))||{}},localStorage.setItem("personalMessagesBackup",JSON.stringify(r))}let a={...r};if("all"===t)document.querySelectorAll(".message-item").forEach((e=>{const t=e.querySelector(".message-username").textContent,n=ns(e);if(t===o&&n){e.remove();const o=e.querySelector(".message-time").textContent;delete a[`[${o}]_${t}_${n}`]}}));else if("from"===t){const t=Array.from(document.querySelectorAll(".message-item"));for(let n=t.indexOf(e);n<t.length;n++){const e=t[n],s=e.querySelector(".message-username").textContent,r=ns(e);if(s===o&&r){e.remove();const t=e.querySelector(".message-time").textContent;delete a[`[${t}]_${s}_${r}`]}}}else if(s){const t=`[${n}]_${o}_${s}`;if(a[t]){delete a[t];let n=e.previousElementSibling;for(;n&&!n.classList.contains("date-item");)n=n.previousElementSibling;e.remove(),n&&n.classList.contains("date-item")&&(!n.nextElementSibling||n.nextElementSibling.classList.contains("date-item"))&&n.remove()}}localStorage.setItem("personalMessagesBackup",JSON.stringify(a));const i=document.querySelector(".personal-messages-button .total-message-count");i&&(i.textContent=Object.keys(a).length)}function as(){const e=Object.keys(JSON.parse(localStorage.getItem("personalMessages")||"{}")).length;document.querySelector(".personal-messages-button .total-message-count").textContent=e}function is(){const e=localStorage.getItem("personalMessages");return JSON.parse(e)||{}}const ls=pe();function cs(e,t,n={}){if(!e.altKey)return;let o=prompt("ru"===ls?"Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚ ÑÐºÑÐ¿Ð¾Ñ€Ñ‚Ð°? (1 = BBCode, 2 = Markdown, 3 = Plain)":"Export format? (1 = BBCode, 2 = Markdown, 3 = Plain)","1");if(null===o)return;let s={1:"bbcode",2:"markdown",3:"plain"}[o.trim()];s||(s="bbcode");const r=function(e,t,n={}){const{date:o=null,isMessagesPanel:s=!1,includeDateHeaders:r=!0,includeMessageLinks:a=!0,prefix:i="",messages:l={}}=n,c=Array.from(e.querySelectorAll(".date-item, .message-item")).filter((e=>{const t=window.getComputedStyle(e);return"hidden"!==t.contentVisibility&&"none"!==t.display}));let d="",u=!0;"bbcode"===t&&(d+="[hide]\n");let m=null,p={};return s||(p=JSON.parse(localStorage.getItem(C)||"{}")),c.forEach((e=>{if(e.classList.contains("date-item")&&r){const n=e.querySelector(".date-text"),o=n?n.textContent:e.textContent.replace(/[ðŸ“…â³]+$/,"").trim();m=o,u||(d+="\n"),d+="bbcode"===t?`[b][color=gray]${o}[/color][/b]\n`:"markdown"===t?`**${o}**\n`:`${o}\n`,u=!1}else if(e.classList.contains("message-item")){const n=e.querySelector(".message-time")?.textContent?.trim()||"",r=e.querySelector(".message-username")?.textContent?.trim()||"",i=e.querySelector(".message-text"),c=i?function(e,t){if(!e)return"";let n=e.innerHTML.replace(/<img[^>]*title=["']([^"']+)["'][^>]*>/gi,"$1");return n=n.replace(/<span class=["']parse-match-message["']>([\s\S]*?)<\/span>/gi,((e,n)=>"bbcode"===t?`[color=#32cd32]${n}[/color]`:"markdown"===t?`*${n}*`:n)).replace(/<span class=["']search-match-message["']>([\s\S]*?)<\/span>/gi,((e,n)=>"bbcode"===t?`[color=#ffa500]${n}[/color]`:"markdown"===t?`*${n}*`:n)),n=n.replace(/<[^>]+>/g,""),"plain"===t?e.textContent:n}(i,t):"",g=o||m||(new Date).toISOString().slice(0,10),h=a?`https://klavogonki.ru/chatlogs/${g}.html#${n.replace(/[\[\]]/g,"")}`:"";let f;if(s){const e=l[`[${n}]_${r}`];f=e&&e.usernameColor?R(e.usernameColor):"#808080"}else f=p[r]?.color||"#808080";if("bbcode"===t){const e=c.replace(/(^|\s|\():(\w+):(?=\s|\.|,|!|\?|$)/g,((e,t,n)=>`${t}[img]https://klavogonki.ru/img/smilies/${n}.gif[/img]`));d+=h?`[url=${h}]${n}[/url] `:`${n} `,d+=`[color=${f}]${r}[/color] ${e}\n`}else"markdown"===t?(d+=h?`[${n}](${h}) `:`${n} `,d+=`**${r}** ${c}\n`):(d+=`[${n}] `,d+=`(${r}) ${c}\n`);u=!1}})),"bbcode"===t&&(d+="[/hide]\n"),d}(t,s,n);if(r)if(e.shiftKey){const e=new Blob([r],{type:"text/plain"}),t=document.createElement("a");t.href=URL.createObjectURL(e);const o=n.prefix,a=n.date?`_${n.date}`:"";t.download=`${o}_${a}_${s}.txt`,document.body.appendChild(t),t.click(),setTimeout((()=>document.body.removeChild(t)),100)}else navigator.clipboard.writeText(r).catch((()=>{alert("ru"===ls?"ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ ÑÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ":"Failed to copy messages")}))}var ds=n(805),us={};us.styleTagTransform=g(),us.setAttributes=d(),us.insert=l().bind(null,"head"),us.domAPI=a(),us.insertStyleElement=m();s()(ds.A,us);ds.A&&ds.A.locals&&ds.A.locals;function ms(e,t,n,o,s=[],r=!1){const a=JSON.parse(localStorage.getItem(C)||"{}");let i=null;const l=new Map;if(n||(t.innerHTML=""),o){const e=document.createElement("div");e.className="date-item";const n=document.createElement("span");n.className="date-text",n.textContent=o;const s=document.createElement("span");s.className="date-emoji",s.textContent=" ðŸ“…",e.appendChild(n),e.appendChild(s),t.appendChild(e)}const c=document.createDocumentFragment();return e.forEach((({time:e,username:t,message:n})=>{l.set(t,(l.get(t)||0)+1);const o=document.createElement("div");o.classList.add("message-item");const d=document.createElement("span");d.className="message-time",d.textContent=e;const u=document.createElement("span");u.className="message-username",u.textContent=t,u.style.color=a[t]?.color||"#808080";const m=document.createElement("span");m.className="message-text";let p="";"string"==typeof n&&n.length>0&&(p=n.replace(/:(?=\w*[a-zA-Z])(\w+):/g,((e,t)=>`<img src="/img/smilies/${t}.gif" alt=":${t}:" title=":${t}:" class="smile">`)).replace(/(https?:\/\/[^\s]+)/gi,(e=>`<a href="${e}" target="_blank" rel="noopener noreferrer">${e}</a>`)),r&&s&&s.length>0&&(p=function(e,t){if(!(r&&t&&t.length&&e))return e;const n=t.map((e=>e.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&"))),o=new RegExp(`(${n.join("|")})`,"gi");return e.replace(o,'<span class="parse-match-message">$1</span>')}(p,s))),m.innerHTML=p,o.style.marginTop=i!==t?"0.6em":"",i=t,o.appendChild(d),o.appendChild(u),o.appendChild(m),c.appendChild(o)})),t.appendChild(c),l}function ps(e,t){if("shown"===localStorage.getItem("shouldShowActiveUsers")){let n=t.querySelector(".active-users");n||(n=document.createElement("div"),n.className="active-users",t.appendChild(n));const o=Array.from(e.entries()).sort((([,e],[,t])=>t-e));n.innerHTML="";const s=JSON.parse(localStorage.getItem(C)||"{}"),r=document.createDocumentFragment();o.forEach((([e,t])=>{const n=document.createElement("div");n.className="active-user-item";const o=document.createElement("span");o.className="active-user-name",o.textContent=e;const a=s[e]?.color||"#808080";o.style.color=a;const i=document.createElement("span");i.className="active-user-messages-count",i.textContent=t,i.style.color=a,i.style.backgroundColor=a+"20",n.appendChild(i),n.appendChild(o),r.appendChild(n)})),n.appendChild(r)}}const gs="ðŸ“Œï¸",hs="âœï¸",fs="âš ï¸",ys="ðŸ”",vs="ðŸ‘¤",bs="ðŸ“„",xs="ðŸ“œ",ws="ðŸ“‹",Cs="ðŸ“…",Ss={selectParseMode:{en:[`${gs} Select parse mode`,"1. Single date","2. From date","3. Date range","4. From start","5. From registered date","6. Personal mentions"].join("\n"),ru:[`${gs} Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ€ÐµÐ¶Ð¸Ð¼ Ð¿Ð°Ñ€ÑÐ¸Ð½Ð³Ð°`,"1. ÐžÐ´Ð½Ð° Ð´Ð°Ñ‚Ð°","2. Ð¡ Ð´Ð°Ñ‚Ñ‹","3. Ð”Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½ Ð´Ð°Ñ‚","4. Ð¡ ÑÐ°Ð¼Ð¾Ð³Ð¾ Ð½Ð°Ñ‡Ð°Ð»Ð°","5. Ð¡ Ð´Ð°Ñ‚Ñ‹ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸","6. Ð›Ð¸Ñ‡Ð½Ñ‹Ðµ ÑƒÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ñ"].join("\n")},invalidSelection:{en:`${fs} Invalid selection.`,ru:`${fs} ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ð²Ñ‹Ð±Ð¾Ñ€.`},enterDateRange:{en:[`${hs} Enter ${Cs} date range`,`${ws} Examples:`,"2024-01-01 - 2024-01-07","20240101 - 20240107","2024:01:01 - 2024:01:07","240101 - 240107","24-02-02 - 24-03-03"].join("\n"),ru:[`${hs} Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½ ${Cs} Ð´Ð°Ñ‚`,`${ws} ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹:`,"2024-01-01 - 2024-01-07","20240101 - 20240107","2024:01:01 - 2024:01:07","240101 - 240107","24-02-02 - 24-03-03"].join("\n")},invalidRange:{en:`${fs} Invalid range format or one/both ${Cs} dates out of bounds. Please try again.`,ru:`${fs} ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½Ð° Ð¸Ð»Ð¸ Ð¾Ð´Ð½Ð°/Ð¾Ð±Ðµ ${Cs} Ð´Ð°Ñ‚Ñ‹ Ð²Ð½Ðµ Ð´Ð¾Ð¿ÑƒÑÑ‚Ð¸Ð¼Ð¾Ð³Ð¾ Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½Ð°. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÑÐ½Ð¾Ð²Ð°.`},enterFromDate:{en:[`${hs} Enter FROM ${Cs} date`,`${ws} Examples:`,"2024-01-01","20240101","2024:01:01","240101",`${gs} Range will be FROM this ${Cs} date to today.`].join("\n"),ru:[`${hs} Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð½Ð°Ñ‡Ð°Ð»ÑŒÐ½ÑƒÑŽ ${Cs} Ð´Ð°Ñ‚Ñƒ`,`${ws} ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹:`,"2024-01-01","20240101","2024:01:01","240101",`${gs} Ð”Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½ Ð±ÑƒÐ´ÐµÑ‚ Ñ ÑÑ‚Ð¾Ð¹ ${Cs} Ð´Ð°Ñ‚Ñ‹ Ð´Ð¾ ÑÐµÐ³Ð¾Ð´Ð½Ñ.`].join("\n")},invalidFromDate:{en:`${fs} Invalid FROM ${Cs} date format or date out of bounds. Please try again.`,ru:`${fs} ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ð½Ð°Ñ‡Ð°Ð»ÑŒÐ½Ð¾Ð¹ ${Cs} Ð´Ð°Ñ‚Ñ‹ Ð¸Ð»Ð¸ Ð´Ð°Ñ‚Ð° Ð²Ð½Ðµ Ð´Ð¾Ð¿ÑƒÑÑ‚Ð¸Ð¼Ð¾Ð³Ð¾ Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½Ð°. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÑÐ½Ð¾Ð²Ð°.`},enterSingleDate:{en:[`${hs} Enter a ${Cs} date`,`${ws} Examples:`,"2024-01-01","20240101","2024:01:01","240101"].join("\n"),ru:[`${hs} Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ${Cs} Ð´Ð°Ñ‚Ñƒ`,`${ws} ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹:`,"2024-01-01","20240101","2024:01:01","240101"].join("\n")},invalidDate:{en:`${fs} Invalid ${Cs} date format or date out of bounds. Please try again.`,ru:`${fs} ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ ${Cs} Ð´Ð°Ñ‚Ñ‹ Ð¸Ð»Ð¸ Ð´Ð°Ñ‚Ð° Ð²Ð½Ðµ Ð´Ð¾Ð¿ÑƒÑÑ‚Ð¸Ð¼Ð¾Ð³Ð¾ Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½Ð°. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÑÐ½Ð¾Ð²Ð°.`},enterUsernames:{en:[`${vs} Enter ${vs} username(s) to parse (comma-separated):`,`${gs} Leave empty to search ${bs} messages from all ${vs} users.`].join("\n"),ru:[`${vs} Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¸Ð¼Ñ Ð¸Ð»Ð¸ Ð¸Ð¼ÐµÐ½Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð´Ð»Ñ Ð¿Ð°Ñ€ÑÐ¸Ð½Ð³Ð° (Ñ‡ÐµÑ€ÐµÐ· Ð·Ð°Ð¿ÑÑ‚ÑƒÑŽ):`,`${gs} ÐžÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ Ð¿ÑƒÑÑ‚Ñ‹Ð¼, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¸ÑÐºÐ°Ñ‚ÑŒ ${bs} ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð²ÑÐµÑ… ${vs} Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹.`].join("\n")},userPossiblyBanned:{en:e=>`${fs} User ${vs} ${e} not found. The user may be banned or deleted. Continue anyway?`,ru:e=>`${fs} ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ ${vs} ${e} Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½. Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾, Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð·Ð°Ð±Ð°Ð½ÐµÐ½ Ð¸Ð»Ð¸ ÑƒÐ´Ð°Ð»Ñ‘Ð½. ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ Ð² Ð»ÑŽÐ±Ð¾Ð¼ ÑÐ»ÑƒÑ‡Ð°Ðµ?`},retrieveHistoryPrompt:{en:`${gs} Do you want to retrieve all previous ${vs} history usernames for this user? (1 - yes, 2 - no)`,ru:`${gs} Ð¥Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð²ÑÐµ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ðµ ${vs} Ð¸Ð¼ÐµÐ½Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð´Ð»Ñ ÑÑ‚Ð¾Ð³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ? (1 - Ð´Ð°, 2 - Ð½ÐµÑ‚)`},confirmUsernames:{en:`${hs} Confirm or edit the list of ${vs} usernames to parse (comma-separated):`,ru:`${hs} ÐŸÐ¾Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¸Ñ‚Ðµ Ð¸Ð»Ð¸ Ð¾Ñ‚Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ ÑÐ¿Ð¸ÑÐ¾Ðº ${vs} Ð¸Ð¼Ñ‘Ð½ Ð´Ð»Ñ Ð¿Ð°Ñ€ÑÐ¸Ð½Ð³Ð° (Ñ‡ÐµÑ€ÐµÐ· Ð·Ð°Ð¿ÑÑ‚ÑƒÑŽ):`},noUsersSelected:{en:`${fs} No ${vs} users selected.`,ru:`${fs} ÐÐµ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ñ‹ ${vs} Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸.`},unableToGetRegDate:{en:`${fs} Could not get registration ${Cs} date.`,ru:`${fs} ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ${Cs} Ð´Ð°Ñ‚Ñƒ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸.`},editStartDate:{en:e=>`${hs} From which ${Cs} to start parsing? (registration date: ${e})`,ru:e=>`${hs} Ð¡ ÐºÐ°ÐºÐ¾Ð¹ ${Cs} Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ Ð¿Ð°Ñ€ÑÐ¸Ð½Ð³? (Ð´Ð°Ñ‚Ð° Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸: ${e})`},invalidEditedDate:{en:`${fs} Invalid ${Cs} date format.`,ru:`${fs} ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ ${Cs} Ð´Ð°Ñ‚Ñ‹.`},dateBeforeMinimal:{en:e=>`${fs} ${xs} Chat logs are only available from ${e}. Using this ${Cs} date.`,ru:e=>`${fs} ${xs} Ð›Ð¾Ð³Ð¸ Ñ‡Ð°Ñ‚Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ ${e}. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ ÑÑ‚Ð° ${Cs} Ð´Ð°Ñ‚Ð°.`},enterSearchTerms:{en:e=>[`${ys} Enter search terms to filter ${bs} messages (comma-separated):`,e?`${gs} This will search through all ${vs} users' ${bs} messages for the specified terms.`:`${gs} Leave empty to show all ${bs} messages from selected ${vs} users.`,`${ws} Examples:`,"hello, dude","creature, spammer, troll",`${gs} Note: Search is case-insensitive and will find ${bs} messages containing ANY of the terms.`].join("\n"),ru:e=>[`${ys} Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¿Ð¾Ð¸ÑÐºÐ¾Ð²Ð¾Ðµ ÑÐ»Ð¾Ð²Ð¾ Ð¸Ð»Ð¸ ÑÐ»Ð¾Ð²Ð° Ð´Ð»Ñ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ð¸ ${bs} ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ (Ñ‡ÐµÑ€ÐµÐ· Ð·Ð°Ð¿ÑÑ‚ÑƒÑŽ):`,e?`${gs} Ð‘ÑƒÐ´ÐµÑ‚ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÑŒÑÑ Ð¿Ð¾Ð¸ÑÐº Ð¿Ð¾ Ð²ÑÐµÐ¼ ${bs} ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸ÑÐ¼ ${vs} Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð´Ð»Ñ ÑƒÐºÐ°Ð·Ð°Ð½Ð½Ñ‹Ñ… ÑÐ»Ð¾Ð².`:`${gs} ÐžÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ Ð¿ÑƒÑÑ‚Ñ‹Ð¼, Ð´Ð»Ñ Ð¿Ð¾Ð¸ÑÐºÐ° Ð²ÑÐµÑ… ${bs} ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ñ… ${vs} Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹.`,`${ws} ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹:`,"Ð¿Ñ€Ð¸Ð²ÐµÑ‚, Ñ‡ÑƒÐ²Ð°Ðº","Ñ‡ÑƒÑ‡ÐµÐ»Ð¾, ÑÐ¿Ð°Ð¼ÐµÑ€, Ñ‚Ñ€Ð¾Ð»Ð»ÑŒ",`${gs} ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ðµ: Ð¿Ð¾Ð¸ÑÐº Ð½Ðµ Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð¸Ñ‚ÐµÐ»ÐµÐ½ Ðº Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ñƒ Ð¸ Ð½Ð°Ð¹Ð´Ñ‘Ñ‚ ${bs} ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ, ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ðµ Ð›Ð®Ð‘ÐžÐ• Ð¸Ð· ÑÐ»Ð¾Ð².`].join("\n")},searchAllUsersRequired:{en:`${fs} When searching all ${vs} users, you must provide search terms to filter ${bs} messages.`,ru:`${fs} ÐŸÑ€Ð¸ Ð¿Ð¾Ð¸ÑÐºÐµ Ð¿Ð¾ Ð²ÑÐµÐ¼ ${vs} Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑÐ¼ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ ÑƒÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¿Ð¾Ð¸ÑÐºÐ¾Ð²Ñ‹Ðµ ÑÐ»Ð¾Ð²Ð° Ð´Ð»Ñ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ð¸ ${bs} ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹.`},searchInfoAllUsers:{en:e=>`${ys} Searching all ${vs} users for ${bs} messages containing: ${e.join(", ")}`,ru:e=>`${ys} ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ Ð²ÑÐµÐ¼ ${vs} Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑÐ¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ ${bs}, ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ñ…: ${e.join(", ")}`},searchInfoSomeUsers:{en:(e,t)=>`${ys} Searching for ${bs} messages from: ${vs} ${e.join(", ")}, containing: ${t.join(", ")}`,ru:(e,t)=>`${ys} ÐŸÐ¾Ð¸ÑÐº ${bs} ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ Ð¾Ñ‚: ${vs} ${e.join(", ")}, ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ñ…: ${t.join(", ")}`},searchInfoAllFromUsers:{en:e=>`${ys} Showing all ${bs} messages from: ${vs} ${e.join(", ")}`,ru:e=>`${ys} ÐŸÐ¾ÐºÐ°Ð·Ð°Ð½Ñ‹ Ð²ÑÐµ ${bs} ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¾Ñ‚: ${vs} ${e.join(", ")}`},dateProgressInfo:{en:(e,t,n)=>`${Cs} Start: ${e} | Current: ${t} | Progress: ${n}%`,ru:(e,t,n)=>`${Cs} ÐÐ°Ñ‡Ð°Ð»Ð¾: ${e} | Ð¢ÐµÐºÑƒÑ‰Ð°Ñ: ${t} | ÐŸÑ€Ð¾Ð³Ñ€ÐµÑÑ: ${n}%`},noMessagesFoundAll:{en:e=>`${fs} No ${bs} messages found containing the search terms: ${e.join(", ")}`,ru:e=>`${fs} ${bs} Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ, ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ðµ ÑÐ»Ð¾Ð²Ð°: ${e.join(", ")}, Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹.`},noMessagesFoundSome:{en:e=>`${fs} No ${bs} messages found for the selected ${vs} user(s) containing the search terms: ${e.join(", ")}`,ru:e=>`${fs} ${bs} Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ñ… ${vs} Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹, ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ðµ ÑÐ»Ð¾Ð²Ð°: ${e.join(", ")}, Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹.`},noMessagesFound:{en:`${fs} No ${bs} messages found for the selected ${vs} user(s).`,ru:`${fs} ${bs} Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð´Ð»Ñ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ñ… ${vs} Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹.`},deleteConfirm:{en:`${fs} Are you sure you want to delete all saved ${xs} chatlogs?`,ru:`${fs} Ð’Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½Ñ‹, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ Ð²ÑÐµ ÑÐ¾Ñ…Ñ€Ð°Ð½Ñ‘Ð½Ð½Ñ‹Ðµ ${xs} Ñ‡Ð°Ñ‚Ð»Ð¾Ð³Ð¸?`},deleteSuccess:{en:`${gs} All ${xs} chatlogs deleted and cache size reset.`,ru:`${gs} Ð’ÑÐµ ${xs} Ñ‡Ð°Ñ‚Ð»Ð¾Ð³Ð¸ ÑƒÐ´Ð°Ð»ÐµÐ½Ñ‹, Ñ€Ð°Ð·Ð¼ÐµÑ€ ÐºÑÑˆÐ° ÑÐ±Ñ€Ð¾ÑˆÐµÐ½.`},selectPersonalMentionsDateMode:{en:[`${gs} Select date mode for personal mentions`,"1. Single date","2. From date","3. Date range","4. From start","5. Last (N) days"].join("\n"),ru:[`${gs} Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ€ÐµÐ¶Ð¸Ð¼ Ð´Ð°Ñ‚ Ð´Ð»Ñ Ð»Ð¸Ñ‡Ð½Ñ‹Ñ… ÑƒÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ð¹`,"1. ÐžÐ´Ð½Ð° Ð´Ð°Ñ‚Ð°","2. Ð¡ Ð´Ð°Ñ‚Ñ‹","3. Ð”Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½ Ð´Ð°Ñ‚","4. Ð¡ ÑÐ°Ð¼Ð¾Ð³Ð¾ Ð½Ð°Ñ‡Ð°Ð»Ð°","5. Ð—Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ (N) Ð´Ð½ÐµÐ¹"].join("\n")},enterMentionKeywords:{en:`${hs} Enter mention keywords to search (comma-separated):`,ru:`${hs} Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ ÑÐ»Ð¾Ð²Ð° Ð´Ð»Ñ Ð¿Ð¾Ð¸ÑÐºÐ° ÑƒÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ð¹ (Ñ‡ÐµÑ€ÐµÐ· Ð·Ð°Ð¿ÑÑ‚ÑƒÑŽ):`},noMentionKeywords:{en:`${fs} No mention keywords provided. Please enter at least one keyword.`,ru:`${fs} ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ñ‹ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ ÑÐ»Ð¾Ð²Ð° Ð´Ð»Ñ Ð¿Ð¾Ð¸ÑÐºÐ° ÑƒÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ð¹. Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ñ…Ð¾Ñ‚Ñ Ð±Ñ‹ Ð¾Ð´Ð½Ð¾ ÑÐ»Ð¾Ð²Ð¾.`},enterLatestDays:{en:`${hs} Enter the number of latest days:`,ru:`${hs} Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ñ… Ð´Ð½ÐµÐ¹:`},invalidDaysNumber:{en:`${fs} Please enter a valid number of days.`,ru:`${fs} Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾Ðµ Ñ‡Ð¸ÑÐ»Ð¾ Ð´Ð½ÐµÐ¹.`}};function ks(e){const t=new Date,n=new Date(t);return n.setDate(t.getDate()-e+1),{from:n.toISOString().slice(0,10),to:t.toISOString().slice(0,10)}}function Es(e,t){let n=!1,o=!1,s=null;const r=pe();async function a(){let e;for(;;){if(e=prompt(Ss.selectParseMode[r],"1"),null===e)return null;if(["1","2","3","4","5","6"].includes(e))break;alert(Ss.invalidSelection[r])}const t={};async function n(e){if("4"===e)t.from=w,t.to=(new Date).toISOString().slice(0,10);else if("3"===e){let e,n,o;for(;;){if(e=prompt(Ss.enterDateRange[r],""),null===e)return null;if(!e.trim())continue;const s=e.match(/([\d:\-]{6,10})\s*-\s*([\d:\-]{6,10})/);if(s&&(n=he(s[1]),o=he(s[2]),n&&o)){t.from=n,t.to=o;break}alert(Ss.invalidRange[r])}}else if("2"===e){let e,n;for(;;){if(e=prompt(Ss.enterFromDate[r],""),null===e)return null;if(e.trim()){if(n=he(e.trim()),n){t.from=n,t.to=(new Date).toISOString().slice(0,10);break}alert(Ss.invalidFromDate[r])}}}else if("1"===e){let e,n;for(;;){if(e=prompt(Ss.enterSingleDate[r],""),null===e)return null;if(e.trim()){if(n=he(e.trim()),n){t.from=n,t.to=n;break}alert(Ss.invalidDate[r])}}}}if("6"===e){let e;for(;;){if(e=prompt(Ss.selectPersonalMentionsDateMode[r],"1"),null===e)return null;if(["1","2","3","4","5"].includes(e))break;alert(Ss.invalidSelection[r])}if("5"===e){let e;for(;;){if(e=prompt(Ss.enterLatestDays[r],"7"),null===e)return null;const n=parseInt(e.trim());if(isNaN(n)||n<=0||n>365){alert(Ss.invalidDaysNumber[r]);continue}const o=ks(n);t.from=o.from,t.to=o.to;break}}else{if(null===await n(e))return null}const o=await async function(){let e=[];if(v&&e.push(v),v)try{const t=await P(v,"usernamesHistory");Array.isArray(t)&&t.length>0&&t.forEach((t=>{t&&!e.includes(t)&&e.push(t)}))}catch(e){console.warn("Could not fetch username history for",v,":",e)}let t=[];try{const e=localStorage.getItem("mentionKeywords");e&&(t=JSON.parse(e))}catch(e){console.warn("Could not parse mention keywords from localStorage:",e)}return Array.isArray(t)||(t=[]),t.forEach((t=>{t&&!e.includes(t)&&e.push(t)})),e}();let s=prompt(Ss.enterMentionKeywords[r],o.join(", "));if(null===s)return null;let a=[];if(s&&s.trim()){const e=s.split(",");if(Array.isArray(e)){a=e.map((e=>e?e.trim():"")).filter(Boolean);const t=[];a.forEach((e=>{e&&!t.includes(e)&&t.push(e)})),a=t}}return 0===a.length?(alert(Ss.noMentionKeywords[r]),null):(t.mode="personalmentions",t.mentionKeywords=a,t)}if("5"===e)return t.mode="fromregistered",t;if(["4","3","2","1"].includes(e)){return null===await n(e)?null:(t.mode="1"===e?"single":"2"===e?"fromdate":"3"===e?"range":"fromstart",t)}}async function i(){let e="";for(;;){if(e=prompt(Ss.enterUsernames[r],e||""),null===e)return null;if(!e||!e.trim())return[];let t=[];if(e&&e.trim()){const n=e.split(",");Array.isArray(n)&&(t=n.map((e=>e?e.trim():"")).filter(Boolean))}if(0===t.length)return[];const n=[];for(const e of t){(await O(e)||confirm(Ss.userPossiblyBanned[r](e)))&&n.push(e)}if(0!==n.length){if(1===n.length){if("1"===prompt(Ss.retrieveHistoryPrompt[r],"2")){const e=await P(n[0],"usernamesHistory");if(Array.isArray(e)&&e.length>0){const t=[n[0],...e.filter((e=>e!==n[0]))],o=prompt(Ss.confirmUsernames[r],t.join(", "));if(!o)return null;let s=[];if(o&&o.trim()){const e=o.split(",");Array.isArray(e)&&(s=e.map((e=>e?e.trim():"")).filter(Boolean))}return s}}}return n}}}function l(e,t){if(!t||0===t.length)return!0;if(!e)return!1;const n=e.toLowerCase();return t.some((e=>n.includes(e)))}function c(){const e=t.querySelector(".panel-header-shuffle-button");e&&(e.dataset.mode="loadToday",e.classList.add("today"),e.innerHTML=Ze,kt(e,{en:"Load Today's Chat Logs",ru:"Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ ÑÐµÐ³Ð¾Ð´Ð½ÑÑˆÐ½Ð¸Ðµ Ð»Ð¾Ð³Ð¸ Ñ‡Ð°Ñ‚Ð°"}))}function d(e,t,n){const o=n-t,s=e-t;return o<=0?100:Math.min(100,Math.max(0,Math.round(s/o*100)))}async function u(){window.chatlogsParserState||(window.chatlogsParserState={isRunning:()=>n,stop:m}),window.stopChatlogsParser||(window.stopChatlogsParser=m),n=!0,o=!1,s=new AbortController,e.innerHTML=ct,function(){const e=t.querySelector(".panel-header-shuffle-button");e&&(e.dataset.mode="",e.classList.remove("today"),e.innerHTML=We,kt(e,{en:"Random Date",ru:"Ð¡Ð»ÑƒÑ‡Ð°Ð¹Ð½Ð°Ñ Ð´Ð°Ñ‚Ð°"}))}();const u=await a();if(!u)return void p();let g,h;if("personalmentions"===u.mode){let e=u.mentionKeywords||[];if(!Array.isArray(e)||0===e.length)return alert("No mention keywords provided. Please enter at least one keyword."),void p();h=e.map((e=>e?e.toLowerCase():"")).filter(Boolean),g=[]}else if("fromregistered"===u.mode){let e=await i();if(null===e||0===e.length)return alert(Ss.noUsersSelected[r]),void p();let t=[];for(const n of e){let e=await P(n,"registered"),o=null;"string"==typeof e?o=e:"number"==typeof e&&(o=new Date(1e3*e).toISOString().slice(0,10)),o&&t.push(o)}if(!t.length)return alert(Ss.unableToGetRegDate[r]),void p();let n=t.sort()[0],o=prompt(Ss.editStartDate[r](n),n);if(!o)return void p();if(o=he(o.trim()),!o)return alert(Ss.invalidEditedDate[r]),void p();let s=w;o<s&&(alert(Ss.dateBeforeMinimal[r](s)),o=s),u.from=o,u.to=(new Date).toISOString().slice(0,10),g=e}else if(g=await i(),null===g)return void p();const f=0===g.length;if("personalmentions"!==u.mode){if(h=function(e=!1){let t;for(;;){if(t=prompt(Ss.enterSearchTerms[r](e),""),null===t)return null;if(!t||!t.trim()){if(e){alert(Ss.searchAllUsersRequired[r]);continue}return[]}let n=[];if(t&&t.trim()){const e=t.split(",");Array.isArray(e)&&(n=e.map((e=>e?e.trim().toLowerCase():"")).filter(Boolean))}return n}}(f),null===h)return void p();if(f&&0===h.length)return alert(Ss.searchAllUsersRequired[r]),void p()}let y=u.from,v=u.to,b=[];const x=new Map,C=(S=t)?S.classList.contains("chat-logs-container")?S:S.querySelector(".chat-logs-container"):null;var S;C&&(C.innerHTML="");let k=null;if(C){const e=document.createElement("div");e.className="search-messages-info",f?e.textContent=Ss.searchInfoAllUsers[r](h):h.length>0?e.textContent=Ss.searchInfoSomeUsers[r](g,h):e.textContent=Ss.searchInfoAllFromUsers[r](g),C.appendChild(e),k=document.createElement("div"),k.className="search-messages-date",k.textContent="",e.insertAdjacentElement("afterend",k)}const E=new Date(y),$=new Date(v);let L=new Date(E);for(;L<=$&&!o;){const e=L.toISOString().slice(0,10);if(k){const t=d(L,E,$);k.textContent=Ss.dateProgressInfo[r](y,e,t)}try{const{chatlogs:t}=await Co(e,null,s.signal);if(o)break;let n;if(f?n=t.filter((e=>e&&e.message&&l(e.message,h))):(n=t.filter((e=>e&&e.message&&g.includes(e.username))),h.length>0&&(n=n.filter((e=>l(e.message,h))))),o)break;if(b=b.concat(n),n.forEach((({username:e})=>{x.set(e,(x.get(e)||0)+1)})),o)break;if(C&&n.length>0){if(ms(n,C,!0,e,h,h&&h.length>0),o)break;ps(x,C.closest(".chat-logs-panel"))}if(o)break;if(await new Promise((e=>setTimeout(e,60))),o)break;L.setDate(L.getDate()+1)}catch(e){if("AbortError"===e.name){console.log("Parsing was aborted");break}console.error("Error during parsing:",e);break}}if(C&&0===b.length){let e;e=f?Ss.noMessagesFoundAll[r](h):h.length>0?Ss.noMessagesFoundSome[r](h):Ss.noMessagesFound[r],C.innerHTML=`<div class="no-messages-info">${e}</div>`;const t=C.closest(".chat-logs-panel");if(t){const e=t.querySelector(".active-users");e&&(e.innerHTML="")}}p(),C&&ps(x,C.closest(".chat-logs-panel")),c()}function m(){o=!0,s&&s.abort(),n=!1,p(),c()}function p(){e.innerHTML=lt,n=!1,o=!1,s=null}e.addEventListener("click",(async e=>{e.ctrlKey?confirm(Ss.deleteConfirm[r])&&(await async function(){const e=await mo();return new Promise(((t,n)=>{const o=e.transaction(uo,"readwrite").objectStore(uo).clear();o.onsuccess=()=>{fo(0),t()},o.onerror=()=>n(o.error)}))}(),alert(Ss.deleteSuccess[r])):n?m():await u()}))}let{panelsEvents:$s}=E;async function Ls(e){const t=document.querySelector(".chat-logs-panel");if(t)return t.remove(),void It("hide");ee();const n=document.createElement("div");n.className="chat-logs-panel popup-panel";const o=document.createElement("div");o.className="panel-header";const s=document.createElement("div");s.className="panel-control-buttons";const r=document.createElement("div");r.className="search-for-chatlogs-messages";const a=document.createElement("input");function i(){requestAnimationFrame((function(){a.focus()}))}a.className="chatlogs-search-input",a.type="text",kt(a,{en:" \n      [Ctrl + Click] clear input and reset filtered items\n      [Valid date + Enter] load chat logs for the date in input field (e.g. 2023-10-01, 2023:10:01, 231001, 2310, 2310:01)\n      [Search by name]: name(, name2â€¦); prefix: name (partial) or prefix:: name (exact), e.g. name: iv / name:: Ivan. Prefixes: user, username, nick, name, nickname.\n      [Search by word]: word(, or(\\/|) word2â€¦); prefix: word (partial) or prefix:: word (exact), e.g. word: priv / word:: privet. Prefixes: msg, message, text, word, content.\n    ",ru:" \n      [Ctrl + Click] Ð¾Ñ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»Ðµ Ð¸ ÑÐ±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€\n      [ÐšÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð°Ñ Ð´Ð°Ñ‚Ð° + Enter] Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ñ‡Ð°Ñ‚-Ð»Ð¾Ð³Ð¸ Ð·Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½ÑƒÑŽ Ð´Ð°Ñ‚Ñƒ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, 2023-10-01, 2023:10:01, 231001, 2310, 2310:01)\n      [ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ Ð¸Ð¼ÐµÐ½Ð¸]: Ð¸Ð¼Ñ(, Ð¸Ð¼Ñ2â€¦); Ð¿Ñ€Ð¸ÑÑ‚Ð°Ð²ÐºÐ°: Ð¸Ð¼Ñ (Ð½ÐµÐ¿Ð¾Ð»Ð½Ð¾Ðµ) Ð¸Ð»Ð¸ Ð¿Ñ€Ð¸ÑÑ‚Ð°Ð²ÐºÐ°:: Ð¸Ð¼Ñ (Ñ‚Ð¾Ñ‡Ð½Ð¾Ðµ), Ð½Ð°Ð¿Ñ€. Ð¸Ð¼Ñ: Ð¸Ð² / Ð¸Ð¼Ñ:: Ð˜Ð²Ð°Ð½. ÐŸÑ€Ð¸ÑÑ‚Ð°Ð²ÐºÐ¸: Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ, Ð½Ð¸Ðº, Ð¸Ð¼Ñ, Ð½Ð¸ÐºÐ½ÐµÐ¹Ð¼.\n      [ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ ÑÐ»Ð¾Ð²Ñƒ]: ÑÐ»Ð¾Ð²Ð¾(. Ð¸Ð»Ð¸(\\/|) ÑÐ»Ð¾Ð²Ð¾2â€¦); Ð¿Ñ€Ð¸ÑÑ‚Ð°Ð²ÐºÐ°: ÑÐ»Ð¾Ð²Ð¾ (Ð½ÐµÐ¿Ð¾Ð»Ð½Ð¾Ðµ) Ð¸Ð»Ð¸ Ð¿Ñ€Ð¸ÑÑ‚Ð°Ð²ÐºÐ°:: ÑÐ»Ð¾Ð²Ð¾ (Ñ‚Ð¾Ñ‡Ð½Ð¾Ðµ), Ð½Ð°Ð¿Ñ€. ÑÐ»Ð¾Ð²Ð¾: Ð¿Ñ€Ð¸Ð² / ÑÐ»Ð¾Ð²Ð¾:: Ð¿Ñ€Ð¸Ð²ÐµÑ‚. ÐŸÑ€Ð¸ÑÑ‚Ð°Ð²ÐºÐ¸: ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ, Ñ‚ÐµÐºÑÑ‚, ÑÐ»Ð¾Ð²Ð¾, ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚.\n    "}),r.appendChild(a),o.appendChild(r),a.addEventListener("input",(()=>es(a.value))),a.addEventListener("click",(e=>{e.ctrlKey&&(a.value="",es(a.value))})),a.addEventListener("keydown",(async e=>{const t=a.value;if("Enter"===e.key){let e=t;/^\d{8}$/.test(t)?(e=6===t.length?"20"+t:t,e=e.replace(/(\d{4})(\d{2})(\d{2})/,"$1-$2-$3")):/^\d{6}$/.test(t)&&(e="20"+t.replace(/(\d{2})(\d{2})(\d{2})/,"$1-$2-$3"));if(/^\d{2,4}[:\-]\d{2}[:\-]\d{2}$/.test(e.replace(/:/g,"-"))&&!isNaN(new Date(e.replace(/:/g,"-")).getTime()))await D(e),d(u);else{const e="ru"===pe()?["ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð²Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½ÑƒÑŽ Ð´Ð°Ñ‚Ñƒ.","","Ð”Ð¾Ð¿ÑƒÑÑ‚Ð¸Ð¼Ñ‹Ðµ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ñ‹:","1. Ð³Ð³Ð³Ð³-Ð¼Ð¼-Ð´Ð´","2. Ð³Ð³Ð³Ð³:Ð¼Ð¼:Ð´Ð´","3. Ð³Ð³-Ð¼Ð¼-Ð´Ð´","4. Ð³Ð³:Ð¼Ð¼:Ð´Ð´","5. Ð³Ð³Ð³Ð³Ð¼Ð¼Ð´Ð´","6. Ð³Ð³Ð¼Ð¼Ð´Ð´",""].join("\n"):["Please enter a valid date.","","Valid formats include:","1. yyyy-mm-dd","2. yyyy:mm:dd","3. yy-mm-dd","4. yy:mm:dd","5. yyyymmdd","6. yymmdd",""].join("\n");alert(e)}a.value=""}})),i();const l=document.createElement("div");l.className="large-button panel-header-parse-button",l.innerHTML=lt,kt(l,{en:"\n      [Click] to parse Chat Logs\n      [Ctrl + Click] to delete stored Chat Logs from IndexedDB\n    ",ru:"\n      [ÐšÐ»Ð¸Ðº] ÑÐ¿Ð°Ñ€ÑÐ¸Ñ‚ÑŒ Ð»Ð¾Ð³Ð¸ Ñ‡Ð°Ñ‚Ð°\n      [Ctrl + ÐšÐ»Ð¸Ðº] ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÐ¾Ñ…Ñ€Ð°Ð½Ñ‘Ð½Ð½Ñ‹Ðµ Ð»Ð¾Ð³Ð¸ Ð¸Ð· IndexedDB\n    "}),Es(l,n),s.appendChild(l);const c=document.createElement("div");function d(e){"none"===e.style.display&&(e.style.display="flex")}c.className="large-button panel-header-date-button",c.innerHTML=Ye,c.addEventListener("click",(()=>{var e;(e=u).style.display="none"===e.style.display?"flex":"none"}));const u=document.createElement("input");u.type="date",u.className="chatlogs-date-input",u.style.display="none",s.appendChild(c),s.appendChild(u);const m=document.createElement("div");m.className="large-button panel-header-toggle-mention-messages-button",m.innerHTML=De,kt(m,{en:"Toggle Mention Messages",ru:"ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÑƒÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ñ"}),m.addEventListener("click",(async()=>{B("mention")}));const p=document.createElement("div");p.className="toggle-mention-messages-counter",p.textContent="0",m.appendChild(p),s.appendChild(m);const g=document.createElement("div");g.className="large-button panel-header-toggle-media-messages-button",g.innerHTML=Oe,kt(g,{en:"Toggle Media Messages",ru:"ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¼ÐµÐ´Ð¸Ð° ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚"}),g.addEventListener("click",(async()=>{B("media")}));const h=document.createElement("div");h.className="toggle-media-messages-counter",h.textContent="0",g.appendChild(h),s.appendChild(g);const f=document.createElement("div");function y(e,t){t&&(t.replaceChildren(),e.forEach((({url:e,title:n})=>{const o=vo(e),s=document.createElement("div");s.classList.add("saved-chatlog-url-wrapper");const r=document.createElement("a");r.classList.add("saved-chatlog-url"),r.textContent=o,r.href=e;const a=document.createElement("span");a.classList.add("saved-chatlog-url-title"),a.textContent=n||"âž•",s.appendChild(r),s.appendChild(a),t.appendChild(s)})))}f.className="large-button panel-header-copy-button",f.innerHTML=Xe,kt(f,{en:" \n      [Click] to copy Chat Logs Url\n      [Ctrl + Click] to save Chat Logs with title\n      [Shift + Click] to show/hide saved Chat Logs\n      [Alt + Click] to copy Chat Logs in BBCode, Markdown, or Plain format\n      [Alt + Shift + Click] to save Chat Logs in BBCode, Markdown, or Plain format\n    ",ru:" \n      [ÐšÐ»Ð¸Ðº] ÑÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÑÑ‹Ð»ÐºÑƒ Ð½Ð° Ñ‡Ð°Ñ‚-Ð»Ð¾Ð³Ð¸\n      [Ctrl + ÐšÐ»Ð¸Ðº] ÑÐ¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ñ‡Ð°Ñ‚-Ð»Ð¾Ð³Ð¸ Ñ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ¾Ð¼\n      [Shift + ÐšÐ»Ð¸Ðº] Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ/ÑÐºÑ€Ñ‹Ñ‚ÑŒ ÑÐ¾Ñ…Ñ€Ð°Ð½Ñ‘Ð½Ð½Ñ‹Ðµ Ñ‡Ð°Ñ‚-Ð»Ð¾Ð³Ð¸\n      [Alt + ÐšÐ»Ð¸Ðº] ÑÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ñ‡Ð°Ñ‚-Ð»Ð¾Ð³Ð¸ Ð² BBCode, Markdown Ð¸Ð»Ð¸ Plain\n      [Alt + Shift + ÐšÐ»Ð¸Ðº] ÑÐ¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ñ‡Ð°Ñ‚-Ð»Ð¾Ð³Ð¸ Ð² BBCode, Markdown Ð¸Ð»Ð¸ Plain\n    "}),f.addEventListener("click",(e=>{let t=document.querySelector(".saved-chatlog-container");!t&&!e.shiftKey&&K(f,0,0),!t||e.ctrlKey||t.contains(e.target)||t.remove();let n=JSON.parse(localStorage.getItem("savedChatlogs"))||[];const o=document.querySelectorAll(".chat-logs-container .message-item");if((e.altKey||e.altKey&&e.shiftKey)&&0===o.length)ge({en:"No chat logs to copy or save.",ru:"ÐÐµÑ‚ Ñ‡Ð°Ñ‚Ð»Ð¾Ð³Ð¾Ð² Ð´Ð»Ñ ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¸Ð»Ð¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ."},"alert");else if(e.altKey)cs(e,N,{date:u.value||x,isMessagesPanel:!1,includeDateHeaders:!0,includeMessageLinks:!0,prefix:"chatlogs"});else if(e.ctrlKey&&!e.target.closest(".saved-chatlog-url")){const e=vo(q);if(!e)return;const o=prompt("Enter a title for this chat log:","âž•");n.some((t=>vo(t.url)===e))||(n.push({url:q,title:o||"âž•"}),n.sort(((e,t)=>{const n=vo(e.url),o=vo(t.url);return new Date(n)-new Date(o)})),localStorage.setItem("savedChatlogs",JSON.stringify(n))),y(n,t)}else e.shiftKey?n.length>0&&!t&&(t=document.createElement("div"),t.classList.add("saved-chatlog-container"),y(n,t),f.appendChild(t)):navigator.clipboard.writeText(q).catch((e=>console.error("Failed to copy: ",e)))})),s.appendChild(f);const v=localStorage.getItem("shouldShowActiveUsers")||(localStorage.setItem("shouldShowActiveUsers","shown"),"shown"),b=document.createElement("div");function S(e){b.innerHTML="shown"===e?Ke:Je,kt(b,"shown"===e?{en:"Hide User List",ru:"Ð¡ÐºÑ€Ñ‹Ñ‚ÑŒ ÑÐ¿Ð¸ÑÐ¾Ðº Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹"}:{en:"Show User List",ru:"ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ ÑÐ¿Ð¸ÑÐ¾Ðº Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹"})}b.className="large-button panel-header-toggle-button",S(v),b.addEventListener("click",(function(){const e="shown"===localStorage.getItem("shouldShowActiveUsers")?"hidden":"shown";if(localStorage.setItem("shouldShowActiveUsers",e),S(e),"shown"===e)ps(A,n);else{const e=n.querySelector(".active-users");e&&n.removeChild(e)}})),s.appendChild(b);const k=document.createElement("div");k.className="large-button panel-header-one-day-back-button",k.innerHTML=Ve,kt(k,{en:"Previous Day",ru:"ÐŸÑ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ð¹ Ð´ÐµÐ½ÑŒ"});const E=document.createElement("div");E.className="large-button panel-header-one-day-forward-button",E.innerHTML=Ge,kt(E,{en:"Next Day",ru:"Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ Ð´ÐµÐ½ÑŒ"});const $=document.createElement("div");function L(){return u.value?new Date(u.value):new Date}$.className="large-button panel-header-shuffle-button",$.innerHTML=We,kt($,{en:"Random Date",ru:"Ð¡Ð»ÑƒÑ‡Ð°Ð¹Ð½Ð°Ñ Ð´Ð°Ñ‚Ð°"});function T(){a.value&&a.value.trim().length>0&&es(a.value),d(u),i()}k.addEventListener("click",(async()=>{const e=L();e.setDate(e.getDate()-1),await D(e,T)})),E.addEventListener("click",(async()=>{const e=L();e.setDate(e.getDate()+1),await D(e,T)})),$.addEventListener("click",(async()=>{if("loadToday"===$.dataset.mode)await D(x,(()=>{T(),$.dataset.mode="",$.classList.remove("today"),$.innerHTML=We,kt($,{en:"Random Date",ru:"Ð¡Ð»ÑƒÑ‡Ð°Ð¹Ð½Ð°Ñ Ð´Ð°Ñ‚Ð°"})}));else{const e=function(){const e=new Date(w),t=new Date-e,n=Math.floor(Math.random()*t),o=new Date(e.getTime()+n);return new Intl.DateTimeFormat("en-CA").format(o)}();await D(e,(()=>{T()}))}})),s.appendChild(k),s.appendChild(E),s.appendChild($);const M=document.createElement("div");M.className="large-button panel-header-close-button",M.innerHTML=Pe,kt(M,{en:"Close panel",ru:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ð°Ð½ÐµÐ»ÑŒ"}),M.addEventListener("click",(()=>{Nt(n,"hide"),It("hide")})),s.appendChild(M),o.appendChild(s);const N=document.createElement("div");N.className="chat-logs-container messages-search-container",n.appendChild(o),n.appendChild(N),document.body.appendChild(n);const{scrollButtonsContainer:I}=Dt(N);n.appendChild(I),Nt(n,"show"),It("show");const A=new Map;let q="";const D=async(e,t)=>{const o=new Intl.DateTimeFormat("en-CA").format(new Date((e=>/^\d{4}:\d{2}:\d{2}$/.test(e)?e.replace(/:/g,"-"):e)(e)));if(o<w||o>x){const e=pe();return void alert(o<w?"ru"===e?`Ð’Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð°Ñ Ð´Ð°Ñ‚Ð° Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ñ€Ð°Ð½ÑŒÑˆÐµ ${w}.`:`The selected date cannot be earlier than ${w}.`:"ru"===e?"Ð’Ñ‹ Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð±ÑƒÐ´ÑƒÑ‰ÑƒÑŽ Ð´Ð°Ñ‚Ñƒ.":"You cannot load a future date.")}(e=>{u.value=e;const t={en:`Current date: ${e}`,ru:`Ð¢ÐµÐºÑƒÑ‰Ð°Ñ Ð´Ð°Ñ‚Ð°: ${e}`};kt(u,t),kt(c,t)})(o);const{chatlogs:s,url:r,placeholder:i}=await Co(o,N);a.placeholder=i,q=`${r}?rand=${yo}`,A.clear();const l=[...new Set(s.map((e=>e.username)).filter((e=>e&&"SYSTEM"!==e)))];await J(l);const d=ms(s,N);A.clear();for(const[e,t]of d.entries())A.set(e,t);ps(A,n),requestAnimationFrame((()=>{Fo("chatlogsMessages"),Go("chatlogsMessages"),fn("chatlogsMessages"),un("chatlogsMessages"),h.textContent=document.querySelectorAll(".chat-logs-container .media").length,p.textContent=document.querySelectorAll(".chat-logs-container .mention").length,function(){if(N.childElementCount>0){const e="ru"===pe()?"Ð’ÑÐµÐ³Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹":"Total messages";a.placeholder+=` | ${e}: ${N.childElementCount}`}}(),B(null,!1),"function"==typeof t&&t(),N.scrollTop=N.scrollHeight}))},j=e||x;await D(j),e&&d(u),u.max=x,u.min=w,u.value=j,kt(c,{en:`Current date: ${j}`,ru:`Ð¢ÐµÐºÑƒÑ‰Ð°Ñ Ð´Ð°Ñ‚Ð°: ${j}`}),u.addEventListener("change",(async e=>{const t=e.target.value;await D(t),kt(c,{en:`Current date: ${t}`,ru:`Ð¢ÐµÐºÑƒÑ‰Ð°Ñ Ð´Ð°Ñ‚Ð°: ${t}`})})),$s.handleChatLogsKeydown=e=>{"Escape"===e.key&&(Nt(n,"hide"),It("hide"),document.removeEventListener("keydown",$s.handleChatLogsKeydown))},document.addEventListener("keydown",$s.handleChatLogsKeydown),n.addEventListener("click",(async e=>{if(e.target.closest("a"))return;const t=e.target.closest(".message-item"),n=e.target.closest(".message-time"),o=e.target.closest(".message-username"),s=e.target.closest(".message-text");if(t||s){if(e.ctrlKey&&t)return void function(e,t){const n=e.querySelector(".message-username")?.textContent?.trim(),o=e.querySelector(".message-text"),s=o?me(o):"",r=e.querySelector(".message-time")?.textContent?.trim();let a=t.value,i=e.previousElementSibling;for(;i&&!i.classList.contains("date-item");)i=i.previousElementSibling;if(i&&i.classList.contains("date-item")){const e=i.querySelector(".date-text");a=e?e.textContent.trim():i.textContent.trim()}const l=JSON.parse(localStorage.getItem(Ns))||{},c=JSON.parse(localStorage.getItem(C)||"{}");l[`[${r}]_${n}_${a}`]={time:`[${r}]`,date:a||x,username:n,usernameColor:c[n]?.color||"#808080",message:s,type:"mention",userId:c[n]?.id||""};const d=Object.keys(l);d.sort(((e,t)=>{const n=e=>{const t=l[e],n=t.date||"",o=(t.time||"").replace(/\[|\]/g,"");return new Date(`${n}T${o||"00:00:00"}`)};return n(e)-n(t)}));const u={};for(const e of d)u[e]=l[e];localStorage.setItem(Ns,JSON.stringify(u)),K(e,0,0)}(t,u);if(O={media:!1,mention:!1},m.classList.remove("active"),g.classList.remove("active"),a.value="",es(""),n){let t=u.value;const o=n.textContent;if(n.closest(".chat-logs-container")){let e=n.parentElement;for(;e&&!e.classList.contains("date-item");)e=e.previousElementSibling;if(e&&e.classList.contains("date-item")){const n=e.querySelector(".date-text");t=n?n.textContent.trim():e.textContent.trim()}}if(e.shiftKey)return e.preventDefault(),e.stopPropagation(),void de(t,o,n);const s=`https://klavogonki.ru/chatlogs/${t}.html#${o}`;return void window.open(s,"_blank","noopener,noreferrer")}if(o){const e=o.textContent,t=await async function(e){const t=JSON.parse(localStorage.getItem(C)||"{}");if(t[e]?.id)return t[e].id}(e);if(t){const e=`https://klavogonki.ru/u/#/${t}/`;window.open(e,"_blank","noopener,noreferrer")}else Y(o);return}requestAnimationFrame((async()=>{await On(N,t)}))}})),kt(".message-time",n,(e=>({en:` \n      [Click] Open chatlog at ${e.textContent}\n      [Shift + Click] Copy chatlogs URL to clipboard\n    `,ru:` \n      [ÐšÐ»Ð¸Ðº] Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ñ‡Ð°Ñ‚Ð»Ð¾Ð³ Ð½Ð° ${e.textContent}\n      [Shift + ÐšÐ»Ð¸Ðº] ÑÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÑÑ‹Ð»ÐºÑƒ Ð½Ð° Ñ‡Ð°Ñ‚Ð»Ð¾Ð³\n   `})),!0),kt(".message-username",n,(e=>({en:`[Click] Open ${e.textContent} profile`,ru:`[ÐšÐ»Ð¸Ðº] Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»ÑŒ ${e.textContent}`})),!0),kt(".message-text",n,(e=>({en:"\n      [Click] Scroll message to the middle of the chat logs\n      [Ctrl + Click] add message to the messages panel  \n    ",ru:"\n      [ÐšÐ»Ð¸Ðº] Ð¿Ñ€Ð¾ÐºÑ€ÑƒÑ‚Ð¸Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ðº Ñ†ÐµÐ½Ñ‚Ñ€Ñƒ Ñ‡Ð°Ñ‚Ð»Ð¾Ð³Ð°\n      [Ctrl + ÐšÐ»Ð¸Ðº] Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð² Ð¿Ð°Ð½ÐµÐ»ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹\n    "})),!0),n.addEventListener("click",(e=>{const t=e.target.closest(".active-user-item");if(t){const n=t.querySelector(".active-user-name"),o=n?.textContent;if(!o)return;const s=a.value.trim(),r=e.ctrlKey?`, ${o}`:o;a.value=s===o?"":e.ctrlKey&&!s.includes(o)?s+r:o,es(a.value)}})),kt(".active-user-name",n,(e=>({en:`\n      [Click] to filter messages by ${e.textContent}\n      [Repeat Click] to clear ${e.textContent} from the search input\n      [Ctrl + Click] to add additional username to the search input\n    `,ru:` \n      [ÐšÐ»Ð¸Ðº] Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¿Ð¾ ${e.textContent}\n      [ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð½Ñ‹Ð¹ ÐºÐ»Ð¸Ðº] ÑƒÐ±Ñ€Ð°Ñ‚ÑŒ ${e.textContent} Ð¸Ð· Ð¿Ð¾Ð¸ÑÐºÐ°\n      [Ctrl + ÐšÐ»Ð¸Ðº] Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ðº Ð¿Ð¾Ð¸ÑÐºÑƒ\n    `})),!0),kt(".saved-chatlog-url",n,(e=>({en:`\n      [Click] Load chat logs for ${e.textContent}\n      [Ctrl + Click] Remove this saved chat log\n      [Middle Click]Open in new tab\n    `,ru:`\n      [ÐšÐ»Ð¸Ðº] Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ñ‡Ð°Ñ‚ - Ð»Ð¾Ð³Ð¸ Ð·Ð° ${e.textContent}\n      [Ctrl + ÐšÐ»Ð¸Ðº] ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÐ¾Ñ…Ñ€Ð°Ð½Ñ‘Ð½Ð½Ñ‹Ð¹ Ñ‡Ð°Ñ‚Ð»Ð¾Ð³\n      [Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹ ÐºÐ»Ð¸Ðº] Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð² Ð½Ð¾Ð²Ð¾Ð¹ Ð²ÐºÐ»Ð°Ð´ÐºÐµ\n    `})),!0),kt(".saved-chatlog-url-title",n,(e=>({en:"[Click] Edit title for this chat log",ru:"[ÐšÐ»Ð¸Ðº] Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº Ð´Ð»Ñ ÑÑ‚Ð¾Ð³Ð¾ Ñ‡Ð°Ñ‚Ð»Ð¾Ð³Ð°"})),!0),n.addEventListener("click",(async e=>{const t=e.target.closest(".saved-chatlog-url");if(t){e.preventDefault();let n=JSON.parse(localStorage.getItem("savedChatlogs"))||[];if(e.ctrlKey){const e=t.href,o=n.filter((t=>t.url!==e));if(o.length!==n.length){n=o,localStorage.setItem("savedChatlogs",JSON.stringify(n));const e=t.closest(".saved-chatlog-url-wrapper");e&&e.remove()}}else if(1===e.button)window.open(t.href,"_blank","noopener,noreferrer");else{const e=t.textContent;await D(e)}return}const n=e.target.closest(".saved-chatlog-url-title");if(n){let e=JSON.parse(localStorage.getItem("savedChatlogs"))||[];const t=n.closest(".saved-chatlog-url-wrapper"),o=t&&t.querySelector(".saved-chatlog-url");if(!o)return;const s=o.href,r=prompt("Enter a new title for this chat log:",n.textContent);if(null!==r&&r!==n.textContent){n.textContent=r;const t=e.findIndex((e=>e.url===s));-1!==t&&(e[t].title=r,localStorage.setItem("savedChatlogs",JSON.stringify(e)))}}else;}));let O={media:!1,mention:!1};function B(e,t=!0){if(t&&e){const t="mention"===e;O={media:!!("media"===e)&&!O.media,mention:!!t&&!O.mention}}N.querySelectorAll(".message-item").forEach((e=>{const t=e.querySelector(".media"),n=e.querySelector(".mention");O.media?e.classList.toggle("hidden-message",!t):O.mention?e.classList.toggle("hidden-message",!n):e.classList.remove("hidden-message")})),m.classList.toggle("active",O.mention),g.classList.toggle("active",O.media)}}function Ts(e,t){function n(){Nt(e.closest(".cached-messages-panel"),"hide"),It("hide")}e.addEventListener("mouseover",(function(t){const n=t.target.closest(".message-time");if(n&&e.contains(n)){const e=n.closest(".message-item");if(!e)return;const t=e.dataset.type;"mention"!==t&&"private"!==t||(n.style.color="mention"===t?"lightgreen":"peachpuff")}})),e.addEventListener("mouseout",(function(t){const n=t.target.closest(".message-time");if(n&&e.contains(n)){const e=n.closest(".message-item");if(!e)return;const t=e.dataset.type;"mention"!==t&&"private"!==t||(n.style.color=N[t]||"slategray")}})),e.addEventListener("click",(async function(e){const o=e.target.closest(".message-time"),s=e.target.closest(".message-username"),r=e.target.closest(".message-text"),a=e.target.closest(".message-item");if(a){if(o&&a.contains(o)){const t=a.dataset.type;let n,s=a.previousElementSibling;for(;s&&!s.classList.contains("date-item");)s=s.previousElementSibling;if(s&&(n=s.dataset.date),"mention"===t||"private"===t){if(e.shiftKey)return e.preventDefault(),e.stopPropagation(),void("mention"===t&&de(n,ss(o.textContent),o));if(e.ctrlKey)return void rs(a,"from");if("mention"===t){const e=`https://klavogonki.ru/chatlogs/${n}.html#${ss(o.textContent)}`;window.open(e,"_blank","noopener,noreferrer")}}}if(s&&a.contains(s)){if(e.ctrlKey)return void rs(a,"all");const t=s.dataset.userId;if(t){const e=`https://klavogonki.ru/u/#/${t}/`;window.open(e,"_blank","noopener,noreferrer")}else Y(s)}if(r&&a.contains(r)){if(e.ctrlKey)return e.target.closest("a")&&(e.preventDefault(),e.stopPropagation()),void rs(a,"single");const o=a.querySelector(".message-username")?.textContent;a.querySelector(".message-time");if("private"===a.dataset.type)return void requestAnimationFrame((async()=>{await os(r.textContent,o,!0)?n():Y(a)}));if(await os(r.textContent,o,!0))n();else{Y(a);let e=r.parentElement.previousElementSibling;for(;e&&!e.classList.contains("date-item");)e=e.previousElementSibling;if(e){await Ls(e.dataset.date);const n=r.textContent;requestAnimationFrame((()=>{let e=0;const s=setInterval((async()=>{const r=await async function(e,t,n){const o=document.querySelector(".chat-logs-container");if(!o)return null;const s=e=>String(e||"").replace(/\s+/g,"").trim().toLowerCase(),r=s(t),a=s(e),i=Array.from(o.querySelectorAll(".message-item")).find((e=>{const t=e.querySelector(".message-username"),n=e.querySelector(".message-text");if(t&&n){const e=s(t.textContent),o=s(n.textContent);if(e===r&&o===a)return!0}return!1}));return i&&n&&await On(o,i),i||!1}(n,o,!0);if(r)clearInterval(s);else if(++e>=10){clearInterval(s);Nt(document.querySelector(".chat-logs-panel"),"hide"),t()}}),200)}))}}}}}))}let{panelsEvents:Ms}=E;const Ns="personalMessages",Is="newMessagesCount",As="personalMessagesBackup",qs="absentMentionsLastFetch";async function Ds(){const e=document.querySelector(".cached-messages-panel");if(e)return e.remove(),void It("hide");let t=!0,n=!1,o=!1;as(),localStorage.getItem(As)&&localStorage.removeItem(As),ee();const s=document.querySelector(".personal-messages-button .new-message-count");s&&(s.textContent="0"),s.style.visibility="hidden",localStorage.removeItem(Is);let r=is();const a=document.createElement("div");a.className="cached-messages-panel popup-panel";const i=document.createElement("div");i.className="panel-header";const l=document.createElement("div");l.className="search-for-personal-messages";const c=document.createElement("input");c.className="personal-messages-search-input",c.type="search",kt(c,{en:"\n      [Ctrl + Click] to clear search input and display all personal messages\n      [Search by name]: name(, name2â€¦); prefix: name (partial) or prefix:: name (exact), e.g. name: iv / name:: Ivan. Prefixes: user, username, nick, name, nickname.\n      [Search by word]: word(, or(\\/|) word2â€¦); prefix: word (partial) or prefix:: word (exact), e.g. word: priv / word:: privet. Prefixes: msg, message, text, word, content.\n    ",ru:"\n      [Ctrl + Click] Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¾Ñ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð¸ÑÐº Ð¸ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð²ÑÐµ Ð»Ð¸Ñ‡Ð½Ñ‹Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ\n      [ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ Ð¸Ð¼ÐµÐ½Ð¸]: Ð¸Ð¼Ñ(, Ð¸Ð¼Ñ2â€¦); Ð¿Ñ€Ð¸ÑÑ‚Ð°Ð²ÐºÐ°: Ð¸Ð¼Ñ (Ð½ÐµÐ¿Ð¾Ð»Ð½Ð¾Ðµ) Ð¸Ð»Ð¸ Ð¿Ñ€Ð¸ÑÑ‚Ð°Ð²ÐºÐ°:: Ð¸Ð¼Ñ (Ñ‚Ð¾Ñ‡Ð½Ð¾Ðµ), Ð½Ð°Ð¿Ñ€. Ð¸Ð¼Ñ: Ð¸Ð² / Ð¸Ð¼Ñ:: Ð˜Ð²Ð°Ð½. ÐŸÑ€Ð¸ÑÑ‚Ð°Ð²ÐºÐ¸: Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ, Ð½Ð¸Ðº, Ð¸Ð¼Ñ, Ð½Ð¸ÐºÐ½ÐµÐ¹Ð¼.\n      [ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ ÑÐ»Ð¾Ð²Ñƒ]: ÑÐ»Ð¾Ð²Ð¾(. Ð¸Ð»Ð¸(\\/|) ÑÐ»Ð¾Ð²Ð¾2â€¦); Ð¿Ñ€Ð¸ÑÑ‚Ð°Ð²ÐºÐ°: ÑÐ»Ð¾Ð²Ð¾ (Ð½ÐµÐ¿Ð¾Ð»Ð½Ð¾Ðµ) Ð¸Ð»Ð¸ Ð¿Ñ€Ð¸ÑÑ‚Ð°Ð²ÐºÐ°:: ÑÐ»Ð¾Ð²Ð¾ (Ñ‚Ð¾Ñ‡Ð½Ð¾Ðµ), Ð½Ð°Ð¿Ñ€. ÑÐ»Ð¾Ð²Ð¾: Ð¿Ñ€Ð¸Ð² / ÑÐ»Ð¾Ð²Ð¾:: Ð¿Ñ€Ð¸Ð²ÐµÑ‚. ÐŸÑ€Ð¸ÑÑ‚Ð°Ð²ÐºÐ¸: ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ, Ñ‚ÐµÐºÑÑ‚, ÑÐ»Ð¾Ð²Ð¾, ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚. \n    "}),l.appendChild(c);const d=document.createElement("div");d.className="panel-control-buttons";const u=document.createElement("div");u.className="large-button panel-header-save-button",u.innerHTML=ot,kt(u,{en:"Save messages",ru:"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ"}),u.style.opacity="0",u.addEventListener("click",(()=>{const e=localStorage.getItem(As),n=localStorage.getItem(Ns),o=e&&n;if(o&&o&&n!==e&&!t){ge({en:"Do you want to apply changes?",ru:"Ð’Ñ‹ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ?"},"confirm")&&(localStorage.setItem(Ns,e),localStorage.removeItem(As),u.style.setProperty("display","none","important"),u.style.opacity="0",u.addEventListener("transitionend",(function(){u.style.display="none"})))}}));const m=document.createElement("div");m.className="large-button panel-header-parse-button",m.innerHTML=lt,kt(m,{en:"[Click] to start parsing mentions",ru:"[ÐšÐ»Ð¸Ðº] Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ Ð¿Ð°Ñ€ÑÐ¸Ð½Ð³ ÑƒÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ð¹"}),m.addEventListener("click",(()=>{const e={en:"Enter a date for parsing start (formats: yyyy-mm-dd, yyyy:mm:dd, yyyymmdd, yymmdd, yy-mm-dd, yy:mm:dd):",ru:"Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð´Ð°Ñ‚Ñƒ Ð½Ð°Ñ‡Ð°Ð»Ð° Ð¿Ð°Ñ€ÑÐ¸Ð½Ð³Ð° (Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ñ‹: Ð³Ð³Ð³Ð³-Ð¼Ð¼-Ð´Ð´, Ð³Ð³Ð³Ð³:Ð¼Ð¼:Ð´Ð´, Ð³Ð³Ð³Ð³Ð¼Ð¼Ð´Ð´, Ð³Ð³Ð¼Ð¼Ð´Ð´, Ð³Ð³-Ð¼Ð¼-Ð´Ð´, Ð³Ð³:Ð¼Ð¼:Ð´Ð´):"};let t=null;for(;;){let n=ge(e,"prompt","");if(!n)return;if(t=he(n.trim()),t)break;ge({en:"Invalid date format or value. Please try again.",ru:"ÐÐµÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ð¸Ð»Ð¸ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð´Ð°Ñ‚Ñ‹. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÐµÑ‰Ðµ Ñ€Ð°Ð·."},"alert")}localStorage.setItem("lastParseDate",t),ge({en:`Start date for parsing set to: ${t}`,ru:`Ð”Ð°Ñ‚Ð° Ð½Ð°Ñ‡Ð°Ð»Ð° Ð¿Ð°Ñ€ÑÐ¸Ð½Ð³Ð° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð°: ${t}`},"alert"),Hs(x),ee(!0)}));const p=document.createElement("div");p.className="large-button panel-header-import-button",p.innerHTML=tt,kt(p,{en:"Import messages",ru:"Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ"}),p.addEventListener("click",(()=>{n=!0;const e=document.createElement("input");e.type="file",e.accept=".json",e.addEventListener("change",(e=>{const t=e.target.files[0];if(t){const e=new FileReader;e.onload=async()=>{try{const t=JSON.parse(e.result),n={...JSON.parse(localStorage.getItem(Ns)||"{}"),...t},o=Object.fromEntries(Object.entries(n).sort((([,e],[,t])=>{const n=e.time.replace(/[[\]]/g,""),o=t.time.replace(/[[\]]/g,""),s=`${e.date} ${n}`,r=`${t.date} ${o}`;return new Date(s)-new Date(r)})));localStorage.setItem(Ns,JSON.stringify(o)),as();const s=is();await E(s)}catch(e){ge({en:"Failed to import messages. The file may be corrupted.",ru:"ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ. Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾, Ñ„Ð°Ð¹Ð» Ð¿Ð¾Ð²Ñ€ÐµÐ¶Ð´ÐµÐ½."},"alert")}},e.readAsText(t)}})),e.click()}));const g=document.createElement("div");g.className="large-button panel-header-export-button",g.innerHTML=nt,kt(g,{en:"Export messages",ru:"Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ"}),g.addEventListener("click",(()=>{const e=localStorage.getItem(Ns);if(e&&"{}"!==e){const t=new Intl.DateTimeFormat("en-CA").format(new Date),n=JSON.parse(e),o=JSON.stringify(n,null,2),s=new Blob([o],{type:"application/json"}),r=document.createElement("a");r.href=URL.createObjectURL(s),r.download=`Personal_Messages_${t}.json`,r.click()}else ge({en:"No messages to export.",ru:"ÐÐµÑ‚ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ Ð´Ð»Ñ ÑÐºÑÐ¿Ð¾Ñ€Ñ‚Ð°."},"alert")}));const h=document.createElement("div");h.className="large-button panel-header-copy-button",h.innerHTML=Xe,kt(h,{en:"\n      [Click] copy messages in BBCode, Markdown, or Plain format\n      [Shift + Click] save messages in BBCode, Markdown, or Plain format\n    ",ru:"\n      [ÐšÐ»Ð¸Ðº] ÑÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð² BBCode, Markdown Ð¸Ð»Ð¸ Plain Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ\n      [Shift + ÐšÐ»Ð¸Ðº] ÑÐ¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð² BBCode, Markdown Ð¸Ð»Ð¸ Plain Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ\n    "}),h.addEventListener("click",(e=>{const t=localStorage.getItem(Ns);if(!t||"{}"===t||0===Object.keys(JSON.parse(t)).length)return void ge({en:"No messages to copy or save.",ru:"ÐÐµÑ‚ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ Ð´Ð»Ñ ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¸Ð»Ð¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ."},"alert");cs(new MouseEvent("click",{altKey:!0,shiftKey:e.shiftKey,bubbles:!0,cancelable:!0}),v,{date:x,isMessagesPanel:!0,includeDateHeaders:!0,includeMessageLinks:!0,prefix:"messages",messages:r}),K(h)}));const f=document.createElement("div");f.className="large-button panel-header-clear-button",kt(f,{en:"Clear personal messages",ru:"ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ Ð»Ð¸Ñ‡Ð½Ñ‹Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ"}),f.innerHTML=Qe,f.addEventListener("click",(()=>{n=!0;const e=JSON.parse(localStorage.getItem(Ns)||"{}");if(0===Object.keys(e).length)return ge({en:"No messages to delete.",ru:"ÐÐµÑ‚ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ Ð´Ð»Ñ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ."},"alert"),void localStorage.setItem("lastParseDate",x);v.innerHTML=null,localStorage.setItem(Ns,JSON.stringify({})),localStorage.setItem("lastParseDate",x),Nt(a,"hide"),It("hide");const t=document.querySelector(".personal-messages-button .total-message-count");t&&(t.textContent="0")}));const y=document.createElement("div");y.className="large-button panel-header-close-button",kt(y,{en:"Close panel",ru:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ð°Ð½ÐµÐ»ÑŒ"}),y.innerHTML=Pe,y.addEventListener("click",(()=>{Nt(a,"hide"),It("hide")})),i.appendChild(l),d.append(u,m,p,g,h,f,y),i.appendChild(d),a.appendChild(i);const v=document.createElement("div");v.className="messages-container messages-search-container",a.appendChild(v);let b=null,w=null,C=0,S=100;const k=[];async function E(e){v.children.length&&v.replaceChildren();const s=document.createDocumentFragment();Object.entries(e).forEach((([,{time:e,date:t,username:n,usernameColor:o,message:r,type:a,userId:i}])=>{if(b!==t){const e=document.createElement("div");e.className="date-item";const n=document.createElement("span");n.className="date-text",n.textContent=t===x?"Today":t;const o=document.createElement("span");o.className="date-emoji",o.textContent=t===x?" â³":" ðŸ“…",e.appendChild(n),e.appendChild(o),e.dataset.date=t,s.appendChild(e),b=t}const l=document.createElement("div");l.className="message-item",l.dataset.type=a;const c=`${t}|${e}|${n}`;l.setAttribute("data-message-key",c),n!==w&&(l.style.marginTop="0.6em",w=n);const d=e.replace(/[\[\]]/g,"").trim(),u=document.createElement("span");u.className="message-time",u.textContent=d,u.style.color=N[a]||"slategray";const m=document.createElement("span");m.className="message-username",m.textContent=n,m.style.color=o,m.dataset.userId=i;const p=document.createElement("span");p.className="message-text",p.innerHTML=r.replace(/:(?=\w*[a-zA-Z])(\w+):/g,((e,t)=>`<img src="/img/smilies/${t}.gif" alt=":${t}:" title=":${t}:" class="smile">`)).replace(/(https?:\/\/[^\s]+)/gi,(e=>`<a href="${e}" target="_blank" rel="noopener noreferrer">${e}</a>`));const g={messageTextElement:p,time:e,username:n,type:a};k.push(g),l.appendChild(u),l.appendChild(m),l.appendChild(p),l.addEventListener("click",(function(e){localStorage.setItem("lastClickedMessage",c)})),s.appendChild(l)})),v.appendChild(s),requestAnimationFrame((()=>{o=!0,Fo("personalMessages"),Go("personalMessages"),fn("personalMessages"),un("personalMessages"),setTimeout((()=>{o=!1,n=!1,new MutationObserver((e=>{n||e.find((e=>"childList"===e.type&&e.removedNodes.length>0))&&"0"===u.style.opacity&&(t=!1,u.style.visibility="visible",u.style.display="flex",u.offsetHeight,u.style.opacity="1",u.style.transition="opacity 0.5s ease")})).observe(v,{childList:!0,subtree:!0});const e=localStorage.getItem("lastClickedMessage");if(e){const t=v.querySelector(`[data-message-key="${e}"]`);t&&(t.classList.add("previous-message"),t.scrollIntoView({block:"center",behavior:"smooth"}))}}),500)})),k.reverse().forEach((async({messageTextElement:e,username:t,type:n})=>{let o=!1;if(C<S){const n=e.textContent;try{const e=await os(n,t,!1);o=Boolean(e),C++,C>=S&&console.log("Reached maximum ping checks limit.")}catch(e){console.error("Error checking for pingable message:",e),o=!1}}e.style.color=o&&"mention"===n?"lightgreen":o&&"private"===n?"lemonchiffon":I[n]||I.default}))}await E(r),document.body.appendChild(a);const{scrollButtonsContainer:$}=Dt(v);a.appendChild($),Nt(a,"show"),It("show"),c.addEventListener("click",(e=>{e.ctrlKey&&(c.value="",c.dispatchEvent(new Event("input",{bubbles:!0})))})),c.addEventListener("input",(()=>{es(c.value)})),requestAnimationFrame((function(){c.focus()})),Ms.handlePersonalMessagesKeydown=e=>{"Escape"===e.key&&(Nt(a,"hide"),It("hide"),document.removeEventListener("keydown",Ms.handlePersonalMessagesKeydown))},document.addEventListener("keydown",Ms.handlePersonalMessagesKeydown),function(e){kt(".message-time",e,(e=>{const t=e.closest(".message-item")?.dataset.type,n=`[Ctrl + Click] Remove all messages starting from ${ss(e.textContent)}`,o=`[Ctrl + ÐšÐ»Ð¸Ðº] Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð²ÑÐµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð½Ð°Ñ‡Ð¸Ð½Ð°Ñ Ñ ${ss(e.textContent)}`;return"private"===t?{en:n,ru:o}:{en:`\n        [Click] Open chatlog at ${ss(e.textContent)}\n        [Shift + Click] Copy chatlogs URL to clipboard\n        ${n}\n      `,ru:`\n        [ÐšÐ»Ð¸Ðº] ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ñ‡Ð°Ñ‚Ð»Ð¾Ð³ Ð² ${ss(e.textContent)}\n        [Shift + ÐšÐ»Ð¸Ðº] Ð¡ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÑÑ‹Ð»ÐºÑƒ Ð½Ð° Ñ‡Ð°Ñ‚Ð»Ð¾Ð³\n        ${o}\n      `}}),!0),kt(".message-username",e,(e=>({en:`\n      [Click] Open ${e.textContent} profile\n      [Ctrl + Click] Remove all messages from ${e.textContent} user\n    `,ru:`\n      [ÐšÐ»Ð¸Ðº] ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»ÑŒ ${e.textContent}\n      [Ctrl + ÐšÐ»Ð¸Ðº] Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð²ÑÐµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ ${e.textContent}\n    `})),!0),kt(".message-text",e,(e=>{const t=e.closest(".message-item")?.dataset.type,n={private:{en:"[Click] Find this message in general chat",ru:"[ÐšÐ»Ð¸Ðº] ÐÐ°Ð¹Ñ‚Ð¸ ÑÑ‚Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð² Ð¾Ð±Ñ‰ÐµÐ¼ Ñ‡Ð°Ñ‚Ðµ"},mention:{en:"[Click] Find this message in general chat or chatlog",ru:"[ÐšÐ»Ð¸Ðº] ÐÐ°Ð¹Ñ‚Ð¸ ÑÑ‚Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð² Ð¾Ð±Ñ‰ÐµÐ¼ Ñ‡Ð°Ñ‚Ðµ Ð¸Ð»Ð¸ Ñ‡Ð°Ñ‚Ð»Ð¾Ð³Ðµ"}};if("private"===t||"mention"===t)return{en:`${n[t].en} [Ctrl + Click] Remove only this message`,ru:`${n[t].ru} [Ctrl + ÐšÐ»Ð¸Ðº] Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÑÑ‚Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ`}}),!0)}(a),Ts(v,Ds)}const js="lastParseDate";function Os(e,t={}){try{return e?JSON.parse(e):t}catch{return t}}function Bs(e,t){const n={},o={};for(const s of e){const e=t[s];n[s]=e?.color||"#808080",o[s]=e?.id||"",e||console.debug(`No cached data found for username: ${s}`)}return{usernameColorCache:n,usernameIdCache:o}}async function Hs(e=x){const t=Date.now(),n=Number(localStorage.getItem(qs))||0;if(t-n<6e4)return void localStorage.setItem(qs,String(t));localStorage.setItem(qs,String(t));const o=Os(localStorage.getItem(Ns)),s=localStorage.getItem(js)||e,r=[];if(s===e)r.push(e);else{new Date(s)>new Date(e)?r.push(e):r.push(...function(e,t){const n=[],o=new Date(e),s=new Date(t);for(;o<=s;)n.push(o.toISOString().split("T")[0]),o.setDate(o.getDate()+1);return n}(s,e))}const a=Math.floor((t-n)/864e5);if(r.length>1&&a>1){if(!ge({en:`You've been absent for ${a} days. Do you want to load personal mentions for the last ${r.length} days? This may take a while.`,ru:`Ð’Ñ‹ Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²Ð¾Ð²Ð°Ð»Ð¸ ${a} Ð´Ð½ÐµÐ¹. Ð–ÐµÐ»Ð°ÐµÑ‚Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ñ ÑƒÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸ÑÐ¼Ð¸ Ð¾ Ð²Ð°Ñ Ð·Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ ${r.length} Ð´Ð½ÐµÐ¹? Ð­Ñ‚Ð¾ Ð¼Ð¾Ð¶ÐµÑ‚ Ð·Ð°Ð½ÑÑ‚ÑŒ Ð½ÐµÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ.`},"confirm"))return}console.log(`Parsing messages for dates: ${r.join(", ")}`);const i=new Set(Object.values(o).map((e=>`${e.date}|${e.message}`))),l=Os(localStorage.getItem(C));let c,d,u,m,p,g={},h={},f=0;r.length>1&&a>1&&(c=document.createElement("div"),c.className="messages-parser-progress-container",d=document.createElement("div"),d.className="messages-parser-date-indicator",u=document.createElement("div"),u.className="messages-parser-progress-bar",m=document.createElement("div"),m.className="messages-parser-progress-bar-inner",m.style.width="0%",u.appendChild(m),p=document.createElement("div"),p.className="messages-parser-progress-label",p.textContent="",c.append(d,u,p),document.body.appendChild(c));let y=0;for(const e of r){let t=0;try{if(c){d.textContent=e;const t=Math.round(y/r.length*100);m.style.width=t+"%",p.textContent=`${y+1} / ${r.length}`}const n=await Co(e);if(!n?.chatlogs?.length)continue;const s=n.chatlogs,a=[...new Set(s.filter((e=>e.username&&"SYSTEM"!==e.username.trim())).map((e=>e.username)))],u=a.filter((e=>!l[e]));if(u.length>0){console.log(`Fetching data for ${u.length} uncached users for date ${e}`);try{const e=await J(u);Object.assign(l,e),localStorage.setItem(C,JSON.stringify(l))}catch(e){console.error("Failed to fetch user data for uncached users:",e)}}const{usernameColorCache:v,usernameIdCache:b}=Bs(a,l);Object.assign(g,v),Object.assign(h,b);for(const n of s)if(n.username&&"SYSTEM"!==n.username&&n.message&&cn(n.message)){const s=`${e}|${n.message}`;if(!i.has(s)){o[`[${n.time}]_${n.username}_${e}`]={time:`[${n.time}]`,date:e,username:n.username,usernameColor:g[n.username]||"#808080",message:n.message,type:"mention",userId:h[n.username]||""},i.add(s),t++,f++}}console.log(`Found ${t} new mentions for ${e}`),r.indexOf(e)<r.length-1&&await new Promise((e=>setTimeout(e,100)))}catch(t){console.error(`Error parsing messages for date ${e}:`,t)}y++}if(c&&(m.style.width="100%",c.remove()),f>0){localStorage.setItem(Ns,JSON.stringify(o));let e=Number(localStorage.getItem("newMessagesCount"))||0;e+=f,localStorage.setItem("newMessagesCount",String(e));const t=document.querySelector(".personal-messages-button .new-message-count");t&&(t.textContent=e,t.style.visibility=e>0?"visible":"hidden",K(t,50,50)),r.length>1&&a>1&&ge({en:`Added ${f} new personal mentions across ${r.length} days!`,ru:`Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾ ${f} Ð½Ð¾Ð²Ñ‹Ñ… Ð»Ð¸Ñ‡Ð½Ñ‹Ñ… ÑƒÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ð¹ Ð·Ð° ${r.length} Ð´Ð½ÐµÐ¹!`},"alert"),console.log(`Added ${f} total new mentions across ${r.length} days`)}localStorage.setItem(js,e)}var Ps=n(324),Fs={};Fs.styleTagTransform=g(),Fs.setAttributes=d(),Fs.insert=l().bind(null,"head"),Fs.domAPI=a(),Fs.insertStyleElement=m();s()(Ps.A,Fs);Ps.A&&Ps.A.locals&&Ps.A.locals;class _s{constructor(){this.selected=new Set,this.isDragging=!1,this.toggleBtn=null,this.init()}init(){this.attachEvents(),this.updateDeletedMessages(),this.renderToggle()}attachEvents(){document.addEventListener("mousedown",(e=>{const t=e.target.closest(".messages-content p");if((2!==e.button||!e.target.closest("a")||!t)&&t&&2===e.button&&t){if(e.target.closest(".time")){const n=Array.from(document.querySelectorAll(".messages-content p")),o=n.indexOf(t);if(-1!==o)if(e.ctrlKey)n.slice(o).forEach((e=>{this.toggleSelect(e,!0,"time-mode"),e.classList.add("time-mode")}));else{const e=t.querySelector(".username");if(e){const t=e.textContent.trim();n.slice(o).forEach((e=>{const n=e.querySelector(".username");n&&n.textContent.trim()===t&&(this.toggleSelect(e,!0,"time-mode"),e.classList.add("time-mode"))}))}}}else if(e.target.closest(".username")){const t=e.target.closest(".username").textContent.trim();document.querySelectorAll(".messages-content p").forEach((e=>{const n=e.querySelector(".username");n&&n.textContent.trim()===t&&(this.toggleSelect(e,!0,"username-mode"),e.classList.add("username-mode"))}))}else this.isDragging=!0,this.toggleSelect(t,!0,"message-mode")}})),document.addEventListener("mouseup",(()=>this.isDragging=!1)),document.addEventListener("mousemove",(e=>{if(!this.isDragging)return;const t=e.target.closest(".messages-content p");t&&this.toggleSelect(t,!0,"message-mode")})),document.addEventListener("contextmenu",(e=>{const t=e.target.closest(".messages-content p");t&&!e.target.closest("a")&&(ue()||(e.preventDefault(),this.showDeleteButton(e,t)))}))}toggleSelect(e,t,n="message-mode"){if(!e)return;if(ue())return;e.classList.toggle("selected-message",t),t?"message-mode"===n&&e.classList.add("message-mode"):e.classList.remove("username-mode","time-mode","message-mode");const o=zs(e);t?this.selected.add(o):this.selected.delete(o)}showDeleteButton(e,t){if(ue())return;const n=document.querySelector(".delete-btn");n&&n.remove();let o="message-mode";t.classList.contains("username-mode")?o="username-mode":t.classList.contains("time-mode")&&(o="time-mode");const s=document.createElement("button");s.className=`delete-btn ${o}`,s.textContent="Delete",document.body.append(s);const{offsetWidth:r,offsetHeight:a}=s;let i;s.remove(),Object.assign(s.style,{position:"fixed",top:e.clientY-a/2+"px",left:e.clientX-r/2+"px"}),s.onclick=()=>{document.querySelectorAll(".selected-message").forEach((e=>{e&&(e.classList.remove("selected-message","username-mode","time-mode","message-mode"),0===e.classList.length&&e.removeAttribute("class"))})),this.storeDeleted([...this.selected]),s.remove(),this.selected.clear(),this.updateDeletedMessages(),this.renderToggle()},s.addEventListener("mouseenter",(()=>{i&&clearTimeout(i)})),s.addEventListener("mouseleave",(()=>{i=setTimeout((()=>{s.remove(),this.clearSelection()}),1e3)})),document.body.append(s)}clearSelection(){document.querySelectorAll(".selected-message").forEach((e=>{e&&(e.classList.remove("selected-message","username-mode","time-mode","message-mode"),0===e.classList.length&&e.removeAttribute("class"))})),this.selected.clear()}storeDeleted(e){const t=new Set(JSON.parse(localStorage.getItem("deletedChatMessagesContent")||"[]"));e.forEach((e=>t.add(e))),localStorage.setItem("deletedChatMessagesContent",JSON.stringify([...t]))}updateDeletedMessages(){const e=new Set(JSON.parse(localStorage.getItem("deletedChatMessagesContent")||"[]")),t=document.querySelectorAll(".messages-content p");0!==t.length&&(t.forEach((t=>{if(!t)return;const n=zs(t);t.classList.remove("shown-message"),t.classList.toggle("hidden-message",e.has(n))})),localStorage.setItem("deletedChatMessagesContent",JSON.stringify([...e])))}renderToggle(){if(!(JSON.parse(localStorage.getItem("deletedChatMessagesContent")||"[]").length>0))return void(this.toggleBtn&&(this.toggleBtn.remove(),this.toggleBtn=null));const e=document.querySelector(".messages-content");e&&(this.toggleBtn||(this.toggleBtn=document.createElement("button"),this.toggleBtn.className="toggle-button toggle-hidden",this.toggleBtn.textContent="Show",this.toggleBtn.onclick=e=>{if(e.ctrlKey)return document.querySelectorAll(".messages-content p").forEach((e=>{e&&e.classList.remove("hidden-message","shown-message")})),localStorage.setItem("deletedChatMessagesContent",JSON.stringify([])),this.selected.clear(),this.updateDeletedMessages(),void this.renderToggle();const t="Show"===this.toggleBtn.textContent,n=JSON.parse(localStorage.getItem("deletedChatMessagesContent")||"[]");document.querySelectorAll(".messages-content p").forEach((e=>{if(!e)return;const o=zs(e);n.includes(o)&&(e.classList.toggle("hidden-message",!t),e.classList.toggle("shown-message",t))})),t?(this.toggleBtn.textContent="Hide",this.toggleBtn.classList.remove("toggle-hidden"),this.toggleBtn.classList.add("toggle-shown")):(this.toggleBtn.textContent="Show",this.toggleBtn.classList.remove("toggle-shown"),this.toggleBtn.classList.add("toggle-hidden"))},e.append(this.toggleBtn)))}}function zs(e){if(!e)return"";const t=e.cloneNode(!0);Array.from(t.querySelectorAll(".time")).forEach((e=>e.remove()));return[t.textContent,[...Array.from(e.querySelectorAll("a")).map((e=>e.href)),...Array.from(e.querySelectorAll("img")).map((e=>e.title.trim())),...Array.from(e.querySelectorAll("iframe")).map((e=>e.src.trim()))].filter(Boolean).join(" ")].filter(Boolean).join(" ")}function Rs(){const e=document.querySelectorAll(".messages-content p");if(0===e.length)return;const t=new Set(Array.from(e).map((e=>zs(e)))),n=new Set(JSON.parse(localStorage.getItem("deletedChatMessagesContent")||"[]"));localStorage.setItem("deletedChatMessagesContent",JSON.stringify([...n].filter((e=>t.has(e)))))}const Us="Ð’Ñ‹ Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÑ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ",Js="Ð¡Ð²ÑÐ·ÑŒ Ñ ÑÐµÑ€Ð²ÐµÑ€Ð¾Ð¼ Ð¿Ð¾Ñ‚ÐµÑ€ÑÐ½Ð°";function Ks(e){if(!e)return null;const t=e.value;return t.includes(Us)?Us:t.includes(Js)?Js:null}function Ys(){const e=document.getElementById("chat-content").querySelectorAll(".messages-content div p"),t="14px",n=Array.from(e).map((e=>({element:e,isSystem:!!e.querySelector(".system-message"),username:(()=>{const t=e.querySelector("span.username span[data-user]");return t?t.textContent.replace(/[<>]/g,""):null})()})));let o=null,s=!1;n.forEach(((e,r)=>{const{element:a,isSystem:i,username:l}=e;if(a.style.marginTop="",a.style.marginBottom="",i)return a.style.marginTop=t,void(a.style.marginBottom=t);if(!l)return;s&&l!==o&&(a.style.marginTop=t);const c=n[r+1];c&&!c.isSystem&&c.username!==l&&(a.style.marginBottom=t),o=l,s=!0}))}if(Z("gamelist")){function aa(e,t,n){if(t.disabled){const o=Ks(t);o===Us?(t.disabled=n.disabled=!1,n.style.setProperty("background-color","rgb(160, 35, 35)","important"),n.style.setProperty("background-image",`url("data:image/svg+xml,${encodeURIComponent(Be)}")`,"important"),n.style.setProperty("background-repeat","no-repeat","important"),n.style.setProperty("background-position","center","important"),n.style.setProperty("color","transparent","important"),t.value=null,console.log("Chat field was blocked, re-enabled.")):o===Js&&(console.log("Lost connection, reloading..."),setTimeout((()=>{window.location.reload()}),e))}}const ia=new MutationObserver((()=>{const{chatField:e,chatSend:t}=oo();aa(5e3,e,t)})),{chatField:la}=oo();la&&ia.observe(la,{attributes:!0,attributeFilter:["disabled"]}),document.addEventListener("visibilitychange",(()=>{if("visible"===document.visibilityState){const{chatField:e,chatSend:t}=oo();aa(1e3,e,t)}}))}function Xs(e){const t=document.querySelector(".chat .messages .text");t&&(Xs._privateInputHandler||(Xs._privateInputHandler=function(e){""===e.target.value&&Xs(!1)}),e?(t.style.setProperty("background-color","hsl(0, 50%, 20%)","important"),t.style.setProperty("color","hsl(0, 50%, 80%)","important"),t.addEventListener("input",Xs._privateInputHandler)):(t.style.removeProperty("background-color"),t.style.removeProperty("color"),t.removeEventListener("input",Xs._privateInputHandler)))}function Vs(e){Vs._lastUserId=Vs._lastUserId??null,Vs._privateMode=Vs._privateMode??!0,Vs._lastUserId!==e?(Vs._privateMode=!0,Vs._lastUserId=e):Vs._privateMode=!Vs._privateMode;const t=document.querySelector(`.name[data-user="${e}"]`).textContent,n=document.querySelector(".messages .text");n.value=Vs._privateMode?`<${t}>`:`${t}, `,n.focus(),n.selectionEnd=n.value.length,Xs(Vs._privateMode)}function Gs(){const{chatHidden:e,chatField:t}=oo();!e&&t&&t.focus()}function Ws(e){console.log("Clicked element:",e.target);const t=e.target.classList.contains("general")?"general":"game";localStorage.setItem("activeChatTab",t)}function Zs(){const{chatField:e}=oo();e.setAttribute("maxlength","1000"),e.addEventListener("paste",(t=>{t.preventDefault();const n=t.clipboardData.getData("text");let o=n;gn(n)&&(o=hn(n));const s=e.selectionStart,r=e.selectionEnd;e.value=e.value.slice(0,s)+o+e.value.slice(r),e.setSelectionRange(s+o.length,s+o.length)})),e.addEventListener("keydown",(t=>{const n=e.value;"Enter"===t.key&&(n.length>300?(t.preventDefault(),async function(e){const t=e.split(" ").reduce(((e,t)=>{const n=e[e.length-1];return(n+" "+t).trim().length>300?[...e,t]:[...e.slice(0,-1),(n+" "+t).trim()]}),[""]),{chatField:n,chatSend:o}=oo(),s=e.length>300;s&&(n.disabled=!0);for(let e=0;e<t.length;e++){const s=t[e];if(n.value=s,console.log(`Sending piece ${e+1}: "${s}" (Length: ${s.length})`),o.click(),e<t.length-1){const e=Math.floor(500*Math.random())+500;console.log(`Waiting for ${e} ms before sending the next piece.`),await new Promise((t=>setTimeout(t,e)))}}s&&(n.disabled=!1)}(n),console.log(`Long message processed: "${n}"`),e.value=""):console.log(`Short message processed: "${n}"`))}))}[...document.querySelectorAll(".general.c, .game.c")].forEach((e=>e.addEventListener("click",Ws))),document.addEventListener("keydown",(e=>{"Tab"===e.key&&(!function(){const{nextChatTab:e,chatField:t,chatHidden:n}=oo();!n&&e&&(e.click(),t?.focus())}(),e.preventDefault())})),(Z("gmid")||Z("gamelist"))&&document.querySelector(".mostright")?.addEventListener("click",(()=>{setTimeout((()=>{document.querySelector("#chat-wrapper.chat-hidden")?(localStorage.setItem("shouldShowPopupMessage","true"),E.isInitializedChat=!1):(requestAnimationFrame((()=>Rs())),Gs(),setTimeout((()=>E.isInitializedChat=!0),3e3),localStorage.setItem("shouldShowPopupMessage","false"))}),300)})),(Z("gmid")||Z("gamelist"))&&document.addEventListener("keydown",(e=>{if(e.ctrlKey&&"Space"===e.code){const e=document.querySelector("#chat-fixed-placeholder"),t="none"===e.style.display;e.style.display=t?"unset":"none",localStorage.setItem("shouldShowPopupMessage",!t),t||(document.querySelector(".popup-messages-container")?.remove(),oo().chatField?.focus())}}));const Qs=[{family:"Montserrat",weights:["100","200","300","400","500","600","700","800","900"]},{family:"Orbitron",weights:["400","500","600","700","800","900"]},{family:"Roboto Mono",weights:["100","200","300","400","500","600","700"]}];async function er(){try{Qs.forEach((e=>{!function(e,t){if(!document.querySelector(`.font-${e.replace(/\s/g,"-")}`)){const n=document.createElement("link");n.rel="stylesheet",n.href=`https://fonts.googleapis.com/css2?family=${e.replace(/\s/g,"+")}:wght@${t.join(";")}&display=swap`,n.classList.add(`font-${e.replace(/\s/g,"-")}`),document.head.appendChild(n)}}(e.family,e.weights)}))}catch(e){console.error("Font loading failed:",e)}}function tr(){const e=document.createElement("div");e.classList.add("empowerment-panel");const t=45,n=15,o=15,s=15;let r={x:null,y:null},a=1;const i=document.createElement("div");i.classList.add("empowerment-panel-move-handle"),i.innerHTML=dt,e.appendChild(i);const l=pe?pe():"en";kt(i,"ru"===l?"[Ð£Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°Ð¹Ñ‚Ðµ] Ð¸ Ð¿ÐµÑ€ÐµÑ‚Ð°ÑÐºÐ¸Ð²Ð°Ð¹Ñ‚Ðµ Ð¿Ð°Ð½ÐµÐ»ÑŒ. [S] â€” Ð¼Ð°ÑÑˆÑ‚Ð°Ð±, [R] â€” ÑÐ±Ñ€Ð¾Ñ.":"[Hold] and drag to move panel. [S] â€” scale, [R] â€” reset.");try{const t=JSON.parse(localStorage.getItem("empowermentPanelState")||"{}");void 0!==t.x&&void 0!==t.y&&(r.x=t.x,r.y=t.y,e.style.left=t.x+"px",e.style.top=t.y+"px"),void 0!==t.scale&&(a=t.scale,e.style.transform=`scale(${t.scale})`,e.style.transformOrigin="0 0")}catch{}document.body.appendChild(e);const c=()=>{if(null===r.x||null===r.y)return;const a=e.getBoundingClientRect(),i=window.innerWidth-a.width-n,l=window.innerHeight-a.height-o,c=Math.max(s,Math.min(r.x,i)),d=Math.max(t,Math.min(r.y,l));c!==r.x||d!==r.y?(e.style.left=c+"px",e.style.top=d+"px"):(e.style.left=r.x+"px",e.style.top=r.y+"px")},d=()=>{r.x=null,r.y=null,a=1,e.style.left="",e.style.top="",e.style.transform="",e.style.transformOrigin="",localStorage.removeItem("empowermentPanelState"),requestAnimationFrame((()=>c()))};requestAnimationFrame((()=>c())),window.addEventListener("resize",c);let u,m,p,g,h=!1,f=!1,y=!1,v=new Set;return document.addEventListener("keydown",(t=>{if(v.add(t.code),!h||f||y)if(h&&f&&"KeyS"===t.code){f=!1,y=!0,p=a,g=window.lastMouseY||0;const t=e.getBoundingClientRect(),n=i.getBoundingClientRect();e.style.transformOrigin=`${n.left+n.width/2-t.left}px ${n.top+n.height/2-t.top}px`}else(h&&y&&"KeyR"===t.code||h&&"KeyR"===t.code)&&d();else{const n=e.getBoundingClientRect(),o=i.getBoundingClientRect();"KeyS"===t.code?(y=!0,p=a,g=window.lastMouseY||0,e.style.transformOrigin=`${o.left+o.width/2-n.left}px ${o.top+o.height/2-n.top}px`):"KeyR"===t.code&&d()}})),document.addEventListener("keyup",(e=>{v.delete(e.code)})),document.addEventListener("mousemove",(e=>{window.lastMouseY=e.clientY})),i.addEventListener("mousedown",(t=>{if(0!==t.button)return;h=!0;const n=e.getBoundingClientRect(),o=i.getBoundingClientRect();if(v.has("KeyS"))y=!0,p=a,g=t.clientY,e.style.transformOrigin=`${o.left+o.width/2-n.left}px ${o.top+o.height/2-n.top}px`;else{if(v.has("KeyR"))return d(),void(h=!1);f=!0,u=t.clientX-n.left,m=t.clientY-n.top}document.body.style.userSelect="none",t.preventDefault()})),document.addEventListener("mousemove",(i=>{if(f){const a=Math.max(s,Math.min(i.clientX-u,window.innerWidth-e.offsetWidth-n)),l=Math.max(t,Math.min(i.clientY-m,window.innerHeight-e.offsetHeight-o));e.style.left=a+"px",e.style.top=l+"px",r.x=a,r.y=l}else if(y){const t=g-i.clientY,n=Math.max(.1,Math.min(3,p+.01*t));a=n,e.style.transform=`scale(${n})`}})),document.addEventListener("mouseup",(e=>{h&&(v.has("KeyR")||!f&&!y||localStorage.setItem("empowermentPanelState",JSON.stringify({x:r.x,y:r.y,scale:a})),h=!1,f=!1,y=!1,document.body.style.userSelect="")})),e}let{fetchedUsers:nr}=E;const{usersToTrack:or,ignored:sr,moderator:rr}=tn;function ar(e){const t={class:"unknown",icon:"â“",color:"#000000"},n={Ð­ÐºÑÑ‚Ñ€Ð°ÐºÐ¸Ð±ÐµÑ€:{class:"extra",icon:"ðŸš€",color:"#06B4E9"},ÐšÐ¸Ð±ÐµÑ€Ð³Ð¾Ð½Ñ‰Ð¸Ðº:{class:"cyber",icon:"ðŸ¤–",color:"#5681ff"},Ð¡ÑƒÐ¿ÐµÑ€Ð¼ÐµÐ½:{class:"superman",icon:"ðŸ‘Š",color:"#B543F5"},ÐœÐ°Ð½ÑŒÑÐº:{class:"maniac",icon:"ðŸ”ª",color:"#DA0543"},Ð“Ð¾Ð½Ñ‰Ð¸Ðº:{class:"racer",icon:"âš¡ï¸ï¸",color:"#FF8C00"},ÐŸÑ€Ð¾Ñ„Ð¸:{class:"profi",icon:"ï¸ðŸ’¼ï¸",color:"#C1AA00"},Ð¢Ð°ÐºÑÐ¸ÑÑ‚:{class:"driver",icon:"ðŸš–ï¸",color:"#2DAB4F"},Ð›ÑŽÐ±Ð¸Ñ‚ÐµÐ»ÑŒ:{class:"amateur",icon:"ðŸ†ï¸",color:"#61B5B3"},ÐÐ¾Ð²Ð¸Ñ‡Ð¾Ðº:{class:"newbie",icon:"ðŸ¥",color:"#AFAFAF"}}[e]||t;return n.class===t.class&&console.log(`Class not found for status title: ${e}. Using default class: ${t.class}`),n}function ir(e,t,n,o,s){const r=nr?.[e]?.avatarTimestamp,a="00"!==r?`/storage/avatars/${e}_big.png?updated=${r}`:"",i=document.createElement("div"),l=ar(t),c=l.class,d=l.color,u=l.icon;i.classList.add(`user${e}`,c);const m=document.createElement("div");if(m.classList.add("avatar"),"00"!==r){const e=document.createElement("img");e.src=a,m.appendChild(e)}else m.style.fontSize="1.8rem",m.innerHTML=oe();const p=document.createElement("a");p.classList.add("name"),p.dataset.user=e,p.textContent=n,p.style.setProperty("color",d,"important");const g=document.createElement("a");g.classList.add("profile");const h=`${u} ${t} - ${o}`;g.setAttribute("data-title",h),g.target="_blank",g.href=`/profile/${e}/`;let f=function(e,t,n){const o="http://www.w3.org/2000/svg",s=20,r=10,a=Math.random().toString(36).substring(2,22),i=n||0!==e?1:.6,l=document.createElementNS(o,"svg");if(Object.entries({width:s,height:s,viewBox:"0 0 20 20",xmlns:o}).forEach((([e,t])=>l.setAttribute(e,t))),l.classList.add("circularProgress"),l.style.pointerEvents="none",n||0===e){if(!n){const e=document.createElementNS(o,"circle");Object.entries({cx:r,cy:r,r:8,fill:"none",stroke:t,"stroke-width":2}).forEach((([t,n])=>e.setAttribute(t,n))),e.classList.add("outerCircle"),l.appendChild(e)}const e=s/24*i,a=r-12*e,c=document.createElementNS(o,"g");c.setAttribute("transform",`translate(${a}, ${a}) scale(${e})`),c.classList.add("closeIconGroup");const d=document.createElementNS(o,"path");Object.entries({d:"M18.364 5.636a1 1 0 0 1 0 1.414L13.414 12l4.95 4.95a1 1 0 0 1-1.414 1.414L12 13.414l-4.95 4.95a1 1 0 0 1-1.414-1.414L10.586 12l-4.95-4.95a1 1 0 0 1 1.414-1.414L12 10.586l4.95-4.95a1 1 0 0 1 1.414 0z",fill:t}).forEach((([e,t])=>d.setAttribute(e,t))),c.appendChild(d),l.appendChild(c)}else{const n=document.createElementNS(o,"defs");n.classList.add("defs");const s=document.createElementNS(o,"clipPath");s.setAttribute("id",`clipInner-${a}`),s.classList.add("clipPath");const i=document.createElementNS(o,"rect");Object.entries({x:2,y:2,width:16,height:0,transform:"rotate(180, 10, 10)"}).forEach((([e,t])=>i.setAttribute(e,t))),i.classList.add("clipRect");const c=document.createElementNS(o,"animate");Object.entries({attributeName:"height",from:0,to:e/100*16,begin:"indefinite",dur:"1s",fill:"freeze",calcMode:"spline",keySplines:"0.4 0 0.2 1",keyTimes:"0;1"}).forEach((([e,t])=>c.setAttribute(e,t))),c.classList.add("animateProfileProgress"),i.appendChild(c),s.appendChild(i),n.appendChild(s),l.appendChild(n);const d=document.createElementNS(o,"circle");Object.entries({cx:r,cy:r,r:8,fill:"none",stroke:t,"stroke-width":2}).forEach((([e,t])=>d.setAttribute(e,t))),d.classList.add("outerCircle"),l.appendChild(d);const u=document.createElementNS(o,"circle");Object.entries({cx:r,cy:r,r:8,fill:t,"clip-path":`url(#clipInner-${a})`}).forEach((([e,t])=>u.setAttribute(e,t))),u.classList.add("innerCircle"),l.appendChild(u)}return l.outerHTML}(function(e){const t=100*Math.floor(e/100);return(e-t)/(t+100-t)*100}(o),d,s);g.innerHTML=f,setTimeout((()=>{const e=g.querySelector(".animateProfileProgress");e&&e.beginElement()}),10),i.appendChild(m),i.appendChild(p),i.appendChild(g);if(or.find((t=>t.id===e&&"thawed"===t.state))){const e=document.createElement("div");e.classList.add("tracked"),e.innerHTML=Ce,i.appendChild(e)}if(sr.includes(n)){const e=document.createElement("div");e.classList.add("ignored"),e.innerHTML=Se,i.appendChild(e)}const y=document.querySelector(`.userlist-content ins.user${e} img[src*="moderator"]`),v=rr.includes(n);if(y||v){const e=document.createElement("div");e.classList.add("moderator"),e.innerHTML=we,i.appendChild(e)}return i}async function lr(e,t){try{const n=document.querySelector(".userlist-content");let o=document.querySelector(".chat-user-list");if(!o){o=document.createElement("div"),o.classList.add("chat-user-list");const e=document.querySelector(".userlist");e&&e.appendChild(o)}const s={};["extra","cyber","superman","maniac","racer","profi","driver","amateur","newbie"].forEach((e=>{const t=o.querySelector(`.rank-group-${e}`);t?s[e]=t:(s[e]=document.createElement("div"),s[e].classList.add(`rank-group-${e}`),o.appendChild(s[e]))}));const r=new Set;for(const o of n.querySelectorAll("ins")){const n=o.querySelector(".name"),a=n.getAttribute("data-user"),i=n.textContent;if(!r.has(a))try{const{rank:n,login:l,registeredDate:c,bestSpeed:d,ratingLevel:u,friends:m,cars:p,avatarTimestamp:g}=await wn(a);nr[a]?(nr[a].rank=n,nr[a].login=l,nr[a].registered=c,nr[a].bestSpeed=d,nr[a].ratingLevel=u,nr[a].friends=m,nr[a].cars=p,nr[a].avatarTimestamp=g):nr[a]={rank:n,login:l,registered:c,bestSpeed:d,ratingLevel:u,friends:m,cars:p,avatarTimestamp:g},e===i&&"enter"===t&&(nr[a].visits=(nr[a].visits||0)+1,nr[a].tracked=or.some((e=>e.id===a)));const{class:h}=ar(n);if(!s[h].querySelector(`.user${a}`)){const e=ir(a,n,i,d,o.classList.contains("revoked"));s[h].appendChild(e),E.isInitializedChat&&Y(e)}r.add(a)}catch(e){console.error(`Error fetching profile summary for user ${a}:`,e)}}o.querySelectorAll('.chat-user-list [class^="user"]').forEach((e=>{const t=e.querySelector(".name").getAttribute("data-user");r.has(t)||e.remove()})),Object.values(s).forEach((e=>[...e.children].sort(((e,t)=>(nr[t.querySelector(".name")?.getAttribute("data-user")]?.bestSpeed||0)-(nr[e.querySelector(".name")?.getAttribute("data-user")]?.bestSpeed||0))).forEach((t=>e.appendChild(t))))),localStorage.setItem("fetchedUsers",JSON.stringify(nr)),function(){const e=document.querySelector(".cache-panel-load-button .cache-user-count");if(!e)return;const t=Object.keys(JSON.parse(localStorage.getItem("fetchedUsers"))||{}).length.toString();t!==e.textContent&&(e.textContent=t,X(e))}(),function(){const e=document.querySelector(".chat-user-list");if(kt(".name,.profile,.tracked,.ignored,.moderator",e,(e=>{if(e.classList.contains("name")){const t=e.textContent||"";return{en:`\n            [Click] Private chat message ${t?`for ${t}`:""}\n            [Repeat Click] General chat message ${t?`for ${t}`:""}\n          `,ru:`\n            [ÐšÐ»Ð¸Ðº] ÐŸÑ€Ð¸Ð²Ð°Ñ‚Ð½Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ ${t?`Ð´Ð»Ñ ${t}`:""}\n            [ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð½Ñ‹Ð¹ ÐºÐ»Ð¸Ðº] Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð² Ð¾Ð±Ñ‰ÐµÐ¼ Ñ‡Ð°Ñ‚Ðµ ${t?`Ð´Ð»Ñ ${t}`:""}\n          `}}if(e.classList.contains("profile")){const t=e.getAttribute("data-title");return{en:`\n            ${t}\n            [Click] to open profile in iframe (summary)\n            [Ctrl + Click] to open profile in iframe (messages)\n            [Ctrl + Shift + Click] to open profile in a new tab (messages)\n          `,ru:`\n            ${t}\n            [ÐšÐ»Ð¸Ðº] Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»ÑŒ Ð² iframe (ÑÐ²Ð¾Ð´ÐºÐ°)\n            [Ctrl + ÐšÐ»Ð¸Ðº] Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»ÑŒ Ð² iframe (ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ)\n            [Ctrl + Shift + ÐšÐ»Ð¸Ðº] Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»ÑŒ Ð² Ð½Ð¾Ð²Ð¾Ð¹ Ð²ÐºÐ»Ð°Ð´ÐºÐµ (ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ)\n          `}}return e.classList.contains("tracked")?{en:"Tracked user",ru:"ÐžÑ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°ÐµÐ¼Ñ‹Ð¹ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ"}:e.classList.contains("ignored")?{en:"Ignored user",ru:"Ð˜Ð³Ð½Ð¾Ñ€Ð¸Ñ€ÑƒÐµÐ¼Ñ‹Ð¹ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ"}:e.classList.contains("moderator")?{en:"Moderator",ru:"ÐœÐ¾Ð´ÐµÑ€Ð°Ñ‚Ð¾Ñ€"}:{en:"",ru:""}}),!0),!e)return void console.warn("Userlist element not found for event delegation");if(e.dataset.delegatedEvents)return;e.addEventListener("click",(function(e){if(e.target.closest(".profile")){e.preventDefault();const t=e.target.closest(".profile").parentElement.querySelector(".name").dataset.user;if(e.ctrlKey&&e.shiftKey){const e=`${y}${b}/messages/${t}/`,n=window.open(e,"_blank");return void(n&&n.focus())}if(e.ctrlKey){return void Ln(`${y}${b}/messages/${t}/`)}Ln(y+t)}else if(e.target.closest(".name")){Vs(e.target.closest(".name").getAttribute("data-user"))}else;})),e.dataset.delegatedEvents="true"}()}catch(e){console.error("Error refreshing user list:",e)}}const cr={extra:"ðŸš€",cyber:"ðŸ¤–",superman:"ðŸ‘Š",maniac:"ðŸ”ª",racer:"âš¡ï¸",profi:"ðŸ’¼",driver:"ðŸš–",amateur:"ðŸ†",newbie:"ðŸ¥"};function dr(e,t=0){const n=document.createElement("div");n.classList.add("participant-count"),n.innerHTML=t.toString(),e&&e.appendChild(n),n.addEventListener("mouseover",(function(){const e=Object.keys(cr).reduce(((e,t)=>{const n=document.getElementsByClassName(t).length;return n>0&&e.push(`${cr[t]}&nbsp;${n}&nbsp;`),e}),[]).join(" ");kt(n,e)}))}let ur,mr,pr=en.voiceSettings.voiceSpeed??1.5,gr=en.voiceSettings.voicePitch??1;function hr(){mr.innerHTML="silence"===ur.id?Le:"beep"===ur.id?Te:Me}function fr(){return{speed:(pr-0)/2.5*100+"%",pitch:(gr-0)/2*100+"%"}}let yr=null,vr=null;function br(e){e.preventDefault();const t=function(e){const t=0===e.button,n=e.ctrlKey||e.metaKey,o=e.altKey;if(!n&&!o)return null;const s=n?"voiceSpeed":"voicePitch",r=t?-.1:.1,a=en.voiceSettings[s],[i,l]="voiceSpeed"===s?[0,S]:[0,2];return r<0&&a<=i||r>0&&a>=l?null:{prop:s,step:r}}(e);if(!t)return;const{prop:n,step:o}=t;xr(n,o),yr=setTimeout((()=>{vr=setInterval((()=>{xr(n,o)||clearInterval(vr)}),100)}),500);const s=()=>{clearTimeout(yr),clearInterval(vr),ur.removeEventListener("mouseup",s),ur.removeEventListener("mouseleave",s)};ur.addEventListener("mouseup",s),ur.addEventListener("mouseleave",s)}function xr(e,t){const n=parseFloat(en.voiceSettings[e]),[o,s]="voiceSpeed"===e?[0,S]:[0,2],r=Math.min(s,Math.max(o,n+t));return n!==r&&(function(e,t){const n=parseFloat(t.toFixed(1));en.voiceSettings[e]=n,"voiceSpeed"===e?pr=n:"voicePitch"===e&&(gr=n);localStorage.setItem("KG_Chat_Empowerment",JSON.stringify(en)),function(){let e=document.querySelector(".voice-settings"),t=document.querySelector(".current-voice-speed"),n=document.querySelector(".current-voice-pitch");if(Lt){e||(e=document.createElement("div"),e.classList.add("voice-settings"),ur.appendChild(e),e.offsetWidth,e.style.opacity="1"),n?.remove(),t||(t=document.createElement("span"),t.classList.add("current-voice-speed"),e.appendChild(t));let o=t.querySelector(".voice-value-info")||document.createElement("span");t.querySelector(".voice-value-info")||(o.classList.add("voice-speed","voice-value-info"),t.appendChild(o)),o.innerHTML=pr<=0||pr>=S?Ae:`SPEED ${Number(pr).toFixed(1)}`;let s=t.querySelector(".voice-speed-progress")||document.createElement("span");if(!t.querySelector(".voice-speed-progress")){s.classList.add("voice-speed-progress");const e=document.createElement("span");e.classList.add("voice-speed-progress-fill"),s.appendChild(e),t.appendChild(s)}t.querySelector(".voice-speed-progress-fill").style.width=fr().speed,e.timeoutId&&clearTimeout(e.timeoutId),e.timeoutId=setTimeout((()=>{e.style.opacity="0",setTimeout((()=>e.remove()),500)}),2e3)}else if(Tt){e||(e=document.createElement("div"),e.classList.add("voice-settings"),ur.appendChild(e),e.offsetWidth,e.style.opacity="1"),t?.remove(),n||(n=document.createElement("span"),n.classList.add("current-voice-pitch"),e.appendChild(n));let o=n.querySelector(".voice-value-info")||document.createElement("span");n.querySelector(".voice-value-info")||(o.classList.add("voice-pitch","voice-value-info"),n.appendChild(o)),o.innerHTML=gr<=0||gr>=2?Ae:`PITCH ${gr.toFixed(1)}`;let s=n.querySelector(".voice-pitch-progress")||document.createElement("span");if(!n.querySelector(".voice-pitch-progress")){s.classList.add("voice-pitch-progress");const e=document.createElement("span");e.classList.add("voice-pitch-progress-fill"),s.appendChild(e),n.appendChild(s)}n.querySelector(".voice-pitch-progress-fill").style.width=fr().pitch,e.timeoutId&&clearTimeout(e.timeoutId),e.timeoutId=setTimeout((()=>{e.style.opacity="0",setTimeout((()=>e.remove()),500)}),2e3)}else e?.remove()}()}(e,r),t>0?r<s:r>o)}const wr=new Promise((e=>{const t=window.speechSynthesis;let n=t.getVoices();const o="Microsoft Pavel - Russian (Russia)",s="Microsoft Irina - Russian (Russia)";let r=n.find((e=>e.name===o)),a=n.find((e=>e.name===s));if(r&&a&&0!==n.length){const o=new SpeechSynthesisUtterance;o.lang="ru-RU",o.voice=a,e({synth:t,utterance:o,voices:n,pavelVoice:r,irinaVoice:a})}else t.addEventListener("voiceschanged",(()=>{if(n=t.getVoices(),r=n.find((e=>e.name===o)),a=n.find((e=>e.name===s)),r&&a){const o=new SpeechSynthesisUtterance;o.lang="ru-RU",o.voice=a,e({synth:t,utterance:o,voices:n,pavelVoice:r,irinaVoice:a})}}))}));async function Cr(e,t=t){const n=se("sound","gTTS"),o=await async function(e){return e.replace(/[-âˆ’_]/g," ").replace(/https?:\/\/(?:www\.)?([a-zA-Z0-9.-]+)(\/.*)?/g,((e,t)=>t)).replace(/\s(?=[?!,.:;@])/g,"").replace(/["#$%&'()*+\/<=>[\\\]^`{|}~]/g,"").split(" ").filter(Boolean).join(" ").trim()}(e);if(n){const e=(e=>e.split(/\s+/).reduce(((e,t)=>{const n=/[Ð-Ð¯Ð°-ÑÐÑ‘0-9]/.test(t)?"ru":"en";return e.length&&e[e.length-1].lang===n?e[e.length-1].text+=" "+t:e.push({lang:n,text:t}),e}),[]))(o);try{for(const{lang:t,text:n}of e)await new Promise(((e,o)=>{fetch(`http://127.0.0.1:5000/speak?text=${encodeURIComponent(n)}&lang=${t}`).then((e=>{if(!e.ok)throw new Error(`HTTP ${e.status}`);return e.arrayBuffer()})).then((t=>{const n=new(window.AudioContext||window.webkitAudioContext),s=new Audio(URL.createObjectURL(new Blob([t],{type:"audio/mp3"}))),r=n.createMediaElementSource(s),a=n.createGain();a.gain.value=1.5,r.connect(a),a.connect(n.destination),s.onended=e,s.onerror=o,s.play()})).catch(o)}))}catch(e){console.error("Server TTS failed:",e)}}else await async function(e,t=t){const{synth:n,utterance:o,voice:s}=await wr;return Object.assign(o,{text:e,rate:t,volume:1,pitch:gr,voice:s}),new Promise((e=>{o.onend=e,n.speak(o)}))}(e,t)}const{usersToTrack:Sr}=tn,kr={userEntered:"https://raw.githubusercontent.com/VimiummuimiV/KG_Chat_Empowerment_NPM_Main/main/src/sounds/user-entered.mp3",userLeft:"https://raw.githubusercontent.com/VimiummuimiV/KG_Chat_Empowerment_NPM_Main/main/src/sounds/user-left.mp3",message:"https://raw.githubusercontent.com/VimiummuimiV/KG_Chat_Empowerment_NPM_Main/main/src/sounds/message.mp3",mention:"https://raw.githubusercontent.com/VimiummuimiV/KG_Chat_Empowerment_NPM_Main/main/src/sounds/mention.mp3"},Er=new Map;function $r(){Object.entries(kr).forEach((([e,t])=>{const n=new Audio(t);n.preload="auto",n.volume=1,Er.set(e,n),n.onerror=()=>{console.warn(`Failed to load audio file: ${t}`)}}))}function Lr(e,t=1){const n=Er.get(e);if(!n)return void console.warn(`Audio file not found for key: ${e}`);const o=n.cloneNode();o.volume=t,o.play().catch((e=>{console.warn(`Failed to play audio: ${e.message}`)})),o.onended=()=>{o.remove()}}$r();const Tr={Male:{enter:"Ð·Ð°ÑˆÑ‘Ð»",leave:"Ð²Ñ‹ÑˆÐµÐ»"},Female:{enter:"Ð·Ð°ÑˆÐ»Ð°",leave:"Ð²Ñ‹ÑˆÐ»Ð°"}};const{usersToTrack:Mr}=tn,Nr=oo().userList.general;let Ir=new Map,Ar=0,qr=!1;function Dr(e,t){if(!e)return;const n=t.toString().length;e.textContent=t,e.style.fontSize=Math.max(24-2*(n-1),12)+"px"}const jr=new MutationObserver(te((e=>{e.forEach((e=>{if("childList"===e.type){const t=document.querySelector("#voice, #beep, #silence"),n=t&&"silence"===t.id,o=document.querySelector("#chat-wrapper.chat-hidden"),s=document.querySelector(".participant-count");if(o)return void(s&&(s.style.filter="grayscale(100%)",s.textContent="0"));const r=new Map(Array.from(Nr.children).map((e=>{const t=e.querySelector(".name"),n=t?.getAttribute("data-user"),o=t?.textContent?.trim();return n?[n,{userName:o}]:null})).filter(Boolean));if(!E.isInitializedChat)return;if(!qr)return s&&0===Number(s.textContent)&&function(e,t){let n=0;const o=()=>{if(n<=e){const s=Math.min(n/(e||1),1);Dr(t,n++),t.style.filter=`grayscale(${100-100*s}%)`,setTimeout(o,20)}else X(t),K(t),qr=!0};setTimeout(o,20)}(r.size,s),r.forEach(((e,t)=>Ir.set(t,e))),void setTimeout((()=>{qr=!0}),2e3);let a=[...r].filter((([e])=>!Ir.has(e))).map((([e,t])=>({userId:e,...t}))),i=[...Ir].filter((([e])=>!r.has(e))).map((([e,t])=>({userId:e,userName:t.userName})));Ir=new Map(r);const l=Ir.size;function c(e,t){const{userName:o,userId:s}=e,r=function(e){const t=Mr.find((t=>t.id===e));return t?t.gender:null}(s),a=Mr.some((e=>e.id===s&&"thawed"===e.state));Un(o,"enter"===t?be:xe,"enter"===t),lr(o,t),function(e,t){e&&t?(W[e]=W[e]||{},W[e].actionLog=W[e].actionLog||[],W[e].actionLog.push({type:t,timestamp:re()})):console.error("Missing userId or actionType")}(s,t),!n&&a&&function(e,t,n){if(!se("sound","presence"))return;const o=n||"Male",s=Sr.find((t=>t.name===e)),r="enter"===t?Tr[o].enter:Tr[o].leave;Lr("enter"===t?"userEntered":"userLeft",1),setTimeout((()=>Cr(`${s.pronunciation} ${r}`,pr)),300)}(o,t,r)}l!==Ar&&qr&&s&&(Dr(s,l),s.style.filter=l>0?"none":"grayscale(100%)",X(s)),a.forEach((e=>c(e,"enter"))),i.forEach((e=>c(e,"leave"))),Ar=l}}))}),300));let Or=!1;const Br=new Set;function Hr(e){Br.has(e)||(Br.add(e),Or||(Or=!0,async function(){for(const e of Br)await Cr(e,pr),Br.delete(e);Or=!1}()))}const Pr={};function Fr(){if("true"!==localStorage.getItem("shouldShowPopupMessage"))return;const e=document.querySelector(".messages-content p:last-of-type");if(e){const t=e.querySelector(".time"),n=e.querySelector(".username"),o=Array.from(e.childNodes).map((e=>{if(e.nodeType===Node.TEXT_NODE)return{type:"text",value:e.nodeValue};if(e.nodeType===Node.ELEMENT_NODE){if("a"===e.tagName.toLowerCase()&&e.classList.contains("private"))return{type:"text",value:"ðŸ“¢Â "};if("span"===e.tagName.toLowerCase()&&e.classList.contains("private"))return{type:"text",value:e.textContent};if("img"===e.tagName.toLowerCase())return{type:"img",title:e.getAttribute("title")};if("a"===e.tagName.toLowerCase())return{type:"anchor",href:e.getAttribute("href")}}})).filter(Boolean),s=t.textContent.replace(/[\[\]]/g,""),r=n.textContent.replace(/[<>]/g,"");let a=Pr[r];a||(a=15*Math.floor(24*Math.random()),Pr[r]=a);let i=document.querySelector(".popup-messages-container");if(i||(i=document.createElement("div"),i.classList.add("popup-messages-container"),document.body.appendChild(i)),i.childElementCount>=10){const e=i.firstChild;e.classList.add("fade-out"),setTimeout((()=>{i.removeChild(e)}),300)}const l=document.createElement("div");l.classList.add("popup-chat-message"),l.style.filter=`hue-rotate(${a}deg)`;const c=document.createElement("div");c.classList.add("time-icon"),c.innerHTML=ke;const d=document.createElement("div");d.classList.add("time"),d.textContent=s;const u=document.createElement("div");u.classList.add("user-icon"),u.innerHTML=$e;const m=document.createElement("div");m.classList.add("username"),m.textContent=r;const p=document.createElement("div");p.classList.add("action-icon"),p.innerHTML=Ee;const g=document.createElement("div");g.classList.add("message"),l.appendChild(c),l.appendChild(d),l.appendChild(u),l.appendChild(m),l.appendChild(p),l.appendChild(g),o.forEach((e=>{if("text"===e.type){const t=document.createTextNode(e.value);g.appendChild(t)}else if("img"===e.type){const t=document.createElement("span");t.innerHTML=`&nbsp;${e.title}&nbsp;`,g.appendChild(t)}else if("anchor"===e.type){const t=document.createElement("span");t.innerHTML=`&nbsp;${e.href}&nbsp;`,g.appendChild(t)}})),i.appendChild(l)}}const{ignored:_r}=tn;let zr=[];function Rr(e){if(!e)return!1;const t=e.toLowerCase();return zr.some((e=>t.includes(e.toLowerCase())))}!function(){const e=localStorage.getItem("mentionKeywords"),t=e?JSON.parse(e):[];zr=[v,...t]}();let Ur=!1;const Jr=new MutationObserver((async e=>{if(ce(document.querySelectorAll(".username"),"all"),E.isInitializedChat)for(let t of e)if("childList"===t.type)for(let e of t.addedNodes)if(e.nodeType===Node.ELEMENT_NODE&&"P"===e.tagName){const t=e.querySelector(".username");t&&ce(t,"one");const n=localStorage.getItem("previousMessageText"),o=await pn(),s=o?.messageText||null,r=o?.usernameText||null,a="[ÑˆÐµÐ¿Ñ‡ÐµÑ‚ Ð²Ð°Ð¼]",i=e.querySelector(".room.private"),l=i&&i.textContent.includes(a);if(Ur=Rr(s)||l,le(s)&&(console.log("Ban message detected:",s),new Audio("https://github.com/VimiummuimiV/Sounds/raw/refs/heads/main/Mario_Game_Over.mp3").play()),r&&_r.includes(r)){const t=`from-${ro(r)}`;e.classList.add("ignored-user",t),e.style.display="none";continue}if(s){let t=null;if(/^[^\s,]+,/.test(s)?t=s.split(",")[0].trim():/^[^\s]+ /.test(s)&&(t=s.split(" ")[0].trim()),t&&_r.includes(t)){const n=`to-${ro(t)}`;e.classList.add("ignored-user",n),e.style.display="none";continue}}const c=document.querySelector("#voice, #beep, #silence"),d=c&&"voice"===c.id,u=c&&"beep"===c.id,m=document.querySelector("#every-message, #mention-message"),p=m&&"every-message"===m.id,g=m&&"mention-message"===m.id,h=!se("sound","activity")||"visible"!==document.visibilityState;if(h&&d&&E.isInitializedChat&&s&&s!==n&&(localStorage.setItem("previousMessageText",s),r&&!r.includes(v))){(p||g&&Ur)&&Hr(s)}if(h&&u&&E.isInitializedChat&&s&&s!==n&&(localStorage.setItem("previousMessageText",s),r&&!r.includes(v))){if(p||g&&Ur){Lr(!p||Ur?"mention":"message"),Ur&&(Ur=!1)}}E.isInitializedChat&&(Fo("generalMessages"),Go("generalMessages"),fn("generalMessages"),Ys(),jn("generalMessages",350),Fr(),ie(),io("latest"))}}));const{chatField:Kr,messagesContainer:Yr}=oo();let Xr=null;(Z("gmid")||Z("gamelist"))&&(Xr=document.createElement("div"),Xr.className="length-field-popup",Yr.appendChild(Xr));const Vr=document.createElement("canvas").getContext("2d");let Gr,Wr,Zr,Qr=!1,ea=0;function ta(e){let t;t=e>ea?`${e} ðŸ¡†`:e<ea?`ðŸ¡„ ${e}`:`${e}`,Xr.textContent=t,function(e){if(!Xr)return void console.error("lengthPopup is not defined");let t;if(0===e)t="hsl(200, 20%, 50%)";else if(e>=1&&e<=90)t="hsl(120, 100%, 40%)";else if(e>90&&e<=100){const n=(e-90)/10;t=`hsl(${Math.round(120+-60*n)}, 100%, 40%)`}else if(e>100&&e<=190)t="hsl(60, 100%, 50%)";else if(e>190&&e<=200){const n=(e-190)/10;t=`hsl(${Math.round(60+-30*n)}, 100%, 50%)`}else if(e>200&&e<=250)t="hsl(40, 100%, 50%)";else if(e>250&&e<=300){const n=(e-250)/50;t=`hsl(${Math.round(40+-40*n)}, 100%, 70%)`}else t="hsl(0, 100%, 70%)";Xr.style.color=t}(e),ea=e}function na(e){Qr!==e&&(Xr.classList.toggle("bounce-in",e),Xr.classList.toggle("bounce-out",!e),Qr=e,e||setTimeout((()=>Xr.classList.remove("bounce-out")),500))}function oa(){clearTimeout(Gr),ta(Kr.value.length),function(e){const t=getComputedStyle(Kr);Vr.font=`${t.fontWeight} ${t.fontSize} ${t.fontFamily}`;const n=Vr.measureText(e).width,o=Kr.offsetLeft+n+5,s=Kr.offsetLeft+Kr.offsetWidth-Xr.offsetWidth;Xr.style.left=`${Math.min(o,s)}px`}(Kr.value),na(!0),Gr=setTimeout((()=>na(!1)),1e3)}function sa(e){"Enter"===e.key&&(ta(0),Object.assign(Xr.style,{left:"0px",color:"hsl(200, 20%, 50%)"}),na(!0),Gr=setTimeout((()=>na(!1)),1e3))}function ra(){Zr.innerHTML="every-message"===Wr.id?Ne:Ie}(()=>{if(window.self!==window.top)return;er();const e=tr();if(Z("gmid")||Z("gamelist")){se("elements","counter")&&dr(e),function(){const e=getComputedStyle(document.querySelector(".chat .messages")).backgroundColor,t=document.createElement("style");t.innerHTML=`\n    #chat-general .smile-tab, .chat-user-list {\n      background-color: ${e};\n    }\n  `,document.head.appendChild(t)}()}if((Z("gmid")||Z("gamelist"))&&(function(e){const t={silence:{en:"Do not disturb",ru:"ÐÐµ Ð±ÐµÑÐ¿Ð¾ÐºÐ¾Ð¸Ñ‚ÑŒ"},beep:{en:"Notify with beep signal",ru:"Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÑÑ‚ÑŒ Ð·Ð²ÑƒÐºÐ¾Ð²Ñ‹Ð¼ ÑÐ¸Ð³Ð½Ð°Ð»Ð¾Ð¼"},voice:{en:"Notify with voice API",ru:"Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÑÑ‚ÑŒ Ð³Ð¾Ð»Ð¾ÑÐ¾Ð¼"}};ur=document.createElement("div");const n=en.messageSettings.messageNotificationState||"silence";ur.classList.add("empowerment-button","sound-switcher-button"),ur.id=n,kt(ur,t[n]),mr=document.createElement("span"),mr.classList.add("sound-switcher-icon"),ur.appendChild(mr),e.appendChild(ur),ur.addEventListener("click",(function(){if(!Lt&&!Tt){switch(document.querySelector(".current-voice-speed")?.remove(),document.querySelector(".current-voice-pitch")?.remove(),X(this),this.id){case"silence":this.id="beep",kt(this,t.beep),en.messageSettings.messageNotificationState="beep",en.messageSettings.messageNotificationTitle=t.beep.en;break;case"beep":this.id="voice",kt(this,t.voice),en.messageSettings.messageNotificationState="voice",en.messageSettings.messageNotificationTitle=t.voice.en;break;case"voice":this.id="silence",kt(this,t.silence),en.messageSettings.messageNotificationState="silence",en.messageSettings.messageNotificationTitle=t.silence.en}localStorage.setItem("KG_Chat_Empowerment",JSON.stringify(en)),hr()}})),ur.addEventListener("mousedown",br),ur.addEventListener("contextmenu",(e=>e.preventDefault())),hr()}(e),function(e){const t={"every-message":{en:"Notify about every message",ru:"Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÑÑ‚ÑŒ Ð¾ ÐºÐ°Ð¶Ð´Ð¾Ð¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¸"},"mention-message":{en:"Notify about mention message",ru:"Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÑÑ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸ÑÑ… Ñ ÑƒÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸ÐµÐ¼"}};Wr=document.createElement("div");const n=en.messageSettings.messageModeState||"every-message";Wr.classList.add("empowerment-button","message-mode-button"),Wr.id=n,kt(Wr,t[n]),Zr=document.createElement("span"),Zr.classList.add("message-mode-icon"),Wr.appendChild(Zr),e.appendChild(Wr),Wr.addEventListener("click",(function(){Lt||Tt||(X(this),"every-message"===this.id?(this.id="mention-message",kt(this,t["mention-message"]),en.messageSettings.messageModeState="mention-message",en.messageSettings.messageModeTitle=t["mention-message"].en):(this.id="every-message",kt(this,t["every-message"]),en.messageSettings.messageModeState="every-message",en.messageSettings.messageModeTitle=t["every-message"].en),localStorage.setItem("KG_Chat_Empowerment",JSON.stringify(en)),ra())})),ra()}(e)),function(e){const t=document.createElement("div");t.classList.add("empowerment-button","cache-panel-load-button"),t.style.position="relative",t.style.zIndex="3",t.innerHTML=qe;const n=document.createElement("div");n.className="cache-user-count",n.textContent=Object.keys(JSON.parse(localStorage.getItem("fetchedUsers"))||{}).length,t.appendChild(n),kt(t,{en:"Open Cache",ru:"ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ ÐºÑÑˆ"}),t.addEventListener("click",(()=>{X(t),Vn()})),e.appendChild(t)}(e),function(e){const t=document.createElement("div");t.classList.add("empowerment-button","personal-messages-button"),t.innerHTML=De;const n=document.createElement("div");n.classList.add("message-count","total-message-count");const o=JSON.parse(localStorage.getItem(Ns))||{};n.textContent=Object.keys(o).length,t.appendChild(n);const s=document.createElement("div");s.classList.add("message-count","new-message-count");let r=Number(localStorage.getItem(Is))||(localStorage.setItem(Is,"0"),0);s.textContent=r,s.style.visibility=r>0?"visible":"hidden",t.appendChild(s),kt(t,{en:"Open Messages",ru:"ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ"}),t.addEventListener("click",(function(){X(t),Ds(),Object.keys(JSON.parse(localStorage.getItem(Ns))||{}).length>0&&(localStorage.setItem(Is,"0"),r=0,s.textContent=r)})),e.appendChild(t)}(e),function(e){const t=document.createElement("div");t.classList.add("empowerment-button","chat-logs-button"),t.style.position="relative",t.style.zIndex="1",t.innerHTML=je,kt(t,{en:"Open Chat Logs",ru:"ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð»Ð¾Ð³Ð¸ Ñ‡Ð°Ñ‚Ð°"}),t.addEventListener("click",(async function(){X(t),await Ls()})),e.appendChild(t)}(e),on(e),function(){const e=document.querySelector(".messages-content div");e?Jr.observe(e,{childList:!0,subtree:!0}):console.warn("Messages container not found!")}(),Nr?jr.observe(Nr,{childList:!0}):console.warn("User list not found!"),!Z("gmid")&&!Z("gamelist"))return;const t=new _s;let n=new MutationObserver((()=>{const e=document.querySelector(".messages-content div"),o=document.querySelectorAll(".messages-content div p");document.contains(e)&&(!function(){const e=document.querySelector("#chat-fixed-placeholder");null===localStorage.getItem("shouldShowPopupMessage")&&localStorage.setItem("shouldShowPopupMessage","false");const t=JSON.parse(localStorage.getItem("shouldShowPopupMessage"));e.style.display=t?"none":"unset"}(),o.length>=20&&(n.disconnect(),function(){const{allMessages:e}=oo();e.forEach((e=>{const t=e.querySelector(".username"),n=t?.textContent?.replace(/[<>]/g,"")||null,o=e.textContent||"";if(n&&so.includes(n)){const t=`from-${ro(n)}`;return e.classList.add("ignored-user",t),void(e.style.display="none")}let s=null;if(/^[^\s,]+,/.test(o)?s=o.split(",")[0].trim():/^[^\s]+ /.test(o)&&(s=o.split(" ")[0].trim()),s&&so.includes(s)){const t=`to-${ro(s)}`;return e.classList.add("ignored-user",t),void(e.style.display="none")}so.some((e=>o.includes(e)))&&(so.forEach((t=>{if(o.includes(t)){const n=`to-${ro(t)}`;e.classList.add("ignored-user",n)}})),e.style.display="none")}))}(),io(),Fo("generalMessages"),Go("generalMessages"),fn("generalMessages"),window.location.href.includes("gmid")&&function(){const{activeChatTab:e,chatField:t}=oo();e?.click(),t?.focus()}(),function(){const{chatField:e}=oo();e&&(e.value=localStorage.getItem("inputBackup")||"",e.addEventListener("input",te((()=>{Ks(e)||localStorage.setItem("inputBackup",e.value)}),250)),e.addEventListener("keydown",(e=>{"Enter"===e.key&&localStorage.removeItem("inputBackup")})))}(),un(),Ys(),jn("generalMessages",350),eo(!1,$),lr(),Gs(),t.updateDeletedMessages(),Zs(),Rs(),setTimeout((()=>{Xr&&(Kr.addEventListener("input",oa),Kr.addEventListener("keydown",sa))}),600),setTimeout((()=>E.isInitializedChat=!0),600),Hs(x)))}));n.observe(document,{childList:!0,subtree:!0})})()})();